<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lemon&#39;s blog</title>
  
  <subtitle>æ‰€æœ‰çš„ä¸œè¥¿ä½ éƒ½è¦åšæŒåˆ°æœ€åæ‰çŸ¥é“å€¼ä¸å€¼å¾—</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lemon2well.top/"/>
  <updated>2019-04-13T16:40:59.148Z</updated>
  <id>http://lemon2well.top/</id>
  
  <author>
    <name>lemon</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Runtimeé˜²æ­¢Crash(unrecognized Selector sent to instanceç¯‡)</title>
    <link href="http://lemon2well.top/2019/04/14/iOS%20%E5%BC%80%E5%8F%91/Runtime%E9%98%B2%E6%AD%A2Crash(unrecognized%20Selector%20sent%20to%20instance%E7%AF%87)/"/>
    <id>http://lemon2well.top/2019/04/14/iOS å¼€å‘/Runtimeé˜²æ­¢Crash(unrecognized Selector sent to instanceç¯‡)/</id>
    <published>2019-04-13T16:39:46.000Z</published>
    <updated>2019-04-13T16:40:59.148Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æˆ‘ç›¸ä¿¡å¯¹äºæ‰€æœ‰çš„iOSeræ¥è¯´ï¼Œæœ€ææ€–çš„å°±æ˜¯çº¿ä¸Šçš„crashäº†ã€‚å¯¹äºæœ‰ï¼ˆmeiï¼‰å¼ºè¿«(you)ç—‡ï¼ˆqianï¼‰çš„æˆ‘æ¥è¯´ï¼Œåªè¦ä¸€å‘ç°æœ‰crashï¼Œåªè¦æ¡ä»¶å…è®¸ï¼Œæ— è®ºæ˜¯åœ¨å‡Œæ™¨ä¸‰ç‚¹è¿˜æ˜¯åœ¨æ™šä¸ŠåäºŒç‚¹ï¼Œæˆ‘éƒ½ä¼šç«‹åˆ»æ‹¿å‡ºç”µè„‘æ¥æŸ¥æ‰¾åŸå› çœ‹çœ‹æ˜¯å“ªé‡Œå¯¼è‡´çš„crashã€‚æ‰€ä»¥ä¸ºäº†è®©ç¨‹åºä¸è¦crashï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯é¢„é˜²ï¼Œä¸€ç§æ˜¯è¡¥æ•‘ã€‚</p></blockquote><p>ä»Šå¤©æˆ‘ä»¬çš„é‡ç‚¹æ˜¯é¢„é˜²ï¼Œè‡³äºè¡¥æ•‘æˆ‘åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­æœ‰è¯´è¿‡ï¼Œå¤§ä½“å°±æ˜¯é€šè¿‡ä¸Šä¼ crashå †æ ˆä¿¡æ¯ï¼Œæˆ–è€…é€šè¿‡xcodeæ‹¿åˆ°logï¼Œç„¶åé€šè¿‡ç¬¦å·è¡¨è¿˜åŸå®šä½åˆ°crashçš„ä»£ç ã€‚å…·ä½“çš„å¯ä»¥çœ‹<a href="http://lemon2well.top/2018/08/22/iOS%20å¼€å‘/iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†/">iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†</a></p><a id="more"></a><h3 id="1-crashçš„åŸå› "><a href="#1-crashçš„åŸå› " class="headerlink" title="1. crashçš„åŸå› "></a>1. crashçš„åŸå› </h3><p>æˆ‘ä»¬æœ€å¸¸è§çš„crashçš„åŸå› ä¸å¤–ä¹ä»¥ä¸‹å‡ ç§ï¼š</p><blockquote><ul><li>unrecognized selector sent to instance</li><li>KVO crash</li><li>NSNotification crash</li><li>NSTimer crash</li><li>æ•°ç»„è¶Šç•Œï¼Œå­—å…¸æ’å…¥nil</li><li>å­—ç¬¦ä¸²å¤„ç†crash</li><li>EXC_BAD_ACCESS</li></ul></blockquote><p>unrecognized selector sent to instanceè¿™ä¸ªcrashæˆ‘ç›¸ä¿¡æ‰€æœ‰çš„å¼€å‘è€…éƒ½è§è¿‡ï¼Œè¿™ç§é—®é¢˜ä¸€èˆ¬åœ¨å¼€å‘æˆ–è€…æµ‹è¯•çš„æ—¶å€™å¯ä»¥å‘ç°å¹¶ä¸”å¾ˆå®¹æ˜“å°±ä¿®å¤äº†ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€å¤©ï¼Œæˆ‘ä»¬äº²çˆ±çš„æœåŠ¡ç«¯åŒäº‹ï¼Œæœ¬æ¥æ˜¯è¿”å›ä¸€ä¸ªpersonçš„nameå±æ€§ï¼Œä½†æ˜¯é‚£ä¸ªnameæ˜¯ç©ºçš„ï¼Œåœ¨OCä¸­ï¼Œ<code>nil</code>ä»£è¡¨çš„æ˜¯ç©ºï¼Œä½†æ˜¯æœåŠ¡ç«¯è¿”å›çš„å¯èƒ½æ˜¯ä¸€ä¸ª<code>â€œ&lt;NULL&gt;â€</code>ï¼ŒOCè§£æå‡ºæ¥ä¼šæ˜¯ä¸€ä¸ª<code>NSNull</code>çš„å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä»£ç é‡Œé¢è¿˜æœ‰å¯¹nameå±æ€§åšä¸€äº›å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œä¾‹å¦‚<code>[name subString:]</code>ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™ä¸ªAPPä¼šè‡ªæ€ç»™ä½ çœ‹ã€‚</p><h3 id="2-unrecognized-selectorçš„èƒŒå"><a href="#2-unrecognized-selectorçš„èƒŒå" class="headerlink" title="2. unrecognized selectorçš„èƒŒå"></a>2. unrecognized selectorçš„èƒŒå</h3><p>æ‹¿ä¸Šé¢çš„<code>[name subStringFromIndex:1]</code>æ¥è¯´ï¼Œæˆ‘ä»¬çŸ¥é“OCä¸­çš„è°ƒç”¨æ–¹æ³•ä¸æ˜¯å•çº¯çš„ç›´æ¥è·å–åˆ°æ–¹æ³•å‡½æ•°çš„åœ°å€ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚å…ˆæ”¾ä¸€å¼ å›¾ï¼š</p><p><img src="http://7xqcm1.com1.z0.glb.clouddn.com/message_forwarding.png" alt=""></p><p>ä¸Šé¢æ˜¯æ¶ˆæ¯è½¬å‘çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»Šå¤©é‡ç‚¹è¦è¯´çš„ã€‚</p><p>ä½†æ˜¯å…¶å®åœ¨è¿™å¼ å›¾ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªæ¶ˆæ¯æŸ¥æ‰¾çš„æµç¨‹ï¼Œæ¶ˆæ¯æŸ¥æ‰¾çš„æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><ol><li>å¦‚æœæ˜¯å¯¹è±¡æ–¹æ³•ï¼Œé¦–å…ˆä¼šåœ¨å¯¹è±¡çš„ç¼“å­˜æ–¹æ³•é‡Œé¢æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°åˆ™æ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆï¼Œå»ç±»å¯¹è±¡é‡Œé¢æŸ¥æ‰¾ã€‚</li><li>å¦‚æœç±»å¯¹è±¡é‡Œé¢æ²¡æœ‰æŸ¥æ‰¾åˆ°è¯¥æ–¹æ³•ï¼Œåˆ™ä¼šåœ¨è¯¥ç±»å¯¹è±¡çš„çˆ¶ç±»é‡Œé¢æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾éµå¾ª1ï¼Œ2çš„é¡ºåº</li><li>å¦‚æœä¸€ç›´æŸ¥æ‰¾åˆ°æ ¹ç±»éƒ½æ²¡æœ‰æ‰¾åˆ°è¯¥æ–¹æ³•çš„å®ç°çš„è¯ï¼Œå°±ä¼šå¼€å§‹æ¶ˆæ¯çš„è½¬å‘æµç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾çš„æµç¨‹</li><li>å¦‚æœæ¶ˆæ¯çš„è½¬å‘ä¾ç„¶æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å¤„ç†ï¼Œåˆ™ä¼šcrashã€‚</li></ol></blockquote><h3 id="3-åœ¨å“ªé‡Œåšæ‹¦æˆªå¤„ç†"><a href="#3-åœ¨å“ªé‡Œåšæ‹¦æˆªå¤„ç†" class="headerlink" title="3. åœ¨å“ªé‡Œåšæ‹¦æˆªå¤„ç†"></a>3. åœ¨å“ªé‡Œåšæ‹¦æˆªå¤„ç†</h3><p>å¦‚æœæˆ‘ä»¬è¦é˜²æ­¢ç¨‹åºunrecognized selector crashï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯çš„è½¬å‘æµç¨‹ä¸­åšæ‹¦æˆªå¤„ç†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹runtimeç»™æˆ‘ä»¬æä¾›çš„ä¸‰ä¸ªæ¶ˆæ¯å¤„ç†çš„æ–¹æ³•ã€‚</p><p><code>1. + (BOOL)resolveInstanceMethod:(SEL)sel OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);</code><br><strong><em>è¿™ä¸ªæ˜¯æ¶ˆæ¯è½¬å‘çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆ©ç”¨class_addMethodç»™è¯¥å¯¹è±¡æä¾›ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œç„¶åè¿”å›YESã€‚å¦‚æœè¿”å›äº†NOæˆ–è€…åˆ™ä¼šè°ƒç”¨ä¸‹é¢ç¬¬äºŒä¸ªæ–¹æ³•ã€‚</em></strong></p><p><code>2. - (id)forwardingTargetForSelector:(SEL)aSelector OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);</code><br><strong><em>å½“ç³»ç»Ÿè°ƒç”¨åˆ°è¯¥æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦å¼€å‘è€…è¿”å›ä¸€ä¸ªidå¯¹è±¡ï¼Œå¦‚æœè¿”å›äº†ä¸€ä¸ªénilçš„å¯¹è±¡ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šå°†è¯¥selectorè½¬å‘åˆ°è¯¥å¯¹è±¡ä¸Šå»ï¼Œä¹Ÿå°±æ˜¯ä¼šé‡æ–°å¼€å§‹æ¶ˆæ¯çš„å‘é€æµç¨‹ã€‚å¦‚æœè¿”å›äº†nilæˆ–è€…selfï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸‹é¢çš„ç¬¬ä¸‰æ­¥</em></strong></p><p>`3. - (void)forwardInvocation:(NSInvocation *)anInvocation OBJC_SWIFT_UNAVAILABLE(â€œâ€);</p><ul><li>(NSMethodSignature <em>)methodSignatureForSelector:(SEL)aSelector OBJC_SWIFT_UNAVAILABLE(â€œâ€);`<br>**</em>ç³»ç»Ÿä¼šé¦–å…ˆè°ƒç”¨<code>methodSignatureForSelector</code>æ¥è·å–ä¸€ä¸ªæ–¹æ³•çš„ç­¾åï¼Œå¦‚æœè¿”å›äº†æ–¹æ³•çš„ç­¾ååˆ™ä¼šåˆ›å»ºä¸€ä¸ªNSInvocationå¯¹è±¡å¹¶ä¸”è°ƒç”¨<code>forwardInvocation</code>å°†æ¶ˆæ¯è½¬å‘ç»™ç›®æ ‡å¯¹è±¡ã€‚***</li></ul><p>æ¥ä¸‹æ¥å°±æœ‰ä¸€ä¸ªç–‘é—®äº†ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨å“ªä¸€æ­¥é‡Œé¢æ‹¦æˆªæ¶ˆæ¯ä¼šæ¯”è¾ƒå¥½ã€‚</p><blockquote><ol><li>resolveInstanceMethodæ–¹æ³•éœ€è¦æˆ‘ä»¬ä¸ºè¯¥ç±»æ·»åŠ ä¸€ä¸ªå®ç°ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºæœ¬æ¥é‚£ä¸ªç±»å°±ä¸éœ€è¦æœ‰é‚£ä¸ªæ–¹æ³•ï¼Œæ²¡å¿…è¦ä¸ºäº†é˜²æ­¢crashè€Œç»™å®ƒæ·»åŠ ä¸€ä¸ªå¤šä½™çš„å®ç°ã€‚</li><li>methodSignatureForSelector ä»¥åŠ forwardInvocation è¿™é‡Œçš„å¼€é”€æ¯”è¾ƒå¤§ï¼Œéœ€è¦åˆ›å»ºinvocationå¯¹è±¡å¹¶ä¸”è¿™é‡Œæœ‰å¯èƒ½ä¼šè¢«å¼€å‘è€…è°ƒç”¨è¿›è¡Œæ¶ˆæ¯å¤šé‡è½¬å‘æœºåˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸å¤ªé€‚åˆã€‚</li><li>å‰©ä¸‹çš„å°±åªæœ‰forwardingTargetForSelectoræ–¹æ³•äº†ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦æä¾›ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„ç±»ï¼Œæˆ‘ä»¬æ­£å¥½å¯ä»¥åˆ›å»ºä¸€ä¸ªç”¨äºä¿æŠ¤çš„<code>LMProtecter</code>ç±»ï¼Œåˆ°æ—¶ç”±è¯¥ç±»é‡Œé¢å¤„ç†å°±å¯ä»¥äº†ã€‚</li></ol></blockquote><h3 id="4-æ‹¦æˆªçš„æµç¨‹"><a href="#4-æ‹¦æˆªçš„æµç¨‹" class="headerlink" title="4. æ‹¦æˆªçš„æµç¨‹"></a>4. æ‹¦æˆªçš„æµç¨‹</h3><p>æˆ‘ä»¬æ‹¦æˆªå¤„ç†çš„æµç¨‹å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>åˆ©ç”¨method_swizzleï¼Œåˆ›å»ºä¸€ä¸ªNSObjectçš„åˆ†ç±»åœ¨loadæ–¹æ³•é‡Œé¢æ›¿æ¢åŸæ¥çš„forwardingTargetForSelectorã€‚</li><li>æä¾›ä¸€ä¸ªç™½åå•æœºåˆ¶ï¼Œåªå¯¹ç‰¹å®šçš„ç±»è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚å¸¸è§çš„NSNullæˆ–æˆ–è€…æ˜¯SDKä¸­çš„ç±»ï¼Œé€šè¿‡ç±»å‰ç¼€æ¥åˆ¤æ–­è¯¥ç±»æ˜¯å¦å±äºSDKçš„ç±»ã€‚å¦‚æœæ˜¯ç³»ç»Ÿçš„ç±»ï¼ˆä¸€èˆ¬ä»¥_å¼€å¤´ï¼Œåˆ™ä¸è¿›è¡Œæ‹¦æˆªï¼‰</li><li>åˆ›å»ºä¸€ä¸ªprotectç±»ï¼Œå¹¶ä¸”é‡å†™protectç±»çš„resolveInstanceMethodæ–¹æ³•ï¼Œæä¾›ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå½“æ¶ˆæ¯è½¬å‘ç»™protectç±»çš„æ—¶å€™ï¼Œæ‰§è¡Œé»˜è®¤çš„å®ç°ï¼Œè¯¥æ–¹æ³•ä¼šæœ‰ä¸€ä¸ªè¿”å›å€¼è¿”å›NSNullï¼Œè¿™æ ·å½“æ‰§è¡ŒæŸäº›æœ‰è¿”å›å€¼çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥é¿å…å…¶ä»–çš„å¼‚å¸¸ã€‚ä¸ºä»€ä¹ˆåœ¨è¯¥æ–¹æ³•è¿”å›nulè€Œä¸æ˜¯nilæˆ–è€…å…¶ä»–å¯¹è±¡å‘¢ï¼Œå› ä¸ºè¿”å›NUllæ­£å¥½åœ¨æˆ‘ä»¬çš„ç™½åå•é‡Œé¢è®¾ç½®äº†nullçš„åˆ¤æ–­ï¼Œå¦‚æœè¿”å›nilçš„è¯ï¼Œå¯èƒ½ä¼šå¼•å‘å…¶ä»–çš„ä¾‹å¦‚å°†nilæ’å…¥åˆ°å­—å…¸ä¸­çš„é”™è¯¯ã€‚</li><li>åœ¨è¯¥æ–¹æ³•é‡Œé¢è¿›è¡Œå¼‚å¸¸çš„ä¸ŠæŠ¥ï¼Œä¸‹æ¬¡ç‰ˆæœ¬ä¿®å¤è¯¥é—®é¢˜ã€‚</li></ol><h3 id="5-å…³é”®ä»£ç ï¼š"><a href="#5-å…³é”®ä»£ç ï¼š" class="headerlink" title="5. å…³é”®ä»£ç ï¼š"></a>5. å…³é”®ä»£ç ï¼š</h3><p>åŸç†å’Œæµç¨‹æˆ‘ä»¬éƒ½è¯´äº†ï¼Œæ¥ä¸‹æ¥ä»£ç å®ç°å°±æ¯”è¾ƒç®€å•äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  NSObject+UnrecognizedSelectorProtecter.m</span><br><span class="line">//  UnRecognizedSelectorProtecter</span><br><span class="line">//</span><br><span class="line">//  Created by lemon on 2019/4/12.</span><br><span class="line">//  Copyright Â© 2019å¹´ Lemon. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;NSObject+UnrecognizedSelectorProtecter.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line">#import &quot;LMProtecter.h&quot;</span><br><span class="line"></span><br><span class="line">static id protecter = nil;</span><br><span class="line">static NSString *const ClassPrefix = @&quot;LM&quot;;</span><br><span class="line"></span><br><span class="line">@implementation NSObject (UnrecognizedSelectorProtecter)</span><br><span class="line"></span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        protecter = [[LMProtecter alloc]init];</span><br><span class="line">        swizzleMethod([self class], @selector(forwardingTargetForSelector:), @selector(swizzleForwardingTargetForSelector:));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - instance method</span><br><span class="line">- (id)swizzleForwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line">    //å…ˆæ‰§è¡ŒåŸæ¥çš„é€»è¾‘ï¼Œå¦‚æœå·²ç»å¤–éƒ¨æä¾›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¸è¿›è¡Œå¤„ç†</span><br><span class="line">    id instance = [self swizzleForwardingTargetForSelector:aSelector];</span><br><span class="line">    if (instance) &#123;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">    //åˆ¤æ–­å½“å‰ç±»æ˜¯å¦åœ¨ç™½åå•ä¸­</span><br><span class="line">    BOOL isWhiteList = isWhiteListClass([self class]);</span><br><span class="line">    if (!isWhiteList) &#123;</span><br><span class="line">        //å¦‚æœæ˜¯ç³»ç»Ÿç±»åˆ™ä¸åšå¤„ç†</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!instance) &#123;</span><br><span class="line">        //å°†æ¶ˆæ¯è½¬å‘ç»™procterå¯¹è±¡</span><br><span class="line">        instance = protecter;</span><br><span class="line">    &#125;</span><br><span class="line">    return instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark -  private method</span><br><span class="line">static inline BOOL swizzleMethod(Class aClass,SEL originSelector , SEL swizzleSelector)&#123;</span><br><span class="line">    Method originMethod = class_getInstanceMethod(aClass, originSelector);</span><br><span class="line">    Method swizzleMethod = class_getInstanceMethod(aClass, swizzleSelector);</span><br><span class="line">    </span><br><span class="line">    BOOL isAdded = class_addMethod(aClass, originSelector, method_getImplementation(swizzleMethod), method_getTypeEncoding(swizzleMethod));</span><br><span class="line">    </span><br><span class="line">    if (isAdded) &#123;</span><br><span class="line">        class_replaceMethod(aClass, swizzleSelector, method_getImplementation(originMethod), method_getTypeEncoding(originMethod));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        method_exchangeImplementations(originMethod, swizzleMethod);</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static inline BOOL isWhiteListClass(Class aClass)&#123;</span><br><span class="line">    NSString *classStr = NSStringFromClass(aClass);</span><br><span class="line">    //å¦‚æœæ˜¯ä¸‹åˆ’çº¿å¼€å¤´çš„ä»£è¡¨æ˜¯ç³»ç»Ÿç±»,ä¸å¯¹ç³»ç»Ÿç±»è¿›è¡Œå¤„ç†</span><br><span class="line">    if ([classStr hasPrefix:@&quot;_&quot;]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    //å¦‚æœæ˜¯è‡ªå·±çš„ç±»æˆ–è€…æ˜¯NSNULLåˆ™è¿›è¡Œå¤„ç†</span><br><span class="line">    BOOL isNull = [classStr isEqualToString:NSStringFromClass([NSNull class])];</span><br><span class="line">    BOOL isBusinessCls = [classStr hasPrefix:classStr];</span><br><span class="line">    return isNull || isBusinessCls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  LMProtecter.m</span><br><span class="line">//  UnRecognizedSelectorProtecter</span><br><span class="line">//</span><br><span class="line">//  Created by lemon on 2019/4/12.</span><br><span class="line">//  Copyright Â© 2019å¹´ Lemon. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &quot;LMProtecter.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation LMProtecter</span><br><span class="line"></span><br><span class="line">id protect_method_implementation(id self, SEL _cmd)&#123;</span><br><span class="line">    return [NSNull null];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel&#123;</span><br><span class="line">    //æ¶ˆæ¯ä¼šè½¬å‘åˆ°è¿™é‡Œæ¥ï¼ŒåŠ¨æ€çš„ç»™Selæä¾›ä¸€ä¸ªæ–¹æ³•çš„å®ç°å°±ğŸ‘Œäº†</span><br><span class="line">    class_addMethod([self class], sel, (IMP)protect_method_implementation, &quot;@@:&quot;);</span><br><span class="line">    NSLog(@&quot;æ•è·åˆ°ä¸€ä¸ªunRecognized Selector = %@ å´©æºƒä¿¡æ¯&quot;,NSStringFromSelector(sel));</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//- (id)forwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line">//    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">//&#125;</span><br><span class="line">//</span><br><span class="line">//- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector&#123;</span><br><span class="line">//    return [super methodSignatureForSelector:aSelector];</span><br><span class="line">//&#125;</span><br><span class="line">//</span><br><span class="line">//- (void)forwardInvocation:(NSInvocation *)anInvocation&#123;</span><br><span class="line">//    return [super forwardInvocation:anInvocation];</span><br><span class="line">//&#125;</span><br><span class="line">//</span><br><span class="line">//- (void)doesNotRecognizeSelector:(SEL)aSelector&#123;</span><br><span class="line">//    return [super doesNotRecognizeSelector:aSelector];</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨ä»£ç å·²ç»æ”¾åˆ°gitï¼Œéœ€è¦çš„è‡ªå–ï¼š <a href="https://github.com/codemonkeybulucck/LMProtecter" target="_blank" rel="noopener">LMProtecter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æˆ‘ç›¸ä¿¡å¯¹äºæ‰€æœ‰çš„iOSeræ¥è¯´ï¼Œæœ€ææ€–çš„å°±æ˜¯çº¿ä¸Šçš„crashäº†ã€‚å¯¹äºæœ‰ï¼ˆmeiï¼‰å¼ºè¿«(you)ç—‡ï¼ˆqianï¼‰çš„æˆ‘æ¥è¯´ï¼Œåªè¦ä¸€å‘ç°æœ‰crashï¼Œåªè¦æ¡ä»¶å…è®¸ï¼Œæ— è®ºæ˜¯åœ¨å‡Œæ™¨ä¸‰ç‚¹è¿˜æ˜¯åœ¨æ™šä¸ŠåäºŒç‚¹ï¼Œæˆ‘éƒ½ä¼šç«‹åˆ»æ‹¿å‡ºç”µè„‘æ¥æŸ¥æ‰¾åŸå› çœ‹çœ‹æ˜¯å“ªé‡Œå¯¼è‡´çš„crashã€‚æ‰€ä»¥ä¸ºäº†è®©ç¨‹åºä¸è¦crashï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯é¢„é˜²ï¼Œä¸€ç§æ˜¯è¡¥æ•‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»Šå¤©æˆ‘ä»¬çš„é‡ç‚¹æ˜¯é¢„é˜²ï¼Œè‡³äºè¡¥æ•‘æˆ‘åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­æœ‰è¯´è¿‡ï¼Œå¤§ä½“å°±æ˜¯é€šè¿‡ä¸Šä¼ crashå †æ ˆä¿¡æ¯ï¼Œæˆ–è€…é€šè¿‡xcodeæ‹¿åˆ°logï¼Œç„¶åé€šè¿‡ç¬¦å·è¡¨è¿˜åŸå®šä½åˆ°crashçš„ä»£ç ã€‚å…·ä½“çš„å¯ä»¥çœ‹&lt;a href=&quot;http://lemon2well.top/2018/08/22/iOS%20å¼€å‘/iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†/&quot;&gt;iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>é€†å‘å¾®ä¿¡æ ¹æ®æ‰‹æœºå·ç æœç´¢è”ç³»äººè·å–WXID</title>
    <link href="http://lemon2well.top/2019/04/02/iOS%20%E9%80%86%E5%90%91/%E9%80%86%E5%90%91%E5%BE%AE%E4%BF%A1%E6%A0%B9%E6%8D%AE%E6%89%8B%E6%9C%BA%E5%8F%B7%E7%A0%81%E6%90%9C%E7%B4%A2%E8%81%94%E7%B3%BB%E4%BA%BA%E8%8E%B7%E5%8F%96WXID/"/>
    <id>http://lemon2well.top/2019/04/02/iOS é€†å‘/é€†å‘å¾®ä¿¡æ ¹æ®æ‰‹æœºå·ç æœç´¢è”ç³»äººè·å–WXID/</id>
    <published>2019-04-02T01:43:09.000Z</published>
    <updated>2019-04-04T03:18:14.687Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ®µæ—¶é—´åœ¨å¿™ç€æ–°ç‰ˆæœ¬SDKçš„å¼€å‘ï¼Œä¹Ÿåœ¨å‡†å¤‡æ¢å·¥ä½œçš„äº‹æƒ…ï¼Œè™½ç„¶ç°åœ¨æ˜¯â€œå¯’æ½®â€ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³èµ°å‡ºèˆ’é€‚åŒºï¼Œå»æ„Ÿå—ä¸€ä¸‹æ˜¥å¤©çš„â€œå¯’å†·â€ã€‚ä¹Ÿå¾ˆä¹…æ²¡æœ‰æ¥è§¦é€†å‘æ–¹é¢çš„å·¥ä½œäº†ï¼Œæ˜¨å¤©ä¸€ä¸ªå¤§å­¦åŒå­¦é—®æˆ‘ï¼Œèƒ½ä¸èƒ½é€šè¿‡ä¸€ä¸ªäººçš„æ‰‹æœºå·ä»¥åŠå¾®ä¿¡å·æ‰¾åˆ°é‚£ä¸ªäººå¯¹åº”çš„wxidï¼Œå…¶å®æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹æ‰¾ä¸€ä¸‹ã€‚</p></blockquote><h3 id="1-wxid-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-wxid-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. wxid æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. wxid æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>wxidæ˜¯é¡¾åæ€ä¹‰å°±æ˜¯å¾®ä¿¡çš„IDï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‰‹æœºå·ç åˆšæ³¨å†Œçš„æ—¶å€™ï¼Œå¾®ä¿¡ç»™äºˆç”¨æˆ·çš„ä¸€ä¸ªåˆå§‹åŒ–IDï¼Œè¿™ä¸ªå’Œåé¢çš„å¾®ä¿¡å·å…¶å®æ˜¯åˆ†å¼€çš„ï¼Œç»è¿‡æˆ‘æµ‹è¯•ï¼Œå¦‚æœè®¾ç½®äº†å¾®ä¿¡å·ä¹‹åï¼Œå¯èƒ½åŸå§‹çš„wxidå°±ä¼šè¢«è¦†ç›–ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æ˜¯ä¸ä¼šè¢«è¦†ç›–çš„ï¼Œè¿™ä¸ªå°±ä¸æ¸…æ¥šå¾®ä¿¡æ˜¯æ€ä¹ˆå¤„ç†çš„äº†ã€‚</p><a id="more"></a><h3 id="2-å¼€å§‹wxidçš„å¯»æ‰¾ä¹‹æ—…"><a href="#2-å¼€å§‹wxidçš„å¯»æ‰¾ä¹‹æ—…" class="headerlink" title="2. å¼€å§‹wxidçš„å¯»æ‰¾ä¹‹æ—…"></a>2. å¼€å§‹wxidçš„å¯»æ‰¾ä¹‹æ—…</h3><h4 id="2-1-åˆ†æ"><a href="#2-1-åˆ†æ" class="headerlink" title="2.1 åˆ†æ"></a>2.1 åˆ†æ</h4><p>å½“æˆ‘ä»¬é€šè¿‡æ‰‹æœºå·ç æŸ¥æ‰¾ä¸€ä¸ªäººçš„æ—¶å€™ï¼ŒæŸ¥æ‰¾å‡ºæ¥çš„ç•Œé¢æ˜¯åªä¼šæ˜¾ç¤ºä¸‹é¢çš„ä¿¡æ¯ï¼Œä¸ä¼šæœ‰wxidæˆ–è€…å¾®ä¿¡å·è¿™æ ·çš„ä¿¡æ¯ã€‚</p><p><img src="media/15537420649103/15537427751243.jpg" alt="-w160"></p><p>ä½†æ˜¯ç›´è§‰å‘Šè¯‰æˆ‘ï¼Œæ—¢ç„¶å·²ç»æœå‡ºæ¥è¿™ä¸ªäººï¼Œé‚£ä¹ˆè¿™ä¸ªæ§åˆ¶å™¨é‡Œé¢è‚¯å®šæœ‰ä¸€ä¸ªåŒ…å«è¿™ä¸ªäººä¿¡æ¯çš„å¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹é‚£ä¸ªå¯¹è±¡é‡Œé¢çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå¯èƒ½ä¼šæ‰¾åˆ°æˆ‘æƒ³è¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªå¯¹è±¡çš„æ§åˆ¶å™¨ï¼Œç„¶åçœ‹çœ‹é‡Œé¢æœ‰æ²¡æœ‰ä¸€ä¸ªç±»ä¼¼äºè”ç³»äººä¹‹ç±»çš„å¯¹è±¡ï¼Œç„¶åå†çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡é‡Œé¢çš„å±æ€§ã€‚Letâ€™s do it.</p><h4 id="2-2-æ¢ç©¶"><a href="#2-2-æ¢ç©¶" class="headerlink" title="2.2 æ¢ç©¶"></a>2.2 æ¢ç©¶</h4><blockquote><p>åœ¨æ¢ç©¶ä¹‹å‰å¦‚æœä½ ä¸æ¸…æ¥šLLDB+DebugServerçš„ä½¿ç”¨å¯ä»¥çœ‹<a href="http://lemon2well.top/2018/07/25/iOS%20é€†å‘/LLDB-debugserverçš„ä½¿ç”¨/">è¿™é‡Œ</a></p></blockquote><h4 id="2-3-é¦–å…ˆæ‹¿å‡ºæˆ‘é‚£å°ç¥–ä¼ çš„iPhoneï¼Œè¿ä¸Šæ•°æ®çº¿ï¼Œç„¶åSSHç™»é™†ä¸Šå»ï¼š"><a href="#2-3-é¦–å…ˆæ‹¿å‡ºæˆ‘é‚£å°ç¥–ä¼ çš„iPhoneï¼Œè¿ä¸Šæ•°æ®çº¿ï¼Œç„¶åSSHç™»é™†ä¸Šå»ï¼š" class="headerlink" title="2.3 é¦–å…ˆæ‹¿å‡ºæˆ‘é‚£å°ç¥–ä¼ çš„iPhoneï¼Œè¿ä¸Šæ•°æ®çº¿ï¼Œç„¶åSSHç™»é™†ä¸Šå»ï¼š"></a>2.3 é¦–å…ˆæ‹¿å‡ºæˆ‘é‚£å°ç¥–ä¼ çš„iPhoneï¼Œè¿ä¸Šæ•°æ®çº¿ï¼Œç„¶åSSHç™»é™†ä¸Šå»ï¼š</h4><ul><li>iTermæ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå°†æœ¬åœ°çš„2222ç«¯å£æ˜ å°„åˆ°iPhoneçš„22ç«¯å£</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Last login: Thu Mar 28 11:20:01 on ttys003</span><br><span class="line">LemonsMcBookPro:~ lemon$ tcprelay.py -t 22:2222</span><br><span class="line">Forwarding local port 2222 to remote port 22</span><br></pre></td></tr></table></figure><ul><li>iTermæ‰“å¼€å¦å¤–ä¸€ä¸ªçª—å£ï¼Œé€šè¿‡sshè¿æ¥ä¸Šå»</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LemonsMcBookPro:~ lemon$ ssh root@localhost -p 2222</span><br><span class="line">lemons-iPhone5S:~ root#</span><br></pre></td></tr></table></figure><h4 id="2-4-ç™»é™†ä¸Šå»ä¹‹åï¼Œçœ‹ä¸€ä¸‹å½“å‰å¾®ä¿¡çš„è¿›ç¨‹IDï¼Œç„¶åé€šè¿‡å°†debugserveræŒ‚åˆ°å¾®ä¿¡ä¸Šé¢ï¼Œç„¶åæ¥å—æ¥è‡ªLLDBçš„å‘½ä»¤ï¼Œè¾¾åˆ°åŠ¨æ€è°ƒè¯•å¾®ä¿¡çš„ç›®çš„ã€‚"><a href="#2-4-ç™»é™†ä¸Šå»ä¹‹åï¼Œçœ‹ä¸€ä¸‹å½“å‰å¾®ä¿¡çš„è¿›ç¨‹IDï¼Œç„¶åé€šè¿‡å°†debugserveræŒ‚åˆ°å¾®ä¿¡ä¸Šé¢ï¼Œç„¶åæ¥å—æ¥è‡ªLLDBçš„å‘½ä»¤ï¼Œè¾¾åˆ°åŠ¨æ€è°ƒè¯•å¾®ä¿¡çš„ç›®çš„ã€‚" class="headerlink" title="2.4 ç™»é™†ä¸Šå»ä¹‹åï¼Œçœ‹ä¸€ä¸‹å½“å‰å¾®ä¿¡çš„è¿›ç¨‹IDï¼Œç„¶åé€šè¿‡å°†debugserveræŒ‚åˆ°å¾®ä¿¡ä¸Šé¢ï¼Œç„¶åæ¥å—æ¥è‡ªLLDBçš„å‘½ä»¤ï¼Œè¾¾åˆ°åŠ¨æ€è°ƒè¯•å¾®ä¿¡çš„ç›®çš„ã€‚"></a>2.4 ç™»é™†ä¸Šå»ä¹‹åï¼Œçœ‹ä¸€ä¸‹å½“å‰å¾®ä¿¡çš„è¿›ç¨‹IDï¼Œç„¶åé€šè¿‡å°†debugserveræŒ‚åˆ°å¾®ä¿¡ä¸Šé¢ï¼Œç„¶åæ¥å—æ¥è‡ªLLDBçš„å‘½ä»¤ï¼Œè¾¾åˆ°åŠ¨æ€è°ƒè¯•å¾®ä¿¡çš„ç›®çš„ã€‚</h4><ul><li>å…ˆåœ¨æ‰‹æœºè¿è¡Œå¾®ä¿¡ï¼Œç„¶åæŸ¥æ‰¾å¾®ä¿¡çš„è¿›ç¨‹IDï¼Œç„¶åé€šè¿‡debugserverç›‘å¬æ¥è‡ª1234ç«¯å£çš„æ¶ˆæ¯ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">LemonsMcBookPro:~ lemon$ ssh root@localhost -p 2222</span><br><span class="line">lemons-iPhone5S:~ root# ps -e | grep /var</span><br><span class="line">  632 ??         0:04.03 /usr/libexec/pkd -d/var/db/PlugInKit-Annotations</span><br><span class="line"> 1902 ??         0:11.14 /var/containers/Bundle/Application/2A191819-B0B1-41DB-813A-ED369475D3B9/NewsLite.app/NewsLite</span><br><span class="line"> 1910 ??         0:02.20 /var/containers/Bundle/Application/0841859F-B658-4A66-AB81-6B51C4A04D7B/Chain.app/Chain</span><br><span class="line"> 1991 ??         0:45.40 /var/containers/Bundle/Application/81DE6416-3F32-4C7E-BD0C-ABA1585E77E2/wework.app/wework</span><br><span class="line"> 2612 ??         2:16.97 /var/containers/Bundle/Application/5FE48592-3233-47A2-B933-C2F0CF277F14/WeChat.app/WeChat</span><br><span class="line"> 2721 ??         0:31.45 /var/containers/Bundle/Application/A7E1F925-9859-4C2C-9092-C10B719E604F/AndFetion.app/AndFetion</span><br><span class="line"> 2996 ??         0:04.00 /var/containers/Bundle/Application/06B248D3-61C9-48EC-98BF-A95BEFC782BA/WhatsApp.app/WhatsApp</span><br><span class="line"> 3392 ttys000    0:00.01 grep /var</span><br><span class="line">lemons-iPhone5S:~ root# debugserver *:1234 -a 2612</span><br><span class="line">debugserver-@(#)PROGRAM:debugserver  PROJECT:debugserver-340.3.124</span><br><span class="line"> for arm64.</span><br><span class="line">Attaching to process 2612...</span><br><span class="line">Listening to port 1234 for a connection from *...</span><br></pre></td></tr></table></figure><ul><li>æ­¤æ—¶debugserveræ­£åœ¨ç›‘å¬1234ç«¯å£çš„æ¶ˆæ¯ã€‚æ­¤æ—¶æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡å°†æœ¬åœ°çš„1234ç«¯å£æ˜ å°„åˆ°iPhoneçš„1234ç«¯å£ï¼Œç„¶åè¿æ¥æœ¬åœ°çš„1234ç«¯å£ã€‚<br>iTerm æ‰“å¼€ä¸€ä¸ªæ–°çª—å£</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Last login: Thu Mar 28 11:20:24 on ttys003</span><br><span class="line">LemonsMcBookPro:~ lemon$ tcprelay.py -t 1234:1234</span><br><span class="line">Forwarding local port 1234 to remote port 1234</span><br><span class="line">Incoming connection to 1234</span><br><span class="line">Waiting for devices...</span><br></pre></td></tr></table></figure><p>  iTerm æ‰“å¼€ä¸€ä¸ªæ–°çª—å£</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Last login: Thu Mar 28 11:31:52 on ttys005</span><br><span class="line">LemonsMcBookPro:~ lemon$ lldb</span><br><span class="line">(lldb) process connect connect://localhost:1234</span><br><span class="line">Process 2612 stopped</span><br><span class="line">* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = signal SIGSTOP</span><br><span class="line">    frame #0: 0x00000001819b0fd8 libsystem_kernel.dylib`mach_msg_trap + 8</span><br><span class="line">libsystem_kernel.dylib`mach_msg_trap:</span><br><span class="line">-&gt;  0x1819b0fd8 &lt;+8&gt;: ret</span><br><span class="line"></span><br><span class="line">libsystem_kernel.dylib`mach_msg_overwrite_trap:</span><br><span class="line">    0x1819b0fdc &lt;+0&gt;: mov    x16, #-0x20</span><br><span class="line">    0x1819b0fe0 &lt;+4&gt;: svc    #0x80</span><br><span class="line">    0x1819b0fe4 &lt;+8&gt;: ret</span><br><span class="line">Target 0: (WeChat) stopped.</span><br><span class="line">(lldb)</span><br></pre></td></tr></table></figure><ul><li>æ­¤æ—¶å¾®ä¿¡çš„è¿›ç¨‹å·²ç»åœæ­¢äº†ï¼Œå¹¶ä¸”æ­£åœ¨ç­‰å¾…æˆ‘ä»¬çš„å‘½ä»¤ã€‚æˆ‘ä»¬å…ˆè¾“å…¥<strong>c</strong>è®©è¿›ç¨‹ç»§ç»­ã€‚(è¿™æ˜¯LLDBçš„åŸºç¡€å‘½ä»¤ï¼Œcä»£è¡¨continue)</li></ul><h4 id="2-5-æ‰“å¼€ç›®æ ‡ç•Œé¢ï¼ŒæŸ¥æ‰¾ç›®æ ‡å¯¹è±¡"><a href="#2-5-æ‰“å¼€ç›®æ ‡ç•Œé¢ï¼ŒæŸ¥æ‰¾ç›®æ ‡å¯¹è±¡" class="headerlink" title="2.5 æ‰“å¼€ç›®æ ‡ç•Œé¢ï¼ŒæŸ¥æ‰¾ç›®æ ‡å¯¹è±¡"></a>2.5 æ‰“å¼€ç›®æ ‡ç•Œé¢ï¼ŒæŸ¥æ‰¾ç›®æ ‡å¯¹è±¡</h4><ul><li><p>ä¸Šé¢æˆ‘ä»¬å·²ç»å°†LLDBæŒ‚åˆ°å¾®ä¿¡ä¸Šé¢äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæœç´¢ä¸€ä¸ªæ‰‹æœºå·ï¼Œç„¶åå»åˆ°æ·»åŠ è”ç³»äººç•Œé¢ã€‚<br><img src="media/15537420649103/15537443880035.jpg" alt="-w160"></p></li><li><p>æˆ‘ä»¬æœç´¢åˆ°è”ç³»äººä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å½“å‰ç•Œé¢çš„æ§åˆ¶å™¨ã€‚ä¸‹é¢æ˜¯å…³é”®å‘½ä»¤:</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(lldb) process interrupt</span><br><span class="line">(lldb) po [[[UIApplication sharedApplication]keyWindow]recursiveDescription]</span><br><span class="line">&lt;MMUILongPressImageView: 0x140982bf0; baseClass = UIImageView; frame = (3 3; 64 64); opaque = NO; layer = &lt;CALayer: 0x14338b660&gt;&gt;</span><br><span class="line">&lt;UIImageView: 0x14337eb10; frame = (0 0; 70 70); hidden = YES; userInteractionEnabled = NO; layer = &lt;CALayer: 0x14337ecc0&gt;&gt;</span><br><span class="line">&lt;MMCPLabel: 0x1433cf8f0; baseClass = UILabel; frame = (107 0; 88 27); text = &apos;é»˜é»˜ç­‰å¾…&apos;; tag = 90220; gestureRecognizers = &lt;NSArray: 0x143517010&gt;; layer = &lt;_UILabelLayer: 0x1402ac6c0&gt;&gt;</span><br><span class="line">&lt;_UILabelContentLayer: 0x143398ee0&gt; (layer)</span><br><span class="line">&lt;UIView: 0x1433e1600; frame = (304 1.5; 0 24); layer = &lt;CALayer: 0x1433e1520&gt;&gt;</span><br><span class="line">(lldb) po [0x1433cf8f0 nextResponder]</span><br><span class="line">&lt;MMUIButton: 0x143581b10; baseClass = UIButton; frame = (0 0; 320 77); opaque = NO; tag = 90221; layer = &lt;CALayer: 0x14354ff50&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x143581b10 nextResponder]</span><br><span class="line">&lt;UIView: 0x140982a80; frame = (0 0; 320 105); layer = &lt;CALayer: 0x143541d80&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x140982a80 nextResponder]</span><br><span class="line">&lt;WCStoryTableView: 0x13f5f7a00; baseClass = UITableView; frame = (0 0; 320 568); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x143510ee0&gt;; layer = &lt;CALayer: 0x1433f3570&gt;; contentOffset: &#123;0, -64&#125;; contentSize: &#123;320, 504&#125;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x13f5f7a00 nextResponder];</span><br><span class="line">&lt;MMUIButton: 0x1426b1960; baseClass = UIButton; frame = (0 0; 320 1136); opaque = NO; autoresize = W; gestureRecognizers = &lt;NSArray: 0x14315c0c0&gt;; layer = &lt;CALayer: 0x14093f9a0&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x1426b1960 nextResponder]</span><br><span class="line">&lt;UIView: 0x14354d550; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x13ef32f00&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x1426b1960 nextResponder];</span><br><span class="line">&lt;UIView: 0x14354d550; frame = (0 0; 320 568); autoresize = W+H; layer = &lt;CALayer: 0x13ef32f00&gt;&gt;</span><br><span class="line"></span><br><span class="line">(lldb) po [0x14354d550 nextResponder];</span><br><span class="line">&lt;ContactInfoViewController: 0x13fc0c400&gt;</span><br></pre></td></tr></table></figure><blockquote><p><strong>process interrupt</strong>: ä¸­æ–­å½“å‰è¿›ç¨‹<br><strong>[[[UIApplication sharedApplication]keyWindow]recursiveDescription]</strong> : ç­”åº”å½“å‰ç•Œé¢çš„ä¿¡æ¯ï¼Œæ­¤æ—¶ä¼šæ˜¾ç¤ºæ‰€æœ‰çš„ç•Œé¢çš„å…ƒç´ ã€‚</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®åå­—â€œé»˜é»˜ç­‰å¾…â€æ¥æ‰¾åˆ°åˆ°å¯¹åº”çš„Labelï¼Œç„¶åé€šè¿‡è¿™ä¸ªlabelçš„æ‰¾åˆ°å¯¹åº”ViewControllerã€‚ä½¿ç”¨nextResponderä¸€çº§ä¸€çº§çš„æ‰¾åˆ°å¯¹åº”çš„ViewControllerã€‚é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„ViewControlleræ˜¯ContactInfoViewControllerã€‚</p><h4 id="2-6-æ‰“å°å¯¹è±¡å±æ€§ã€‚"><a href="#2-6-æ‰“å°å¯¹è±¡å±æ€§ã€‚" class="headerlink" title="2.6 æ‰“å°å¯¹è±¡å±æ€§ã€‚"></a>2.6 æ‰“å°å¯¹è±¡å±æ€§ã€‚</h4><ul><li>æ‰“å°ContactInfoViewControllerçš„æ‰€æœ‰æˆå‘˜å˜é‡ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po [0x13fc0c400 _ivarDescription]</span><br><span class="line">&lt;ContactInfoViewController: 0x13fc0c400&gt;:</span><br><span class="line">in ContactInfoViewController:</span><br><span class="line">m_uiVerify (unsigned int): 0</span><br><span class="line">m_contact (CContact*): &lt;CSearchedContact: 0x1433b0550&gt;</span><br><span class="line">m_chatContact (CContact*): nil</span><br><span class="line">m_delegate (&lt;contactInfoDelegate&gt;*): nil</span><br><span class="line">m_InfoDelegate (&lt;ContactInfoViewControllerDelegate&gt;*): nil</span><br><span class="line">m_oContactInfoAssist (CBaseContactInfoAssist*): &lt;WeixinContactInfoAssist: 0x14331a240&gt;</span><br><span class="line">m_contactVerifyLogic (CContactVerifyLogic*): nil</span><br><span class="line">m_nsLocation (NSString*): nil</span><br><span class="line">m_bPopToRootWhenDelete (BOOL): &lt;00&gt;</span><br><span class="line">m_uiFromScene (unsigned int): 6</span><br><span class="line">m_wcOperateMode (int): 0</span><br><span class="line">m_popToViewControllerClassWhenDelete (Class): (null)</span><br><span class="line">m_searchScene (int): 0</span><br><span class="line">m_userData (id): nil</span><br><span class="line">m_clickHelper (FavClickStreamHelper*): &lt;FavClickStreamHelper: 0x14260e330&gt;</span><br><span class="line">m_CurrentWidth (double): 320</span><br><span class="line">m_forwardLogic (ForwardMessageLogicController*): nil</span><br><span class="line">_startTime (unsigned int): 1553744360</span><br><span class="line">m_sendVerifylogicVC (SendVerifyMsgLogicController*): nil</span><br><span class="line">_isFullScreenShowStory (BOOL): &lt;00&gt;</span><br><span class="line">_hasStoryData (BOOL): &lt;00&gt;</span><br><span class="line">_canShowStoryView (BOOL): &lt;01&gt;</span><br><span class="line">_isShowingStoryPreview (BOOL): &lt;00&gt;</span><br><span class="line">m_uiAddFriendStatScene (int): 0</span><br><span class="line">_m_qrCodeAddFriendScene (int): 0</span><br><span class="line">_searchFromIndex (unsigned int): 0</span><br><span class="line">_favId (unsigned int): 0</span><br><span class="line">_verifyUserInfoList (NSMutableDictionary*): nil</span><br><span class="line">_searchId (NSString*): nil</span><br><span class="line">_searchKeyword (NSString*): nil</span><br><span class="line">........</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æœ€ä¸Šé¢æœ‰ä¸€ä¸ª<code>m_contact (CContact*): &lt;CSearchedContact: 0x1433b0550&gt;</code>æˆ‘çŒœæµ‹è¿™ä¸ªåº”è¯¥æ˜¯æˆ‘ä»¬æœç´¢å‡ºæ¥çš„å¾®ä¿¡å·ä¿¡æ¯çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€æ‰“å°ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡çœ‹çœ‹ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po [0x1433b0550 _ivarDescription]</span><br><span class="line">&lt;CSearchedContact: 0x1433b0550&gt;:</span><br><span class="line">in CSearchedContact:</span><br><span class="line">matchType (unsigned int): 2</span><br><span class="line">searchString (NSString*): @&quot;18575784615&quot;&lt;__NSCFString: 0x1435838e0&gt;</span><br><span class="line">in CContact:</span><br><span class="line">m_uiChatRoomStatus (unsigned int): 0</span><br><span class="line">m_nsChatRoomMemList (NSString*): nil</span><br><span class="line">m_nsChatRoomAdminList (NSString*): nil</span><br><span class="line">m_uiChatRoomAccessType (unsigned int): 0</span><br><span class="line">m_uiChatRoomMaxCount (unsigned int): 0</span><br><span class="line">m_uiChatRoomVersion (unsigned int): 0</span><br><span class="line">m_ChatRoomDetail (ChatRoomDetail*): nil</span><br><span class="line">m_nsChatRoomData (NSString*): nil</span><br><span class="line">m_ChatRoomData (ChatRoomData*): nil</span><br><span class="line">m_nsCountry (NSString*): @&quot;CN&quot;&lt;NSTaggedPointerString: 0xa00000000004e432&gt;</span><br><span class="line">m_nsProvince (NSString*): @&quot;Anhui&quot;&lt;NSTaggedPointerString: 0xa00006975686e415&gt;</span><br><span class="line">m_nsCity (NSString*): @&quot;Fuyang&quot;&lt;NSTaggedPointerString: 0xa00676e617975466&gt;</span><br><span class="line">m_nsSignature (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_uiCertificationFlag (unsigned int): 0</span><br><span class="line">m_nsCertificationInfo (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_nsOwner (NSString*): nil</span><br><span class="line">m_nsFBNickName (NSString*): nil</span><br><span class="line">m_nsFBID (NSString*): nil</span><br><span class="line">m_uiNeedUpdate (unsigned int): 0</span><br><span class="line">m_nsWCBGImgObjectID (NSString*): @&quot;0&quot;&lt;NSTaggedPointerString: 0xa000000000000301&gt;</span><br><span class="line">m_iWCFlag (int): 0</span><br><span class="line">m_pcWCBGImgID (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_nsExternalInfo (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_nsBrandSubscriptConfigUrl (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_uiBrandSubscriptionSettings (unsigned int): 0</span><br><span class="line">m_subBrandInfo (SubscriptBrandInfo*): &lt;SubscriptBrandInfo: 0x140936fe0&gt;</span><br><span class="line">m_nsBrandIconUrl (NSString*): @&quot;&quot;&lt;__NSCFConstantString: 0x10adaff28&gt;</span><br><span class="line">m_isExtInfoValid (BOOL): &lt;01&gt;</span><br><span class="line">externalInfoJSONCache (NSDictionary*): nil</span><br><span class="line">m_isShowRedDot (BOOL): &lt;00&gt;</span><br><span class="line">m_nsMobileHash (NSString*): nil</span><br><span class="line">m_nsMobileFullHash (NSString*): nil</span><br><span class="line">m_nsLinkedInID (NSString*): nil</span><br><span class="line">m_nsLinkedInName (NSString*): nil</span><br><span class="line">m_nsLinkedInPublicUrl (NSString*): nil</span><br><span class="line">m_uiDeleteFlag (unsigned int): 0</span><br><span class="line">m_nsDescription (NSString*): nil</span><br><span class="line">m_nsCardUrl (NSString*): nil</span><br><span class="line">m_nsWorkID (NSString*): nil</span><br><span class="line">m_nsLabelIDList (NSString*): nil</span><br><span class="line">m_arrPhoneItem (NSArray*): &lt;__NSArrayM: 0x1433d60a0&gt;</span><br><span class="line">m_lockForChatRoomData (NSRecursiveLock*): &lt;NSRecursiveLock: 0x1406dada0&gt;</span><br><span class="line">_appBrandInfo (CAppBrandInfo*): nil</span><br><span class="line">_m_bFromNewDB (BOOL): &lt;01&gt;</span><br><span class="line">_m_hasNewBizMsg (BOOL): &lt;00&gt;</span><br><span class="line">_m_uiLastUpdate (unsigned int): 0</span><br><span class="line">_m_uiMetaFlag (unsigned int): 0</span><br><span class="line">_m_uiDebugModeType (unsigned int): 0</span><br><span class="line">_m_uiWxAppOpt (unsigned int): 0</span><br><span class="line">_uiLastUpdateAppVersionInfoTime (unsigned int): 0</span><br><span class="line">openIMAppid (NSString*): nil</span><br><span class="line">openIMInfo (COpenIMInfo*): nil</span><br><span class="line">_m_dicWeiDianInfo (NSDictionary*): nil</span><br><span class="line">_m_nsWeiDianInfo (NSString*): nil</span><br><span class="line">in CBaseContact:</span><br><span class="line">m_nsUsrName (NSString*): @&quot;v1_81f423f663f69d690124bb98c81aade8c47642dfb41842bb2bdfd85907d912df04b2f31b8f910255577a8cde8dc835d4@stranger&quot;&lt;__NSCFString: 0x1434c5630&gt;</span><br><span class="line">m_nsEncodeUserName (NSString*): nil</span><br><span class="line">m_nsAliasName (NSString*): @&quot;yao1054057455&quot;&lt;__NSCFString: 0x1432f4c60&gt;</span><br><span class="line">m_uiConType (unsigned int): 0</span><br><span class="line">m_nsNickName (NSString*): @&quot;é»˜é»˜ç­‰å¾…&quot;&lt;__NSCFString: 0x1434b18c0&gt;</span><br><span class="line">m_nsFullPY (NSString*): @&quot;wxid0rxnvbwkf1n512132&quot;&lt;__NSCFString: 0x14324d5f0&gt;</span><br><span class="line">m_nsShortPY (NSString*): @&quot;mmdd&quot;&lt;__NSCFString: 0x143526120&gt;</span><br><span class="line">m_nsRemark (NSString*): nil</span><br><span class="line">m_nsRemarkPYShort (NSString*): nil</span><br><span class="line">m_nsRemarkPYFull (NSString*): nil</span><br><span class="line">m_nsDisplayNamePY (NSString*): nil</span><br><span class="line">m_uiSex (unsigned int): 2</span><br><span class="line">m_uiType (unsigned int): 0</span><br><span class="line">m_uiChatState (unsigned int): 0</span><br><span class="line">m_dtUsrImg (NSData*): nil</span><br><span class="line">m_nsImgStatus (NSString*): @&quot;IMG_HAS&quot;&lt;__NSCFConstantString: 0x104085c48&gt;</span><br><span class="line">m_nsHDImgStatus (NSString*): nil</span><br><span class="line">m_nsHeadImgUrl (NSString*): @&quot;http://wx.qlogo.cn/mmhead/ver_1/x0enJ9WJoJ9lSdibxAk8ukuriaLjBphAFdnAfib9pLM6fZXJclib1uyenjSr3fUdVSBOAfdlAAyrs8JhSbbOatpRUTgeqO4ReTkNG9ahRpJJHms/132&quot;&lt;__NSCFString: 0x1426bc500&gt;</span><br><span class="line">m_nsHeadHDImgUrl (NSString*): @&quot;http://wx.qlogo.cn/mmhead/ver_1/x0enJ9WJoJ9lSdibxAk8ukuriaLjBphAFdnAfib9pLM6fZXJclib1uyenjSr3fUdVSBOAfdlAAyrs8JhSbbOatpRUTgeqO4ReTkNG9ahRpJJHms/0&quot;&lt;__NSCFString: 0x14354d710&gt;</span><br><span class="line">m_nsHeadHDMd5 (NSString*): nil</span><br><span class="line">m_nsDraft (NSString*): nil</span><br><span class="line">m_uiDraftTime (unsigned int): 0</span><br><span class="line">m_nsAtUserList (NSString*): nil</span><br><span class="line">m_uiQQUin (unsigned int): 0</span><br><span class="line">m_nsMobileIdentify (NSString*): nil</span><br><span class="line">m_uiFriendScene (unsigned int): 15</span><br><span class="line">m_uiImgKey (unsigned int): 0</span><br><span class="line">m_uiExtKey (unsigned int): 0</span><br><span class="line">m_uiImgKeyAtLastGet (unsigned int): 0</span><br><span class="line">m_uiExtKeyAtLastGet (unsigned int): 0</span><br><span class="line">m_hasDetectPlugin (BOOL): &lt;01&gt;</span><br><span class="line">m_isPlugin (BOOL): &lt;00&gt;</span><br><span class="line">m_hasDetectSelf (BOOL): &lt;01&gt;</span><br><span class="line">m_isSelf (BOOL): &lt;00&gt;</span><br><span class="line">m_nsAntispamTicket (NSString*): @&quot;v2_2e4d1f9deb2d50cec867afc7481db2adc7bf821f79562b66d83225ae2338039a7abd1160dcc4a7122640fb42e0784801@stranger&quot;&lt;__NSCFString: 0x143539fe0&gt;</span><br><span class="line">_externalInfoJSONCache (NSDictionary*): nil</span><br><span class="line">in NSObject:</span><br><span class="line">isa (Class): CSearchedContact (isa, 0x81a104c3d59d)</span><br></pre></td></tr></table></figure><p>ç»“æœæ²¡æœ‰è®©æˆ‘ä»¬å¤±æœ›ï¼Œåˆ°è¿™é‡Œå·²ç»çœ‹åˆ°äº†m_nsFullPYè¿™ä¸ªå±æ€§åŒ…å«çš„å°±æ˜¯wxidã€‚è¿™æ¬¡é€†å‘å¾ˆç®€å•ï¼Œéƒ½æ²¡æœ‰ç”¨åˆ°é™æ€åˆ†æçœ‹æ±‡ç¼–ä»£ç ç­‰æ–¹æ³•ï¼Œç›´æ¥å°±èƒ½å®ç°æˆ‘ä»¬æƒ³åšçš„ã€‚</p><p>æœ€åæœ‰ä¸ªå°tipsï¼Œä¸€èˆ¬é€šè¿‡wxidæ˜¯åŠ ä¸äº†å¥½å‹çš„ï¼Œä½†æ˜¯åœ¨wxidå‰é¢åŠ å‡ ä¸ªæ±‰å­—å¯ä»¥æœç´¢åˆ°å¥½å‹å“¦ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™æ®µæ—¶é—´åœ¨å¿™ç€æ–°ç‰ˆæœ¬SDKçš„å¼€å‘ï¼Œä¹Ÿåœ¨å‡†å¤‡æ¢å·¥ä½œçš„äº‹æƒ…ï¼Œè™½ç„¶ç°åœ¨æ˜¯â€œå¯’æ½®â€ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³èµ°å‡ºèˆ’é€‚åŒºï¼Œå»æ„Ÿå—ä¸€ä¸‹æ˜¥å¤©çš„â€œå¯’å†·â€ã€‚ä¹Ÿå¾ˆä¹…æ²¡æœ‰æ¥è§¦é€†å‘æ–¹é¢çš„å·¥ä½œäº†ï¼Œæ˜¨å¤©ä¸€ä¸ªå¤§å­¦åŒå­¦é—®æˆ‘ï¼Œèƒ½ä¸èƒ½é€šè¿‡ä¸€ä¸ªäººçš„æ‰‹æœºå·ä»¥åŠå¾®ä¿¡å·æ‰¾åˆ°é‚£ä¸ªäººå¯¹åº”çš„wxidï¼Œå…¶å®æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹æ‰¾ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;1-wxid-æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-wxid-æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1. wxid æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;1. wxid æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;&lt;p&gt;wxidæ˜¯é¡¾åæ€ä¹‰å°±æ˜¯å¾®ä¿¡çš„IDï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ‰‹æœºå·ç åˆšæ³¨å†Œçš„æ—¶å€™ï¼Œå¾®ä¿¡ç»™äºˆç”¨æˆ·çš„ä¸€ä¸ªåˆå§‹åŒ–IDï¼Œè¿™ä¸ªå’Œåé¢çš„å¾®ä¿¡å·å…¶å®æ˜¯åˆ†å¼€çš„ï¼Œç»è¿‡æˆ‘æµ‹è¯•ï¼Œå¦‚æœè®¾ç½®äº†å¾®ä¿¡å·ä¹‹åï¼Œå¯èƒ½åŸå§‹çš„wxidå°±ä¼šè¢«è¦†ç›–ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æ˜¯ä¸ä¼šè¢«è¦†ç›–çš„ï¼Œè¿™ä¸ªå°±ä¸æ¸…æ¥šå¾®ä¿¡æ˜¯æ€ä¹ˆå¤„ç†çš„äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS é€†å‘" scheme="http://lemon2well.top/categories/iOS-%E9%80%86%E5%90%91/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSä¸­å¸¸è§çš„å…«ç§é”</title>
    <link href="http://lemon2well.top/2018/10/31/iOS%20%E5%BC%80%E5%8F%91/iOS%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E5%85%AB%E7%A7%8D%E9%94%81/"/>
    <id>http://lemon2well.top/2018/10/31/iOS å¼€å‘/iOSä¸­å¸¸è§çš„å…«ç§é”/</id>
    <published>2018-10-31T03:19:26.000Z</published>
    <updated>2018-10-31T03:19:52.617Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦é”"><a href="#ä¸ºä»€ä¹ˆéœ€è¦é”" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦é”"></a>ä¸ºä»€ä¹ˆéœ€è¦é”</h2><p>åœ¨iOSä¸­ç›¸ä¿¡å¤§å®¶éƒ½ç”¨è¿‡å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¸¦æ¥çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹å¤šçº¿ç¨‹æœ‰å¯èƒ½å¸¦æ¥çš„é—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼Œæˆ‘ä»¬æœ‰ä¸¤æ¡çº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼ŒAçº¿ç¨‹åšçš„äº‹æƒ…æ˜¯ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¹‹åè¯»å–è¿™ä¸ªå¯¹è±¡çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™Bçº¿ç¨‹å¯èƒ½ä¹Ÿåœ¨ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™æœ‰ä¸¤ç§æƒ…å†µï¼ˆå–å†³äºBçº¿ç¨‹ä¿®æ”¹å¯¹è±¡çš„æ—¶æœºï¼‰ï¼š</p><blockquote><ol><li>æ­£å¸¸çš„æƒ…å†µï¼ŒAçº¿ç¨‹ä¿®æ”¹å¯¹è±¡ä»¥åŠè¯»å–å¯¹è±¡ä¹‹åï¼ŒBçº¿ç¨‹æ‰å¼€å§‹ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚</li><li>å¼‚å¸¸çš„æƒ…å†µï¼ŒAçº¿ç¨‹ä¿®æ”¹å¯¹è±¡ä¹‹åï¼ŒBçº¿ç¨‹ç«‹åˆ»ä¿®æ”¹äº†è¿™ä¸ªå¸ä¹¡ï¼Œç„¶åAçº¿ç¨‹è¯»å–å¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™Açº¿ç¨‹è¯»å–åˆ°çš„æ•°æ®å°±å‡ºé”™äº†ã€‚</li></ol></blockquote><p>è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Data raceï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨è®¿é—®ä¿®æ”¹åŒä¸€ä¸ªå—å†…å­˜çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚</p><a id="more"></a><p>åŸºäºä¸Šé¢çš„å‰æï¼Œæˆ‘ä»¬åœ¨å‡ºç°äº†ç”¨<code>é”</code>æ¥è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯´è¯´iOSä¸­çš„é”ã€‚</p><p>åœ¨ibiremeå†™çš„<a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/" target="_blank" rel="noopener">ä¸å†å®‰å…¨çš„OSSpinLock</a>ä¸­ç»™å‡ºäº†å¸¸ç”¨çš„é”çš„æ€§èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15407991692950.png" alt=""></p><p>åœ¨è§£é‡Šä¸‹é¢çš„é”ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´è¯´ä¸¤ç§ç±»å‹çš„é”ï¼Œä¸€ç§æ˜¯è‡ªæ—‹é”ï¼Œä¸€ç§æ˜¯äº’æ–¥é”ã€‚</p><h2 id="æŒ‰ç…§åŠŸèƒ½æ¥åŒºåˆ†é”"><a href="#æŒ‰ç…§åŠŸèƒ½æ¥åŒºåˆ†é”" class="headerlink" title="æŒ‰ç…§åŠŸèƒ½æ¥åŒºåˆ†é”"></a>æŒ‰ç…§åŠŸèƒ½æ¥åŒºåˆ†é”</h2><h3 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h3><blockquote><p><code>äº’æ–¥é”</code>æ˜¯ä¸ºäº†ä¿æŠ¤ä¸€ä¸ªä¸´ç•ŒåŒºæˆ–è€…èµ„æºä¸èƒ½åŒæ—¶è¢«å¤šä¸ªå°åŸè®¿é—®ã€‚å½“ä¸´ç•ŒåŒºåŠ ä¸Šäº’æ–¥é”ä»¥åï¼Œå…¶ä»–çš„è°ƒç”¨æ–¹ä¸èƒ½è·å¾—é”ï¼Œåªæœ‰å½“äº’æ–¥é”çš„æŒæœ‰æ–¹é‡Šæ”¾é”ä¹‹åå…¶ä»–è°ƒç”¨æ–¹æ‰èƒ½è·å¾—é”ã€‚<br>å¦‚æœè°ƒç”¨æ–¹åœ¨è·å¾—é”çš„æ—¶å€™å‘ç°<code>äº’æ–¥é”</code>å·²ç»è¢«å…¶ä»–æ–¹æŒæœ‰ï¼Œé‚£ä¹ˆè¯¥è°ƒç”¨æ–¹åªèƒ½è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œè¿™æ ·ä¸ä¼šå ç”¨CPUèµ„æºã€‚ä½†æ˜¯ä¼šæœ‰æ—¶é—´çš„æ¶ˆè€—ï¼Œç³»ç»Ÿçš„è¿è¡Œæ—¶åŸºäºCPUæ—¶é—´è°ƒåº¦çš„ï¼Œæ¯æ¬¡çº¿ç¨‹å¯èƒ½æœ‰100msçš„è¿è¡Œæ—¶é—´ï¼Œé¢‘ç¹çš„CPUåˆ‡æ¢ä¹Ÿä¼šæ¶ˆè€—ä¸€å®šçš„æ—¶é—´ã€‚</p></blockquote><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><blockquote><p><code>è‡ªæ—‹é”</code>å’Œäº’æ–¥é”ç›¸ä¼¼ï¼Œä½†æ˜¯è‡ªæ—‹é”ä¸ä¼šå¼•èµ·ä¼‘çœ ,å½“è‡ªæ—‹é”è¢«åˆ«çš„çº¿ç¨‹é”å®šçš„æ—¶å€™ï¼Œé‚£ä¹ˆè°ƒç”¨æ–¹ä¼šä¸€ç›´å¤„äºç­‰å¾…çš„çŠ¶æ€ï¼Œç”¨ä¸€ç§ç”Ÿæ´»åŒ–çš„ä¾‹å­æ¥è¯´å°±åƒæ˜¯ä¸Šå•æ‰€ï¼Œå½“ä½ è¦ä¸Šå•æ‰€å‘ç°é‡Œé¢å·²ç»æœ‰äººçš„æ—¶å€™ï¼Œä½ å°±ä¼šä¸€ç›´ç­‰åœ¨å¤–é¢ï¼Œç›´åˆ°ä»–å‡ºæ¥ä½ å°±ç«‹åˆ»æŠ¢å å•æ‰€ã€‚<br>ç”±äºè°ƒç”¨æ–¹ä¼šä¸€ç›´å¾ªç¯çœ‹è¯¥è‡ªæ—‹é”çš„çš„ä¿æŒè€…æ˜¯å¦å·²ç»é‡Šæ”¾äº†èµ„æºï¼Œæ‰€ä»¥æ€»çš„æ•ˆç‡æ¥è¯´æ¯”äº’æ–¥é”é«˜ã€‚ä½†æ˜¯è‡ªæ—‹é”åªç”¨äºçŸ­æ—¶é—´çš„èµ„æºè®¿é—®ï¼Œå¦‚æœä¸èƒ½çŸ­æ—¶é—´å†…è·å¾—é”ï¼Œå°±ä¼šä¸€ç›´å ç”¨ç€CPUï¼Œé€ æˆæ•ˆç‡ä½ä¸‹ã€‚</p></blockquote><h2 id="å¸¸è§çš„é”çš„ç±»å‹"><a href="#å¸¸è§çš„é”çš„ç±»å‹" class="headerlink" title="å¸¸è§çš„é”çš„ç±»å‹"></a>å¸¸è§çš„é”çš„ç±»å‹</h2><h3 id="OSSpinLock"><a href="#OSSpinLock" class="headerlink" title="OSSpinLock"></a>OSSpinLock</h3><p><code>OSSpinLock</code>æ˜¯è‡ªæ—‹é”ï¼Œä¹Ÿæ­£æ˜¯ç”±äºå®ƒæ˜¯è‡ªæ—‹é”ï¼Œæ‰€ä»¥å®¹æ˜“å‘ç”Ÿä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ã€‚åœ¨ibiremeçš„æ–‡ç« ä¸­å·²ç»å†™åˆ°ï¼Œå½“ä¸€ä¸ªä½ä¼˜å…ˆçº§çº¿ç¨‹è·å¾—é”çš„æ—¶å€™ï¼Œå¦‚æœæ­¤æ—¶ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„ç³»ç»Ÿåˆ°æ¥ï¼Œé‚£ä¹ˆä¼šè¿›å…¥å¿™ç­‰çŠ¶æ€ï¼Œä¸ä¼šè¿›å…¥ç¡çœ ï¼Œæ­¤æ—¶ä¼šä¸€ç›´å ç”¨ç€ç³»ç»ŸCPUæ—¶é—´ï¼Œå¯¼è‡´ä½ä¼˜å…ˆçº§çš„æ— æ³•æ‹¿åˆ°CPUæ—¶é—´ç‰‡ï¼Œä»è€Œæ— æ³•å®Œæˆä»»åŠ¡ä¹Ÿæ— æ³•é‡Šæ”¾é”ã€‚é™¤éèƒ½ä¿è¯è®¿é—®é”çš„çº¿ç¨‹å…¨éƒ¨å¤„äºåŒä¸€ä¼˜å…ˆçº§ï¼Œå¦åˆ™ç³»ç»Ÿæ‰€æœ‰çš„è‡ªæ—‹é”éƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ã€‚ç°åœ¨è‹¹æœçš„<code>OSSpinLock</code>å·²ç»è¢«æ›¿æ¢æˆ<code>os_unfair_lock</code><br><code>typedef int32_t OSSpinLock OSSPINLOCK_DEPRECATED_REPLACE_WITH(os_unfair_lock);</code></p><h3 id="dispatch-semaphore"><a href="#dispatch-semaphore" class="headerlink" title="dispatch_semaphore"></a>dispatch_semaphore</h3><p><code>dispatch_semaphore</code>ä¸»è¦æä¾›äº†ä¸‰ä¸ªå‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_create(long value);//åˆ›é€ ä¿¡å·é‡</span><br><span class="line">dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout); //ç­‰å¾…ä¿¡å·</span><br><span class="line">dispatch_semaphore_signal(dispatch_semaphore_t dsema);//å‘é€ä¿¡å·</span><br></pre></td></tr></table></figure><p><code>dispatch_semaphore</code>æ˜¯GCDç”¨æ¥åŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œ<code>dispatch_semephore_create</code>æ–¹æ³•ç”¨æˆ·åˆ›å»ºä¸€ä¸ª<code>dispatch_semephore_t</code>ç±»å‹çš„ä¿¡å·é‡ï¼Œåˆå§‹çš„å‚æ•°å¿…é¡»å¤§äº0ï¼Œè¯¥å‚æ•°ç”¨æ¥è¡¨ç¤ºè¯¥ä¿¡å·é‡æœ‰å¤šå°‘ä¸ªä¿¡å·ï¼Œç®€å•çš„è¯´ä¹Ÿå°±æ˜¯åŒäº‹å…è®¸å¤šå°‘ä¸ªçº¿ç¨‹è®¿é—®ã€‚<br><code>dispatch_semaphore_wait()</code>æ–¹æ³•æ˜¯ç­‰å¾…ä¸€ä¸ªä¿¡å·é‡ï¼Œè¯¥æ–¹æ³•ä¼šåˆ¤æ–­signalçš„ä¿¡å·å€¼æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0åˆ™ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œæ¶ˆè€—ç‚¹ä¸€ä¸ªä¿¡å·å€¼ï¼Œæ‰§è¡Œåç»­ä»»åŠ¡ã€‚å¦‚æœä¿¡å·å€¼ç­‰äº0é‚£ä¹ˆå°±å’ŒNSConditionä¸€æ ·ï¼Œé˜»å¡å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœç­‰å¾…æ—¶é—´æœªè¶…è¿‡timeoutå¹¶ä¸”<code>dispatch_semaphore_signal</code>é‡Šæ”¾äº†äº†ä¸€ä¸ªä¿¡å·å€¼ï¼Œé‚£ä¹ˆå°±ä¼šæ¶ˆè€—æ‰ä¸€ä¸ªä¿¡å·å€¼å¹¶ä¸”å‘ä¸‹æ‰§è¡Œã€‚å¦‚æœæœŸé—´ä¸€ç›´ä¸èƒ½è·å¾—ä¿¡å·é‡å¹¶ä¸”è¶…è¿‡è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨æ‰§è¡Œåç»­è¯­å¥ã€‚</p><h3 id="pthread-mutex"><a href="#pthread-mutex" class="headerlink" title="pthread-mutex"></a>pthread-mutex</h3><blockquote><p><code>pthread-mutex</code>æ˜¯äº’æ–¥é”ï¼Œäº’æ–¥é”ä¸ä¿¡å·é‡çš„æœºåˆ¶éå¸¸ç›¸ä¼¼ï¼Œä¸ä¼šå¤„äºå¿™ç­‰çŠ¶æ€ï¼Œè€Œæ˜¯ä¼šé˜»å¡çº¿ç¨‹å¹¶ä¼‘çœ ã€‚</p></blockquote><p><code>pthread-mutex</code>æä¾›äº†å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int pthread_mutex_init(pthread_mutex_t * __restrict, const pthread_mutexattr_t * __restrict);//åˆå§‹åŒ–é”</span><br><span class="line">int pthread_mutex_lock(pthread_mutex_t *); //åŠ é”</span><br><span class="line">int pthread_mutex_unlock(pthread_mutex_t *); //è§£é”</span><br></pre></td></tr></table></figure><p><code>pthread_mutex_init</code>æ–¹æ³•ç”¨æ¥åˆå§‹åŒ–ä¸€ä¸ªé”ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªpthread_mutex_tçš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®äº’æ–¥é”çš„ç±»å‹ã€‚äº’æ–¥é”æœ‰å››ç§ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PTHREAD_MUTEX_NORMAL : é»˜è®¤å€¼æ™®é€šé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åŠ é”ä»¥åï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥æŒ‰ç…§ä¼˜å…ˆé¡ºåºè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶ä¸”è§£é”çš„æ—¶å€™æŒ‰ç…§å…ˆå…¥å…ˆå‡ºçš„æ–¹å¼è·å¾—é”ã€‚</span><br><span class="line">PTHREAD_MUTEX_ERRORCHECK : æ£€é”™é”ï¼Œå½“åŒä¸€ä¸ªçº¿ç¨‹è·å¾—åŒä¸€ä¸ªé”çš„æ—¶å€™ï¼Œåˆ™è¿”å›EDEADLKï¼Œå¦åˆ™ä¸æ™®é€šé”å¤„ç†ä¸€æ ·ã€‚</span><br><span class="line">PTHREAD_MUTEX_RECURSIVE : é€’å½’é”ã€‚è¿™é‡Œæœ‰åˆ«äºä¸Šé¢çš„æ£€é”™é”ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥é€’å½’è·å¾—é”ï¼Œä½†æ˜¯åŠ é”å’Œè§£é”å¿…é¡»è¦ä¸€ä¸€å¯¹åº”ã€‚</span><br><span class="line">PTHREAD_MUTEX_DEFAULT : é€‚åº”é”ï¼Œç­‰å¾…è§£é”ä¹‹åé‡æ–°ç«äº‰ï¼Œæ²¡æœ‰ç­‰å¾…é˜Ÿåˆ—ã€‚</span><br></pre></td></tr></table></figure><h3 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h3><p><code>NSLock</code>éµå¾ª<code>NSLocking</code>åè®®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯äº’æ–¥é”ï¼Œæä¾›äº†lockå’Œunlockæ–¹æ³•æ¥è¿›è¡ŒåŠ é”å’Œè§£é”ã€‚<br><code>NSLock</code>å†…éƒ¨æ˜¯å°è£…äº†<code>pthread_mutext</code>ï¼Œç±»å‹æ˜¯<code>PTHREAD_MUTEXT_ERRORCHECK</code>ï¼Œå®ƒä¼šæŸå¤±ä¸€å®šçš„æ€§èƒ½æ¢æ¥é”™è¯¯æç¤ºã€‚</p><h3 id="NSCondition"><a href="#NSCondition" class="headerlink" title="NSCondition"></a>NSCondition</h3><p><code>NSCondition</code>æ˜¯å°è£…äº†ä¸€ä¸ªäº’æ–¥é”å’Œä¿¡å·é‡ï¼Œå®ƒæŠŠå‰è€…çš„lockä»¥åŠåè€…çš„wait/signalç»Ÿä¸€åˆ°<code>NSCondition</code>å¯¹è±¡ä¸­ï¼Œæ˜¯åŸºäºæ¡ä»¶å˜é‡<code>pthread_cond_t</code>æ¥å®ç°çš„ï¼Œå’Œä¿¡å·é‡ç›¸ä¼¼ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”æˆ–è€…é‡Šæ”¾ä¿¡å·ä¹‹åï¼Œå°±ä¼šå”¤é†’çº¿ç¨‹ã€‚ç±»ä¼¼äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">NSCondition *lock = [[NSCondition alloc] init];</span><br><span class="line">    NSMutableArray *array = [[NSMutableArray alloc] init];</span><br><span class="line">    //æ¶ˆè´¹è€…</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        [lock lock];</span><br><span class="line">        while (!array.count) &#123;</span><br><span class="line">            [lock wait];</span><br><span class="line">        &#125;</span><br><span class="line">        [array removeAllObjects];</span><br><span class="line">        NSLog(@&quot;array removeAllObjects&quot;);</span><br><span class="line">        [lock unlock];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    //ç”Ÿäº§è€…</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        sleep(1);//ä»¥ä¿è¯è®©çº¿ç¨‹2çš„ä»£ç åæ‰§è¡Œ</span><br><span class="line">        [lock lock];</span><br><span class="line">        [array addObject:@1];</span><br><span class="line">        NSLog(@&quot;array addObject:@1&quot;);</span><br><span class="line">        [lock signal];</span><br><span class="line">        [lock unlock];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h3 id="NSRecursiveLock"><a href="#NSRecursiveLock" class="headerlink" title="NSRecursiveLock"></a>NSRecursiveLock</h3><blockquote><p><code>NSRecursiveLock</code>å®é™…ä¸Šå®šä¹‰çš„æ˜¯ä¸€ä¸ªé€’å½’é”ï¼Œè¿™ä¸ªé”å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è¯·æ±‚ï¼Œè€Œä¸ä¼šå¼•èµ·æ­»é”ã€‚è¿™ä¸»è¦æ˜¯ç”¨åœ¨å¾ªç¯æˆ–é€’å½’æ“ä½œä¸­</p></blockquote><p><code>NSRecursiveLock</code>å†…éƒ¨æ˜¯é€šè¿‡pthread_mutex_lockæ¥å®ç°çš„ï¼Œåœ¨å†…éƒ¨ä¼šåˆ¤æ–­é”çš„ç±»å‹ï¼Œå¦‚æœæ˜¯é€’å½’é”ï¼Œå°±å…è®¸é€’å½’è°ƒç”¨ï¼Œå†…éƒ¨ä»…ä»…æ˜¯å°†è®¡æ•°å™¨+1ã€‚å½“è°ƒç”¨unlockçš„æ—¶å€™ï¼Œå°±å°†è®¡æ•°å™¨å‡1ã€‚NSRecursiveLockå†…éƒ¨ä½¿ç”¨çš„pthread_mutex_tçš„ç±»å‹æ˜¯<code>PTHREAD_MUTEXT_RECURSIVE</code></p><h3 id="NSConditionLock"><a href="#NSConditionLock" class="headerlink" title="NSConditionLock"></a>NSConditionLock</h3><p><code>NSConditonLock</code> æ˜¯å€ŸåŠ©NSConditionï¼Œæœ¬è´¨ä¸Šæ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œ<code>NSConditonLock</code>å†…éƒ¨æŒæœ‰äº†ä¸€ä¸ª<code>NSCondition</code>å¯¹è±¡å’Œ<code>_condition_value</code>å±æ€§ï¼Œå½“è°ƒç”¨<code>- (instancetype)initWithCondition:(NSInteger)condition NS_DESIGNATED_INITIALIZER;</code>åˆå§‹åŒ–çš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªconditionå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šèµ‹å€¼<code>_condition_value</code>å±æ€§ã€‚</p><ul><li><p>åœ¨<code>NSConditionLock</code>rä¸­ï¼Œå¯¹åº”çš„æ¶ˆè´¹è€…å°±æ˜¯<code>- (void)lockWhenCondition:(NSInteger)condition;</code>æ–¹æ³•ï¼Œé¦–å…ˆä¼šè°ƒç”¨[condition lock]ï¼Œç„¶åå¼€å§‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¦‚æœcondition=_condition_valueï¼Œé‚£ä¹ˆå°±ä¼šä¼‘çœ ï¼Œç›´åˆ°ä»£ç è°ƒç”¨<code>- (void)unlockWithCondition:(NSInteger)condition;</code>æ‰ä¼šå”¤èµ·</p></li><li><p><code>- (void)unlockWithCondition:(NSInteger)condition;</code>å°±æ˜¯å¯¹åº”çš„ç”Ÿäº§è€…æ–¹æ³•ï¼Œå†…éƒ¨ä¼šè®¾ç½®condition=_contion_valueï¼Œå¹¶ä¸”å‘é€å¹¿æ’­å‘Šè¯‰æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œè¡¨ç¤ºç”Ÿäº§å®Œæˆï¼Œç„¶åè°ƒç”¨[condition unlock]é‡Šæ”¾é”ã€‚</p></li></ul><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>@synchronizedæ˜¯OCå±‚é¢ä¸Šçš„é”ï¼Œæ˜¯æ‰€æœ‰çš„é”ä¹‹ä¸­æ€§èƒ½æœ€å·®çš„ã€‚<br>@synchronizedåé¢ç´§è·Ÿä¸€ä¸ªOCå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯å°†è¿™ä¸ªå¯¹è±¡å½“åšé”æ¥ä½¿ç”¨ã€‚è¿™æ˜¯é€šè¿‡ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å®ç°çš„ï¼ŒOCåœ¨åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ªäº’æ–¥é”çš„æ•°ç»„ï¼Œé€šè¿‡å¯¹è±¡çš„å“ˆå¸Œå€¼å»å¾—åˆ°å¯¹è±¡çš„äº’æ–¥é”ã€‚<br>å…·ä½“çš„å®ç°åŸç†å¯ä»¥å‚è€ƒè§ç‰å¤§ç¥çš„è¿™ç¯‡æ–‡ç« : <a href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/" target="_blank" rel="noopener">å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“é”çš„æ€§èƒ½ç”±é«˜åˆ°ä½åˆ†åˆ«æ˜¯<br><code>OSSpinLock(å·²ç»ä¸æ¨èä½¿ç”¨)</code>-&gt;<code>dispatch_semaphore</code>-&gt;<code>pthread_mutext</code>-&gt;<code>NSLock</code>-&gt;<code>NSCondition</code>-&gt;<code>NSRecursiveLock</code>-&gt;<code>NSConditonLock</code>-&gt;<code>@synchronized</code></p><p>æˆ‘ä»¬å†æ¥æ¢³ç†ä¸€ä¸‹å®ƒä»¬çš„å…³ç³»ï¼š</p><ol><li><code>dipatch_semaphore</code>æ˜¯GCDåŒæ­¥çš„ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡dispatch_semaphore_tä¿¡å·é‡æ¥å®ç°ã€‚<br>2.<code>pthread_mutex</code>æ˜¯äº’æ–¥é”ï¼Œæä¾›äº†å››ç§ä¸åŒç±»å‹ï¼Œä¸ä¼šåƒè‡ªæ—‹é”ä¸€æ ·å¿™ç­‰ï¼Œè€Œæ˜¯ä¼šè¿›å…¥ä¼‘çœ ç­‰å¾…ã€‚<br>3.<code>NSLock</code>æ˜¯å°è£…äº†<code>prthread_mutex</code>ï¼Œé”çš„ç±»å‹æ˜¯<code>PTHREAD_MUTEX_ERRORCHECK</code>ï¼Œä¹Ÿå°±æ˜¯å½“åŒä¸€ä¸ªçº¿ç¨‹è·å¾—åŒä¸€ä¸ªé”çš„æ—¶å€™ï¼Œä¼šè¿”å›é”™è¯¯ã€‚<br>4.<code>NSCondition</code>æ˜¯åŸºäºæ¡ä»¶å˜é‡<code>pthread_cond_t</code>å®ç°çš„ï¼Œå’Œä¿¡å·é‡ç›¸ä¼¼ï¼Œå½“ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™å°±ä¼šè¿›å…¥ä¼‘çœ ç­‰å¾…ï¼ŒçŸ¥é“conditionå¯¹è±¡å‘å‡ºsignalä¿¡å·ï¼Œæ‰ä¼šè¢«å”¤é†’æ‰§è¡Œã€‚<br>5.<code>NSRecursiveLock</code>æ˜¯é€’å½’é”ï¼ŒåŒæ ·æ˜¯å°è£…äº†<code>pthread_mutex</code>æ¥å®ç°ï¼Œä½†æ˜¯é”çš„ç±»å‹æ˜¯<code>PTHREAD_MUTEX_RECURSIVE</code>ï¼Œå…è®¸ç»Ÿä¸€é€’å½’è·å¾—é”ï¼Œä½†æ˜¯è¦æ³¨æ„åŠ é”å’Œè§£é”è¦ä¸€ä¸€å¯¹åº”ã€‚<br>6.<code>NSConditionLock</code>æ˜¯åŸºäº<code>NSCondition</code>å®ç°çš„ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ã€‚<br>7.<code>@synchronized</code>æ˜¯OCå±‚é¢çš„é”ï¼Œä¼ å…¥ä¸€ä¸ªOCå¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡çš„å“ˆå¸Œå€¼æ¥ä½œä¸ºæ ‡è¯†ç¬¦å¾—åˆ°äº’æ–¥é”ï¼Œå­˜å…¥åˆ°ä¸€ä¸ªæ•°ç»„é‡Œé¢ã€‚</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://juejin.im/post/57f6e9f85bbb50005b126e5f" target="_blank" rel="noopener">æ·±å…¥ç†è§£iOSä¸­çš„é”</a><br><a href="https://www.jianshu.com/p/938d68ed832c" target="_blank" rel="noopener">iOSä¸­ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‡ ç§æ–¹å¼ä¸æ€§èƒ½å¯¹æ¯”</a><br><a href="https://www.jianshu.com/p/ddbe44064ca4" target="_blank" rel="noopener">iOS å¸¸è§çŸ¥è¯†ç‚¹ï¼ˆä¸‰ï¼‰ï¼šLock</a><br><a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/" target="_blank" rel="noopener">ä¸å†å®‰å…¨çš„OSSpinLock</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ºä»€ä¹ˆéœ€è¦é”&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆéœ€è¦é”&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆéœ€è¦é”&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆéœ€è¦é”&lt;/h2&gt;&lt;p&gt;åœ¨iOSä¸­ç›¸ä¿¡å¤§å®¶éƒ½ç”¨è¿‡å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¸¦æ¥çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹å¤šçº¿ç¨‹æœ‰å¯èƒ½å¸¦æ¥çš„é—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼Œæˆ‘ä»¬æœ‰ä¸¤æ¡çº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼ŒAçº¿ç¨‹åšçš„äº‹æƒ…æ˜¯ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¹‹åè¯»å–è¿™ä¸ªå¯¹è±¡çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™Bçº¿ç¨‹å¯èƒ½ä¹Ÿåœ¨ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™æœ‰ä¸¤ç§æƒ…å†µï¼ˆå–å†³äºBçº¿ç¨‹ä¿®æ”¹å¯¹è±¡çš„æ—¶æœºï¼‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;æ­£å¸¸çš„æƒ…å†µï¼ŒAçº¿ç¨‹ä¿®æ”¹å¯¹è±¡ä»¥åŠè¯»å–å¯¹è±¡ä¹‹åï¼ŒBçº¿ç¨‹æ‰å¼€å§‹ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚å¸¸çš„æƒ…å†µï¼ŒAçº¿ç¨‹ä¿®æ”¹å¯¹è±¡ä¹‹åï¼ŒBçº¿ç¨‹ç«‹åˆ»ä¿®æ”¹äº†è¿™ä¸ªå¸ä¹¡ï¼Œç„¶åAçº¿ç¨‹è¯»å–å¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™Açº¿ç¨‹è¯»å–åˆ°çš„æ•°æ®å°±å‡ºé”™äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Data raceï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨è®¿é—®ä¿®æ”¹åŒä¸€ä¸ªå—å†…å­˜çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å¾—åˆ°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSåŠ¨æ‰‹å®ç°KVO</title>
    <link href="http://lemon2well.top/2018/10/10/iOS%20%E5%BC%80%E5%8F%91/iOS%E5%8A%A8%E6%89%8B%E5%AE%9E%E7%8E%B0KVO/"/>
    <id>http://lemon2well.top/2018/10/10/iOS å¼€å‘/iOSåŠ¨æ‰‹å®ç°KVO/</id>
    <published>2018-10-10T07:11:44.000Z</published>
    <updated>2018-10-10T07:16:26.904Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯KVO"><a href="#ä»€ä¹ˆæ˜¯KVO" class="headerlink" title="ä»€ä¹ˆæ˜¯KVO"></a>ä»€ä¹ˆæ˜¯KVO</h2><blockquote><p>KVO(key-value observing)æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œé€šè¿‡ç›‘å¬å¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§ï¼Œå½“å±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œç›‘å¬è€…ä¼šè·å¾—é€šçŸ¥ã€‚</p></blockquote><h2 id="KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹"><a href="#KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹" class="headerlink" title="KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹"></a>KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿçš„KVOçš„ã€‚<br>ç³»ç»Ÿæä¾›äº†ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è®¾ç½®ç›‘å¬ï¼Œä¸€ä¸ªæ˜¯ç›‘å¬å›è°ƒï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç§»é™¤ç›‘å¬ã€‚</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)addObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath options:(NSKeyValueObservingOptions)options context:(nullable void *)context;</span><br><span class="line">- (void)observeValueForKeyPath:(nullable NSString *)keyPath ofObject:(nullable id)object change:(nullable NSDictionary&lt;NSKeyValueChangeKey, id&gt; *)change context:(nullable void *)context;</span><br><span class="line">- (void)removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath context:(nullable void *)context API_AVAILABLE(macos(10.7), ios(5.0), watchos(2.0), tvos(9.0));</span><br></pre></td></tr></table></figure><p>æ€ä¹ˆä½¿ç”¨æˆ‘å°±ä¸è¯´äº†ï¼Œæˆ‘æ¥è¯´è¯´ç³»ç»Ÿçš„KVOçš„ç¼ºç‚¹ã€‚</p><ol><li>å½“ä¸€ä¸ªè§‚å¯Ÿè€…ç›‘å¬äº†å¾ˆå¤šå¯¹è±¡çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å›è°ƒæ–¹æ³•éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†ï¼Œè¿™æ ·å°±è¦åšå¾ˆå¤šçš„åˆ¤æ–­æ¥æ ¹æ®ä¸åŒçš„å¯¹è±¡ä¸åŒçš„å±æ€§æ¥åšç›¸åº”çš„å“åº”ã€‚</li><li>æ²¡æœ‰æä¾›<code>@selector</code>çš„å½¢å¼ä»¥åŠ<code>block</code>çš„å½¢å¼ï¼Œè€Œä¸”è¿˜è¦å¤„ç†çˆ¶ç±»çš„æƒ…å†µï¼Œå¦‚æœçˆ¶ç±»åŒæ ·ä¹Ÿç›‘å¬äº†å¯¹è±¡çš„åŒä¸€å±æ€§ï¼Œä½ ä¸çŸ¥é“çˆ¶ç±»æ˜¯å¦å¯¹è¿™ä¸ªæ¶ˆæ¯æ„Ÿå…´è¶£ï¼Œè¿˜è¦æ ¹æ®contextæ¥å¤„ç†ï¼Œè¿™æ ·æ˜¾å¾—å¾ˆæ··ä¹±ã€‚</li></ol><h2 id="KVOçš„å®ç°"><a href="#KVOçš„å®ç°" class="headerlink" title="KVOçš„å®ç°"></a>KVOçš„å®ç°</h2><p>åŸºäºä»¥ä¸Šçš„ç¼ºç‚¹è€ƒè™‘ï¼Œæˆ‘ä»¬æƒ³è‡ªå·±å®ç°ä¸€ä¸ªKVOï¼Œå¹¶ä¸”ä»¥blockçš„å½¢å¼è¿›è¡Œå›è°ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“KVOçš„å®ç°åŸç†ã€‚</p><p>åœ¨è‹¹æœçš„å¼€å‘è€…ç½‘ç«™ä¸Šé¢æœ‰é€éœ²äº†KVOçš„å®ç°ï¼Œè™½ç„¶æ²¡æœ‰é€éœ²å†…éƒ¨çš„ç»†èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“ä¸€ä¸ªå¤§æ¦‚ã€‚</p><blockquote><p>Automatic key-value observing is implemented using a technique called isa-swizzling.<br>The isa pointer, as the name suggests, points to the objectâ€™s class which maintains a dispatch table. This dispatch table essentially contains pointers to the methods the class implements, among other data.<br>When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class. As a result the value of the isa pointer does not necessarily reflect the actual class of the instance.<br>You should never rely on the isa pointer to determine class membership. Instead, you should use the class method to determine the class of an object instance.</p></blockquote><p>ä¸Šé¢çš„è¯ç¿»è¯‘è¿‡æ¥å°±æ˜¯KVOçš„å®ç°æ˜¯åŸºäºä¸€ä¸ªå«åšisa-swizzlingçš„æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜isaçš„æŒ‡é’ˆï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆæŒ‡å‘ä»–çš„ç±»ï¼Œåé¢è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æ ¹æ®isaæŒ‡é’ˆæ‰¾åˆ°å¯¹åº”çš„ç±»ç„¶åè°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«æ³¨å†Œç›‘å¬çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªè¯¥å¯¹è±¡æ‰€å±çš„ç±»çš„å­ç±»ï¼Œç„¶åä¿®æ”¹å­ç±»çš„setteræ–¹æ³•ï¼Œè¯¥setteræ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨çˆ¶ç±»çš„setterå®ç°ï¼Œç„¶åå®ç°é€šçŸ¥å‘Šè¯‰è§‚å¯Ÿè€…ã€‚æœ€åæ”¹å˜è¯¥å¯¹è±¡çš„isaæŒ‡é’ˆï¼ŒæŒ‡å‘æˆ‘ä»¬è‡ªå®šä¹‰çš„kvoç±»ã€‚æœ€åå½“æˆ‘ä»¬ç»™ä¸€ä¸ªå±æ€§èµ‹å€¼çš„æ—¶å€™ï¼Œå…¶å®è°ƒç”¨çš„setteræ–¹æ³•åº”ä¸æ˜¯åŸæ¥çš„ç±»çš„setterï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ›å»ºçš„kvoå­ç±»ã€‚</p><p>åŸºäºä»¥ä¸Šçš„åŸç†ï¼Œæˆ‘ä»¬æ¥å¼€å§‹åŠ¨æ‰‹å®ç°ä¸€ä¸ªé€šè¿‡blockå›è°ƒçš„kvo</p><h2 id="å®ç°å¸¦æœ‰blockçš„KVO"><a href="#å®ç°å¸¦æœ‰blockçš„KVO" class="headerlink" title="å®ç°å¸¦æœ‰blockçš„KVO"></a>å®ç°å¸¦æœ‰blockçš„KVO</h2><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªNSObjectçš„categoryï¼Œç„¶åå‘å¤–é¢æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^lmObserveBlock)(id observer, NSString *key ,id oldValue, id newValue);</span><br><span class="line"></span><br><span class="line">@interface NSObject (LMKVO)</span><br><span class="line">- (void)lm_AddObserver:(id)observer</span><br><span class="line">                  key:(NSString *)key</span><br><span class="line">         observeBlock:(lmObserveBlock)block;</span><br><span class="line"></span><br><span class="line">- (void)lm_removeObserver:(id)observer</span><br><span class="line">                   key:(NSString*)key;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹æ·»åŠ ç›‘å¬çš„æ–¹æ³•ï¼š</p><p>ä¸‹é¢çš„ä»£ç ä¸»è¦åšäº†ä¸‹é¢å››ä»¶äº‹ï¼š</p><blockquote><ol><li>åˆ¤æ–­å¯¹è±¡çš„ç±»æ˜¯å¦å­˜åœ¨setteræ–¹æ³•ï¼Œä¸å­˜åœ¨çš„è¯åˆ™ç›´æ¥è¿”å›</li><li>åˆ¤æ–­å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘çš„ç±»æ˜¯å¦æ˜¯kvoç±»ï¼Œä¸æ˜¯çš„è¯å°±é€šè¿‡objc_allocateClassPair()ä»¥åŠobjc_registerClassPair()ä¸¤ä¸ªä¸»è¦æ–¹æ³•æ¥æ³¨å†Œä¸€ä¸ªkvoç±»ï¼Œä¿®æ”¹å¯¹è±¡çš„isaæŒ‡é’ˆã€‚</li><li>åˆ¤æ–­kvoç±»æ˜¯å¦å·²ç»å­˜åœ¨setteræ–¹æ³•ï¼Œä¸å­˜åœ¨çš„è¯åˆ™åˆ›å»ºsetteræ–¹æ³•.</li><li>é€šè¿‡obj_getAssociatedObjectä»¥åŠobjc_setAssociatedObjectæ¥åŠ¨æ€ç»™åˆ†ç±»å¢åŠ ä¸€ä¸ªarrayçš„å±æ€§ï¼Œé€šè¿‡è¯¥å±æ€§ä¿å­˜æ‰€æœ‰çš„obverveä¿¡æ¯ï¼Œä»¥ä¾¿åé¢å±æ€§å€¼å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è°ƒç”¨ã€‚</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">- (void)lm_AddObserver:(id)observer</span><br><span class="line">                   key:(NSString *)key</span><br><span class="line">          observeBlock:(lmObserveBlock)block&#123;</span><br><span class="line">    SEL selForSetter = NSSelectorFromString([self setterName:key]);</span><br><span class="line">    Method setterMethod = class_getInstanceMethod([self class], selForSetter);</span><br><span class="line">    //leiåˆ¤æ–­å¦‚æœçˆ¶ç±»ä¸å­˜åœ¨setteræ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›</span><br><span class="line">    if (!setterMethod) &#123;</span><br><span class="line">        NSLog(@&quot;çˆ¶ç±»æ–¹æ³•ä¸å­˜åœ¨setter&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    //åˆ¤æ–­å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘çš„ç±»æ˜¯å¦æ˜¯kvoï¼Œå¦‚æœä¸æ˜¯åˆ™åˆ›å»ºè¯¥ç±»çš„å­ç±»ï¼Œå¹¶ä¸”å°†å¯¹è±¡çš„isaæŒ‡å‘è¯¥å­ç±»ã€‚</span><br><span class="line">    Class class = object_getClass(self);</span><br><span class="line">    NSString *className = NSStringFromClass(class);</span><br><span class="line">    </span><br><span class="line">    if (![className hasPrefix:LMKVOPREFIX]) &#123;</span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å¹¶ä¸”ä¿®æ”¹isaæŒ‡é’ˆ</span><br><span class="line">        class = [self makeNewClassWithClassName:className];</span><br><span class="line">        object_setClass(self, class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //åˆ¤æ–­æ–°åˆ›å»ºçš„ç±»æ˜¯å¦å·²ç»å®ç°äº†setteræ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°çš„setteræ–¹æ³•</span><br><span class="line">    if (![self hasSelector:selForSetter]) &#123;</span><br><span class="line">        const char *types = method_getTypeEncoding(setterMethod);</span><br><span class="line">        class_addMethod(class, selForSetter, (IMP)kvo_setter, types);</span><br><span class="line">    &#125;</span><br><span class="line">    //ä¿å­˜observerInfo</span><br><span class="line">    LMObserverInfo *info = [[LMObserverInfo alloc] initWithObserver:observer key:key block:block];</span><br><span class="line">    NSMutableArray *observers = objc_getAssociatedObject(self,(__bridge const void * _Nonnull)(LMKVOAssociatedObservers));</span><br><span class="line">    if (!observers) &#123;</span><br><span class="line">        observers = [NSMutableArray array];</span><br><span class="line">        objc_setAssociatedObject(self, (__bridge const void * _Nonnull)(LMKVOAssociatedObservers), observers, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">    &#125;</span><br><span class="line">    if ([self containsSameObserver:observer key:key]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    [observers addObject:info];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç§»é™¤ç›‘å¬çš„æ–¹æ³•å®ç°ï¼š</p><p>è¿™é‡Œå°±æ˜¯åœ¨æˆ‘ä»¬ä¹‹å‰ä¿å­˜çš„æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„observeå’Œkeyï¼Œç„¶åç§»é™¤ç›¸åº”çš„å¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)lm_removeObserver:(id)observer</span><br><span class="line">                   key:(NSString*)key&#123;</span><br><span class="line">    NSMutableArray *observers = objc_getAssociatedObject(self,(__bridge const void * _Nonnull)(LMKVOAssociatedObservers));</span><br><span class="line">    LMObserverInfo *specialInfo = [self containsSameObserver:observer key:key];</span><br><span class="line">    if (specialInfo) &#123;</span><br><span class="line">        [observers removeObject:specialInfo];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°çš„é€»è¾‘å¾ˆç®€å•ï¼Œçœ‹çœ‹demoå°±ä¸€ç›®äº†ç„¶äº†ã€‚<br>è¿™é‡Œæ˜¯[demo][<a href="https://github.com/codemonkeybulucck/LMKVOTool]" target="_blank" rel="noopener">https://github.com/codemonkeybulucck/LMKVOTool]</a></p><p>å‚è€ƒï¼š<a href="https://github.com/okcomp/ImplementKVO" target="_blank" rel="noopener">ImplementKVO</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯KVO&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯KVO&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯KVO&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯KVO&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;KVO(key-value observing)æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œé€šè¿‡ç›‘å¬å¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§ï¼Œå½“å±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œç›‘å¬è€…ä¼šè·å¾—é€šçŸ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹&quot;&gt;&lt;a href=&quot;#KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹&quot; class=&quot;headerlink&quot; title=&quot;KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹&quot;&gt;&lt;/a&gt;KVOçš„ä½¿ç”¨ä»¥åŠç¼ºç‚¹&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿçš„KVOçš„ã€‚&lt;br&gt;ç³»ç»Ÿæä¾›äº†ä¸‰ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è®¾ç½®ç›‘å¬ï¼Œä¸€ä¸ªæ˜¯ç›‘å¬å›è°ƒï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç§»é™¤ç›‘å¬ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="kvo" scheme="http://lemon2well.top/tags/kvo/"/>
    
  </entry>
  
  <entry>
    <title>atomicæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</title>
    <link href="http://lemon2well.top/2018/09/30/iOS%20%E5%BC%80%E5%8F%91/atomic%E6%98%AF%E4%B8%8D%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84/"/>
    <id>http://lemon2well.top/2018/09/30/iOS å¼€å‘/atomicæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„/</id>
    <published>2018-09-30T08:01:01.000Z</published>
    <updated>2018-09-30T08:07:17.153Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆå«åšçº¿ç¨‹å®‰å…¨ã€‚</p><blockquote><p>å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>æˆ–è€…è¯´:ä¸€ä¸ªç±»æˆ–è€…ç¨‹åºæ‰€æä¾›çš„æ¥å£å¯¹äºçº¿ç¨‹æ¥è¯´æ˜¯åŸå­æ“ä½œæˆ–è€…å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¸ä¼šå¯¼è‡´è¯¥æ¥å£çš„æ‰§è¡Œç»“æœå­˜åœ¨äºŒä¹‰æ€§,ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸ç”¨è€ƒè™‘åŒæ­¥çš„é—®é¢˜ã€‚</p></blockquote><a id="more"></a><h2 id="atomicä¸å®‰å…¨ï¼Ÿ"><a href="#atomicä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="atomicä¸å®‰å…¨ï¼Ÿ"></a>atomicä¸å®‰å…¨ï¼Ÿ</h2><p>OKï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€æ®µç»å…¸çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@property (atomic,copy) NSString *name;</span><br><span class="line"></span><br><span class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        @synchronized(self)&#123;</span><br><span class="line">            for (int i = 0; i&lt;100; i++) &#123;</span><br><span class="line">                self.name = @&quot;lemon&quot;;</span><br><span class="line">                NSLog(@&quot;çº¿ç¨‹A ï¼š %@&quot;,self.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        @synchronized(self)&#123;</span><br><span class="line">            for (int i = 0; i&lt;100; i++) &#123;</span><br><span class="line">                self.name = @&quot;well&quot;;</span><br><span class="line">                NSLog(@&quot;çº¿ç¨‹B ï¼š %@&quot;,self.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªatomicçš„nameå±æ€§ï¼Œç„¶åæˆ‘ä»¬åœ¨ä¸¤ä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«ä¿®æ”¹äº†è¿™ä¸ªå±æ€§çš„å€¼ï¼ŒæŒ‰ç…§ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ä»¬çš„è®¾æƒ³åº”è¯¥æ˜¯ï¼šçº¿ç¨‹Aåé¢çš„ä¸€å®šæ˜¯lemonï¼Œçº¿ç¨‹Båé¢çš„ä¸€å®šæ˜¯wellï¼Œä½†æ˜¯ç»“æœæ˜¯çº¿ç¨‹Aåé¢è·Ÿç€çš„æ˜¯lemonæˆ–è€…wellï¼Œçº¿ç¨‹Bæ‰“å°çš„æ˜¯lemonæˆ–è€…wellã€‚ä¹Ÿå°±æ˜¯è¯´å–å€¼æ˜¯ä¸ç¡®å®šçš„ï¼ŒåŸºäºä¸Šé¢çš„ç»“æœï¼Œå¤§å¤šæ•°äººè®¤ä¸º<strong>atomicæ˜¯ä¸å®‰å…¨çš„</strong>ã€‚Butè¿™ä¸æ˜¯è¿™ç¯‡æ–‡ç« çš„ç»“è®ºã€‚</p><h2 id="atomic-æ˜¯å®‰å…¨çš„"><a href="#atomic-æ˜¯å®‰å…¨çš„" class="headerlink" title="atomic æ˜¯å®‰å…¨çš„"></a>atomic æ˜¯å®‰å…¨çš„</h2><p>æˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹atomicï¼Œatomicæ˜¯åŸå­å±æ€§ï¼Œä»€ä¹ˆæ˜¯åŸå­å±æ€§å‘¢ï¼Ÿ</p><p><code>ç‹­ä¹‰ä¸Šçš„åŸå­æ“ä½œè¡¨ç¤ºä¸€æ¡ä¸å¯æ‰“æ–­çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œè¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ï¼Œè€Œæ˜¯ä¸€å®šä¼šæ‰§è¡Œå®Œï¼ˆç†è®ºä¸Šæ‹¥æœ‰CPUæ—¶é—´ç‰‡æ— é™é•¿ï¼‰ã€‚åœ¨å•å¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œä¸€æ¡æ±‡ç¼–æŒ‡ä»¤æ˜¾ç„¶æ˜¯åŸå­æ“ä½œï¼Œå› ä¸ºä¸­æ–­ä¹Ÿè¦é€šè¿‡æŒ‡ä»¤æ¥å®ç°ï¼Œä½†ä¸€å¥é«˜çº§è¯­è¨€çš„ä»£ç å´ä¸æ˜¯åŸå­çš„ï¼Œå› ä¸ºå®ƒæœ€ç»ˆæ˜¯ç”±å¤šæ¡æ±‡ç¼–è¯­è¨€å®Œæˆï¼ŒCPUåœ¨è¿›è¡Œæ—¶é—´ç‰‡åˆ‡æ¢æ—¶ï¼Œå¤§å¤šéƒ½ä¼šåœ¨æŸæ¡ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚ä½†åœ¨å¤šæ ¸å¤„ç†å™¨ä¸‹ï¼Œåˆ™éœ€è¦ç¡¬ä»¶æ”¯æŒ</code></p><p>åœ¨<a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4-723</a>ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°atomicçš„å®ç°ï¼Œåˆ©ç”¨äº†TLS(Thread-Local Storage)å±€éƒ¨çº¿ç¨‹å­˜å‚¨å®ç°äº†åŸå­å±æ€§ï¼Œè¿™é‡Œç”¨äº†æœ€é‡è¦çš„ä¸¤ä¸ªå‡½æ•°:<code>pthread_setspecific</code>ä»¥åŠ<code>pthread_getspecific</code>ã€‚ä¹Ÿå°±æ˜¯è¯´atomicæ˜¯å®‰å…¨çš„ã€‚</p><p>è¿™é‡Œå°±æœ‰çŸ›ç›¾äº†ï¼Œä¸ºä»€ä¹ˆä¸Šé¢è¯´atomicæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè¿™é‡Œåˆè¯´æ˜¯å®‰å…¨çš„ï¼ŒExcuse me?</p><p>æˆ–è®¸æˆ‘ä»¬æ¢ä¸€ç§è¯´æ³•ï¼Œatomicæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æŒ‡å‘çš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ€ä¹ˆè§£é‡Šè¿™å¥è¯å‘¢ï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ï¼Œatomicåªå¯¹getterå’ŒsetteråŠ é”ï¼Œè€Œæ²¡æœ‰åŠæ³•ä¿è¯å¯¹è±¡çš„æ•°æ®å®Œæ•´æ€§ã€‚</p><blockquote><p>æˆ‘ä»¬è¦æ˜ç™½ä¸€ä¸ªæ¦‚å¿µï¼Œå½“æˆ‘ä»¬è®¿é—®nameçš„æ—¶å€™ï¼Œå…¶å®è¿™é‡Œæˆ‘ä»¬è®¿é—®çš„æœ‰å¯èƒ½æ˜¯nameæœ¬èº«ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯nameæŒ‡å‘çš„å†…å­˜åœ°å€ã€‚<br>æ¯”å¦‚ <code>self.name = @&quot;lemon&quot;</code>æ˜¯åœ¨è®¿é—®æŒ‡é’ˆæœ¬èº«ï¼Œè¿™ä¸ªæ˜¯å—atomicä¿æŠ¤çš„ã€‚<br>è€Œ<code>[self.name rangOfString:@&quot;lemon&quot;]</code>æ˜¯åœ¨è®¿é—®nameæŒ‡å‘çš„å­—ç¬¦ä¸²æ‰€åœ¨çš„å†…å­˜åŒºåŸŸï¼Œatomicæ— æ³•ä¿è¯è®¿é—®æŒ‡å‘çš„å†…å®¹çš„è¯»å†™å®‰å…¨ã€‚è¿™æ˜¯ä¸ä¸€æ ·çš„æ¦‚å¿µã€‚</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»¥ä¸‹çš„ç¤ºä¾‹æ¥è¯´æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic,strong) NSMutableString *name;</span><br><span class="line">//æ³¨æ„è¿™é‡Œç”¨çš„æ˜¯NSMutableString</span><br><span class="line"></span><br><span class="line"> self.name = [NSMutableString string]; //ThreadA</span><br><span class="line"> [self.name appendString:@&quot;ddd&quot;];//ThreadB</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çº¿ç¨‹Aå¯¹nameåšäº†åˆå§‹åŒ–æ“ä½œï¼Œç„¶åæˆ‘ä»¬çº¿ç¨‹Båšäº†èµ‹å€¼æ“ä½œã€‚ç³»ç»Ÿä¸ºæˆ‘ä»¬åˆ†é…çš„åœ°å€æ˜¯0x192838452ï¼Œç„¶åæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªåœ°å€å†™åˆ°nameè¿™é‡Œï¼Œå‡è®¾å†™åˆ°ä¸€åŠçš„æ—¶å€™ï¼ŒBå¼€å§‹è¯»å–nameå¹¶ä¸”èµ‹å€¼äº†ï¼Œè¿™ä¸ªæ—¶å€™æ‹¿åˆ°çš„å¯èƒ½æ˜¯ä¸€ä¸ª0x19283000ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±æœ‰é—®é¢˜äº†ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„åœ°å€æ ¹æœ¬ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæœ€å¥½çš„æƒ…å†µè¿™æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆä¸ä¼šé€ æˆä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸€å—åŒºåŸŸæ˜¯ç³»ç»Ÿçš„æŸä¸€ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œè¦æ˜¯è¢«æˆ‘ä»¬ä¸å°å¿ƒç»™æ”¹äº†é‚£å¯èƒ½é—®é¢˜å°±æœ‰ç‚¹å¤§äº†ã€‚</p><p>å¦‚æœåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬å°†nonatomicæ”¹æˆatomicï¼Œé‚£ä¹ˆå°±èƒ½ä¿è¯å°†0x192838452è¿™ä¸ªå€¼å†™åˆ°nameé‡Œé¢çš„æ—¶å€™ä¸ä¼šæœ‰å¦å¤–ä¸€æ¡çº¿ç¨‹æ¥è¯»å–å®ƒï¼Œä¹Ÿå°±èƒ½ä¿è¯ä¿è¯è¯»å–å‡ºæ¥çš„å€¼æ˜¯æ­£ç¡®çš„ï¼Œè€Œä¸ä¼šæ˜¯å…¶ä»–å¼‚å¸¸çš„å€¼ã€‚</p><p>æ‰€ä»¥atomicçš„å·¥ä½œå°±æ˜¯ä¿æŠ¤nameè¿™ä¸ªæŒ‡é’ˆçš„è¯»å†™æ“ä½œä¸ä¼šåŒæ—¶è¿›è¡Œã€‚è‡³äºnameæŒ‡å‘çš„å†…å®¹ï¼Œåˆ™ä¸åœ¨atomicä¿æŠ¤çš„èŒƒå›´ä¹‹å†…ã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®æ˜¯æœ‰ç‚¹è¯¯è§£atomicï¼Œä»¥ä¸ºå®ƒæ˜¯å¯ä»¥ä¿æŠ¤nameæŒ‡å‘çš„å†…å­˜åœ°å€çš„å†…å®¹å®Œæ•´æ€§ã€‚<code>å…¶å®è¿™å¹¶ä¸æ˜¯å®ƒçš„å·¥ä½œ</code></p><h2 id="çº¿ç¨‹å®‰å…¨å¦‚ä½•å®ç°ï¼Ÿ"><a href="#çº¿ç¨‹å®‰å…¨å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="çº¿ç¨‹å®‰å…¨å¦‚ä½•å®ç°ï¼Ÿ"></a>çº¿ç¨‹å®‰å…¨å¦‚ä½•å®ç°ï¼Ÿ</h2><p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè¦è¯´ä¸¤ä¸ªæ¦‚å¿µï¼š</p><p>ç¬¬ä¸€ä¸ªæ˜¯ä¸Šé¢è¯´çš„<code>åŸå­æ€§</code><br>ç¬¬äºŒä¸ªæ˜¯<code>CPUæ—¶é—´ç‰‡è½®è½¬ç®—æ³•</code>ï¼š</p><blockquote><p>ç°ä»£æ“ä½œç³»ç»Ÿåœ¨ç®¡ç†æ™®é€šçº¿ç¨‹æ—¶ï¼Œé€šå¸¸é‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬ç®—æ³•(Round Robinï¼Œç®€ç§° RR)ã€‚æ¯ä¸ªçº¿ç¨‹ä¼šè¢«åˆ†é…ä¸€æ®µæ—¶é—´ç‰‡(quantum)ï¼Œé€šå¸¸åœ¨ 10-100 æ¯«ç§’å·¦å³ã€‚å½“çº¿ç¨‹ç”¨å®Œå±äºè‡ªå·±çš„æ—¶é—´ç‰‡ä»¥åï¼Œå°±ä¼šè¢«æ“ä½œç³»ç»ŸæŒ‚èµ·ï¼Œæ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡è¢«åˆ†é…æ—¶é—´ç‰‡ï¼Œå¦‚æœçº¿ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™CPUå½“å³è¿›è¡Œåˆ‡æ¢ã€‚ç”±äºçº¿ç¨‹åˆ‡æ¢éœ€è¦æ—¶é—´ï¼Œå¦‚æœæ—¶é—´ç‰‡å¤ªçŸ­ï¼Œä¼šå¯¼è‡´å¤§é‡CPUæ—¶é—´æµªè´¹åœ¨åˆ‡æ¢ä¸Šï¼›è€Œå¦‚æœè¿™ä¸ªæ—¶é—´ç‰‡å¦‚æœå¤ªé•¿ï¼Œä¼šä½¿å¾—å…¶å®ƒçº¿ç¨‹ç­‰å¾…å¤ªä¹…ã€‚</p></blockquote><p>ç„¶åæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸‹ï¼Œå“ªå‡ ç§æƒ…å†µæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š</p><ol><li>å¦‚æœçº¿ç¨‹æ˜¯ä¸²è¡Œè®¿é—®å†…å­˜ï¼Œé‚£ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>å¦‚æœæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ol><p>æ‰€ä»¥åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªè¦åšåˆ°åŸå­æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åšåˆ°åŸå­æ€§å‘¢ï¼Ÿ</p><ol><li>64ä½ç³»ç»Ÿçš„åœ°å€æ€»çº¿å¯¹äºè¯»å†™æŒ‡ä»¤å¯ä»¥æ”¯æŒ8ä¸ªå­—èŠ‚çš„é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸è§çš„char,int,long è¿™äº›æ¯”è¾ƒå°çš„æ•°æ®ç±»å‹ï¼Œä¸€å®šæ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®ç±»å‹ä¸€å®šä¸ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™æ“ä½œã€‚</li><li>å¦‚æœæ˜¯å¸¸è§çš„å¯¹è±¡ç±»å‹ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨ä¸Šå±‚åŠ é”æ¥å¤„ç†äº†ï¼ŒåŸå­æ€§å…¶å®ä¹Ÿæ˜¯å¯ä»¥æ ¹æ®å¯¹è±¡æ¥åˆ†ä¸ºå¤§ç²’åº¦å’Œå°ç²’åº¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡é”æŠŠä¸€ç³»åˆ—çš„æ“ä½œå…ˆæ‰§è¡Œå®Œæˆï¼Œç„¶åå†é‡Šæ”¾é”ã€‚</li></ol><p>åœ¨æœ€å¼€å§‹çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡@synchronizedæ¥å®ç°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">       @synchronized(self)&#123;</span><br><span class="line">           for (int i = 0; i&lt;100; i++) &#123;</span><br><span class="line">               self.name = @&quot;lemon&quot;;</span><br><span class="line">               NSLog(@&quot;çº¿ç¨‹A ï¼š %@&quot;,self.name);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">   &#125;);</span><br><span class="line">   dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">       @synchronized(self)&#123;</span><br><span class="line">           for (int i = 0; i&lt;100; i++) &#123;</span><br><span class="line">               self.name = @&quot;well&quot;;</span><br><span class="line">               NSLog(@&quot;çº¿ç¨‹B ï¼š %@&quot;,self.name);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     </span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æ ¹æ®<a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/" target="_blank" rel="noopener">ä¸å†å®‰å…¨çš„osspinlock</a>ä¸€æ–‡ä¸­ï¼Œè¯´åˆ°ï¼Œä½¿ç”¨@synchronizedçš„æ€§èƒ½æ˜¯æœ€ä½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è·å–å¯ä»¥è€ƒè™‘ä½¿ç”¨<br>dispatch_semaphore_tæ¥å¤„ç†ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>atomicæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å®ƒä¸èƒ½ä¿è¯æŒ‡é’ˆæŒ‡å‘çš„åœ°å€ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨æˆ‘ä»¬ä¸€å¼€å§‹å†™çš„ä¾‹å­ä¸­ï¼Œå®ƒå…¶å®æ˜¯ä¸èƒ½å†³å®šå“ªæ¡çº¿ç¨‹å…ˆæ‰§è¡Œï¼Œä½†æ˜¯å®ƒå·²ç»ä¿è¯äº†ç»“æœä¸€å®šæ˜¯wellæˆ–è€…lemonï¼Œè€Œä¸æ˜¯å…¶ä»–çš„å­—ç¬¦ï¼Œè¿™å°±æ˜¯å®ƒèµ·çš„ä½œç”¨ã€‚è‡³äºè¦ä¿è¯ä¸Šå±‚è¯»å†™ç»Ÿä¸€çš„è¯ï¼Œé‚£å°±æ˜¯éœ€è¦ç”¨é”æ¥è§£å†³äº†ã€‚</p><p>æœ€åï¼Œå›½åº†å¿«ä¹ï¼ï¼ï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆå«åšçº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚&lt;br&gt;æˆ–è€…è¯´:ä¸€ä¸ªç±»æˆ–è€…ç¨‹åºæ‰€æä¾›çš„æ¥å£å¯¹äºçº¿ç¨‹æ¥è¯´æ˜¯åŸå­æ“ä½œæˆ–è€…å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¸ä¼šå¯¼è‡´è¯¥æ¥å£çš„æ‰§è¡Œç»“æœå­˜åœ¨äºŒä¹‰æ€§,ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸ç”¨è€ƒè™‘åŒæ­¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="atomic" scheme="http://lemon2well.top/tags/atomic/"/>
    
      <category term="é”" scheme="http://lemon2well.top/tags/%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>iOSä¸­çš„loadå’Œinitializeæ–¹æ³•</title>
    <link href="http://lemon2well.top/2018/09/11/iOS%20%E5%BC%80%E5%8F%91/iOS%E4%B8%AD%E7%9A%84load%E5%92%8Cinitialize%E6%96%B9%E6%B3%95/"/>
    <id>http://lemon2well.top/2018/09/11/iOS å¼€å‘/iOSä¸­çš„loadå’Œinitializeæ–¹æ³•/</id>
    <published>2018-09-11T03:21:13.000Z</published>
    <updated>2018-09-11T03:21:32.880Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨NSObjectä¸­æœ‰ä¸¤ä¸ªåˆå§‹åŒ–çš„æ–¹æ³•ï¼Œ<code>+(void)load</code>ä»¥åŠ<code>+ (void)initialize</code>æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”±ç³»ç»Ÿæ¥è‡ªåŠ¨è°ƒç”¨ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„å†…éƒ¨åšä¸€äº›magicçš„äº‹æƒ…ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é¦–å…ˆå¯¹è¿™ä¸¤ä¸ªæ–¹æ³•åšä¸€ä¸ªåˆæ­¥çš„ä½¿ç”¨ï¼Œçœ‹çœ‹ä»–ä»¬ä¸¤çš„è°ƒç”¨æ—¶æœºä»¥åŠå¼‚åŒã€‚</p><p><strong>å½“ç„¶å¦‚æœå·²ç»çŸ¥é“äº†ä»–ä»¬çš„å¼‚åŒä»¥åŠè°ƒç”¨é¡ºåºçš„å¯ä»¥ç›´æ¥çœ‹æ€»ç»“æˆ–è€…æºç åˆ†æ</strong></p><a id="more"></a><h2 id="è°ƒç”¨æ—¶æœºä»¥åŠè°ƒç”¨ç­–ç•¥"><a href="#è°ƒç”¨æ—¶æœºä»¥åŠè°ƒç”¨ç­–ç•¥" class="headerlink" title="è°ƒç”¨æ—¶æœºä»¥åŠè°ƒç”¨ç­–ç•¥"></a>è°ƒç”¨æ—¶æœºä»¥åŠè°ƒç”¨ç­–ç•¥</h2><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªxcodeå·¥ç¨‹ï¼Œç„¶åå»ºç«‹äº†ä¸€ä¸ªpersonç±»ï¼Œä»¥åŠä¸€ä¸ªstudentç±»ï¼Œstudentç±»ç»§æ‰¿äºpersonç±»ï¼Œpersonç±»é‡Œé¢æœ‰ä¸€ä¸ªsayHelloçš„ç±»æ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåˆ†ç±»ï¼ŒStudent(Extension),æˆ‘ä»¬åˆ†åˆ«åœ¨è¿™ä¸‰ä¸ªç±»ä¸‹é¢é‡å†™äº†<code>load</code>ä»¥åŠ<code>initialize</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//Persom.m</span><br><span class="line">#import &quot;Person.h&quot;</span><br><span class="line">@implementation Person</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;person load&quot;);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)initialize&#123;</span><br><span class="line">    NSLog(@&quot;person initialize&quot;);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)hello&#123;</span><br><span class="line">    NSLog(@&quot;Person say hello&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//Student.m</span><br><span class="line">#import &quot;Student.h&quot;</span><br><span class="line">@implementation Student</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;student load&quot;);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)initialize&#123;</span><br><span class="line">    NSLog(@&quot;student initialize&quot;);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)hello&#123;</span><br><span class="line">    NSLog(@&quot;student say hello&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//Student+Extension.m</span><br><span class="line">#import &quot;Student+Extension.h&quot;</span><br><span class="line">@implementation Student (Extension)</span><br><span class="line">+ (void)load&#123;</span><br><span class="line">    NSLog(@&quot;Student Category load&quot;);</span><br><span class="line">&#125;</span><br><span class="line">+ (void)initialize&#123;</span><br><span class="line">    NSLog(@&quot;Student Category initialize&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨ViewControllerçš„<code>touchBegan</code>æ–¹æ³•é‡Œé¢åŠ å…¥<code>[Studnet hello]</code>ï¼Œç¨‹åºå¯åŠ¨ä¹‹åä¼šæ‰“æ‰“å°å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-10 16:51:26.487852+0800 Runtime[38325:14188628] person load</span><br><span class="line">2018-09-10 16:51:26.489395+0800 Runtime[38325:14188628] student load</span><br><span class="line">2018-09-10 16:51:26.489825+0800 Runtime[38325:14188628] Student Category load</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡ä¸Šé¢çš„æ‰“å°ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œloadæ–¹æ³•æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼Œå¹¶ä¸”è°ƒç”¨çš„é¡ºåºæ˜¯çˆ¶ç±»-&gt;å­ç±»-&gt;åˆ†ç±»ã€‚</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç‚¹å‡»å±å¹•ï¼Œæ‰“å°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-10 16:53:36.481032+0800 Runtime[38325:14188628] person initialize</span><br><span class="line">2018-09-10 16:53:36.481312+0800 Runtime[38325:14188628] Student Category initialize</span><br><span class="line">2018-09-10 16:53:36.481437+0800 Runtime[38325:14188628] student say hello</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡æ‰“å°ä¿¡æ¯æˆ‘ä»¬çŸ¥é“ï¼Œåªæœ‰å½“è¯¥ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™æ‰ä¼šè°ƒç”¨initializeæ–¹æ³•ï¼ŒåŒæ ·ä¼šä¼˜å…ˆè°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å­ç±»åŒæ ·ä¹Ÿå®ç°äº†initializeæ–¹æ³•ï¼Œè¿™é‡Œåªæ‰“å°äº†åˆ†ç±»çš„æ–¹æ³•ï¼Œä¼šä¸ä¼šæ˜¯åˆ†ç±»çš„æ–¹æ³•æŠŠå­ç±»çš„æ–¹æ³•è¦†ç›–äº†ï¼Ÿ</p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹å°†åˆ†ç±»çš„initializeæ–¹æ³•æ³¨é‡Šæ‰ï¼Œç„¶åé‡æ–°è¿è¡Œç‚¹å‡»å±å¹•ï¼Œæ‰“å°ä¿¡æ¯å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-10 17:00:22.099887+0800 Runtime[39163:14201501] person initialize</span><br><span class="line">2018-09-10 17:00:22.100215+0800 Runtime[39163:14201501] student initialize</span><br><span class="line">2018-09-10 17:00:22.101254+0800 Runtime[39163:14201501] student say hello</span><br></pre></td></tr></table></figure><blockquote><p>æœç„¶éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ï¼Œåˆ†ç±»çš„initializeç¡®å®ä¼šè¦†ç›–åŸç±»çš„initializeæ–¹æ³•ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœå­ç±»ä¹Ÿä¸å®ç°initializeæ–¹æ³•çš„è¯ï¼Œè¿™æ ·è¿˜ä¼šè°ƒç”¨åˆ°çˆ¶ç±»çš„initializeæ–¹æ³•å—ï¼Ÿ</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†Studentç±»çš„initializeæ–¹æ³•æ³¨é‡Šæ‰ï¼Œçœ‹ä¸€ä¸‹æ‰“å°ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-09-10 17:02:47.361138+0800 Runtime[39388:14205240] person initialize</span><br><span class="line">2018-09-10 17:02:47.361337+0800 Runtime[39388:14205240] person initialize</span><br><span class="line">2018-09-10 17:02:47.361451+0800 Runtime[39388:14205240] student say hello</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡æ‰“å°ä¿¡æ¯æˆ‘ä»¬çœ‹å‡ºæ¥äº†ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°å¯¹åº”çš„initializeæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šè°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ã€‚å¯æ˜¯ä¸ºä»€ä¹ˆçˆ¶ç±»initializeæ–¹æ³•ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡å‘¢ï¼Œæ˜¯ä¸æ˜¯æ¯ä¸ªå­ç±»ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™éƒ½ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•å‘¢ï¼Ÿ</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ViewControllerçš„<code>TouchBegan</code>æ–¹æ³•ä¿®æ”¹ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Person hello];</span><br><span class="line">[Student hello];</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“å°ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-09-10 17:06:34.228551+0800 Runtime[39744:14211193] person initialize</span><br><span class="line">2018-09-10 17:06:34.228788+0800 Runtime[39744:14211193] Person say hello</span><br><span class="line">2018-09-10 17:06:34.229098+0800 Runtime[39744:14211193] person initialize</span><br><span class="line">2018-09-10 17:06:34.229187+0800 Runtime[39744:14211193] student say hello</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡æ‰“å°ä¿¡æ¯æˆ‘ä»¬çœ‹åˆ°äº†å½“Personæ”¶åˆ°helloæ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è‡ªèº«çš„initializeæ–¹æ³•ï¼Œå½“Personçš„å­ç±»Studentæ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™ï¼ŒåŒæ ·è°ƒç”¨äº†çˆ¶ç±»çš„initializeæ–¹æ³•ï¼ˆè¿™ä¸ªæ˜¯å› ä¸ºä¹‹ç±»æ²¡æœ‰å®ç°initializeæ–¹æ³•ï¼Œåˆšåˆšå·²ç»è®ºè¯ã€‚ï¼‰ï¼Œé€šè¿‡å’Œä¸Šä¸ªæ‰“å°ä¿¡æ¯å¯¹æ¯”ï¼Œæˆ‘ä»¬å‘ç°äº†å¦‚æœå­ç±»ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯ä¹‹å‰ï¼Œçˆ¶ç±»æ²¡æœ‰æ”¶åˆ°è¿‡æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è°ƒç”¨è¿‡initializeæ–¹æ³•ï¼Œä¼šå…ˆè°ƒç”¨initializeåˆå§‹åŒ–çˆ¶ç±»ï¼Œå¦‚æœçˆ¶ç±»initializeæ–¹æ³•å·²ç»è¢«è°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè°ƒç”¨çˆ¶ç±»çš„initializeçš„æ–¹æ³•ï¼Œè€Œä¸”è°ƒç”¨è‡ªèº«çš„initializeæ–¹æ³•ï¼Œå¦‚æœè‡ªèº«çš„initializeæ–¹æ³•æ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆå°±è°ƒç”¨çˆ¶ç±»initializeæ–¹æ³•ã€‚</p></blockquote><p><strong>æˆ‘ä»¬åšäº†è¿™ä¹ˆå¤šçš„å¯¹æ¯”è®ºè¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä¸Šé¢å¾—åˆ°çš„ç»“è®º</strong></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹çš„ä¿¡æ¯ï¼š</p><blockquote><ul><li>è°ƒç”¨æ—¶æœº<br> <code>+(void)load</code>æ˜¯åœ¨ç±»æˆ–è€…åˆ†ç±»åŠ å…¥åˆ°Objective-C Runtimeçš„æ—¶å€™è°ƒç”¨<br> <code>+(void)initialize</code>æ˜¯åœ¨ç±»æˆ–è€…å­ç±»ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ï¼ˆç±»æ¶ˆæ¯æˆ–è€…å¯¹è±¡æ¶ˆæ¯ï¼‰</li></ul></blockquote><blockquote><ul><li>è°ƒç”¨é¡ºåº<br>   <code>+(void)load</code>æ–¹æ³•çš„è°ƒç”¨é¡ºåºæ˜¯ï¼Œçˆ¶ç±»-&gt;å­ç±»-&gt;åˆ†ç±»ã€‚<br>   <code>+(void)initialize</code>æ–¹æ³•çš„é¡ºåºæ˜¯ï¼Œçˆ¶ç±»-&gt;å­ç±»ï¼ˆå¦‚æœæœ‰åˆ†ç±»ï¼Œåˆ†ç±»æ–¹æ³•ä¼šæ›¿æ¢å­ç±»çš„æ–¹æ³•ï¼Œåªæ‰§è¡Œåˆ†ç±»çš„å®ç°ï¼‰</li></ul></blockquote><blockquote><ul><li>è°ƒç”¨æ¬¡æ•°<br> <code>+(void)load</code>æ–¹æ³•åªä¼šè°ƒç”¨ä¸€æ¬¡<br> <code>+(void)initialize</code>æœ‰å¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œåˆ™å­ç±»ç¬¬ä¸€æ¬¡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™ä¼šè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚<br>  å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœåœ¨å­ç±»æ”¶åˆ°æ¶ˆæ¯ä¹‹å‰ï¼Œçˆ¶ç±»åŠå…¶å…¶ä»–å­ç±»æ²¡æœ‰æ”¶åˆ°è¿‡æ¶ˆæ¯ï¼Œé‚£ä¹ˆä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„<code>initialize</code>æ–¹æ³•å†è°ƒç”¨å­ç±»çš„<code>initialize</code>æ–¹æ³•</li></ul></blockquote><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>è¿™ä¸€ç³»åˆ—çš„å¯¹æ¯”å®éªŒä¸‹æ¥æˆ‘ä»¬å¾—å‡ºäº†è‡ªå·±çš„è®ºè¯ç»“æœï¼Œä½†æ˜¯ä»å®ç°åŸç†ä¸Šé¢æ¥è¯´æˆ‘è¿˜æ˜¯å¯¹å®ƒä»¬çš„åº•å±‚å®ç°å¾ˆæ„Ÿå…´è¶£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹æºç å®ç°ã€‚</p><p>æºç æˆ‘è¿™è¾¹ä¸‹è½½çš„æ˜¯ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4-723</a>ç‰ˆæœ¬ã€‚</p><h2 id="void-load"><a href="#void-load" class="headerlink" title="+ (void)load"></a>+ (void)load</h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹åœ¨loadæ–¹æ³•æ˜¯åœ¨å“ªé‡Œè°ƒç”¨çš„ä»¥åŠåœ¨loadæ–¹æ³•ä¹‹å‰éƒ½åšäº†ä»€ä¹ˆï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//åœ¨_objc_initè¿è¡Œæ—¶åˆå§‹åŒ–æ–¹æ³•é‡Œé¢ä¼šæ³¨å†Œload_imagesçš„å›è°ƒï¼Œå½“æœ‰æ–°çš„é•œåƒåŠ è½½åˆ°runtimeæ—¶ï¼Œéƒ½ä¼šé€šçŸ¥load_imagesæ–¹æ³•</span><br><span class="line">_dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);</span><br><span class="line"></span><br><span class="line">//å¤„ç†ç”±DYLD(åŠ¨æ€é“¾æ¥å™¨)æ˜ å°„åŠ è½½çš„é•œåƒé‡Œé¢å¤„ç†loadæ–¹æ³•</span><br><span class="line">load_images(const char *path __unused, const struct mach_header *mh)</span><br><span class="line">&#123;</span><br><span class="line">    // Return without taking locks if there are no +load methods here.</span><br><span class="line">    if (!hasLoadMethods((const headerType *)mh)) return;</span><br><span class="line"></span><br><span class="line">    recursive_mutex_locker_t lock(loadMethodLock);</span><br><span class="line"></span><br><span class="line">    // Discover load methods</span><br><span class="line">    &#123;</span><br><span class="line">        rwlock_writer_t lock2(runtimeLock);</span><br><span class="line">        prepare_load_methods((const headerType *)mh);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Call +load methods (without runtimeLock - re-entrant)</span><br><span class="line">    call_load_methods();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥åˆ°å’Œloadæœ‰å…³çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯prepare_load_methodsä»¥åŠcall_load_methodsã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void prepare_load_methods(const headerType *mhdr)</span><br><span class="line">&#123;</span><br><span class="line">    size_t count, i;</span><br><span class="line"></span><br><span class="line">    runtimeLock.assertWriting();</span><br><span class="line"></span><br><span class="line">    classref_t *classlist = </span><br><span class="line">        _getObjc2NonlazyClassList(mhdr, &amp;count);</span><br><span class="line">    for (i = 0; i &lt; count; i++) &#123;</span><br><span class="line">        schedule_class_load(remapClass(classlist[i]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    category_t **categorylist = _getObjc2NonlazyCategoryList(mhdr, &amp;count);</span><br><span class="line">    for (i = 0; i &lt; count; i++) &#123;</span><br><span class="line">        category_t *cat = categorylist[i];</span><br><span class="line">        Class cls = remapClass(cat-&gt;cls);</span><br><span class="line">        if (!cls) continue;  // category for ignored weak-linked class</span><br><span class="line">        realizeClass(cls);</span><br><span class="line">        assert(cls-&gt;ISA()-&gt;isRealized());</span><br><span class="line">        add_category_to_loadable_list(cat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚é¦–å…ˆä¼šè·å–é•œåƒé‡Œé¢çš„æ‰€æœ‰çš„Classlistï¼Œç„¶åéå†è¯¥classListï¼Œè°ƒç”¨schedule_class_loadï¼Œä¼ å…¥æ¯ä¸€ä¸ªclassã€‚ç„¶åå…¨éƒ¨éå†å®Œæˆä¹‹åä¼šè·å–categoryï¼ŒåŒæ ·çš„éå†ä¹‹åç›´æ¥åŠ å…¥åˆ°loadable_categoriesåˆ—è¡¨ä¸­ã€‚<strong>è¿™æ ·æ˜¯ä¸ºäº†ä¿è¯classçš„loadæ–¹æ³•åœ¨categoryçš„loadæ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚</strong></p></li><li><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹schedule_class_load æ–¹æ³•ï¼š</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static void schedule_class_load(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    if (!cls) return;</span><br><span class="line">    assert(cls-&gt;isRealized());  // _read_images should realize</span><br><span class="line"></span><br><span class="line">    if (cls-&gt;data()-&gt;flags &amp; RW_LOADED) return;</span><br><span class="line"></span><br><span class="line">    // Ensure superclass-first ordering</span><br><span class="line">    schedule_class_load(cls-&gt;superclass);</span><br><span class="line"></span><br><span class="line">    add_class_to_loadable_list(cls);</span><br><span class="line">    cls-&gt;setInfo(RW_LOADED); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¯¥æ–¹æ³•ä¼šè·å–è¯¥ç±»çš„çˆ¶ç±»ç„¶åé€’å½’è°ƒç”¨<code>schedule_class_load</code>æ–¹æ³•ï¼Œä¿è¯çˆ¶ç±»çš„loadæ–¹æ³•åœ¨å­ç±»çš„loadæ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚ç„¶åå°†class åŠ å…¥åˆ°loadable_classesé‡Œé¢ã€‚</li></ul><p><strong>ç»¼ä¸Šæ‰€è¿°ï¼Œprepare_load_methodsè¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†æ»¡è¶³loadæ–¹æ³•çš„classå’Œcategoryåˆ†åˆ«å­˜æ”¾åˆ°loadble_classsä»¥åŠloadable_categoriesé‡Œé¢</strong></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹<code>call_load_methods</code>æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">void call_load_methods(void)</span><br><span class="line">&#123;</span><br><span class="line">    static bool loading = NO;</span><br><span class="line">    bool more_categories;</span><br><span class="line"></span><br><span class="line">    loadMethodLock.assertLocked();</span><br><span class="line"></span><br><span class="line">    // Re-entrant calls do nothing; the outermost call will finish the job.</span><br><span class="line">    if (loading) return;</span><br><span class="line">    loading = YES;</span><br><span class="line"></span><br><span class="line">    void *pool = objc_autoreleasePoolPush();</span><br><span class="line"></span><br><span class="line">    do &#123;</span><br><span class="line">        // 1. Repeatedly call class +loads until there aren&apos;t any more</span><br><span class="line">        while (loadable_classes_used &gt; 0) &#123;</span><br><span class="line">            call_class_loads();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2. Call category +loads ONCE</span><br><span class="line">        more_categories = call_category_loads();</span><br><span class="line"></span><br><span class="line">        // 3. Run more +loads if there are classes OR more untried categories</span><br><span class="line">    &#125; while (loadable_classes_used &gt; 0  ||  more_categories);</span><br><span class="line"></span><br><span class="line">    objc_autoreleasePoolPop(pool);</span><br><span class="line"></span><br><span class="line">    loading = NO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸€æ­¥å°±æ˜¯è°ƒç”¨loabable_classes ä»¥åŠ loadable_categoriesä¸­å‡†å¤‡å¥½çš„loadæ–¹æ³•ï¼Œå¹¶ä¸”classä¼˜å…ˆäºcategoryå…ˆè°ƒç”¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥call_class_loadsä¸ºä¾‹æ¥çœ‹çœ‹ä»£ç ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">static void call_class_loads(void)</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line">    </span><br><span class="line">    // Detach current loadable list.</span><br><span class="line">    struct loadable_class *classes = loadable_classes;</span><br><span class="line">    int used = loadable_classes_used;</span><br><span class="line">    loadable_classes = nil;</span><br><span class="line">    loadable_classes_allocated = 0;</span><br><span class="line">    loadable_classes_used = 0;</span><br><span class="line">    </span><br><span class="line">    // Call all +loads for the detached list.</span><br><span class="line">    for (i = 0; i &lt; used; i++) &#123;</span><br><span class="line">        Class cls = classes[i].cls;</span><br><span class="line">        load_method_t load_method = (load_method_t)classes[i].method;</span><br><span class="line">        if (!cls) continue; </span><br><span class="line"></span><br><span class="line">        if (PrintLoading) &#123;</span><br><span class="line">            _objc_inform(&quot;LOAD: +[%s load]\n&quot;, cls-&gt;nameForLogging());</span><br><span class="line">        &#125;</span><br><span class="line">        (*load_method)(cls, SEL_load);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Destroy the detached list.</span><br><span class="line">    if (classes) free(classes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»å…¨å±€å˜é‡loadable_classesä¸­å¾—åˆ°æ‰€æœ‰å¯ä¾›è°ƒç”¨çš„classï¼Œç„¶åå°†å˜é‡è¿›è¡Œæ¸…é›¶æ“ä½œï¼Œç„¶åéå†åŠ è½½æ‰€æœ‰çš„class,é€šè¿‡<code>(*load_method)(cls, SEL_load);</code>çš„æ–¹å¼è°ƒç”¨+(void)loadæ–¹æ³•ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ç›´æ¥è°ƒç”¨å‡½æ•°çš„å†…å­˜åœ°å€çš„æ–¹å¼æ¥å®ç°è°ƒç”¨loadæ–¹æ³•ï¼Œè€Œä¸æ˜¯objcå¸¸è§çš„msg_send()æ–¹æ³•ã€‚<br><strong>æ‰€ä»¥è¿™é‡Œå°±å¯ä»¥è§£é‡Šäº†ä¸ºä»€ä¹ˆå­ç±»æ²¡æœ‰å®ç°loadæ–¹æ³•çš„æ—¶å€™ä¸ä¼šè°ƒç”¨åˆ°çˆ¶ç±»çš„loadæ–¹æ³•ï¼Œå› ä¸ºä¸æ˜¯é€šè¿‡msg_sendçš„æ–¹å¼å»è°ƒç”¨çš„ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªç±»çš„loadæ–¹æ³•éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šæœ‰æ¶ˆæ¯çš„è½¬å‘ç­‰æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåš<a href="https://nshipster.com/method-swizzling/" target="_blank" rel="noopener">method swizzling</a></strong></li></ul><h2 id="void-initialize"><a href="#void-initialize" class="headerlink" title="+ (void)initialize"></a>+ (void)initialize</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹<code>+ (void)initialize</code>æ–¹æ³•æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼Œæˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹runtime-new.mmæ–‡ä»¶é‡Œé¢çš„lookUpImpOrForwardæ–¹æ³•ï¼Œæˆ‘ç›¸ä¿¡æœ‰äº›äººçœ‹åˆ°è¿™ä¸ªæ–¹æ³•åº”è¯¥è§‰å¾—æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œè¿™é‡Œå°±æ˜¯è¿”å›ä¸€ä¸ªæ–¹æ³•çš„å®ç°æˆ–è€…æ¶ˆæ¯è½¬å‘çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">IMP lookUpImpOrForward(Class cls, SEL sel, id inst, </span><br><span class="line">                       bool initialize, bool cache, bool resolver)</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">    if (initialize  &amp;&amp;  !cls-&gt;isInitialized()) &#123;</span><br><span class="line">        runtimeLock.unlockRead();</span><br><span class="line">        _class_initialize (_class_getNonMetaClass(cls, inst));</span><br><span class="line">        runtimeLock.read();</span><br><span class="line">        // If sel == initialize, _class_initialize will send +initialize and </span><br><span class="line">        // then the messenger will send +initialize again after this </span><br><span class="line">        // procedure finishes. Of course, if this is not being called </span><br><span class="line">        // from the messenger then it won&apos;t happen. 2778172</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä¸Šé¢çš„å…³é”®ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå½“ä¸€ä¸ªç±»çš„æ–¹æ³•ä»»ä½•ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šåˆ¤æ–­è¯¥ç±»æ˜¯å¦å·²ç»è°ƒç”¨äº†initializeæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨çš„è¯å°±ä¼šé€šè¿‡<code>void_class_initialize(Class cls)</code>æ–¹æ³•æ¥è°ƒç”¨initializeæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹å…·ä½“å®ç°ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">void _class_initialize(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    assert(!cls-&gt;isMetaClass());</span><br><span class="line"></span><br><span class="line">    Class supercls;</span><br><span class="line">    bool reallyInitialize = NO;</span><br><span class="line"></span><br><span class="line">    // Make sure super is done initializing BEFORE beginning to initialize cls.</span><br><span class="line">    // See note about deadlock above.</span><br><span class="line">    supercls = cls-&gt;superclass;</span><br><span class="line">    if (supercls  &amp;&amp;  !supercls-&gt;isInitialized())   &#123;</span><br><span class="line">        _class_initialize(supercls);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Try to atomically set CLS_INITIALIZING.</span><br><span class="line">    &#123;</span><br><span class="line">        monitor_locker_t lock(classInitLock);</span><br><span class="line">        if (!cls-&gt;isInitialized() &amp;&amp; !cls-&gt;isInitializing()) &#123;</span><br><span class="line">            cls-&gt;setInitializing();</span><br><span class="line">            reallyInitialize = YES;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (reallyInitialize) &#123;</span><br><span class="line">        // We successfully set the CLS_INITIALIZING bit. Initialize the class.</span><br><span class="line">        </span><br><span class="line">        // Record that we&apos;re initializing this class so we can message it.</span><br><span class="line">        _setThisThreadIsInitializingClass(cls);</span><br><span class="line"></span><br><span class="line">        if (MultithreadedForkChild) &#123;</span><br><span class="line">            // LOL JK we don&apos;t really call +initialize methods after fork().</span><br><span class="line">            performForkChildInitialize(cls, supercls);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // Send the +initialize message.</span><br><span class="line">        // Note that +initialize is sent to the superclass (again) if </span><br><span class="line">        // this class doesn&apos;t implement +initialize. 2157218</span><br><span class="line">        if (PrintInitializing) &#123;</span><br><span class="line">            _objc_inform(&quot;INITIALIZE: thread %p: calling +[%s initialize]&quot;,</span><br><span class="line">                         pthread_self(), cls-&gt;nameForLogging());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Exceptions: A +initialize call that throws an exception </span><br><span class="line">        // is deemed to be a complete and successful +initialize.</span><br><span class="line">        //</span><br><span class="line">        // Only __OBJC2__ adds these handlers. !__OBJC2__ has a</span><br><span class="line">        // bootstrapping problem of this versus CF&apos;s call to</span><br><span class="line">        // objc_exception_set_functions().</span><br><span class="line">#if __OBJC2__</span><br><span class="line">        @try</span><br><span class="line">#endif</span><br><span class="line">        &#123;</span><br><span class="line">        </span><br><span class="line">        //é€šè¿‡objc_msgSendæ–¹æ³•è°ƒç”¨initializeæ–¹æ³•</span><br><span class="line">           ((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);</span><br><span class="line">    asm(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">            if (PrintInitializing) &#123;</span><br><span class="line">                _objc_inform(&quot;INITIALIZE: thread %p: finished +[%s initialize]&quot;,</span><br><span class="line">                             pthread_self(), cls-&gt;nameForLogging());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">#if __OBJC2__</span><br><span class="line">        @catch (...) &#123;</span><br><span class="line">            if (PrintInitializing) &#123;</span><br><span class="line">                _objc_inform(&quot;INITIALIZE: thread %p: +[%s initialize] &quot;</span><br><span class="line">                             &quot;threw an exception&quot;,</span><br><span class="line">                             pthread_self(), cls-&gt;nameForLogging());</span><br><span class="line">            &#125;</span><br><span class="line">            @throw;</span><br><span class="line">        &#125;</span><br><span class="line">        @finally</span><br><span class="line">#endif</span><br><span class="line">        &#123;</span><br><span class="line">            // Done initializing.</span><br><span class="line">            lockAndFinishInitializing(cls, supercls);</span><br><span class="line">        &#125;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬çœ‹åˆ°äº†è¯¥æ–¹æ³•é¦–å…ˆä¼šè·å–è¯¥ç±»çš„çˆ¶ç±»ï¼Œå¹¶ä¸”é€’å½’è°ƒç”¨<code>_class_initialize</code>æ–¹æ³•ä¿è¯çˆ¶ç±»çš„æ–¹æ³•ä¼˜å…ˆäºå­ç±»æ‰§è¡Œã€‚ç„¶åæˆ‘ä»¬çœ‹åˆ°äº†æœ‰ä¸€è¡Œå¾ˆå…³é”®çš„ä»£ç ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);</span><br><span class="line">  asm(&quot;&quot;);</span><br></pre></td></tr></table></figure><ul><li>+(void)initializeæ–¹æ³•æ˜¯é€šè¿‡objc_msgSendæ–¹æ³•æ¥è°ƒç”¨çš„ï¼ŒåŒºåˆ«äºloadæ–¹æ³•é€šè¿‡æ–¹æ³•å†…å­˜åœ°å€è°ƒç”¨ï¼Œæ‰€ä»¥æ ¹æ®objc_msgSendçš„ç‰¹æ€§ï¼Œå¦‚æœä¸€ä¸ªå­ç±»æ²¡æœ‰å®ç°initializeæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šè°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ï¼Œå¦‚æœåˆ†ç±»å®ç°äº†initializeæ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šæ›¿æ¢å­ç±»æ–¹æ³•ã€‚</li></ul><p><strong>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªç±»çš„initializeæ–¹æ³•æ˜¯æœ‰å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡çš„ï¼Œå¦‚æœä»–æœ‰å¯¹åº”çš„å­ç±»å¹¶ä¸”å­ç±»æ²¡æœ‰å®ç°å¯¹åº”çš„initializeæ–¹æ³•çš„æ—¶å€™æœ¬ç±»çš„initializeæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯ä¸€ä¸ªç±»çš„initializeæ–¹æ³•é‡Œé¢çš„é€»è¾‘åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ä»£ç åˆ¤æ–­</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (void)initialize &#123;</span><br><span class="line">  if (self == [ClassName self]) &#123;</span><br><span class="line">    // ... do the initialization ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“åœ¨NSObjectä¸­æœ‰ä¸¤ä¸ªåˆå§‹åŒ–çš„æ–¹æ³•ï¼Œ&lt;code&gt;+(void)load&lt;/code&gt;ä»¥åŠ&lt;code&gt;+ (void)initialize&lt;/code&gt;æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”±ç³»ç»Ÿæ¥è‡ªåŠ¨è°ƒç”¨ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•çš„å†…éƒ¨åšä¸€äº›magicçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é¦–å…ˆå¯¹è¿™ä¸¤ä¸ªæ–¹æ³•åšä¸€ä¸ªåˆæ­¥çš„ä½¿ç”¨ï¼Œçœ‹çœ‹ä»–ä»¬ä¸¤çš„è°ƒç”¨æ—¶æœºä»¥åŠå¼‚åŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“ç„¶å¦‚æœå·²ç»çŸ¥é“äº†ä»–ä»¬çš„å¼‚åŒä»¥åŠè°ƒç”¨é¡ºåºçš„å¯ä»¥ç›´æ¥çœ‹æ€»ç»“æˆ–è€…æºç åˆ†æ&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSå›¾ç‰‡è§£ç å®è·µ</title>
    <link href="http://lemon2well.top/2018/09/04/iOS%20%E5%BC%80%E5%8F%91/iOS%E5%9B%BE%E7%89%87%E8%A7%A3%E7%A0%81%E5%AE%9E%E8%B7%B5/"/>
    <id>http://lemon2well.top/2018/09/04/iOS å¼€å‘/iOSå›¾ç‰‡è§£ç å®è·µ/</id>
    <published>2018-09-04T03:40:15.000Z</published>
    <updated>2018-09-04T06:31:00.701Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨iOSä¸­ï¼Œå¤§å¤šæ•°çš„APPéƒ½æœ‰ä¸å¯æˆ–ç¼ºçš„å›¾ç‰‡èµ„æºï¼ŒåŒæ—¶ä¹Ÿå¾ˆå®¹æ˜“å› ä¸ºå¯¹å›¾ç‰‡çš„å¤„ç†ä¸æ°å½“é€ æˆæ€§èƒ½ä½ä¸‹ï¼Œä¸è¦è®©å›¾ç‰‡æˆä¸ºä½ çš„APPçš„æ€§èƒ½æ€æ‰‹ã€‚</p><p>ä¸€å¼ å›¾ç‰‡ä»ç£ç›˜ä¸­åŠ è½½å‡ºæ¥ï¼ŒåŒæ—¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œç»è¿‡äº†ä¸€ç³»åˆ—çš„å¤æ‚å¤„ç†ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¯¹å›¾ç‰‡çš„è§£ç ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥åšä¸€æ¬¡å›¾ç‰‡çš„è§£ç å®è·µã€‚</p><h2 id="å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹"><a href="#å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹" class="headerlink" title="å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹"></a>å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹</h2><p>å¹³æ—¶æˆ‘ä»¬å¯¹äºå›¾ç‰‡çš„æ˜¾ç¤ºï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;icon&quot;];</span><br><span class="line">self.imageView.image = image;</span><br></pre></td></tr></table></figure><a id="more"></a><blockquote><p>ç®€å•çš„ä¸¤è¡Œä»£ç å…¶å®é‡Œé¢åŒ…å«äº†ä¸‹é¢å‡ æ­¥:</p><ol><li>é¦–å…ˆä¼šè°ƒç”¨ <a href="https://developer.apple.com/library/ios/documentation/graphicsimaging/conceptual/ImageIOGuide/imageio_intro/ikpg_intro.html#//apple_ref/doc/uid/TP40005462-CH201-TPXREF101" target="_blank" rel="noopener">image/io</a>ä»ç£ç›˜ä¸­åŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå›¾ç‰‡è¿˜æ²¡æœ‰è§£ç ã€‚</li><li>å°†imageå¤åˆ¶ç»™imageViewçš„image</li><li>ç„¶åä¸€ä¸ªéšå¼çš„CATransactionæ•è·åˆ°å›¾å±‚æ ‘çš„å˜åŒ–</li><li>åœ¨ä¸»çº¿ç¨‹runloopä¸‹ä¸€æ¬¡è¿­ä»£åˆ°æ¥çš„æ—¶å€™ï¼ŒCore Animationä¼šæäº¤è¿™ä¸ªéšå¼transactionï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¯¹å›¾ç‰‡è¿›è¡Œcopyæ“ä½œï¼Œæ ¹æ®å›¾ç‰‡çš„ä¸åŒï¼Œå¯èƒ½ä¼šæ¶‰åŠä»¥ä¸‹çš„ä¸€äº›ç”šè‡³å…¨éƒ¨çš„æ­¥éª¤ã€‚</li></ol></blockquote><blockquote><pre><code>I. ä¸ºæ–‡ä»¶ç®¡ç†IOå’Œè§£å‹ç¼©æ“ä½œåˆ†é…å†…å­˜ç¼“å­˜åŒºåŸŸII. ä»ç£ç›˜ä¸­è¯»å–æ•°æ®åˆ°å†…å­˜ä¸­III. å°†å‹ç¼©çš„å›¾ç‰‡æ•°æ®è§£ç æˆæœªå‹ç¼©çš„å›¾ç‰‡æ•°æ®ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªéå¸¸é¢‘ç¹è€—æ—¶çš„CPUæ“ä½œIV. CoreAnimationå°†æœªå‹ç¼©ä½å›¾æ•°æ®æ¸²æŸ“åˆ°layerä¸Šã€‚</code></pre></blockquote><p>ä»ä¸Šé¢çš„æ­¥éª¤å¯ä»¥çœ‹å‡ºï¼Œå›¾ç‰‡çš„è§£ç ä¸»æ˜¯ä¸»è¦è€—æ—¶çš„åŸå› ï¼Œå¦‚æœä¸€ä¸ªAPPä¸­åªæœ‰å‡ å¼ å›¾ç‰‡æ˜¯è¿™æ ·è®¾ç½®å½“ç„¶æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯æ˜¯å¦‚æœåœ¨ä¸€ä¸ªTableViewä¸­æœ‰å¤§é‡çš„å›¾ç‰‡åœ¨æ»šåŠ¨ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™åœ¨ä¸æ–­çš„è§£ç æ˜¾ç¤ºé‚£å¿…ç„¶ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ã€‚</p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦è§£ç "><a href="#ä¸ºä»€ä¹ˆéœ€è¦è§£ç " class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è§£ç "></a>ä¸ºä»€ä¹ˆéœ€è¦è§£ç </h2><p>å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨çš„JPEGæˆ–è€…PNGæ ¼å¼çš„å›¾ç‰‡ï¼Œéƒ½æ˜¯ä¸€ç§ç»è¿‡å‹ç¼©çš„ä½å›¾å›¾å½¢æ ¼å¼ï¼Œåªä¸è¿‡PNGæ˜¯æ— æŸå‹ç¼©å¹¶ä¸”æ”¯æŒalphaé€šé“ï¼Œè€ŒJEPGæ˜¯æœ‰æŸå‹ç¼©ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå‹ç¼©æ¯”ã€‚ä¸‹é¢æ˜¯iOSä¸­æä¾›çš„è·å¾—ä¸Šè¿°æ ¼å¼å›¾ç‰‡çš„æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UIKIT_EXTERN  NSData * __nullable UIImagePNGRepresentation(UIImage * __nonnull image);                               // return image as PNG. May return nil if image has no CGImageRef or invalid bitmap format</span><br><span class="line">UIKIT_EXTERN  NSData * __nullable UIImageJPEGRepresentation(UIImage * __nonnull image, CGFloat compressionQuality);  // return image as JPEG. May return nil if image has no CGImageRef or invalid bitmap format. compression is 0(most)..1(least)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦äº†è§£ä¸€ä¸‹ä½å›¾ï¼š</p><blockquote><p>A bitmap image (or sampled image) is an array of pixels (or samples). Each pixel represents a single point in the image. JPEG, TIFF, and PNG graphics files are examples of bitmap images.</p></blockquote><p>å…¶å®ä½å›¾å°±æ˜¯ä¸€ä¸ªåƒç´ æ•°ç»„ï¼Œæ¯ä¸ªåƒç´ éƒ½ä»£è¡¨äº†å›¾ç‰‡ä¸­ç‹¬ç«‹çš„ä¸€ä¸ªç‚¹ï¼Œæ¯ä¸€ä¸ªç‚¹å…¶å®åˆåŒ…å«äº†ä»¥ä¸‹å†…å®¹ï¼š</p><blockquote><p>Bits per component ï¼šä¸€ä¸ªåƒç´ ä¸­æ¯ä¸ªç‹¬ç«‹çš„é¢œè‰²åˆ†é‡ä½¿ç”¨çš„ bit æ•°ï¼›<br>Bits per pixel ï¼šä¸€ä¸ªåƒç´ ä½¿ç”¨çš„æ€» bit æ•°ï¼›<br>Bytes per row ï¼šä½å›¾ä¸­çš„æ¯ä¸€è¡Œä½¿ç”¨çš„å­—èŠ‚æ•°ã€‚</p></blockquote><p>è¿™é‡Œä¸å¤šè¯´ï¼Œå…·ä½“çš„å¯ä»¥æŸ¥çœ‹<a href="https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_images/dq_images.html#//apple_ref/doc/uid/TP30001066-CH212-CJBECCFG" target="_blank" rel="noopener">åƒç´ æ ¼å¼</a>ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ä½å›¾æ˜¯ç»è¿‡å‹ç¼©åçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UIImage *image = [UIImage imageNamed:@&quot;icon&quot;];</span><br><span class="line">CFDataRef rawData = CGDataProviderCopyData(CGImageGetDataProvider(image.CGImage));</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åŸå§‹çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬è¯¥æ•°æ®çš„å¤§å°çš„è®¡ç®—æ–¹å¼æ˜¯ï¼š</p><blockquote><p>å›¾ç‰‡åƒç´ å®½<em> å›¾ç‰‡åƒç´ é«˜  </em> æ¯ä¸ªåƒç´ æ‰€å çš„å­—èŠ‚æ•°4</p></blockquote><p>æ‰€ä»¥å›¾ç‰‡å½“å‰çš„å¤§å°å¹¶ä¸ç­‰äºè§£ç åçš„å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰éœ€è¦è§£ç ä¹‹åæ‰èƒ½å¾—åˆ°åŸå§‹çš„æ•°æ®å¤§å°ï¼Œåªæœ‰ä½¿ç”¨åŸå§‹æ•°æ®æ‰èƒ½æ­£ç¡®çš„æ˜¾ç¤ºå‡ºå›¾ç‰‡ã€‚</p><h2 id="æ­£ç¡®çš„è§£ç å§¿åŠ¿"><a href="#æ­£ç¡®çš„è§£ç å§¿åŠ¿" class="headerlink" title="æ­£ç¡®çš„è§£ç å§¿åŠ¿"></a>æ­£ç¡®çš„è§£ç å§¿åŠ¿</h2><p>ä¸Šé¢å·²ç»çŸ¥é“äº†å›¾ç‰‡æ˜¾ç¤ºæ˜¯ä¼šåœ¨ä¸»çº¿ç¨‹è§£å‹ç¼©å›¾ç‰‡ä¹‹åç„¶åæ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­åšè§£ç çš„æ“ä½œï¼Œåœ¨å­çº¿ç¨‹ä¸­é‡æ–°ç»˜åˆ¶å›¾ç‰‡ï¼Œå¾—åˆ°è§£ç åçš„å›¾ç‰‡ï¼Œç„¶åæ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚</p><p>æˆ‘ä»¬å…ˆä¸Šä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">- (void)decodeImage:(UIImage *)image completion:(void(^)(UIImage *image))completion&#123;</span><br><span class="line">    if (!image) return;</span><br><span class="line">    //åœ¨å­çº¿ç¨‹æ‰§è¡Œè§£ç æ“ä½œ</span><br><span class="line">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0), ^&#123;</span><br><span class="line">        CGImageRef imageRef = image.CGImage;</span><br><span class="line">        //è·å–åƒç´ å®½å’Œåƒç´ é«˜</span><br><span class="line">        size_t width = CGImageGetWidth(imageRef);</span><br><span class="line">        size_t height = CGImageGetHeight(imageRef);</span><br><span class="line">        if (width == 0 || height == 0) return ;</span><br><span class="line">        CGImageAlphaInfo alphaInfo = CGImageGetAlphaInfo(imageRef) &amp; kCGBitmapAlphaInfoMask;</span><br><span class="line">        BOOL hasAlpha = NO;</span><br><span class="line">        //åˆ¤æ–­é¢œè‰²æ˜¯å¦å«æœ‰alphaé€šé“</span><br><span class="line">        if (alphaInfo == kCGImageAlphaPremultipliedLast ||</span><br><span class="line">            alphaInfo == kCGImageAlphaPremultipliedFirst ||</span><br><span class="line">            alphaInfo == kCGImageAlphaLast ||</span><br><span class="line">            alphaInfo == kCGImageAlphaFirst) &#123;</span><br><span class="line">            hasAlpha = YES;</span><br><span class="line">        &#125;</span><br><span class="line">        //åœ¨iOSä¸­ï¼Œä½¿ç”¨çš„æ˜¯å°ç«¯æ¨¡å¼ï¼Œåœ¨macä¸­ä½¿ç”¨çš„æ˜¯å¤§ç«¯æ¨¡å¼ï¼Œä¸ºäº†å…¼å®¹ï¼Œæˆ‘ä»¬ä½¿ç”¨kCGBitmapByteOrder32Hostï¼Œ32ä½å­—èŠ‚é¡ºåºï¼Œè¯¥å®åœ¨ä¸åŒçš„å¹³å°ä¸Šé¢ä¼šè‡ªåŠ¨ç»„è£…æ¢æˆä¸åŒçš„æ¨¡å¼ã€‚</span><br><span class="line">        /*</span><br><span class="line">         #ifdef __BIG_ENDIAN__</span><br><span class="line">         # define kCGBitmapByteOrder16Host kCGBitmapByteOrder16Big</span><br><span class="line">         # define kCGBitmapByteOrder32Host kCGBitmapByteOrder32Big</span><br><span class="line">         #else    //Little endian.</span><br><span class="line">         # define kCGBitmapByteOrder16Host kCGBitmapByteOrder16Little</span><br><span class="line">         # define kCGBitmapByteOrder32Host kCGBitmapByteOrder32Little</span><br><span class="line">         #endif</span><br><span class="line">         */</span><br><span class="line">        </span><br><span class="line">        CGBitmapInfo bitmapInfo = kCGBitmapByteOrder32Host;</span><br><span class="line">        //æ ¹æ®æ˜¯å¦å«æœ‰alphaé€šé“ï¼Œå¦‚æœæœ‰åˆ™ä½¿ç”¨kCGImageAlphaPremultipliedFirstï¼ŒARGBå¦åˆ™ä½¿ç”¨kCGImageAlphaNoneSkipFirstï¼ŒRGB</span><br><span class="line">        bitmapInfo |= hasAlpha ? kCGImageAlphaPremultipliedFirst : kCGImageAlphaNoneSkipFirst;</span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªä½å›¾ä¸Šä¸‹æ–‡</span><br><span class="line">        CGContextRef context = CGBitmapContextCreate(NULL, width, height, 8, 0,  CGColorSpaceCreateDeviceRGB(), bitmapInfo);</span><br><span class="line">        if (!context) return;</span><br><span class="line">        //å°†åŸå§‹å›¾ç‰‡ç»˜åˆ¶åˆ°ä¸Šä¸‹æ–‡å½“ä¸­</span><br><span class="line">        CGContextDrawImage(context, CGRectMake(0, 0, width, height), imageRef);</span><br><span class="line">        //åˆ›å»ºä¸€å¼ æ–°çš„è§£å‹åçš„ä½å›¾</span><br><span class="line">        CGImageRef newImage = CGBitmapContextCreateImage(context);</span><br><span class="line">        CFRelease(context);</span><br><span class="line">        UIImage *originImage =[UIImage imageWithCGImage:newImage scale:[UIScreen mainScreen].scale orientation:image.imageOrientation];</span><br><span class="line">        //å›åˆ°ä¸»çº¿ç¨‹å›è°ƒ</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            completion(originImage);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h2><table><thead><tr><th>å›¾ç‰‡å°ºå¯¸</th><th>æœªè§£ç ç›´æ¥æ¸²æŸ“æ—¶é—´(ms)</th><th>è§£ç åæ¸²æŸ“æ—¶é—´(ms)</th></tr></thead><tbody><tr><td>128x96.jpg</td><td>0.99</td><td>0.08</td></tr><tr><td>128x96.png</td><td>0.80</td><td>0.08</td></tr><tr><td>256x192.jpg</td><td>3.01</td><td>0.14</td></tr><tr><td>256x192.png</td><td>2.30</td><td>0.17</td></tr><tr><td>512x384.jpg</td><td>4.83</td><td>0.28</td></tr><tr><td>512x384.png</td><td>6.03</td><td>0.28</td></tr><tr><td>1024x768.jpg</td><td>13.83</td><td>1.43</td></tr><tr><td>1024x768.png</td><td>18.31</td><td>1.12</td></tr><tr><td>2048x1536.jpg</td><td>31.72</td><td>3.99</td></tr><tr><td>2048x1536.png</td><td>75.05</td><td>5.16</td></tr></tbody></table><p>é€šè¿‡ä¸Šé¢çš„å¯¹æ¯”æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè§£ç åçš„å›¾ç‰‡çš„æ¸²æŸ“é€Ÿåº¦è¿œè¿œé«˜äºæœªè§£ç åçš„å›¾ç‰‡çš„æ¸²æŸ“é€Ÿåº¦ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œè§£ç ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šé€ æˆä¸»çº¿ç¨‹çš„UIå¡é¡¿ã€‚</p><h2 id="Demo-is-here"><a href="#Demo-is-here" class="headerlink" title="Demo is here"></a>Demo is here</h2><p>æœ€åï¼ŒæŒ‰ç…§å¸¸è§„ï¼Œè¿™é‡Œåº”è¯¥æœ‰ä¸€ä»½<a href="https://github.com/codemonkeybulucck/ImageUncompressing" target="_blank" rel="noopener">demo</a>;</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨iOSä¸­ï¼Œå¤§å¤šæ•°çš„APPéƒ½æœ‰ä¸å¯æˆ–ç¼ºçš„å›¾ç‰‡èµ„æºï¼ŒåŒæ—¶ä¹Ÿå¾ˆå®¹æ˜“å› ä¸ºå¯¹å›¾ç‰‡çš„å¤„ç†ä¸æ°å½“é€ æˆæ€§èƒ½ä½ä¸‹ï¼Œä¸è¦è®©å›¾ç‰‡æˆä¸ºä½ çš„APPçš„æ€§èƒ½æ€æ‰‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¼ å›¾ç‰‡ä»ç£ç›˜ä¸­åŠ è½½å‡ºæ¥ï¼ŒåŒæ—¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œç»è¿‡äº†ä¸€ç³»åˆ—çš„å¤æ‚å¤„ç†ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¯¹å›¾ç‰‡çš„è§£ç ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥åšä¸€æ¬¡å›¾ç‰‡çš„è§£ç å®è·µã€‚&lt;/p&gt;
&lt;h2 id=&quot;å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹&quot;&gt;&lt;/a&gt;å›¾ç‰‡æ˜¾ç¤ºè¿‡ç¨‹&lt;/h2&gt;&lt;p&gt;å¹³æ—¶æˆ‘ä»¬å¯¹äºå›¾ç‰‡çš„æ˜¾ç¤ºï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ä»¥ä¸‹çš„ä»£ç ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;UIImage *image = [UIImage imageNamed:@&amp;quot;icon&amp;quot;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;self.imageView.image = image;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½ çœ‹é‚£ä¸ªç¨‹åºå‘˜ï¼Œä»–å­¤ä¸å­¤ç‹¬</title>
    <link href="http://lemon2well.top/2018/08/31/%E6%9D%82%E8%B0%88/%E4%BD%A0%E7%9C%8B%E9%82%A3%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%EF%BC%8C%E4%BB%96%E5%AD%A4%E4%B8%8D%E5%AD%A4%E7%8B%AC/"/>
    <id>http://lemon2well.top/2018/08/31/æ‚è°ˆ/ä½ çœ‹é‚£ä¸ªç¨‹åºå‘˜ï¼Œä»–å­¤ä¸å­¤ç‹¬/</id>
    <published>2018-08-31T02:28:41.000Z</published>
    <updated>2018-08-31T02:29:25.970Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯æ˜ŸæœŸäº”ï¼Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ä¼°è®¡å·²ç»åœ¨ç¢ç£¨ç€å‘¨æœ«å»å“ªé‡Œæµªäº†ï¼Œæˆ–è€…å‘¨æœ«åœ¨å®¶ç¡ä¸ªå¤©æ˜åœ°æš—ï¼Œäº«å—ä¸€ä¸‹è¿™éš¾å¾—ä¸ç”¨æ—©èµ·æŒ¤è½¦æŒ¤åœ°é“çš„å‘¨æœ«ã€‚</p><p>é¾™å“¥çœ‹çœ‹æ‰‹è¡¨ï¼Œå‡Œæ™¨å››ç‚¹æ•´ï¼Œåˆšåƒå®Œé…¸èœç‰›è‚‰é¢çš„é¾™å“¥æ‰“ç®—ä¸‹ç­å›å®¶ã€‚è¿™å·²ç»æ˜¯é¾™å“¥è¿™å‘¨ç¬¬ä¸‰æ¬¡åŠ ç­åˆ°å‡Œæ™¨äº†ï¼Œåªæœ‰æ˜ŸæœŸäºŒçš„æ—¶å€™ä¼‘æ¯äº†ä¸€å¤©æ²¡åŠ ç­ï¼Œå› ä¸ºé¡¹ç›®å¿«è¦ä¸Šçº¿äº†ï¼Œä¼°è®¡å‘¨æœ«è¿˜å¾—åœ¨åŠå…¬å®¤åº¦è¿‡ã€‚</p><p>ä½œä¸ºâ€œèµ„æ·±â€ç¨‹åºå‘˜çš„é¾™å“¥è™½ç„¶æ‰å·¥ä½œä¸‰å¹´å¤šï¼Œä½†æ˜¯å·²ç»æœ‰äº”å¹´çš„å·¥ä½œç»éªŒäº†ã€‚å¦‚æœæ˜¯åŒè¡Œçš„è¯ä¼°è®¡ä¼šæ‡‚è¿™å¥è¯æ˜¯å•¥æ„æ€ï¼Œé‚£å¤šå‡ºæ¥çš„ä¸€å¹´åŠçš„å·¥ä½œç»éªŒå°±æ˜¯åŠ ç­å¤šå‡ºæ¥çš„ã€‚</p><a id="more"></a><p>åŠ ç­å¯¹äºé¾™å“¥æ¥è¯´å·²ç»å¸ç©ºè§æƒ¯äº†ï¼Œå› ä¸ºåŠ ç­ï¼Œä»–è®¤è¯†äº†å¾ˆå¤šå‡ºç§Ÿè½¦å¸æœºï¼Œé€šè¿‡å‡ºç§Ÿè½¦å¸æœºä»–å°±èƒ½çŸ¥é“ä»Šå¤©å“ªé‡Œå“ªé‡Œåˆå‘ç”Ÿä»€ä¹ˆå¤§äº‹äº†ï¼Œå“ªé‡Œçš„ä¼‘é—²ä¼šæ‰€èƒ½æä¾›æœ€å¥½è´¨é‡çš„æœåŠ¡ï¼Œå“ªé‡Œçš„äººæœ€æ²¡ç´ è´¨ã€‚é¾™å“¥æ¯æ¬¡å°±è¿™ä¹ˆååœ¨è½¦ä¸Šå¬å¸æœºé—²æ‰¯ç€ï¼Œä¹Ÿä¸ä¼šåé©³å¸æœºè¯´çš„ä¸å¯¹çš„äº‹æƒ…ã€‚å¯¹äºé¾™å“¥æ¥è¯´ä»–æ¯å¤©å‡Œæ™¨ç¢°åˆ°çš„è¿™äº›äººå°±æ˜¯ä»–çš„ç§äººæ–°é—»å¯¼æ’­ï¼Œåªä¸è¿‡æœ‰ç‚¹ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™äº›æ–°é—»å¾€å¾€è¢«æ”¾å¤§å¾ˆå¤šå€ï¼Œç”šè‡³æœ‰äº›æ˜¯è°£è¨€ï¼Œä¸è¿‡ä»–å¹¶ä¸åœ¨æ„ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€å¤©ä¸­æœ€æœ‰è¶£çš„æ—¶åˆ»ï¼Œæˆ–è€…æ›´ç¡®åˆ‡çš„è¯´ï¼Œè¿™æ˜¯é¾™å“¥æœ€ä¸å­¤ç‹¬çš„æ—¶åˆ»ã€‚</p><p>åˆšåˆšè¯´äº†é¾™å“¥ä¸­é—´æœ‰ä¸€å¤©ä¸åŠ ç­ï¼Œå…¶å®æ˜¯å»å¸®å¥³ç”Ÿæ¬å®¶äº†ï¼Œæ®è¯´è¿˜è¯·å¥³ç”Ÿåƒé¥­äº†ã€‚<br>é‚£å¤©æˆ‘è¿˜é—®äº†é¾™å“¥ï¼Œå¯¹è¯æ˜¯è¿™æ ·çš„ï¼š<br>æˆ‘ï¼šâ€é¾™å“¥ï¼Œä½ å»å¸®å¥³ç”Ÿæ¬å®¶ï¼Œåº”è¯¥å¥¹è¯·ä½ åƒé¥­æ‰å¯¹å•Šï¼Œæ€ä¹ˆå˜æˆä½ è¯·å¥¹åƒé¥­äº†ï¼Ÿâ€<br>é¾™å“¥ç¬‘ç€è¯´ï¼šâ€æˆ‘è¯·å¥¹åƒé¥­æ˜¯å› ä¸ºæˆ‘å·²ç»å¾ˆä¹…æ²¡æœ‰å’Œåˆ«äººä¸€èµ·åƒé¥­äº†ï¼Œæ¯å¤©ä¸‹ç­åŸºæœ¬ä¸Šéƒ½æ˜¯è‡ªå·±éšä¾¿åƒä¸€ç‚¹å°±è§£å†³äº†ï¼Œåº”è¯¥è¿˜è¦æ„Ÿè°¢å¥¹é™ªæˆ‘åƒé¥­ã€‚â€œ<br>æˆ‘ï¼šâ€œé‚£è¿™æ ·è¯´çš„è¯ï¼Œä»¥åä½ æƒ³æ‰¾åˆ«äººé™ªä½ åƒé¥­äº†ä½ å°±æ‰¾æˆ‘ï¼Œè¿™æ ·çš„å¥½äº‹åˆ«ä¾¿å®œåˆ«äººäº†ï¼Œä½†æ˜¯å‰ææ˜¯ä½ ä¹°å•â€ã€‚<br>é¾™å“¥ï¼šâ€œæ»šâ€ã€‚ï¼ˆè¯·è‡ªè¡Œè„‘è¡¥é¾™å“¥è‡­è„¸çš„æ ·å­ï¼‰</p><p>é¾™å“¥æ²¡æœ‰å¥³æœ‹å‹ï¼Œæ®ä»–è¯´æ˜¯å¤§å­¦çš„æ—¶å€™è°ˆè¿‡ä¸€æ¬¡æ‹çˆ±ï¼Œåˆ†æ‰‹çš„åŸå› å’Œå¾ˆå¤šäººä¸€æ ·ï¼Œæ¯•ä¸šä¹‹åå¤§å®¶æ„å‘ä¸åŒï¼Œé¾™å“¥æƒ³å»åŒ—ä¸Šå¹¿æ·±è¿™äº›å¤§åŸå¸‚å·¥ä½œï¼Œé‚£é‡Œçš„ITå°±ä¸šç¯å¢ƒæ˜¯å…¶ä»–äºŒçº¿åŸå¸‚ä¸èƒ½æ¯”çš„ï¼Œä½†æ˜¯ä»–å‰å¥³å‹æƒ³ç•™åœ¨è€å®¶æ‰¾ä¸ªæ•™å¸ˆçš„å·¥ä½œï¼Œå®¶é‡Œçš„ç”Ÿæ´»å‹åŠ›ç›¸å¯¹å°ç‚¹ï¼Œç„¶åä»–ä»¬å°±å’Œå¹³åˆ†æ‰‹äº†ã€‚</p><p>æˆ‘é—®è¿‡é¾™å“¥æƒ³è¿‡é‡æ–°æ‰¾ä¸ªå¥³æœ‹å‹å—ï¼Ÿé¾™å“¥ä¹Ÿå¾ˆå®è¯šï¼Œè¯´æƒ³è¿‡ï¼Œä½†æ˜¯æœ‰ä¸ªäº‹æƒ…ä»–æ„æƒ³ä¸åˆ°ã€‚å› ä¸ºå¤§å­¦æ˜¯åœ¨å¸ˆèŒƒé™¢æ ¡è¯»çš„è®¡ç®—æœºä¸“ä¸šï¼Œæ‰€ä»¥å¤§å­¦çš„æ—¶å€™èº«è¾¹çš„å¥³ç”Ÿä¹Ÿç›¸å¯¹è¾ƒå¤šä¸€ç‚¹ï¼Œæ‰¾å¥³æœ‹å‹æœºä¼šä¹Ÿå¤šä¸€ç‚¹ã€‚æ²¡æƒ³åˆ°æ¯•ä¸šä¹‹åè¿›å»çš„ç§‘æŠ€å…¬å¸ï¼Œèº«è¾¹çº¯ä¸€è‰²çš„æŠ è„šå¤§æ±‰ï¼Œæ ¹æœ¬æ²¡æœ‰é€”å¾„å»è®¤è¯†å¥³ç”Ÿã€‚å¥½ä¸å®¹æ˜“æ¥äº†ä¸€ä¸ªå¥³åŒäº‹ï¼Œè¦ä¸å°±æ˜¯æœ‰ç”·æœ‹å‹ï¼Œè¦ä¸å°±æ˜¯å·²å©šï¼Œå†è¦ä¸å°±æ˜¯ä»–å–œæ¬¢çš„å¥³ç”Ÿä»–è¿˜æ²¡è¡ŒåŠ¨åˆæˆä¸ºåˆ«äººçš„å¥³æœ‹å‹äº†ã€‚</p><p>åæ¥é¾™å“¥å°±å¯¹è°ˆæ‹çˆ±è¿™ä¸ªäº‹æƒ…ä¸å¼ºæ±‚äº†ï¼Œä½›ç³»æ‰¾å¥³æœ‹å‹ï¼Œæœ‰ä¹Ÿè¡Œï¼Œæ²¡æœ‰ä¹Ÿè¡Œï¼Œä¸äº‰ä¸æŠ¢ã€‚</p><p>é¾™å“¥ä¸å–œæ¬¢å¾…åœ¨å®¶é‡Œï¼Œå°±å–œæ¬¢åœ¨å¤–è¾¹æºœè¾¾ï¼Œé¾™å“¥è‡ªå·±ä¸€ä¸ªäººä½ï¼Œå¹¿å·çš„åŸä¸­æ‘å¤§å®¶éƒ½çŸ¥é“ï¼Œå³ä½¿æ˜¯ä¸€æˆ¿ä¸€å…ä¹Ÿå°å¾—å¯æ€œï¼Œæ¡æ‰‹æ¥¼ï¼Œä¸€æ ‹æŒ¨ç€ä¸€æ ‹ã€‚æ‰“å¼€çª—æ²¡æœ‰é˜³å…‰ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯æ°´æ³¥é’¢ç­‹ï¼Œå…³ä¸Šé—¨ä¹Ÿä¸éš”éŸ³ï¼Œå¬åˆ°çš„éƒ½æ˜¯å˜ˆæ‚å™ªéŸ³ã€‚è¿™ä¸ªæ—¶èŠ‚çš„å¹¿å·ï¼ŒåŸºæœ¬ä¸Šæ¯å¤©éƒ½ä¸‹é›¨ï¼Œé¾™å“¥å®¶é‡Œä¹Ÿæ½®æ¹¿ï¼Œä¹‹å‰å¬ä»–è¯´å®¶é‡Œçš„æŸœå­éƒ½å› ä¸ºæ½®æ¹¿æœ¨å¤´è†¨èƒ€å€’å¡Œäº†ï¼Œä¸è¿‡ä»–åˆæŠŠå®ƒç»™ä¿®å¥½äº†ï¼Œåæ¥é€¢äººä»–å°±ç‚«è€€ä»–ä¼šä¿®æŸœå­è¿™ä¸ªäº‹æƒ…ã€‚</p><p>é¾™å“¥çˆ±å¥½ä¸å¤šï¼Œå¦‚æœå‘å‘†ç®—æ˜¯çˆ±å¥½çš„è¯é‚£ä»–å°±åªæœ‰ä¸€ä¸ªçˆ±å¥½ã€‚æˆ‘ç»å¸¸çœ‹åˆ°ä»–ååœ¨åº§ä½ä¸Šå‘å‘†ï¼Œä¹Ÿä¸çŸ¥é“ä»–åœ¨æƒ³äº›ä»€ä¹ˆï¼Œä¸è¿‡æˆ‘çŸ¥é“ä»–å¾ˆå°‘å’Œäººè¯´ä»–è‡ªå·±çš„ç§äº‹ï¼Œä»–æœ‹å‹ä¸å¤šï¼Œæˆ‘ç®—æ˜¯ä»–æ¯”è¾ƒå¥½çš„æœ‹å‹ï¼Œä¸è¿‡æˆ‘ä¹Ÿæ²¡å¬ä»–å‘æˆ‘æŠ±æ€¨è¿‡ä»€ä¹ˆæˆ–è€…è¯´ä¸€äº›ï¼Œé‚£ä¸€æ¬¡é¾™å“¥å‘å‘†çœŸçš„å“åˆ°æˆ‘äº†ã€‚</p><p>é‚£æ˜¯æˆ‘ä»¬ä¿©åœ¨åŠ ç­çš„æ—¶å€™ï¼Œæˆ‘å’Œé¾™å“¥ç®—æ˜¯åŒé“ä¸­äººï¼Œæˆ‘ä¹Ÿæ˜¯åŠ ç­ç‹‚é­”ã€‚é™¤äº†å·¥ä½œåŸå› å¤–ï¼Œæˆ‘æ˜¯æƒ³ç€æ”’å¤šä¸€ç‚¹å‡æœŸåé¢è°ƒä¼‘å‡ºå»æ—…æ¸¸ä¸€è¶Ÿï¼Œè‡³äºé¾™å“¥ï¼Œæˆ‘é—®è¿‡ä»–ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä»–æ˜¯åœ¨é€ƒé¿ä¸€äº›ä»€ä¹ˆä¸œè¥¿ã€‚</p><p>æˆ‘å°è±¡æœ€æ·±åˆ»çš„æ—¶å€™æ˜¯é‚£ä¸€å¤©ï¼Œæ˜ŸæœŸäº”ï¼Œå·²ç»æ˜¯å‡Œæ™¨ä¸‰ç‚¹é’Ÿäº†ï¼ŒåŠå…¬å®¤çš„äººéƒ½èµ°å…‰äº†ï¼Œå°±åªæœ‰æˆ‘å’Œé¾™å“¥è¿˜åœ¨å·¥ä½œï¼Œæˆ‘çªç„¶è§‰å¾—è‚šå­æœ‰ç‚¹é¥¿ï¼Œæˆ‘å°±å’Œé¾™å“¥è¯´ï¼Œâ€œé¾™å“¥ï¼Œä½ é¥¿å—ï¼Ÿå’Œä½ ä¸€èµ·ä¸‹å»åƒç‚¹ä¸œè¥¿â€ã€‚é¾™å“¥æŠ¬å¤´çœ‹ç€æˆ‘ï¼Œâ€œæˆ‘æœ‰ç‚¹å¿™ï¼Œå•†å“è¯¦æƒ…åŠŸèƒ½æˆ‘å¿«å†™å®Œäº†ï¼Œä½ å¸®æˆ‘ä¹°ä¸€ä¸ªæ–¹ä¾¿é¢ä¸Šæ¥å¯ä»¥å—ï¼Ÿæƒ¯ä¾‹ï¼Œé…¸èœç‰›è‚‰é¢â€ã€‚â€œOKï¼Œé‚£æˆ‘å¸®ä½ ä¹°ä¸Šæ¥ã€‚â€ç„¶åæˆ‘å°±ä¸‹å»ä¹°æ–¹ä¾¿é¢äº†ï¼Œé¾™å“¥æ€»æ˜¯å¯¹é…¸èœç‰›è‚‰é¢æƒ…æœ‰ç‹¬é’Ÿï¼Œæ¯æ¬¡éƒ½æ˜¯åƒè¿™ä¸ªé¢ï¼Œè€Œæˆ‘è®¨åŒé…¸èœç‰›è‚‰é¢ï¼Œæˆ‘å–œæ¬¢åƒç‚¹å¥åº·çš„ï¼Œè”¬èœé¢ã€‚ä¸åˆ°ååˆ†é’Ÿæˆ‘å°±æŠŠé¢ä¹°ä¸Šæ¥äº†ã€‚</p><p>ç„¶åæˆ‘å°±çœ‹åˆ°äº†ä»¥ä¸‹çš„ä¸€å¹•ï¼ŒåŠå…¬å¸æ‰€æœ‰çš„ç¯éƒ½å…³æ‰äº†ï¼Œå°±åªæœ‰æˆ‘ä»¬ä¿©å¤´é¡¶é‚£ä¸¤ç›ç¯è¿˜å¼€ç€ï¼Œåœ¨æš—é»„çš„ç¯å…‰çš„ç…§è€€ä¸‹ï¼Œé¾™å“¥åŒæ‰‹äº¤å‰æŠ±åœ¨èƒ¸å‰ï¼ŒåèƒŒé åœ¨åº§ä½ä¸Šï¼Œèº«ä½“ä¾§ç€å¯¹ç€ç”µè„‘ï¼Œçœ¼é•œå¥½åƒçœ‹ç€æ–œä¸Šæ–¹çš„æ¨ªæ¢ï¼Œä½†æ˜¯å¤„äºæ”¾ç©ºçš„çŠ¶æ€ï¼Œå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯åŒç›®æ— ç¥ï¼Œä»–çœ‹èµ·æ¥æ•´ä¸ªäººé™æ­¢äº†ã€‚</p><p>è¯´å®è¯æˆ‘åˆšçœ‹åˆ°é‚£ä¸€åˆ»çš„æ—¶å€™æˆ‘ç¬¬ä¸€æƒ³æ³•å°±æ˜¯æ‰“120ï¼Œé¾™å“¥æ˜¯ä¸æ˜¯å‡ºäº‹äº†ï¼Œ å› ä¸ºæˆ‘ä»æ¥æ²¡æœ‰è§è¿‡ä»–è¿™ä¹ˆç–²æƒ«ï¼Œè„¸ä¸Šæ¯«æ— è¡¨æƒ…ï¼Œä¸€å‰¯ä¸ä¸–éš”ç»çš„æ ·å­ã€‚é‚£æ—¶æˆ‘çœŸçš„è¢«å“åˆ°äº†ï¼Œåæ¥æˆ‘çœ‹é¾™å“¥çœ¨äº†ä¸€ä¸‹çœ¼ç›ï¼Œæˆ‘æ‰æ”¾ä¸‹å¿ƒæ¥ã€‚</p><p>æˆ‘è®°å¾—æˆ‘é—®è¿‡é¾™å“¥ï¼Œâ€œä½ å­¤ç‹¬å—ï¼Ÿâ€ï¼Œé¾™å“¥è¯´äº†ä¸‹é¢ä¸€æ®µè¯ï¼š</p><blockquote><p>â€œä½ è¯•è¿‡å‡Œæ™¨ä¸‰ç‚¹é’Ÿçªç„¶æƒŠé†’å—ï¼Ÿæˆ‘è¯•è¿‡ï¼æˆ‘é†’æ¥ä¹‹åæˆ‘çœ‹ç€å››å‘¨é»‘æš—ä¸€ç‰‡ï¼Œæˆ‘çœ‹å‘çª—å¤–ï¼Œåªæœ‰å¾®å¾®çš„å…‰äº®ã€‚åæ¥æˆ‘æ‰“å¼€ç¯ï¼Œå››å‘¨æ˜¯äº®ç™½çš„å¢™ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¾ˆæ€•ï¼Œæ„Ÿè§‰æˆ‘è¢«åˆ«äººå›°åœ¨æˆ¿å­é‡Œé¢äº†ï¼Œå­¤ç‹¬æ„ŸåŒ…å›´ç€æˆ‘ï¼Œæˆ‘é‚£æ™šä¸€å®¿æ²¡ç¡ï¼Œç¬¬äºŒå¤©å…­ç‚¹é’Ÿæˆ‘å°±å‡ºé—¨å»ä¸Šç­äº†ï¼Œæˆ‘ä¸æƒ³å†æœ‰é‚£æ ·çš„æ—¶åˆ»ã€‚â€</p></blockquote><p>å¯èƒ½å‘å‘†çš„è¿™ä¸€åˆ»é¾™å“¥ä»€ä¹ˆéƒ½æ²¡æœ‰åœ¨æƒ³ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æƒ³èµ·äº†é‚£å¤©çš„æƒ…æ™¯ï¼Œé‚£ç§å­¤ç‹¬æ„Ÿè”“å»¶åˆ°äº†å…¬å¸ï¼ŒåŒæ ·åœ¨ä¸‰ç‚¹é’Ÿï¼Œå°†é¾™å“¥åŒ…å›´äº†ã€‚</p><p>æˆ–è®¸é¾™å“¥çœŸçš„åœ¨é€ƒé¿ï¼Œä»–æ˜¯åœ¨é€ƒé¿å­¤ç‹¬ï¼Œæˆ‘è§è¿‡ä»–ä¸€ä¸ªäººæŠ±ç€çˆ†ç±³èŠ±å»ç”µå½±é™¢çœ‹çˆ±æƒ…ç”µå½±ï¼Œæ—è¾¹éƒ½æ˜¯ä¸€å¯¹å¯¹çš„æƒ…ä¾£ï¼›æˆ‘è§è¿‡ä»–ä¸€ä¸ªäººå»åƒæµ·åº•æï¼Œåº—å‘˜çœ‹ä»–æ˜¯ä¸€ä¸ªäººæ¥çš„å¯¹é¢ç»™ä»–æ”¾äº†ä¸€ä¸ªå¤§çš„å…¬ä»”ï¼›æˆ‘è§è¿‡ä»–ä¸€ä¸ªäººå»KTVï¼Œå”±äº†ä¸€æ™šä¸Šã€Šç”·äººKTVã€‹ã€‚</p><p>ç°åœ¨æ˜¯å‡Œæ™¨å››ç‚¹é’Ÿï¼Œç»ˆäºæŠŠå•†å“è¯¦æƒ…åŠŸèƒ½å®Œæˆäº†ï¼Œåˆšåƒå®Œé…¸èœç‰›è‚‰é¢ï¼Œè¿˜æœ‰ç‚¹é¥±ï¼Œå†™å®Œè¿™ç¯‡æ–‡ç« å°±æ‰“ç®—å›å»ç¡è§‰ï¼Œä»Šå¤©æœ‰ç‚¹ç´¯ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å®æ„¿å‡Œæ™¨ä¸‰ç‚¹é’Ÿç¡è§‰ä¹Ÿä¸æ„¿å‡Œæ™¨ä¸‰ç‚¹é’Ÿé†’æ¥ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ˜¯æ˜ŸæœŸäº”ï¼Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ä¼°è®¡å·²ç»åœ¨ç¢ç£¨ç€å‘¨æœ«å»å“ªé‡Œæµªäº†ï¼Œæˆ–è€…å‘¨æœ«åœ¨å®¶ç¡ä¸ªå¤©æ˜åœ°æš—ï¼Œäº«å—ä¸€ä¸‹è¿™éš¾å¾—ä¸ç”¨æ—©èµ·æŒ¤è½¦æŒ¤åœ°é“çš„å‘¨æœ«ã€‚&lt;/p&gt;
&lt;p&gt;é¾™å“¥çœ‹çœ‹æ‰‹è¡¨ï¼Œå‡Œæ™¨å››ç‚¹æ•´ï¼Œåˆšåƒå®Œé…¸èœç‰›è‚‰é¢çš„é¾™å“¥æ‰“ç®—ä¸‹ç­å›å®¶ã€‚è¿™å·²ç»æ˜¯é¾™å“¥è¿™å‘¨ç¬¬ä¸‰æ¬¡åŠ ç­åˆ°å‡Œæ™¨äº†ï¼Œåªæœ‰æ˜ŸæœŸäºŒçš„æ—¶å€™ä¼‘æ¯äº†ä¸€å¤©æ²¡åŠ ç­ï¼Œå› ä¸ºé¡¹ç›®å¿«è¦ä¸Šçº¿äº†ï¼Œä¼°è®¡å‘¨æœ«è¿˜å¾—åœ¨åŠå…¬å®¤åº¦è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºâ€œèµ„æ·±â€ç¨‹åºå‘˜çš„é¾™å“¥è™½ç„¶æ‰å·¥ä½œä¸‰å¹´å¤šï¼Œä½†æ˜¯å·²ç»æœ‰äº”å¹´çš„å·¥ä½œç»éªŒäº†ã€‚å¦‚æœæ˜¯åŒè¡Œçš„è¯ä¼°è®¡ä¼šæ‡‚è¿™å¥è¯æ˜¯å•¥æ„æ€ï¼Œé‚£å¤šå‡ºæ¥çš„ä¸€å¹´åŠçš„å·¥ä½œç»éªŒå°±æ˜¯åŠ ç­å¤šå‡ºæ¥çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="http://lemon2well.top/categories/%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSä¸­çš„åœ†è§’å¤„ç†ï¼ˆç»ˆç»“ç¯‡ï¼‰</title>
    <link href="http://lemon2well.top/2018/08/29/iOS%20%E5%BC%80%E5%8F%91/iOS%E4%B8%AD%E7%9A%84%E5%9C%86%E8%A7%92%E5%A4%84%E7%90%86%EF%BC%88%E7%BB%88%E7%BB%93%E7%AF%87%EF%BC%89/"/>
    <id>http://lemon2well.top/2018/08/29/iOS å¼€å‘/iOSä¸­çš„åœ†è§’å¤„ç†ï¼ˆç»ˆç»“ç¯‡ï¼‰/</id>
    <published>2018-08-29T09:18:46.000Z</published>
    <updated>2018-08-30T01:52:22.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°åœ†è§’çš„å¤„ç†ï¼Œåœ†è§’çœ‹èµ·æ¥ä¼šæ¯”ç›´è§’æ›´åŠ ç¾è§‚å’ŒæŸ”ç¾ã€‚ä½†æ˜¯è®¾ç½®åœ†è§’å¾€å¾€ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼ŒæŸè€—çš„æ¥æºä¸»è¦ç”±äºå¤§é‡çš„ç¦»å±æ¸²æŸ“ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è®²ä¸€ä¸‹å¦‚æœå®ç°é«˜æ€§èƒ½çš„åœ†è§’ã€‚æˆ‘ä»¬ä¸‹é¢æ¥çœ‹ä»¥ä¸‹å‡ ç§è®¾ç½®åœ†è§’çš„æ–¹å¼ä»¥åŠå®ƒä»¬å¯¹æ€§èƒ½çš„å½±å“ã€‚</p><h2 id="CornerRadius-masksToBounds"><a href="#CornerRadius-masksToBounds" class="headerlink" title="CornerRadius+masksToBounds"></a>CornerRadius+masksToBounds</h2><p>ç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„è®¾ç½®åœ†è§’çš„æ–¹å¼ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹<code>cornerRadius</code>çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼š</p><blockquote><p>The radius to use when drawing rounded corners for the layerâ€™s background. Animatable.<br>Setting the radius to a value greater than 0.0 causes the layer to begin drawing rounded corners on its background. By default, the corner radius does not apply to the image in the layerâ€™s contents property; it applies only to the background color and border of the layer. However, setting the masksToBounds property to YES causes the content to be clipped to the rounded corners.<br>The default value of this property is 0.0.</p></blockquote><a id="more"></a><p>é€šè¿‡ä¸Šé¢çš„è§£é‡Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°cornerRadiusåªæ˜¯å¯¹viewçš„èƒŒæ™¯é¢œè‰²å’Œè¾¹æ¡†èµ·ä½œç”¨ï¼Œå¯¹äºä¸€äº›åƒImageViewä»¥åŠLabelç­‰å«æœ‰å†…éƒ¨å­è§†å›¾çš„å°±ä¸èµ·ä½œç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¾€å¾€è¿˜è¦æ·»ä¸‹ä¸‹é¢è¿™ä¸€å¥æ¥è®©labelç”Ÿæˆä¸€ä¸ªé€‚é…åœ†è§’çš„å‰ªåˆ‡è’™ç‰ˆï¼Œè¯¥è’™ç‰ˆä¸labelçš„è¾¹ç•Œç›¸åŒ¹é…ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†åœ†è§’çš„æ•ˆæœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">label.layer.masksToBounds = YES;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·å°±ä¼šå¯¼è‡´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œç¦»å±æ¸²æŸ“ã€‚å‰é¢æˆ‘ä»¬å·²ç»è¯´äº†å¤§é‡çš„ç¦»å±æ¸²æŸ“ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œæœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯å¦‚æœåœ¨ä¸€ä¸ªtableViewä¸­æœ‰å¤§é‡çš„ç¦»å±æ¸²æŸ“ï¼Œå°±ä¼šå¯¼è‡´FPSä¸‹é™å¯¼è‡´æ‰å¸§ï¼Œç•Œé¢çœ‹èµ·æ¥å¡é¡¿ã€‚</p><h3 id="æ€§èƒ½å½±å“"><a href="#æ€§èƒ½å½±å“" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h3><p>æˆ‘ä»¬é€šè¿‡æ¨¡æ‹Ÿå™¨çš„ <code>Color-Off-screen-Render</code>å¯ä»¥çœ‹åˆ°é‚£ä¸ªå…ƒç´ äº§ç”Ÿäº†ç¦»å±æ¸²æŸ“äº†ï¼Œå’Œå¾ˆå¤šäººè¯´çš„ä¸ä¸€æ ·ï¼Œä¸å¯ä»¥ç»Ÿç­¹çš„è¯´<code>åˆ›å»ºåœ†è§’æ˜¯äº§ç”Ÿç¦»å±æ¸²æŸ“çš„åŸå› </code><br>æ­£ç¡®çš„æ¥è¯´ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.layer.cornerRadius = 5;</span><br><span class="line">view.layer.maskToBounds = YES;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸¤å¥ä»£ç åˆåœ¨ä¸€èµ·æ‰æ˜¯äº§ç”Ÿç¦»å±æ¸²æŸ“çš„åŸå› ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªcellçš„ç¬¬ä¸€å’Œç¬¬äºŒä¸ªçš„ImageViewéƒ½æ˜¯æ‰§è¡Œäº†ä¸Šé¢çš„ä¸¤å¥ä»£ç ï¼Œäº§ç”Ÿäº†ç¦»å±å¹•æ¸²æŸ“ï¼Œè€Œç¬¬ä¸‰ä¸ªæ£•è‰²çš„åœ†å½¢åˆ™æ˜¯ä¸€ä¸ªviewï¼Œä»£ç é‡Œé¢ä»…ä½¿ç”¨äº†<code>view.layer.cornerRadius</code>ï¼Œæ‰€ä»¥æ²¡æœ‰äº§ç”Ÿç¦»å±æ¸²æŸ“ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/sim.png" alt="si"></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå½“ä¸€ä¸ªtableViewçš„ç¦»å±æ¸²æŸ“è¾¾åˆ°äº†44ä¸ªçš„æ—¶å€™ï¼ŒFPSä¸‹é™åˆ°äº†35å·¦å³ï¼Œæ€§èƒ½ä¸‹é™å¾—å¾ˆå‰å®³ã€‚æ‰€ä»¥å¦‚æœä¸€ä¸ªç•Œé¢ä¸Šéœ€è¦æœ‰å¾ˆå¤šçš„åœ†è§’çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼ä¸å¯å–ã€‚</p><h2 id="CAShapeLayer-UIBezierPath"><a href="#CAShapeLayer-UIBezierPath" class="headerlink" title="CAShapeLayer+UIBezierPath"></a>CAShapeLayer+UIBezierPath</h2><p>è¿™ç§æ–¹å¼ç®€ç›´æ˜¯å™©æ¢¦ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> CAShapeLayer *mask = [CAShapeLayer new];</span><br><span class="line">    mask.path = [UIBezierPath bezierPathWithRoundedRect:imageView.bounds cornerRadius:10].CGPath;</span><br><span class="line">imageView.layer.mask = mask;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªmaskï¼Œç„¶åé€šè¿‡è´å¡å°”æ›²çº¿è¦†ç›–åˆ°åŸæ¥çš„imageViewä¸Šé¢ï¼Œå‡ è¡Œä»£ç æå®šã€‚</p><h3 id="æ€§èƒ½å½±å“-1"><a href="#æ€§èƒ½å½±å“-1" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h3><p>ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹ç•Œé¢æ˜¯å¦ä¼šäº§ç”Ÿç¦»å±æ¸²æŸ“ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/sim2.png" alt="si"></p><p>å¦‚æœä¸çœ‹ä¸€ä¸‹çœŸçš„å“ä¸€è·³ï¼Œå…¨éƒ¨çš„å…ƒç´ éƒ½äº§ç”Ÿäº†ç¦»å±æ¸²æŸ“ï¼Œè¿˜ä¸å¦‚ç¬¬ä¸€ç§æ–¹å¼ã€‚ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹FPSæ˜¯10ï¼Œå…¶å®éƒ½ä¸ç”¨çœ‹FPSï¼Œç›´æ¥é¡µé¢ä¸Šéƒ½èƒ½çœ‹å‡ºæ¥äº†ï¼Œå¡åˆ°æ€€ç–‘äººç”Ÿã€‚</p><p>ä¸Šé¢çš„æ–¹å¼æ˜¯åˆ›å»ºå­æ§ä»¶çš„æ—¶å€™ç›´æ¥æ·»åŠ maskï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯åœ¨ <code>-(void)drawRect:(CGRect)rect</code>é‡Œé¢æ·»åŠ maskï¼Œè¿™æ ·æ–¹å¼æ›´åŠ ç³Ÿç³•ï¼Œå› ä¸ºä¸æ°å½“çš„ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¼šå¯¼è‡´å†…å­˜æš´å¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒiPhone6 ä¸Šä¸å±å¹•ç­‰å¤§çš„ UIViewï¼Œå³ä½¿é‡å†™ä¸€ä¸ªç©ºçš„ drawRect æ–¹æ³•ï¼Œå®ƒä¹Ÿè‡³å°‘å ç”¨ 750 <em> 1134 </em> 4 å­—èŠ‚ â‰ˆ 3.4 Mb çš„å†…å­˜ã€‚åœ¨ <a href="http://bihongbo.com/2016/01/03/memoryGhostdrawRect/" target="_blank" rel="noopener">å†…å­˜æ¶é¬¼drawRect</a> åŠå…¶åç»­ä¸­ï¼Œä½œè€…è¯¦ç»†ä»‹ç»äº†å…¶ä¸­åŸç†ï¼Œæ®ä»–æµ‹è¯•ï¼Œåœ¨ iPhone6 ä¸Šç©ºçš„ã€ä¸å±å¹•ç­‰å¤§çš„è§†å›¾é‡å†™ drawRect æ–¹æ³•ä¼šæ¶ˆè€— 5.2 Mb å†…å­˜ã€‚æ€»ä¹‹ï¼Œèƒ½é¿å…é‡å†™ drawRect æ–¹æ³•å°±å°½å¯èƒ½é¿å…ã€‚</p><h2 id="Core-Graphics"><a href="#Core-Graphics" class="headerlink" title="Core Graphics"></a>Core Graphics</h2><p>æˆ‘ä»¬çŸ¥é“UIViewå…¶å®æ˜¯ç”±CALayerå’ŒUIResponderç»„æˆï¼Œä¸€ä¸ªè´Ÿè´£æ˜¾ç¤ºï¼Œä¸€ä¸ªè´Ÿè´£å“åº”ã€‚ä½†æ˜¯CALayerä¹Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ƒå¹¶ä¸èƒ½ç›´æ¥æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°å±å¹•ä¸Šé¢çš„ä¸œè¥¿å…¶å®ä¹Ÿåªæ˜¯ä¸€å¼ å¼ å›¾ç‰‡ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°CALayerçš„å†…å®¹å‘¢ã€‚å› ä¸ºCALayeræœ‰ä¸€ä¸ªcontentçš„å±æ€§ï¼Œè¯¥å±æ€§å¯ä»¥ä¼ ä¸€ä¸ªidç±»å‹çš„å¯¹è±¡ï¼Œå½“ä½ ä¼ çš„å¯¹è±¡ä¸ºCGImageçš„æ—¶å€™ï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>é‚£é€šè¿‡Core Graphics æˆ‘ä»¬å¯ä»¥ç”»å‡ºä¸€ä¸ªå…·æœ‰åœ†è§’çš„å›¾ç‰‡ï¼Œç„¶åæ·»åŠ åˆ°layerä¸Šé¢ã€‚</p><p>ä¸è¿‡UIVIewå’ŒUIImageViewçš„å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼ŒUIViewçš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å›¾ç‰‡ï¼Œç„¶åæ’å…¥åˆ°è§†å›¾çš„æœ€ä¸‹é¢ã€‚è€ŒUIImageViewæ˜¯å°†åœ¨åŸæ¥Imageçš„åŸºç¡€ä¸Šé‡æ–°ç»˜åˆ¶ä¸€å¼ å¸¦æœ‰åœ†è§’çš„å›¾ç‰‡ï¼Œç„¶åèµ‹å€¼ç»™ImageViewã€‚</p><p>ä»¥ä¸‹æ˜¯å…³é”®ä»£ç ï¼š</p><p>UIVIew:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- (UIImage *)lm_drawRectWithRoundedCorner:(CGFloat)radius</span><br><span class="line">                              borderWidth:(CGFloat)borderWidth</span><br><span class="line">                              borderColor:(UIColor *)borderColor</span><br><span class="line">                          backGroundColor:(UIColor*)bgColor&#123;</span><br><span class="line">    CGSize size = self.bounds.size;</span><br><span class="line">    UIGraphicsBeginImageContextWithOptions(size, NO, [UIScreen mainScreen].scale);</span><br><span class="line">    CGContextRef contextRef =  UIGraphicsGetCurrentContext();</span><br><span class="line">    </span><br><span class="line">    CGContextSetLineWidth(contextRef, borderWidth);</span><br><span class="line">    CGContextSetStrokeColorWithColor(contextRef, borderColor.CGColor);</span><br><span class="line">    CGContextSetFillColorWithColor(contextRef, bgColor.CGColor);</span><br><span class="line">    </span><br><span class="line">    CGFloat halfBorderWidth = borderWidth / 2.0;</span><br><span class="line">    CGFloat width = size.width;</span><br><span class="line">    CGFloat height = size.height;</span><br><span class="line">    </span><br><span class="line">    CGContextMoveToPoint(contextRef, width - halfBorderWidth, radius + halfBorderWidth);</span><br><span class="line">    CGContextAddArcToPoint(contextRef, width - halfBorderWidth, height - halfBorderWidth, width - radius - halfBorderWidth, height - halfBorderWidth, radius);  // å³ä¸‹è§’è§’åº¦</span><br><span class="line">    CGContextAddArcToPoint(contextRef, halfBorderWidth, height - halfBorderWidth, halfBorderWidth, height - radius - halfBorderWidth, radius); // å·¦ä¸‹è§’è§’åº¦</span><br><span class="line">    CGContextAddArcToPoint(contextRef, halfBorderWidth, halfBorderWidth, width - halfBorderWidth, halfBorderWidth, radius); // å·¦ä¸Šè§’</span><br><span class="line">    CGContextAddArcToPoint(contextRef, width - halfBorderWidth, halfBorderWidth, width - halfBorderWidth, radius + halfBorderWidth, radius); // å³ä¸Šè§’</span><br><span class="line">    CGContextDrawPath(contextRef, kCGPathFillStroke);</span><br><span class="line">    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">    UIGraphicsEndImageContext();</span><br><span class="line">    return image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>UIImageVIew:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (UIImage *)lm_drawRectWithRoundedCorner:(CGFloat)radius</span><br><span class="line">                                     size:(CGSize)size&#123;</span><br><span class="line">    </span><br><span class="line">    CGRect rect = CGRectMake(0, 0, size.width, size.height);</span><br><span class="line">    </span><br><span class="line">    UIGraphicsBeginImageContextWithOptions(rect.size, false, [UIScreen mainScreen].scale);</span><br><span class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</span><br><span class="line">    </span><br><span class="line">    UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect byRoundingCorners:UIRectCornerAllCorners cornerRadii:CGSizeMake(radius, radius)];</span><br><span class="line">    CGContextAddPath(context, path.CGPath);</span><br><span class="line">    </span><br><span class="line">    CGContextClip(context);</span><br><span class="line">    </span><br><span class="line">    [self drawInRect:rect];</span><br><span class="line">    CGContextDrawPath(context, kCGPathFillStroke);</span><br><span class="line">    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();</span><br><span class="line">    UIGraphicsEndImageContext();</span><br><span class="line">    return  image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½å½±å“-2"><a href="#æ€§èƒ½å½±å“-2" class="headerlink" title="æ€§èƒ½å½±å“"></a>æ€§èƒ½å½±å“</h3><p><img src="http://pcd17v2u0.bkt.clouddn.com/sim3.png" alt="si"></p><p>ä»ä¸Šé¢çš„å›¾ç‰‡æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè®¾ç½®åœ†è§’å·²ç»æ²¡æœ‰ç¦»å±æ¸²æŸ“äº†ï¼Œé€šè¿‡Core Animationå¯ä»¥çœ‹å‡ºFPSä¹Ÿå›åˆ°60å·¦å³ï¼Œç•Œé¢ä¹Ÿæ²¡æœ‰å¡é¡¿äº†ã€‚</p><font color="#dd0000">æ³¨æ„ï¼šå³ä½¿æˆ‘ä»¬ä½¿ç”¨äº†è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦è°¨æ…ç›´æ¥è®¾ç½®view.backGroundColorï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®maskToBoundså±æ€§ï¼Œæ‰€ä»¥ä»¥è¿™æ ·çš„æ–¹å¼è®¾ç½®äº†èƒŒæ™¯é¢œè‰²ä¾ç„¶ä¼šå¯¼è‡´æ²¡æœ‰åœ†è§’æ•ˆæœã€‚<br>å¦‚æœæƒ³è¦èƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥åœ¨ç”»åœ†è§’å›¾ç‰‡çš„æ—¶å€™æ”¹å˜ä¸€ä¸‹backGroundColorã€‚</font><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—å‡ºä»¥ä¸‹çš„ç»“è®ºï¼š</p><ol><li>layer.cornerRadiusä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼Œè¯¥å±æ€§åªæ˜¯å¯¹è¾¹æ¡†å’ŒèƒŒæ™¯é¢œè‰²èµ·ä½œç”¨ï¼Œé€‚ç”¨äºå†…éƒ¨æ²¡æœ‰å…¶ä»–æ§ä»¶çš„viewã€‚</li><li>CAShapeLayer+UIBezierPathä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚</li><li>æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨Core Graphicsçš„æ–¹å¼ç»˜åˆ¶åœ†è§’å›¾ç‰‡ã€‚</li><li>å½“ç„¶ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œæ ¹æ®åœºæ™¯æ¥ä½¿ç”¨ï¼Œå¦‚æœç•Œé¢ä¸­åœ†è§’çš„åœ°æ–¹ä¸å¤šï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯æœ€ç®€å•å¿«æ·ï¼Œæ•ˆç‡æœ€é«˜çš„ã€‚å¦‚æœç”¨åˆ°çš„åœ†è§’å¾ˆå¤šï¼Œé‚£è¿˜æ˜¯ä½¿ç”¨Core Graphicsçš„æ–¹å¼æŠŠã€‚</li></ol><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>æœ¬æ–‡ç« çš„ä»£ç å·²ç»æ”¾åˆ°Githubï¼Œéœ€è¦çš„å¯ä»¥è‡ªå–ã€‚<a href="https://github.com/codemonkeybulucck/CornerViewDemo" target="_blank" rel="noopener">CornerViewDemo</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°åœ†è§’çš„å¤„ç†ï¼Œåœ†è§’çœ‹èµ·æ¥ä¼šæ¯”ç›´è§’æ›´åŠ ç¾è§‚å’ŒæŸ”ç¾ã€‚ä½†æ˜¯è®¾ç½®åœ†è§’å¾€å¾€ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼ŒæŸè€—çš„æ¥æºä¸»è¦ç”±äºå¤§é‡çš„ç¦»å±æ¸²æŸ“ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥è®²ä¸€ä¸‹å¦‚æœå®ç°é«˜æ€§èƒ½çš„åœ†è§’ã€‚æˆ‘ä»¬ä¸‹é¢æ¥çœ‹ä»¥ä¸‹å‡ ç§è®¾ç½®åœ†è§’çš„æ–¹å¼ä»¥åŠå®ƒä»¬å¯¹æ€§èƒ½çš„å½±å“ã€‚&lt;/p&gt;
&lt;h2 id=&quot;CornerRadius-masksToBounds&quot;&gt;&lt;a href=&quot;#CornerRadius-masksToBounds&quot; class=&quot;headerlink&quot; title=&quot;CornerRadius+masksToBounds&quot;&gt;&lt;/a&gt;CornerRadius+masksToBounds&lt;/h2&gt;&lt;p&gt;ç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„è®¾ç½®åœ†è§’çš„æ–¹å¼ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹&lt;code&gt;cornerRadius&lt;/code&gt;çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The radius to use when drawing rounded corners for the layerâ€™s background. Animatable.&lt;br&gt;Setting the radius to a value greater than 0.0 causes the layer to begin drawing rounded corners on its background. By default, the corner radius does not apply to the image in the layerâ€™s contents property; it applies only to the background color and border of the layer. However, setting the masksToBounds property to YES causes the content to be clipped to the rounded corners.&lt;br&gt;The default value of this property is 0.0.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP</title>
    <link href="http://lemon2well.top/2018/08/23/iOS%20%E5%BC%80%E5%8F%91/Runloop%E9%BB%91%E9%AD%94%E6%B3%95%E4%B9%8B%E5%A4%8D%E6%B4%BBAPP/"/>
    <id>http://lemon2well.top/2018/08/23/iOS å¼€å‘/Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP/</id>
    <published>2018-08-23T02:18:42.000Z</published>
    <updated>2018-08-23T02:19:09.869Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP"><a href="#Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP" class="headerlink" title="Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP"></a>Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP</h1><p>çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆé…·ç‚«ï¼Œä½†æ˜¯æˆ‘è¿˜è¦æ˜¯è§£é‡Šä¸€ä¸‹æ ‡é¢˜æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»¥å…æœ‰äººè¯´æˆ‘æ ‡é¢˜å…šï¼Œæˆ‘ç°åœ¨è¦åšçš„å°±æ˜¯å½“APPå‘ç”ŸCrashçš„æ—¶å€™ï¼Œä¸è¦è®©APPé—ªé€€ï¼Œè€Œæ˜¯é‡æ–°å¤æ´»ã€‚</p><blockquote><p>æ¢å¥è¯å¯ä»¥è¿™ä¹ˆå½¢å®¹ï¼ŒæŠŠä¸€ä¸ªCrashä¿¡æ¯åæ‰ï¼Œå¤§å®¶å½“æ²¡äº‹å‘ç”Ÿè¿‡ã€‚</p></blockquote><p>è¯´å¾—è¿™ä¹ˆç‰›æ‰¹ï¼Œè¿™ä¸ªä¸œè¥¿æœ‰ä»€ä¹ˆå®é™…çš„ç”¨å¤„å‘¢ï¼Ÿé¢ï¼Œå…¶å®è¿˜çœŸçš„æ²¡å•¥å®é™…çš„ç”¨å¤„ï¼Œä¸è¿‡æˆ‘ä»¬å½“å‘ç”Ÿå¼‚å¸¸ä¿¡æ¯çš„æ—¶å€™å¯ä»¥å‹å¥½çš„å¼¹ä¸€ä¸ªæ¡†å‘Šè¯‰ç”¨æˆ·å½“å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ˜¯é€‰æ‹©ä¸Šä¼ å¼‚å¸¸ä¿¡æ¯ç»§ç»­è¿è¡Œè¿˜æ˜¯ç›´æ¥é€€å‡ºï¼Œå½“ç„¶ç»§ç»­è¿è¡Œä¾ç„¶ä¼šæœ‰Crashé£é™©ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°è¿™ä¹ˆä¸€ä¸ªäº‹æƒ…å§ã€‚</p><a id="more"></a><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬çš„APPèƒ½éšæ—¶çš„å¤„ç†äº‹ä»¶å°±æ˜¯å› ä¸ºæœ‰Runloopçš„å­˜åœ¨ï¼ŒRunloopé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªç¯ï¼Œä¸æ–­çš„è·‘ï¼Œå¹¶ä¸”Runloopæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰äº‹æƒ…åšå¾—æ—¶å€™å°±ä¼‘çœ ï¼Œå½“æœ‰äº‹æƒ…åšçš„æ—¶å€™å°±åšäº‹æƒ…ã€‚</p><p>Runloopå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç®¡ç†äº†å…¶æ‰€éœ€è¦çš„æ¶ˆæ¯å’Œäº‹ä»¶ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªå…¥å£å‡½æ•°ã€‚çº¿ç¨‹æ‰§è¡Œäº†è¯¥å‡½æ•°ä¹‹åï¼Œå°±ä¼šä¸€ç›´å¤„äºRunloopçš„å†…éƒ¨ï¼Œè€ŒRunloopçš„å†…éƒ¨å°±ä¼šä¸€ç›´å¤„äºæ¥å—æ¶ˆæ¯-&gt;å¤„ç†-&gt;ç­‰å¾…-&gt;æ¥å—æ¶ˆæ¯è¿™æ ·çš„å¾ªç¯ä¸­ã€‚ç›´åˆ°è¿™ä¸ªå¾ªç¯ç»“æŸï¼Œçº¿ç¨‹æ‰ä¼šé€€å‡ºã€‚</p><p>æƒ³æƒ³å¦‚æœæˆ‘ä»¬çš„APPæ¥å—åˆ°Exceptionæ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…ˆè·å¾—å½“å‰çš„Runloopï¼Œç„¶åè·å–æ‰€æœ‰çš„modeï¼Œè‡ªè¡Œåˆ›å»ºä¸€ä¸ªæ­»å¾ªç¯ï¼Œè®©runloopåœ¨é‡Œé¢æ‰§è¡Œä¸åŒçš„modeï¼Œè¿™æ ·å°±ç›¸å½“äºè®©Runloopèµ·æ­»å›ç”Ÿäº†ï¼Œè¿™æ ·APPä¹Ÿå¤æ´»äº†ã€‚</p><h2 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h2><p>åœ¨æˆ‘å‰é¢å†™å¾—è¿™ä¸€ç¯‡<a href="http://lemon2well.top/2018/08/22/iOS%20%E5%BC%80%E5%8F%91/iOS%E6%94%B6%E9%9B%86Crash%E4%BF%A1%E6%81%AF%E4%B8%8A%E6%8A%A5/">iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†</a>ä¸­æˆ‘ä»¬å·²ç»å®ç°äº†ç›‘å¬Exceptionäº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç›‘å¬åˆ°è¯¥äº‹ä»¶ä¹‹åæ’å…¥ä»¥ä¸‹ä»£ç å³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//è·å¾—å½“å‰çš„runloopå¹¶ä¸”é‡æ–°å¯åŠ¨</span><br><span class="line">   CFRunLoopRef runloop = CFRunLoopGetCurrent();</span><br><span class="line">   NSArray *modes = CFBridgingRelease(CFRunLoopCopyAllModes(runloop));</span><br><span class="line">   while (!self.isExit) &#123;</span><br><span class="line">       for (NSString *mode in modes) &#123;</span><br><span class="line">           CFRunLoopRunInMode((CFStringRef)mode, 0.001, false);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥é€è¡Œçœ‹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬è·å–åˆ°å½“å‰çš„Runloopï¼Œç„¶åæˆ‘ä»¬è·å–åˆ°å½“å‰Runloopçš„æ‰€æœ‰modeï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œåœ¨é‡Œé¢ä¸æ–­çš„è·‘æ‰€æœ‰çš„modeï¼Œè¿™æ ·å°±å®ç°äº†APPçš„å¤æ´»ã€‚</p><p><a href="https://github.com/codemonkeybulucck/RunloopResurgenceAPP" target="_blank" rel="noopener">è¿™é‡Œ</a>æ˜¯å®Œæ•´çš„demo</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Runloopæ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå®ƒèƒ½åšçš„äº‹æƒ…è¿œè¿œè¶…å‡ºæˆ‘ä»¬çš„æƒ³åƒï¼Œè™½ç„¶æˆ‘ä»¬å¼€å‘ä¸­å¾ˆå°‘ç›´æ¥å»æ¥è§¦Runloopï¼Œä½†æ˜¯å®ƒå´èµ·ç€æ— æ¯”é‡è¦çš„ä½œç”¨ï¼Œæ‰€ä»¥ä¸‹é¢æä¾›ä¸€äº›å…³äºRunloopçš„èµ„æ–™ä»‹ç»ï¼š</p><p><a href="https://v.youku.com/v_show/id_XODgxODkzODI0.html" target="_blank" rel="noopener">sunnyxxçº¿ä¸‹åˆ†äº«Runloop</a><br><a href="https://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="noopener">ibiremeæ·±å…¥ç†è§£Runloop</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP&quot;&gt;&lt;a href=&quot;#Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP&quot; class=&quot;headerlink&quot; title=&quot;Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP&quot;&gt;&lt;/a&gt;Runloopé»‘é­”æ³•ä¹‹å¤æ´»APP&lt;/h1&gt;&lt;p&gt;çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆé…·ç‚«ï¼Œä½†æ˜¯æˆ‘è¿˜è¦æ˜¯è§£é‡Šä¸€ä¸‹æ ‡é¢˜æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä»¥å…æœ‰äººè¯´æˆ‘æ ‡é¢˜å…šï¼Œæˆ‘ç°åœ¨è¦åšçš„å°±æ˜¯å½“APPå‘ç”ŸCrashçš„æ—¶å€™ï¼Œä¸è¦è®©APPé—ªé€€ï¼Œè€Œæ˜¯é‡æ–°å¤æ´»ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ¢å¥è¯å¯ä»¥è¿™ä¹ˆå½¢å®¹ï¼ŒæŠŠä¸€ä¸ªCrashä¿¡æ¯åæ‰ï¼Œå¤§å®¶å½“æ²¡äº‹å‘ç”Ÿè¿‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¯´å¾—è¿™ä¹ˆç‰›æ‰¹ï¼Œè¿™ä¸ªä¸œè¥¿æœ‰ä»€ä¹ˆå®é™…çš„ç”¨å¤„å‘¢ï¼Ÿé¢ï¼Œå…¶å®è¿˜çœŸçš„æ²¡å•¥å®é™…çš„ç”¨å¤„ï¼Œä¸è¿‡æˆ‘ä»¬å½“å‘ç”Ÿå¼‚å¸¸ä¿¡æ¯çš„æ—¶å€™å¯ä»¥å‹å¥½çš„å¼¹ä¸€ä¸ªæ¡†å‘Šè¯‰ç”¨æˆ·å½“å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæ˜¯é€‰æ‹©ä¸Šä¼ å¼‚å¸¸ä¿¡æ¯ç»§ç»­è¿è¡Œè¿˜æ˜¯ç›´æ¥é€€å‡ºï¼Œå½“ç„¶ç»§ç»­è¿è¡Œä¾ç„¶ä¼šæœ‰Crashé£é™©ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°è¿™ä¹ˆä¸€ä¸ªäº‹æƒ…å§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†</title>
    <link href="http://lemon2well.top/2018/08/22/iOS%20%E5%BC%80%E5%8F%91/iOSCrash%E4%BF%A1%E6%81%AF%E4%B8%8A%E6%8A%A5%E5%92%8C%E5%A4%84%E7%90%86/"/>
    <id>http://lemon2well.top/2018/08/22/iOS å¼€å‘/iOSCrashä¿¡æ¯ä¸ŠæŠ¥å’Œå¤„ç†/</id>
    <published>2018-08-22T09:41:36.000Z</published>
    <updated>2018-08-23T01:46:25.542Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨iOSå¼€å‘ä¸­ï¼Œæœ€ä¸¥é‡çš„bugä¼°è®¡å°±æ˜¯åº”ç”¨å¥”æºƒï¼Œå¦‚æœåº”ç”¨å¥”æºƒäº†ï¼Œé™¤äº†åšå¥½æŒ¨éª‚çš„å‡†å¤‡ï¼Œè¿˜éœ€è¦å†·é™çš„ä¸‹æ¥å»å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹éœ€è¦åšä»€ä¹ˆäº‹æƒ…ã€‚</p><h2 id="è·å–crashä¿¡æ¯"><a href="#è·å–crashä¿¡æ¯" class="headerlink" title="è·å–crashä¿¡æ¯"></a>è·å–crashä¿¡æ¯</h2><p>æˆ‘ä»¬é¦–å…ˆç¬¬ä¸€ä¸ªäº‹æƒ…å°±æ˜¯è¦çŸ¥é“åº”ç”¨çš„å¥”æºƒä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæœ‰å‡ ç§æ–¹å¼å»è·å–å¥”æºƒä¿¡æ¯ã€‚</p><ol><li>ä½¿ç”¨Buglyï¼Œå‹ç›Ÿç­‰ç¬¬ä¸‰æ–¹SDKç™»å…¥åå°æŸ¥çœ‹å¥”æºƒä¿¡æ¯</li><li>ä»£ç è‡ªåŠ¨ä¸Šä¼ å¥”æºƒä¿¡æ¯åˆ°æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡æ¢å¤dSYMæ–‡ä»¶æ¥æŸ¥çœ‹å¥”æºƒä¿¡æ¯</li><li>é€šè¿‡ä½¿ç”¨å½“å‰å‘ç”Ÿåº”ç”¨å¥”æºƒçš„è®¾å¤‡å¯¼å‡ºç›¸å…³çš„å¥”æºƒä¿¡æ¯</li><li>å¦‚æœæ˜¯çº¿ä¸Šçš„åº”ç”¨ï¼Œè¿˜å¯ä»¥é€šè¿‡itunesConnectæ¥æŸ¥çœ‹ï¼ˆéå³æ—¶ï¼‰</li></ol><a id="more"></a><p>ç¬¬ä¸€ç§é›†æˆç¬¬ä¸‰æ–¹SDKçš„æ–¹æ¡ˆåŸºæœ¬ä¸Šä¸ç”¨æˆ‘ä»¬ç®¡ï¼Œåªéœ€è¦æ ¹æ®æ–‡æ¡£é›†æˆå³å¯ã€‚<br>ä¸‹é¢æˆ‘ä»¬è¦è®²çš„æ˜¯ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œç¬¬å››ç§æ–¹æ¡ˆå…¶å®å’Œç¬¬ä¸‰ç§æ–¹æ¡ˆå·®ä¸å¤šï¼Œä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ç§æ–¹æ¡ˆå‘¢ï¼Œå› ä¸ºç¬¬äºŒç§æ–¹æ¡ˆä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿åˆ°å¥”æºƒçš„å †æ ˆå’Œå…·ä½“ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥çœ‹å‡ºåœ¨é‚£æ®µä»£ç å¥”æºƒä»¥åŠå…·ä½“çš„å¥”æºƒå†…å®¹ã€‚ä½†æ˜¯ç¬¬ä¸‰ç§å’Œç¬¬å››ç§æ–¹æ¡ˆæˆ‘ä»¬æ‹¿åˆ°çš„å¥”æºƒä¿¡æ¯æ˜¯ç»è¿‡å¤„ç†çš„å¥”æºƒä¿¡æ¯ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Incident Identifier: 66BAB91F-07F7-4242-B8EF-8CC1771E5EF0</span><br><span class="line">CrashReporter Key:   bb6af27d5f29cc19a8df5dbdff702227fdb1232b</span><br><span class="line">Hardware Model:      iPhone8,1</span><br><span class="line">Process:             testImageSourceCode [25042]</span><br><span class="line">Path:                /private/var/containers/Bundle/Application/C8A371D9-3F19-4A17-A817-5FF35A40C8E7/testImageSourceCode.app/testImageSourceCode</span><br><span class="line">Identifier:          com.cmcc.enterprise-classID.onecardmultinumber.sdk</span><br><span class="line">Version:             1 (1.0)</span><br><span class="line">Code Type:           ARM-64 (Native)</span><br><span class="line">Role:                Foreground</span><br><span class="line">Parent Process:      launchd [1]</span><br><span class="line">Coalition:           com.cmcc.enterprise-classID.onecardmultinumber.sdk [8274]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Date/Time:           2018-08-22 15:35:09.3494 +0800</span><br><span class="line">Launch Time:         2018-08-22 15:35:03.3154 +0800</span><br><span class="line">OS Version:          iPhone OS 11.3.1 (15E302)</span><br><span class="line">Baseband Version:    4.56.00</span><br><span class="line">Report Version:      104</span><br><span class="line"></span><br><span class="line">Exception Type:  EXC_CRASH (SIGABRT)</span><br><span class="line">Exception Codes: 0x0000000000000000, 0x0000000000000000</span><br><span class="line">Exception Note:  EXC_CORPSE_NOTIFY</span><br><span class="line">Triggered by Thread:  0</span><br><span class="line"></span><br><span class="line">Application Specific Information:</span><br><span class="line">abort() called</span><br><span class="line"></span><br><span class="line">Filtered syslog:</span><br><span class="line">None found</span><br><span class="line"></span><br><span class="line">Last Exception Backtrace:</span><br><span class="line">0   CoreFoundation                0x184152d8c __exceptionPreprocess + 228</span><br><span class="line">1   libobjc.A.dylib               0x18330c5ec objc_exception_throw + 55</span><br><span class="line">2   CoreFoundation                0x1840eb750 _CFThrowFormattedException + 111</span><br><span class="line">3   CoreFoundation                0x18401b90c -[__NSArrayI objectAtIndex:] + 131</span><br><span class="line">4   testImageSourceCode           0x100d55ee4 _hidden#0_ + 24292 (__hidden#4_:14)</span><br><span class="line">5   testImageSourceCode           0x100d5ed6c _hidden#425_ + 60780 (__hidden#452_:131)</span><br><span class="line">6   UIKit                         0x18de826c8 -[UIApplication sendAction:to:from:forEvent:] + 95</span><br><span class="line">7   UIKit                         0x18dfa38a4 -[UIControl sendAction:to:forEvent:] + 79</span><br><span class="line">8   UIKit                         0x18de8877c -[UIControl _sendActionsForEvents:withEvent:] + 439</span><br><span class="line">9   UIKit                         0x18dfbe1dc -[UIControl touchesEnded:withEvent:] + 571</span><br><span class="line">10  UIKit                         0x18df05a48 -[UIWindow _sendTouchesForEvent:] + 2427</span><br><span class="line">11  UIKit                         0x18defa8f8 -[UIWindow sendEvent:] + 3159</span><br><span class="line">12  UIKit                         0x18def9238 -[UIApplication sendEvent:] + 339</span><br><span class="line">13  UIKit                         0x18e6dac0c __dispatchPreprocessedEventFromEventQueue + 2339</span><br><span class="line">14  UIKit                         0x18e6dd1b8 __handleEventQueueInternal + 4743</span><br><span class="line">15  UIKit                         0x18e6d6258 __handleHIDEventFetcherDrain + 151</span><br><span class="line">16  CoreFoundation                0x1840fb404 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 23</span><br><span class="line">17  CoreFoundation                0x1840fac2c __CFRunLoopDoSources0 + 275</span><br><span class="line">18  CoreFoundation                0x1840f879c __CFRunLoopRun + 1203</span><br><span class="line">19  CoreFoundation                0x184018da8 CFRunLoopRunSpecific + 551</span><br><span class="line">20  GraphicsServices              0x185ffb020 GSEventRunModal + 99</span><br><span class="line">21  UIKit                         0x18dff978c UIApplicationMain + 235</span><br><span class="line">22  testImageSourceCode           0x100d75ca8 main + 154792 (__hidden#956_:14)</span><br><span class="line">23  libdyld.dylib                 0x183aa9fc0 start + 3</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°ä¸Šé¢çš„å¥”æºƒä¿¡æ¯æˆ‘ä»¬æ˜¯ä¸€è„¸æ‡µé€¼çš„ï¼Œå®Œå…¨çœ‹ä¸å‡ºæ˜¯å› ä¸ºå“ªé‡Œçš„ä»£ç å¯¼è‡´äº†é”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦è¿›è¡Œç¬¦å·åŒ–ï¼Œé€šè¿‡dSYMæ–‡ä»¶é€šè¿‡å¥”æºƒä¿¡æ¯çš„åœ°å€æ‰¾åˆ°æºç ä¸­å¥”æºƒçš„åœ°æ–¹ã€‚è¿™ä¸ªæˆ‘ä»¬æ”¾åˆ°ç¬¬ä¸‰ç‚¹æ¥è®²ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆå°†ç¬¬äºŒä¸ªæ–¹æ¡ˆã€‚</p><h2 id="æ”¶é›†Crashä¿¡æ¯"><a href="#æ”¶é›†Crashä¿¡æ¯" class="headerlink" title="æ”¶é›†Crashä¿¡æ¯"></a>æ”¶é›†Crashä¿¡æ¯</h2><p>åœ¨iOSä¸­ï¼Œç³»ç»Ÿç»™æˆ‘ä»¬æä¾›äº†<code>NSException</code>è¿™ä¸ªç±»æ¥å¸®åŠ©æˆ‘ä»¬æ”¶é›†å¼‚å¸¸ä¿¡æ¯ã€‚</p><blockquote><p>NSException is used to implement exception handling and contains information about an exception â€” Apple Documentation.</p></blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»é‡Œé¢éƒ½åŒ…å«ä»€ä¹ˆå±æ€§å’Œæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@interface NSException : NSObject &lt;NSCopying, NSCoding&gt; &#123;</span><br><span class="line">    @private</span><br><span class="line">    NSString*name;</span><br><span class="line">    NSString*reason;</span><br><span class="line">    NSDictionary*userInfo;</span><br><span class="line">    idreserved;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSException *)exceptionWithName:(NSExceptionName)name reason:(nullable NSString *)reason userInfo:(nullable NSDictionary *)userInfo;</span><br><span class="line">- (instancetype)initWithName:(NSExceptionName)aName reason:(nullable NSString *)aReason userInfo:(nullable NSDictionary *)aUserInfo NS_DESIGNATED_INITIALIZER;</span><br><span class="line"></span><br><span class="line">@property (readonly, copy) NSExceptionName name;</span><br><span class="line">@property (nullable, readonly, copy) NSString *reason;</span><br><span class="line">@property (nullable, readonly, copy) NSDictionary *userInfo;</span><br><span class="line"></span><br><span class="line">@property (readonly, copy) NSArray&lt;NSNumber *&gt; *callStackReturnAddresses API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));</span><br><span class="line">@property (readonly, copy) NSArray&lt;NSString *&gt; *callStackSymbols API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));</span><br><span class="line"></span><br><span class="line">- (void)raise;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§å’Œæ–¹æ³•ï¼š<br>ä¾‹å¦‚æˆ‘ä»¬ç¢°åˆ°ä¸€ä¸ª<code>name: @&quot;NSRangeException&quot; - reason: @&quot;*** -[__NSArrayI objectAtIndex:]: index 3 beyond bounds [0 .. 1]&quot;</code>è¿™æ ·çš„é”™è¯¯</p><blockquote><ol><li>name : exceptionçš„åå­—ï¼Œåœ¨ä¸Šé¢ä¸­å°±æ˜¯NSRangeException</li><li>reason : exceptionçš„åŸå› ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¿®å¤çš„æœ€ä¸»è¦çš„æç¤ºã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢çš„[__NSArrayI objectAtIndex:]: index 3 beyond bounds [0 .. 1]ã€‚</li><li>userInfo : å…¶ä»–ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºè‡ªå®šä¹‰çš„æ—¶å€™ä¼ é€’ä¸€äº›å…¶ä»–çš„ä¿¡æ¯ã€‚</li><li>callStackSymbols : è¿™ä¸ªäº§ç”ŸExceptionçš„è°ƒç”¨æ ˆï¼Œä»ä¸‹åˆ°ä¸Šã€‚</li><li>raiseæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è®©ç³»ç»Ÿäº§ç”ŸExceptionï¼Œä¾‹å¦‚æˆ‘ä»¬çš„APPå¦‚æœæ£€æµ‹åˆ°æ­£åœ¨è¢«å…¶ä»–ä¸æ€€å¥½æ„çš„äººè°ƒè¯•çš„æ—¶å€™ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªNSExceptionçš„æ–¹æ³•ï¼Œç„¶åè°ƒç”¨raiseç›´æ¥é—ªé€€ï¼Œä¸è¿‡ä»–ä¹Ÿæœ‰å¯èƒ½hookäº†è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</li></ol></blockquote><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†æœ‰è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•æ¥æ•æ‰ç³»ç»Ÿå¼‚å¸¸å‘¢ï¼ŒCrashåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç”±EXC_BAD_ACCESSå¼•èµ·çš„ï¼ŒåŸå› æ˜¯è®¿é—®äº†ä¸å±äºæœ¬è¿›ç¨‹çš„å†…å­˜åœ°å€ï¼Œæœ‰å¯èƒ½æ˜¯è®¿é—®å·²è¢«é‡Šæ”¾çš„å†…å­˜ï¼›å¦ä¸€ç§æ˜¯æœªè¢«æ•è·çš„Objective-Cå¼‚å¸¸ï¼ˆNSExceptionï¼‰ï¼Œå¯¼è‡´ç¨‹åºå‘è‡ªèº«å‘é€äº†SIGABRTä¿¡å·è€Œå´©æºƒã€‚å…¶å®å¯¹äºæœªæ•è·çš„Objective-Cå¼‚å¸¸ï¼Œæˆ‘ä»¬æ˜¯æœ‰åŠæ³•å°†å®ƒè®°å½•ä¸‹æ¥çš„ã€‚</p><p>æˆ‘ä»¬å…ˆè¯´ç¬¬ä¸€ç§ï¼Œç¬¬ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„Exceptionï¼Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ª</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOUNDATION_EXPORT void NSSetUncaughtExceptionHandler(NSUncaughtExceptionHandler * _Nullable);</span><br></pre></td></tr></table></figure><p>æ–¹æ³•æ¥æ•è·å¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ä¼šåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å°±è°ƒç”¨ä¸€æ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•è·æ‰€æœ‰çš„å¼‚å¸¸ã€‚<br>åœ¨APPDelegateçš„didFinishLaunchæ–¹æ³•ä¸­ è°ƒç”¨  <code>NSSetUncaughtExceptionHandler(&amp;CrashExceptionHandler);</code><br>ç„¶åå¢åŠ ä¸€ä¸ªæ–¹æ³•çš„å®ç°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void CrashExceptionHandler(NSException *exception)&#123;</span><br><span class="line">    NSArray *callStack = [exception callStackSymbols];</span><br><span class="line">    NSString *reson = [exception reason];</span><br><span class="line">    NSString *name = [exception name];</span><br><span class="line">   //TODO: ä¿å­˜å¥”æºƒä¿¡æ¯åˆ°æœ¬åœ°ï¼Œä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™ä¸Šä¼ åˆ°æœåŠ¡å™¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒç§å¼‚å¸¸ï¼Œè¿™ç§å¼‚å¸¸é€šè¿‡ä¸Šé¢çš„æ–¹æ³•æ— æ³•æ•æ‰ï¼Œä½†æ˜¯ç³»ç»Ÿä¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨å†Œå¯¹åº”çš„Signalä¿¡æ¯æ¥ç›‘å¬æ˜¯å¦æ•æ‰åˆ°ç³»ç»Ÿå‘å‡ºçš„å¼‚å¸¸ä¿¡å·ã€‚</p><p>åŒæ ·æ˜¯åœ¨APPDelagetä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGABRT, SignalExceptionHandler);</span><br><span class="line">signal(SIGILL, SignalExceptionHandler);</span><br><span class="line">signal(SIGSEGV, SignalExceptionHandler);</span><br><span class="line">signal(SIGFPE, SignalExceptionHandler);</span><br><span class="line">signal(SIGBUS, SignalExceptionHandler);</span><br><span class="line">signal(SIGPIPE, SignalExceptionHandler);</span><br></pre></td></tr></table></figure><p>ç„¶åå®ç° <code>SignalExceptionHandler</code>æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void SignalExceptionHandler(int signal)&#123;</span><br><span class="line">    NSArray *callStack = [LMExceptionHandler backtrace];</span><br><span class="line">    NSLog(@&quot;ä¿¡å·æ•è·å´©æºƒï¼Œå †æ ˆä¿¡æ¯ï¼š%@&quot;,callStack);</span><br><span class="line">    NSString *name = LMSignalException;</span><br><span class="line">    NSString *reason = [NSString stringWithFormat:@&quot;signal %d was raised&quot;,signal];</span><br><span class="line">    //TODO: ä¿å­˜ä¿¡æ¯ä¸Šä¼ åˆ°æœ¬åœ°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSArray *)backtrace</span><br><span class="line">&#123;</span><br><span class="line">    void* callstack[128];</span><br><span class="line">    int frames = backtrace(callstack, 128);</span><br><span class="line">    char **strs = backtrace_symbols(callstack, frames);</span><br><span class="line">    </span><br><span class="line">    NSMutableArray *backtrace = [NSMutableArray arrayWithCapacity:frames];</span><br><span class="line">    for (int i = 0; i &lt; frames; i++) &#123;</span><br><span class="line">        [backtrace addObject:[NSString stringWithUTF8String:strs[i]]];</span><br><span class="line">    &#125;</span><br><span class="line">    free(strs);</span><br><span class="line">    </span><br><span class="line">    return backtrace;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šçš„æ–¹æ³•æˆ‘ä»¬å·²ç»å¯ä»¥æ•è·åˆ°ç³»ç»Ÿçš„crashä¿¡æ¯ï¼Œä»è€Œæ ¹æ®ä¿¡æ¯ä¿®å¤ç›¸å…³çš„bugã€‚</p><h2 id="é€šè¿‡XcodeæŸ¥çœ‹Crashä¿¡æ¯"><a href="#é€šè¿‡XcodeæŸ¥çœ‹Crashä¿¡æ¯" class="headerlink" title="é€šè¿‡XcodeæŸ¥çœ‹Crashä¿¡æ¯"></a>é€šè¿‡XcodeæŸ¥çœ‹Crashä¿¡æ¯</h2><p>å¦‚æœå¥”æºƒå‘ç”Ÿåœ¨æˆ‘ä»¬æµ‹è¯•çš„è®¾å¤‡ä¸Šé¢ï¼Œé‚£ä¹ˆå¥”æºƒä¿¡æ¯æ˜¯ä¿å­˜åˆ°æˆ‘ä»¬æ‰‹æœºæœ¬åœ°çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡xcodeæ¥æŸ¥çœ‹ã€‚</p><p>æ‰‹æœºè¿æ¥ç”µè„‘ï¼Œç„¶åæ‰“å¼€Xcodeï¼Œç‚¹å‡»Window-&gt;Devices And Simulators-&gt;å·¦ä¾§é€‰æ‹©å¯¹åº”çš„è®¾å¤‡ï¼Œç„¶åå³ä¾§ç‚¹å‡»View Device Logsï¼Œç„¶åå°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„å¥”æºƒä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨æœç´¢å‡ºå¯¹åº”çš„APPä¹Ÿå¯ä»¥æ ¹æ®æ—¶é—´æ¥æ’åºæ‰¾åˆ°å¯¹åº”çš„é‚£ä¸€æ¡å¥”æºƒä¿¡æ¯ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15349278888373.jpg" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºæˆ‘ä»¬å…¶å®æ˜¯çœ‹ä¸å‡ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ä»¥åŠå †æ ˆä¿¡æ¯çš„ï¼Œæ ¹æ®è¿™äº›æˆ‘ä»¬å¾ˆéš¾å†ä»£ç ä¸­æ‰¾åˆ°å¯¼è‡´å¥”æºƒçš„ä»£ç åœ¨å“ªé‡Œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å¼€å§‹é€šè¿‡dSYMæ–‡ä»¶æ‰¾åˆ°å¯¹åº”çš„å †æ ˆã€‚</p><h2 id="dSYM"><a href="#dSYM" class="headerlink" title="dSYM"></a>dSYM</h2><p>è¿›è¡Œå´©æºƒåˆ†æï¼Œé¦–å…ˆè¦å¼„æ‡‚ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯ç¬¦å·é›†ã€‚</p><blockquote><p>ç¬¦å·é›†æ˜¯æˆ‘ä»¬å¯¹ipaæ–‡ä»¶è¿›è¡Œæ‰“åŒ…ä¹‹åï¼Œå’Œ.appæ–‡ä»¶åŒçº§çš„åç¼€åä¸º.dSYMçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»ä½¿ç”¨Xcodeè¿›è¡Œæ‰“åŒ…æ‰æœ‰ã€‚<br>æ¯ä¸€ä¸ª.dSYMæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªUUIDï¼Œå’Œ.appæ–‡ä»¶ä¸­çš„UUIDå¯¹åº”ï¼Œä»£è¡¨ç€æ˜¯ä¸€ä¸ªåº”ç”¨ã€‚è€Œ.dSYMæ–‡ä»¶ä¸­æ¯ä¸€æ¡å´©æºƒä¿¡æ¯ä¹Ÿæœ‰ä¸€ä¸ªå•ç‹¬çš„UUIDï¼Œç”¨æ¥å’Œç¨‹åºçš„UUIDè¿›è¡Œæ ¡å¯¹ã€‚<br>æˆ‘ä»¬å¦‚æœä¸ä½¿ç”¨.dSYMæ–‡ä»¶è·å–åˆ°çš„å´©æºƒä¿¡æ¯éƒ½æ˜¯ä¸å‡†ç¡®çš„ã€‚<br>ç¬¦å·é›†ä¸­å­˜å‚¨ç€æ–‡ä»¶åã€æ–¹æ³•åã€è¡Œå·çš„ä¿¡æ¯ï¼Œæ˜¯å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„16è¿›åˆ¶å‡½æ•°åœ°å€å¯¹åº”çš„ï¼Œé€šè¿‡åˆ†æå´©æºƒçš„.Crashæ–‡ä»¶å¯ä»¥å‡†ç¡®çŸ¥é“å…·ä½“çš„å´©æºƒä¿¡æ¯ã€‚<br>æˆ‘ä»¬æ¯æ¬¡Archiveä¸€ä¸ªåŒ…ä¹‹åï¼Œéƒ½ä¼šéšä¹‹ç”Ÿæˆä¸€ä¸ªdSYMæ–‡ä»¶ã€‚æ¯æ¬¡å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¤‡ä»½è¿™ä¸ªæ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿ä»¥åçš„è°ƒè¯•ã€‚è¿›è¡Œå´©æºƒä¿¡æ¯ç¬¦å·åŒ–çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨å½“å‰åº”ç”¨æ‰“åŒ…çš„ç”µè„‘æ‰€ç”Ÿæˆçš„dSYMæ–‡ä»¶ï¼Œå…¶ä»–ç”µè„‘ç”Ÿæˆçš„æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´åˆ†æä¸å‡†ç¡®çš„é—®é¢˜ã€‚</p></blockquote><h2 id="ç¬¦å·åŒ–crashä¿¡æ¯"><a href="#ç¬¦å·åŒ–crashä¿¡æ¯" class="headerlink" title="ç¬¦å·åŒ–crashä¿¡æ¯"></a>ç¬¦å·åŒ–crashä¿¡æ¯</h2><p>å½“ç¨‹åºå´©æºƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—åˆ°å´©æºƒçš„é”™è¯¯å †æ ˆï¼Œä½†æ˜¯è¿™ä¸ªé”™è¯¯å †æ ˆéƒ½æ˜¯0xå¼€å¤´çš„16è¿›åˆ¶åœ°å€ï¼Œéœ€è¦æˆ‘ä»¬ä½¿ç”¨Xcodeè‡ªå¸¦çš„atoså·¥å…·æˆ–è€…<a href="https://github.com/answer-huang/dSYMTools" target="_blank" rel="noopener">dSYMTools</a>æ¥å°†.Crashå’Œ.dSYMæ–‡ä»¶è¿›è¡Œç¬¦å·åŒ–ï¼Œå°±å¯ä»¥å¾—åˆ°è¯¦ç»†å´©æºƒçš„ä¿¡æ¯ã€‚</p><p>é‚£æˆ‘ä»¬å¦‚ä½•å¾—åˆ°dSYMæ–‡ä»¶å‘¢</p><blockquote><p>å…ˆæ‰“å¼€Xcodeï¼ŒWindows-&gt;Organize-&gt;æ‰¾åˆ°å¯¹åº”çš„appåŒ…ï¼Œç„¶åå³é”®-&gt;Show in finder,æ‰¾åˆ°appName. xcarchive-&gt;æ˜¾ç¤ºåŒ…å†…å®¹-&gt;æŠŠdSYMsæ‹·è´å‡ºæ¥(æˆ–è€…å°±åœ¨é‡Œé¢æ“ä½œ)ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªCrashFolderçš„æ–‡ä»¶å¤¹ï¼Œç„¶åå°†ä¸Šé¢çš„dSYMsæ–‡ä»¶æ‹·è´åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åæˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°ä¸Šé¢çš„Crashä¿¡æ¯ï¼Œç„¶åå³é”®å¯¼å‡ºè¯¥Crashä¿¡æ¯ï¼ŒåŒæ ·æ‹·è´åˆ°CrashFolderæ–‡ä»¶å¤¹ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨atosæ¥å°†Crashæ–‡ä»¶ä¸­çš„åœ°å€è¿˜åŸä¸ºä»£ç ã€‚</p><p>atosçš„åŸºæœ¬ç”¨æ³•ä¸ºï¼š</p><p><code>$ atos -arch &lt;Binary Architecture&gt; -o &lt;Path to dSYM file&gt;/Contents/Resources/DWARF/&lt;binary image name&gt; -l &lt;load address&gt; &lt;address to symbolicate&gt;</code></p><p>åœ¨æˆ‘æœ¬åœ°ä¸­ï¼Œæˆ‘æ‰§è¡Œçš„æ˜¯ï¼š<code>atos -arch arm64 -o testImageSourceCode.app.dSYM/Contents/Resources/DWARF/testImageSourceCode -l 0x100d50000 0x100d55ee4</code></p><p>åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œéœ€è¦è§£é‡Šçš„å¯èƒ½å°±æ˜¯-låé¢çš„ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç¨‹åºçš„åŸºåœ°å€ï¼Œä¹Ÿå°±æ˜¯åœ¨crashæ–‡ä»¶ä¸­ï¼Œåœ¨ <code>Binary Images:</code>ä¸‹é¢çš„ç¬¬ä¸€è¡Œä¸­çš„ç¬¬ä¸€ä¸ªä»¥0Xå¼€å¤´çš„åœ°å€ï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯Crashæ–‡ä»¶ä¸­é”™è¯¯ä¿¡æ¯çš„åœ°å€ï¼Œæ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤ä¹‹åè¾“å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-[LMTool test] (in testImageSourceCode) (LMTool.m:15)</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯å¯¹åº”ä»£ç ä¸­çš„æ–¹æ³•ä»¥åŠå¯¹åº”çš„æ–‡ä»¶é‡Œé¢çš„è¡Œæ•°ã€‚</p><p>å¦å¤–ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥å…·<a href="https://github.com/answer-huang/dSYMTools" target="_blank" rel="noopener">dSYMTools</a>è¿™é‡Œçš„ç”¨æ³•å’Œæˆ‘ä»¬ä¸Šè¿°çš„å·®ä¸å¤šï¼Œåªä¸è¿‡é‚£é‡Œæ˜¯å¯è§†åŒ–å·¥å…·ã€‚</p><p>å®Œæ•´çš„<a href="https://github.com/codemonkeybulucck/CrashCatchDemo" target="_blank" rel="noopener">demo</a>å·²ç»ä¸Šä¼ åˆ°Githubã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨iOSå¼€å‘ä¸­ï¼Œæœ€ä¸¥é‡çš„bugä¼°è®¡å°±æ˜¯åº”ç”¨å¥”æºƒï¼Œå¦‚æœåº”ç”¨å¥”æºƒäº†ï¼Œé™¤äº†åšå¥½æŒ¨éª‚çš„å‡†å¤‡ï¼Œè¿˜éœ€è¦å†·é™çš„ä¸‹æ¥å»å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹éœ€è¦åšä»€ä¹ˆäº‹æƒ…ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è·å–crashä¿¡æ¯&quot;&gt;&lt;a href=&quot;#è·å–crashä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;è·å–crashä¿¡æ¯&quot;&gt;&lt;/a&gt;è·å–crashä¿¡æ¯&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬é¦–å…ˆç¬¬ä¸€ä¸ªäº‹æƒ…å°±æ˜¯è¦çŸ¥é“åº”ç”¨çš„å¥”æºƒä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæœ‰å‡ ç§æ–¹å¼å»è·å–å¥”æºƒä¿¡æ¯ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨Buglyï¼Œå‹ç›Ÿç­‰ç¬¬ä¸‰æ–¹SDKç™»å…¥åå°æŸ¥çœ‹å¥”æºƒä¿¡æ¯&lt;/li&gt;
&lt;li&gt;ä»£ç è‡ªåŠ¨ä¸Šä¼ å¥”æºƒä¿¡æ¯åˆ°æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡æ¢å¤dSYMæ–‡ä»¶æ¥æŸ¥çœ‹å¥”æºƒä¿¡æ¯&lt;/li&gt;
&lt;li&gt;é€šè¿‡ä½¿ç”¨å½“å‰å‘ç”Ÿåº”ç”¨å¥”æºƒçš„è®¾å¤‡å¯¼å‡ºç›¸å…³çš„å¥”æºƒä¿¡æ¯&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯çº¿ä¸Šçš„åº”ç”¨ï¼Œè¿˜å¯ä»¥é€šè¿‡itunesConnectæ¥æŸ¥çœ‹ï¼ˆéå³æ—¶ï¼‰&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>NSRunLoopä¸iOSä¸­çš„å€’è®¡æ—¶ï¼ˆGCD,CADisplaylink,NSTimerï¼‰</title>
    <link href="http://lemon2well.top/2018/08/20/iOS%20%E5%BC%80%E5%8F%91/NSRunLoop%E4%B8%8EiOS%E4%B8%AD%E7%9A%84%E5%80%92%E8%AE%A1%E6%97%B6%EF%BC%88GCD-CADisplaylink-NSTimer%EF%BC%89/"/>
    <id>http://lemon2well.top/2018/08/20/iOS å¼€å‘/NSRunLoopä¸iOSä¸­çš„å€’è®¡æ—¶ï¼ˆGCD-CADisplaylink-NSTimerï¼‰/</id>
    <published>2018-08-20T03:17:45.000Z</published>
    <updated>2018-08-20T03:18:42.822Z</updated>
    
    <content type="html"><![CDATA[<p>ç›¸ä¿¡åœ¨iOSå¼€å‘ä¸­å¤§å®¶éƒ½ç”¨è¿‡å€’è®¡æ—¶çš„åŠŸèƒ½ï¼Œè€ŒNSTimerä¹Ÿæ˜¯å¤§å®¶ç”¨å¾—æœ€å¤šç”¨æ¥å®ç°è¯¥åŠŸèƒ½çš„ç±»ï¼Œä½†æ˜¯å¯èƒ½æœ‰äººä¸å¤ªæ¸…æ¥šNSTimerå­˜åœ¨è®¡æ—¶ä¸å‡†å¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´å¼•ç”¨å¾ªç¯èµ„æºæ— æ³•é‡Šæ”¾çš„æƒ…å†µï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šä»‹ç»ä¸€ä¸‹ä½¿ç”¨GCDä»¥åŠCADisplaylinkæ¥å®ç°å€’è®¡æ—¶ä»¥åŠä»–ä»¬ä¸‰è€…çš„åˆ©å¼Šã€‚</p><h2 id="RunLoop"><a href="#RunLoop" class="headerlink" title="RunLoop"></a>RunLoop</h2><p>åœ¨å¼€å§‹ä»‹ç»ä¸‹é¢ä¸‰ç§æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘æƒ³æˆ‘ä»¬æœ‰å¿…è¦å…ˆæ¥ä»‹ç»ä¸€ä¸‹RunLoopï¼Œå› ä¸ºCADisplaylinkå’ŒNSTimeréƒ½æ˜¯éœ€è¦é€šè¿‡è¿è¡Œåœ¨RunLoopé‡Œé¢æ‰ä¿è¯äº†æ¯æ¬¡åˆ°ç‰¹å®šçš„æ—¶é—´ç‚¹å°±ä¼šæ‰§è¡Œå¯¹åº”çš„äº‹ä»¶</p><a id="more"></a><h2 id="RunLoopæ˜¯ä»€ä¹ˆ"><a href="#RunLoopæ˜¯ä»€ä¹ˆ" class="headerlink" title="RunLoopæ˜¯ä»€ä¹ˆ"></a>RunLoopæ˜¯ä»€ä¹ˆ</h2><p>ä¸€èˆ¬æ¥è¯´çº¿ç¨‹åªèƒ½æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä»»åŠ¡ä¹‹åå°±ä¼šé€€å‡ºï¼Œå¯æ˜¯å¦‚æœéœ€è¦å¤„ç†å¤šä¸ªä»»åŠ¡å‘¢ï¼Œé‚£å°±éœ€è¦RunLoopæ¥ä¿è¯çº¿ç¨‹èƒ½éšæ—¶å¤„ç†äº‹ä»¶å¹¶ä¸”ä¸ä¼šé€€å‡ºã€‚</p><p>RunLoopå®é™…ä¸Šåƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ä¸ªå…¥å£å‡½æ•°ï¼Œè¯¥å…¥å£å‡½æ•°ä¼šå®ç°åƒä¸æ–­çš„å¾ªç¯è·å–ä»»åŠ¡æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ï¼Œå½“çº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªå…¥å£å‡½æ•°ä¹‹åï¼Œå°±ä¼šä¸€ç›´å¤„äºå‡½æ•°å†…éƒ¨ï¼šæ¥å—ä»»åŠ¡-&gt;ç­‰å¾…-&gt;å¤„ç†è¿™æ ·çš„å¾ªç¯ä¸­ï¼ŒçŸ¥é“æ¥å—åˆ°quitæ¶ˆæ¯ï¼Œå°±ä¼šæ¨å‡ºè¯¥å…¥å£å‡½æ•°ï¼Œç„¶åçº¿ç¨‹é”€æ¯ã€‚</p><h2 id="RunLoopå’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»"><a href="#RunLoopå’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»" class="headerlink" title="RunLoopå’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»"></a>RunLoopå’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»</h2><p>RunLoopå’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå®ƒä»¬é€šè¿‡key-valueçš„å½¢å¼ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸é‡Œé¢ï¼ˆkeyæ˜¯p_thread,valueæ˜¯CFRunLoopRefï¼‰ï¼ŒiOSä¸­ä¸å…è®¸ç›´æ¥åˆ›å»ºRunLoopï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªæ–¹æ³•è·å–RunLoop ï¼ŒCFRunLoopGetMain() å’Œ CFRunLoopGetCurrent()ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨<code>CFRunLoopRef _CFRunLoopGet(pthread_t thread)</code>æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆåˆ¤æ–­è¯¥å­—å…¸æ˜¯ä¸æ˜¯ä¸ºç©ºï¼Œå¦‚æœæ˜¯çš„è¯å°±åˆ›å»ºä¸€ä¸ªä»¥pthread_main_thread_np()ä¸ºkeyçš„runloopå¹¶ä¸”æ”¾åˆ°å­—å…¸é‡Œé¢ã€‚ç„¶ååœ¨å­—å…¸ä¸­å¯»æ‰¾threadä¸ºkeyçš„runloopï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„RunLoopå¹¶ä¸”æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå½“çº¿ç¨‹é”€æ¯æ—¶ï¼Œä¹Ÿé”€æ¯RunLoopã€‚</p><h2 id="RunLoopMode"><a href="#RunLoopMode" class="headerlink" title="RunLoopMode"></a>RunLoopMode</h2><p>è‹¹æœæä¾›äº†ä¸¤ä¸ªå…¬å¼€çš„RunLoopModeï¼ŒNSDefaultRunLoopä»¥åŠUITrackingRunLoopModeï¼Œç¬¬ä¸€ä¸ªmodeç¨‹åºé»˜è®¤çš„modeï¼Œå½“ç¨‹åºä¸­æœ‰ScrollViewæ»šåŠ¨çš„æ—¶å€™ï¼ŒRunLoopå°±ä¼šå°†å½“å‰çš„modeåˆ‡æ¢ä¸ºUITrackingRunLoopModeã€‚</p><blockquote><p>ç›¸ä¿¡å¾ˆå¤šäººéƒ½æœ‰è¿‡NSTimeråœ¨é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ï¼Œå½“APPæœ‰ScrollViewåœ¨æ»šåŠ¨çš„æ—¶å€™å°±ä¸å¯ç”¨çš„å›è°ƒï¼Œé‚£æ˜¯å› ä¸ºNSTimeråŠ åˆ°runloopé‡Œé¢çš„æ—¶å€™é»˜è®¤æ˜¯NSDefaultRunLoopï¼Œå½“é¡µé¢æ»‘åŠ¨çš„æ—¶å€™RunLoopåˆ‡æ¢åˆ°äº†UITrackingRunLoopModeï¼Œæ‰€ä»¥timerå°±ä¸èµ·ä½œç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨<code>[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];</code>å°†timeræ ‡è®°ä¸ºNSRunLoopCommonModesï¼ŒNSRunLoopCommonModesé»˜è®¤æ˜¯åŒ…å«äº†NSDefaultRunLoopå’ŒUITrackingRunLoopModeä¸¤ä¸ªmodelã€‚</p></blockquote><h2 id="RunLoopçš„ç»“æ„"><a href="#RunLoopçš„ç»“æ„" class="headerlink" title="RunLoopçš„ç»“æ„"></a>RunLoopçš„ç»“æ„</h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹RunLoopçš„éƒ½åŒ…å«ä»€ä¹ˆä¸œè¥¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">struct __CFRunLoopMode &#123;</span><br><span class="line">    CFStringRef _name;            // Mode Name, ä¾‹å¦‚ @&quot;kCFRunLoopDefaultMode&quot;</span><br><span class="line">    CFMutableSetRef _sources0;    // Set</span><br><span class="line">    CFMutableSetRef _sources1;    // Set</span><br><span class="line">    CFMutableArrayRef _observers; // Array</span><br><span class="line">    CFMutableArrayRef _timers;    // Array</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">struct __CFRunLoop &#123;</span><br><span class="line">    CFMutableSetRef _commonModes;     // Set</span><br><span class="line">    CFMutableSetRef _commonModeItems; // Set&lt;Source/Observer/Timer&gt;</span><br><span class="line">    CFRunLoopModeRef _currentMode;    // Current Runloop Mode</span><br><span class="line">    CFMutableSetRef _modes;           // Set</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>_CFRunLoop:</p><ul><li><p>_commonModesï¼š ä¸€ä¸ªæ ‡è®°ä¸ºcommonçš„é›†åˆï¼Œé€šè¿‡<code>CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);</code>å¯ä»¥å°†ä¸€ä¸ªmodeåŠ åˆ°commonModesé‡Œé¢ï¼Œå½“RunLoopçš„å†…å®¹å˜åŒ–çš„æ—¶å€™ï¼ŒRunLoopéƒ½ä¼šå°†Timer/Observer/SourcesåŒæ­¥åˆ°æ ‡è®°ä¸ºâ€œcommonâ€çš„Modeé‡Œé¢</p></li><li><p>_commonModeItemsï¼š è¢«åŠ åˆ°CommonModesé‡Œé¢çš„æ‰€æœ‰çš„Itemçš„é›†åˆï¼Œä¸€ä¸ªItemåŒ…å«_source0,_source1,_observersï¼Œ_timersã€‚</p></li><li><p>_currentModeï¼š å½“å‰RunLoopçš„modeï¼Œå¯ä»¥é€šè¿‡ <code>CFRunLoopRunInMode(CFStringRef modeName, ...);</code>æ¥åˆ‡æ¢mode</p></li><li><p>_modesï¼šRunLoopåŒ…å«çš„mode</p></li></ul><p>_CFRunLoopMode:</p><ul><li><p>source0(CFRunLoopSourceRef)ï¼š modeçš„äº‹ä»¶æºï¼Œsource0åªåŒ…å«ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªåŠ¨è§¦å‘ï¼Œéœ€è¦å…ˆè°ƒç”¨ <code>CFRunLoopSourceSinal(source)</code>å°†sourceæ ‡ä¸ºå¾…å¤„ç†ï¼Œç„¶åè°ƒç”¨<code>CFRunLoopSourceWakeUp(source)</code>æ¥å”¤é†’RunLoopæ‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p></li><li><p>_sources1(CFRunLoopSourceRef)ï¼š modeçš„å¦å¤–ä¸€ä¸ªäº‹ä»¶æºï¼Œsource1åŒ…å«äº†å›è°ƒä»¥åŠä¸€ä¸ªmach-portï¼Œè¢«ç”¨äºé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ã€‚è¿™ç§ Source èƒ½ä¸»åŠ¨å”¤é†’ RunLoop çš„çº¿ç¨‹</p></li><li><p>_timers: æ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼Œå®ƒå’Œ NSTimer æ˜¯toll-free bridged çš„ï¼Œå¯ä»¥æ··ç”¨ã€‚å…¶åŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰</p></li><li><p>_observers: æ˜¯è§‚å¯Ÿè€…ï¼Œæ¯ä¸ª Observer éƒ½åŒ…å«äº†ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå½“ RunLoop çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å°±èƒ½é€šè¿‡å›è°ƒæ¥å—åˆ°è¿™ä¸ªå˜åŒ–ã€‚</p></li></ul><p>æ›´å¤šçš„å…³äºRunLoopçš„å†…å®¹å¯ä»¥çœ‹<a href="https://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="noopener">æ·±å…¥ç†è§£RunLoop</a></p><h2 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h2><p>æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹çš„ä»£ç æ¥åˆ›å»ºä¸€ä¸ªTimerå¹¶ä¸”å°†TimeråŠ åˆ°RunLoopé‡Œé¢ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sellf.timer = [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(doSomeThing) userInfo:nil repeats:YES];</span><br><span class="line">[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„ä»£ç ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œé¦–å…ˆRunLoopä¼šå¼ºå¼•ç”¨timerï¼Œè€Œtimerä¼šå¼ºå¼•ç”¨self,æ‰€ä»¥timerä¸é‡Šæ”¾çš„æ—¶å€™ï¼Œselfä¹Ÿæ— æ³•é‡Šæ”¾ã€‚é€šå¸¸æˆ‘ä»¬ä¼šç”¨ä»¥ä¸‹çš„ä»£ç æ¥é‡Šæ”¾Timerï¼Œä½†æ˜¯éœ€è¦æ‰¾ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå»é‡Šæ”¾å®ƒï¼ŒåŠ å…¥æˆ‘ä»¬åƒä»¥ä¸‹ä»£ç é‚£æ ·åœ¨viewWillDisapperé‚£æ ·é‡Šæ”¾å®ƒï¼Œå½“å›åˆ°ä¸»å±å¹•çš„æ—¶å€™é‚£timeråˆè¦è¢«é”€æ¯äº†ï¼Œç„¶åé‡æ–°è¿›å…¥é‡æ–°åˆ›å»ºä¸€ä¸ªtimerï¼Œè¿™æ ·å°±ä¼šéå¸¸éº»çƒ¦ï¼Œéœ€è¦å¤šä¸ªåœ°æ–¹ç»´æŠ¤timerçš„çŠ¶æ€ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillDisappear:(BOOL)animated&#123;</span><br><span class="line">    [super viewWillDisappear:animated];</span><br><span class="line">    [self.timer invalidate];</span><br><span class="line">    self.timer  = nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬è¿™é‡Œè¦è§£å†³çš„å°±æ˜¯timerçš„é‡Šæ”¾æ—¶æœºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯å¸Œæœ›æŒæœ‰timerçš„è§†å›¾æ§åˆ¶å™¨æ‰§è¡Œdeallocé‡Šæ”¾çš„æ—¶å€™é‡Šæ”¾å®ƒï¼Œä½†æ˜¯è¿™æ—¶å€™åƒä¸‡åˆ«ä¼å›¾åœ¨deallocæ–¹æ³•é‡Œé¢åšè¿™ä¸ªäº‹æƒ…ï¼ŒåŸå› è‡ªå·±æƒ³ã€‚</p><p>æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªMagicClassæ¥å¼±åº”ç”¨è¿™ä¸ªtargetï¼Œç„¶åtimerçš„targetå¼ºå¼•ç”¨è¿™ä¸ªMagicClassï¼Œæ‰§è¡ŒMagicClassçš„ä¸€ä¸ªæ›¿èº«Actionï¼Œåœ¨è¿™ä¸ªActioné‡Œé¢æˆ‘ä»¬å¯ä»¥åˆ¤æ–­targetæ˜¯ä¸æ˜¯è¢«é”€æ¯äº†ï¼ˆå› ä¸ºè¿™ä¸ªæ—¶å€™æ²¡æœ‰Timerå¼ºå¼•ç”¨å®ƒï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æœ‰å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼‰ï¼Œç„¶åæ²¡æœ‰è¢«é”€æ¯åˆ™æ‰§è¡ŒçœŸæ­£çš„Actionï¼Œå¦‚æœTargetå·²ç»è¢«é”€æ¯äº†åˆ™è°ƒç”¨invalidateé”€æ¯timerã€‚</p><p>here is the code</p><p>NSTimer+LMExtension.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface NSTimer (LMExtension)</span><br><span class="line">+ (instancetype)lmScheduledTimerWithTimeInterval:(NSTimeInterval)interval target:(id)target selector:(SEL)selector userInfo:(id)userInfo;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>NSTimer+LMExtension.m</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;NSTimer+LMExtension.h&quot;</span><br><span class="line"></span><br><span class="line">@interface LMMagicTarget : NSObject</span><br><span class="line">@property (nonatomic, weak) id target;</span><br><span class="line">@property (nonatomic, assign) SEL selector;</span><br><span class="line">@property (nonatomic, weak) NSTimer *timer;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LMMagicTarget</span><br><span class="line">- (void)LMTimerStarAction:(NSTimer *)timer</span><br><span class="line">&#123;</span><br><span class="line">    if (self.target) &#123;</span><br><span class="line">        [self.target performSelector:self.selector withObject:timer afterDelay:0.0];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self.timer invalidate];</span><br><span class="line">        self.timer = nil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@implementation NSTimer (LMExtension)</span><br><span class="line">+ (instancetype)lmScheduledTimerWithTimeInterval:(NSTimeInterval)interval target:(id)target selector:(SEL)selector userInfo:(id)userInfo&#123;</span><br><span class="line">    LMMagicTarget *magicTarget = [[LMMagicTarget alloc]init];</span><br><span class="line">    magicTarget.target = target;</span><br><span class="line">    magicTarget.selector = selector;</span><br><span class="line">    NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:interval target:magicTarget selector:@selector(LMTimerStarAction:) userInfo:nil repeats:YES];</span><br><span class="line">    magicTarget.timer = timer;</span><br><span class="line">    return  timer;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œç²¾åº¦é—®é¢˜ã€‚NSTimerå…¶å®å°±æ˜¯ CFRunLoopTimerRefï¼Œä»–ä»¬ä¹‹é—´æ˜¯ toll-free bridged çš„ï¼Œä¸€ä¸ªtimeræ³¨å†Œå¥½åï¼ŒRunLoopä¼šåœ¨å…¶é‡å¤çš„æ—¶é—´ç‚¹æ³¨å†Œäº‹ä»¶ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™RunLoopæ­£åœ¨å¤„ç†ä¸€ä¸ªå…¶ä»–ä»»åŠ¡çš„æ—¶å€™ï¼Œé”™è¿‡äº†è¯¥äº‹ä»¶ç‚¹ï¼Œåˆ™è¯¥æ¬¡ä¸ä¼šæ‰§è¡Œtimerçš„äº‹ä»¶æºï¼Œä¼šè·³è¿‡å½“å‰æ—¶é—´ç‚¹ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹æ‰æ‰§è¡Œè¯¥timerçš„äº‹ä»¶æºã€‚æ‰€ä»¥timerä¼šæœ‰ä¸€ä¸ªToleranceçš„å±æ€§ï¼Œè¿™å±æ€§å°±æ˜¯å®½å®¹åº¦ï¼Œè¯¥å±æ€§æ ‡è®°å½“æ—¶é—´ç‚¹åˆ°äº†åï¼Œå®¹è®¸æœ‰å¤šå°‘çš„è¯¯å·®ã€‚</li></ol><h2 id="CADisplayLink"><a href="#CADisplayLink" class="headerlink" title="CADisplayLink"></a>CADisplayLink</h2><p>CADisplayLinkæ˜¯ä¸€ä¸ªä»¥å±å¹•åˆ·æ–°é¢‘ç‡åŒæ­¥çš„è®¡æ—¶å™¨ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºæ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºæ–¹æ³•</span><br><span class="line">self.displayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(handleDisplayLink:)];    </span><br><span class="line">[self.displayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSDefaultRunLoopMode];</span><br><span class="line">åœæ­¢æ–¹æ³•</span><br><span class="line">[self.displayLink invalidate];  </span><br><span class="line">self.displayLink = nil;</span><br></pre></td></tr></table></figure><p>CADisplayLinkçš„è®¡ç®—æ—¶é—´å¹¶ä¸ä¾é RunLoopï¼Œå½“ä¸€ä¸ªå±å¹•åˆ·æ–°å®Œæˆæ—¶å€™åˆ™ä¼šé€šçŸ¥RunLoopç»™å¯¹åº”çš„targetæ‰§è¡Œactionã€‚ä½†æ˜¯CADisplayLinkä¾ç„¶ä¼šæœ‰ç²¾åº¦çš„é—®é¢˜ï¼Œå½“ä¸¤æ¬¡ç•Œé¢åˆ·æ–°ä¹‹é—´æ‰§è¡Œäº†ä¸€æ¬¡é•¿ä»»åŠ¡çš„æ—¶å€™ï¼Œé‚£å°±ä¼šæœ‰ä¸€å¸§è¢«è·³è¿‡å»ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æ‰å¸§ï¼Œé‚£ç›¸åº”çš„æ­¤æ¬¡ä¹Ÿä¸ä¼šè°ƒç”¨targetçš„actionã€‚</p><h2 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h2><p>GCDæä¾›äº†ä¸€ä¸ªè®¡æ—¶çš„æ–¹æ³•ï¼ŒGCDå®šæ—¶å™¨çš„åº•å±‚æ˜¯ç”±XNUå†…æ ¸ä¸­çš„selectæ–¹æ³•å®ç°çš„ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line">    self.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);</span><br><span class="line">    dispatch_source_set_timer(self.timer, DISPATCH_TIME_NOW , 1 * NSEC_PER_SEC, 0 * NSEC_PER_SEC);</span><br><span class="line">    dispatch_source_set_event_handler(self.timer, ^&#123;</span><br><span class="line">        NSLog(@&quot;GCD&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    //å¼€å¯å®šæ—¶å™¨</span><br><span class="line">    dispatch_resume(self.timer);</span><br><span class="line">    </span><br><span class="line">    //é”€æ¯å®šæ—¶å™¨</span><br><span class="line">    dispatch_source_cancel(self.timer);</span><br><span class="line">    self.timer = nil;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœæ˜¯å¯¹æ—¶é—´çš„è¦æ±‚ä¸ç²¾ç¡®çš„è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨NSTimerï¼Œå¦‚æœæ˜¯å¯¹æ—¶é—´æ¯”è¾ƒç²¾ç¡®çš„ï¼Œå¯ä»¥ä½¿ç”¨GCDæä¾›çš„å€’è®¡æ—¶æ–¹æ³•ã€‚å¦‚æœæ˜¯å®ç°åŠ¨ç”»ï¼Œéœ€è¦é«˜é¢‘ç‡çš„ç»˜åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨CADisplayLinkã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç›¸ä¿¡åœ¨iOSå¼€å‘ä¸­å¤§å®¶éƒ½ç”¨è¿‡å€’è®¡æ—¶çš„åŠŸèƒ½ï¼Œè€ŒNSTimerä¹Ÿæ˜¯å¤§å®¶ç”¨å¾—æœ€å¤šç”¨æ¥å®ç°è¯¥åŠŸèƒ½çš„ç±»ï¼Œä½†æ˜¯å¯èƒ½æœ‰äººä¸å¤ªæ¸…æ¥šNSTimerå­˜åœ¨è®¡æ—¶ä¸å‡†å¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´å¼•ç”¨å¾ªç¯èµ„æºæ— æ³•é‡Šæ”¾çš„æƒ…å†µï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šä»‹ç»ä¸€ä¸‹ä½¿ç”¨GCDä»¥åŠCADisplaylinkæ¥å®ç°å€’è®¡æ—¶ä»¥åŠä»–ä»¬ä¸‰è€…çš„åˆ©å¼Šã€‚&lt;/p&gt;
&lt;h2 id=&quot;RunLoop&quot;&gt;&lt;a href=&quot;#RunLoop&quot; class=&quot;headerlink&quot; title=&quot;RunLoop&quot;&gt;&lt;/a&gt;RunLoop&lt;/h2&gt;&lt;p&gt;åœ¨å¼€å§‹ä»‹ç»ä¸‹é¢ä¸‰ç§æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘æƒ³æˆ‘ä»¬æœ‰å¿…è¦å…ˆæ¥ä»‹ç»ä¸€ä¸‹RunLoopï¼Œå› ä¸ºCADisplaylinkå’ŒNSTimeréƒ½æ˜¯éœ€è¦é€šè¿‡è¿è¡Œåœ¨RunLoopé‡Œé¢æ‰ä¿è¯äº†æ¯æ¬¡åˆ°ç‰¹å®šçš„æ—¶é—´ç‚¹å°±ä¼šæ‰§è¡Œå¯¹åº”çš„äº‹ä»¶&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>å›¾æ–‡æ··æ’çš„å››ç§æ–¹æ¡ˆ</title>
    <link href="http://lemon2well.top/2018/08/15/iOS%20%E5%BC%80%E5%8F%91/%E5%9B%BE%E6%96%87%E6%B7%B7%E6%8E%92%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%96%B9%E6%A1%88/"/>
    <id>http://lemon2well.top/2018/08/15/iOS å¼€å‘/å›¾æ–‡æ··æ’çš„å››ç§æ–¹æ¡ˆ/</id>
    <published>2018-08-15T09:12:26.000Z</published>
    <updated>2018-08-15T09:21:15.954Z</updated>
    
    <content type="html"><![CDATA[<p>å›¾æ–‡æ··æ’æœ‰å¤šç§æ–¹å¼å¯ä»¥å®ç°ï¼Œä¸‹é¢æˆ‘ä¼šç”¨å››ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°ä»¥ä¸‹ç•Œé¢çš„æ•ˆæœï¼Œå¹¶ä¸”è¯´æ˜ä»–ä»¬çš„ä¼˜ç¼ºç‚¹ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/screenshot.png" alt="screenshot"></p><h2 id="NSAttributedString"><a href="#NSAttributedString" class="headerlink" title="NSAttributedString"></a>NSAttributedString</h2><blockquote><p>NSAttributedStringæä¾›äº†è‡ªç”±å¹¶ä¸”å¤šæ ·å¼çš„å¯Œæ–‡æœ¬è®¾ç½®ï¼Œå›¾æ–‡æ··æ’çš„å®ç°æ˜¯é€šè¿‡æ’å…¥NSTestAttachmentæ¥å®ç°ã€‚</p></blockquote><a id="more"></a><p>talk is cheap ï¼Œhere is the code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">//è°ƒç”¨</span><br><span class="line">NSString *originStr = @&quot; Hi ALL,è¿™æ˜¯æˆ‘çš„åšå®¢ï¼šlemon2well.topï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œç¯æ¬¢è¿è¯„è®ºç•™è¨€ä¸€èµ·äº¤æµã€‚&quot;;</span><br><span class="line">    NSString *targetStr = @&quot;lemon2well.top&quot;;</span><br><span class="line">    NSString *imageName = @&quot;trumpet&quot;;</span><br><span class="line">    self.label.attributedText = [self attribuStringWithString:originStr targetString:targetStr image:imageName];</span><br><span class="line"></span><br><span class="line">//æ–¹æ³•</span><br><span class="line">- (NSAttributedString*)attribuStringWithString:(NSString*)string targetString:(NSString *)target image:(NSString*)imageName&#123;</span><br><span class="line">    NSMutableAttributedString *attributedStr = [[NSMutableAttributedString alloc]initWithString:string attributes:@&#123;NSForegroundColorAttributeName:[UIColor blackColor],NSFontAttributeName:[UIFont systemFontOfSize:20]&#125;];</span><br><span class="line">    </span><br><span class="line">    NSRange linkRange = [string rangeOfString:target];</span><br><span class="line">    if (linkRange.length != 0) &#123;</span><br><span class="line">        //æ·»åŠ å¯ç‚¹å‡»é“¾æ¥</span><br><span class="line">        [attributedStr addAttribute:NSLinkAttributeName value:[NSURL URLWithString:@&quot;lemon2well.top&quot;] range:linkRange];</span><br><span class="line">        [attributedStr addAttribute:NSForegroundColorAttributeName value:[UIColor blackColor] range:linkRange];</span><br><span class="line">        //æ·»åŠ ä¸‹åˆ’çº¿</span><br><span class="line">        [attributedStr addAttribute:NSUnderlineStyleAttributeName value:@1 range:linkRange];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //æ·»åŠ å›¾ç‰‡</span><br><span class="line">    NSTextAttachment *attachment = [[NSTextAttachment alloc]init];</span><br><span class="line">    attachment.image = [UIImage imageNamed:imageName];</span><br><span class="line">    attachment.bounds = CGRectMake(0, 0, 20 ,20);</span><br><span class="line">    NSAttributedString *imageStr = [NSAttributedString attributedStringWithAttachment:attachment];</span><br><span class="line">    //æ’å…¥å›¾ç‰‡</span><br><span class="line">    [attributedStr insertAttributedString:imageStr atIndex:0];</span><br><span class="line">    </span><br><span class="line">    // æ®µè½æ ·å¼</span><br><span class="line">    NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc]init];</span><br><span class="line">    // è¡Œé—´è·</span><br><span class="line">    [style setLineSpacing:3];</span><br><span class="line">    // æ®µè½é—´è·</span><br><span class="line">    [style setParagraphSpacing:10];</span><br><span class="line">    // é¦–è¡Œç¼©è¿›</span><br><span class="line">    [style setFirstLineHeadIndent:25];</span><br><span class="line">    [attributedStr addAttribute:NSParagraphStyleAttributeName value:style range:NSMakeRange(0, string.length-1)];</span><br><span class="line">    </span><br><span class="line">    return attributedStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯NSAttributedStringçš„å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// NSFontAttributeName                è®¾ç½®å­—ä½“å±æ€§ï¼Œé»˜è®¤å€¼ï¼šå­—ä½“ï¼šHelvetica(Neue) å­—å·ï¼š12</span><br><span class="line">// NSForegroundColorAttributeNam      è®¾ç½®å­—ä½“é¢œè‰²ï¼Œå–å€¼ä¸º UIColorå¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²</span><br><span class="line">// NSBackgroundColorAttributeName     è®¾ç½®å­—ä½“æ‰€åœ¨åŒºåŸŸèƒŒæ™¯é¢œè‰²ï¼Œå–å€¼ä¸º UIColorå¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºnil, é€æ˜è‰²</span><br><span class="line">// NSLigatureAttributeName            è®¾ç½®è¿ä½“å±æ€§ï¼Œå–å€¼ä¸ºNSNumber å¯¹è±¡(æ•´æ•°)ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰è¿ä½“å­—ç¬¦ï¼Œ1 è¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„è¿ä½“å­—ç¬¦</span><br><span class="line">// NSKernAttributeName                è®¾å®šå­—ç¬¦é—´è·ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œæ­£å€¼é—´è·åŠ å®½ï¼Œè´Ÿå€¼é—´è·å˜çª„</span><br><span class="line">// NSStrikethroughStyleAttributeName  è®¾ç½®åˆ é™¤çº¿ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰</span><br><span class="line">// NSStrikethroughColorAttributeName  è®¾ç½®åˆ é™¤çº¿é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²</span><br><span class="line">// NSUnderlineStyleAttributeName      è®¾ç½®ä¸‹åˆ’çº¿ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œæšä¸¾å¸¸é‡ NSUnderlineStyleä¸­çš„å€¼ï¼Œä¸åˆ é™¤çº¿ç±»ä¼¼</span><br><span class="line">// NSUnderlineColorAttributeName      è®¾ç½®ä¸‹åˆ’çº¿é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºé»‘è‰²</span><br><span class="line">// NSStrokeWidthAttributeName         è®¾ç½®ç¬”ç”»å®½åº¦ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡ï¼ˆæ•´æ•°ï¼‰ï¼Œè´Ÿå€¼å¡«å……æ•ˆæœï¼Œæ­£å€¼ä¸­ç©ºæ•ˆæœ</span><br><span class="line">// NSStrokeColorAttributeName         å¡«å……éƒ¨åˆ†é¢œè‰²ï¼Œä¸æ˜¯å­—ä½“é¢œè‰²ï¼Œå–å€¼ä¸º UIColor å¯¹è±¡</span><br><span class="line">// NSShadowAttributeName              è®¾ç½®é˜´å½±å±æ€§ï¼Œå–å€¼ä¸º NSShadow å¯¹è±¡</span><br><span class="line">// NSTextEffectAttributeName          è®¾ç½®æ–‡æœ¬ç‰¹æ®Šæ•ˆæœï¼Œå–å€¼ä¸º NSString å¯¹è±¡ï¼Œç›®å‰åªæœ‰å›¾ç‰ˆå°åˆ·æ•ˆæœå¯ç”¨ï¼š</span><br><span class="line">// NSBaselineOffsetAttributeName      è®¾ç½®åŸºçº¿åç§»å€¼ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼ä¸Šåï¼Œè´Ÿå€¼ä¸‹å</span><br><span class="line">// NSObliquenessAttributeName         è®¾ç½®å­—å½¢å€¾æ–œåº¦ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼å³å€¾ï¼Œè´Ÿå€¼å·¦å€¾</span><br><span class="line">// NSExpansionAttributeName           è®¾ç½®æ–‡æœ¬æ¨ªå‘æ‹‰ä¼¸å±æ€§ï¼Œå–å€¼ä¸º NSNumber ï¼ˆfloatï¼‰,æ­£å€¼æ¨ªå‘æ‹‰ä¼¸æ–‡æœ¬ï¼Œè´Ÿå€¼æ¨ªå‘å‹ç¼©æ–‡æœ¬</span><br><span class="line">// NSWritingDirectionAttributeName    è®¾ç½®æ–‡å­—ä¹¦å†™æ–¹å‘ï¼Œä»å·¦å‘å³ä¹¦å†™æˆ–è€…ä»å³å‘å·¦ä¹¦å†™</span><br><span class="line">// NSVerticalGlyphFormAttributeName   è®¾ç½®æ–‡å­—æ’ç‰ˆæ–¹å‘ï¼Œå–å€¼ä¸º NSNumber å¯¹è±¡(æ•´æ•°)ï¼Œ0 è¡¨ç¤ºæ¨ªæ’æ–‡æœ¬ï¼Œ1 è¡¨ç¤ºç«–æ’æ–‡æœ¬</span><br><span class="line">// NSLinkAttributeName                è®¾ç½®é“¾æ¥å±æ€§ï¼Œç‚¹å‡»åè°ƒç”¨æµè§ˆå™¨æ‰“å¼€æŒ‡å®šURLåœ°å€</span><br><span class="line">// NSAttachmentAttributeName          è®¾ç½®æ–‡æœ¬é™„ä»¶,å–å€¼ä¸ºNSTextAttachmentå¯¹è±¡,å¸¸ç”¨äºæ–‡å­—å›¾ç‰‡æ··æ’</span><br><span class="line">// NSParagraphStyleAttributeName      è®¾ç½®æ–‡æœ¬æ®µè½æ’ç‰ˆæ ¼å¼ï¼Œå–å€¼ä¸º NSParagraphStyle å¯¹è±¡</span><br></pre></td></tr></table></figure><p>NSParagraphStyleçš„å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSMutableParagraphStyle *paragraphStyle = [[NSMutableParagraphStyle alloc] init];  </span><br><span class="line">paragraphStyle.lineSpacing = 10;// å­—ä½“çš„è¡Œé—´è·  </span><br><span class="line">paragraphStyle.firstLineHeadIndent = 20.0f;//é¦–è¡Œç¼©è¿›  </span><br><span class="line">paragraphStyle.alignment = NSTextAlignmentJustified;//ï¼ˆä¸¤ç«¯å¯¹é½çš„ï¼‰æ–‡æœ¬å¯¹é½æ–¹å¼ï¼šï¼ˆå·¦ï¼Œä¸­ï¼Œå³ï¼Œä¸¤ç«¯å¯¹é½ï¼Œè‡ªç„¶ï¼‰  </span><br><span class="line">paragraphStyle.lineBreakMode = NSLineBreakByTruncatingTail;//ç»“å°¾éƒ¨åˆ†çš„å†…å®¹ä»¥â€¦â€¦æ–¹å¼çœç•¥ ( &quot;...wxyz&quot; ,&quot;abcd...&quot; ,&quot;ab...yz&quot;)  </span><br><span class="line">paragraphStyle.headIndent = 20;//æ•´ä½“ç¼©è¿›(é¦–è¡Œé™¤å¤–)  </span><br><span class="line">paragraphStyle.tailIndent = 20;//  </span><br><span class="line">paragraphStyle.minimumLineHeight = 10;//æœ€ä½è¡Œé«˜  </span><br><span class="line">paragraphStyle.maximumLineHeight = 20;//æœ€å¤§è¡Œé«˜  </span><br><span class="line">paragraphStyle.paragraphSpacing = 15;//æ®µä¸æ®µä¹‹é—´çš„é—´è·  </span><br><span class="line">paragraphStyle.paragraphSpacingBefore = 22.0f;//æ®µé¦–è¡Œç©ºç™½ç©ºé—´/* Distance between the bottom of the previous paragraph (or the end of its paragraphSpacing, if any) and the top of this paragraph. */  </span><br><span class="line">paragraphStyle.baseWritingDirection = NSWritingDirectionLeftToRight;//ä»å·¦åˆ°å³çš„ä¹¦å†™æ–¹å‘ï¼ˆä¸€å…±â¡ï¸ä¸‰ç§ï¼‰  </span><br><span class="line">paragraphStyle.lineHeightMultiple = 15;/* Natural line height is multiplied by this factor (if positive) before being constrained by minimum and maximum line height. */  </span><br><span class="line">paragraphStyle.hyphenationFactor = 1;//è¿å­—å±æ€§ åœ¨iOSï¼Œå”¯ä¸€æ”¯æŒçš„å€¼åˆ†åˆ«ä¸º0å’Œ1</span><br></pre></td></tr></table></figure><h2 id="TextView-UIImageview"><a href="#TextView-UIImageview" class="headerlink" title="TextView + UIImageview"></a>TextView + UIImageview</h2><blockquote><p> ä»¥ä¸Šçš„æ•ˆæœåŒæ ·å¯ä»¥ä½¿ç”¨UITextView + UIImageViewæ¥å®ç°ï¼Œè¯¥æ–¹æ³•ä¸»è¦åˆ©ç”¨äº†textviewçš„textContainer.exclusionPathså±æ€§</p></blockquote><p>// Default value : empty array  An array of UIBezierPath representing the exclusion paths inside the receiverâ€™s bounding rect.<br>@property (copy, NS_NONATOMIC_IOSONLY) NSArray<uibezierpath *=""> *exclusionPaths NS_AVAILABLE(10_11, 7_0);</uibezierpath></p><p>æŒ‰ç…§æ–‡æ¡£çš„è¯´æ˜æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªå…ƒç´ ä¸ºUIBezierPathçš„æ•°ç»„ï¼Œè¿™æ ·æ–‡å­—çš„æç»˜å°±ä¼šé¿å¼€è¿™äº›è·¯å¾„ã€‚ä»è€Œå®ç°å›¾æ–‡æ··æ’çš„æ•ˆæœã€‚ä¸è¿‡è¿™ç§æ–¹å¼æœ€é€‚åˆç”¨äºæ–‡å­—ç¯ç»•çš„æ•ˆæœï¼Œæ‰€æœ‰çš„æ–‡å­—æŠŠå›¾ç‰‡åŒ…å›´ä½ã€‚</p><p>here is the code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// è°ƒç”¨</span><br><span class="line"> UITextView *textView = [[UITextView alloc]init];</span><br><span class="line">    textView.frame = CGRectMake(20, 200, 335, 150);</span><br><span class="line">    textView.attributedText = [self textViewAttributestring];</span><br><span class="line">    [textView sizeToFit];</span><br><span class="line">    [self.view addSubview:textView];</span><br><span class="line">    self.textView = textView;</span><br><span class="line">    </span><br><span class="line">    UIImageView *imageView = [[UIImageView alloc]init];</span><br><span class="line">    imageView.frame = CGRectMake(45, 210, 20, 20);</span><br><span class="line">    imageView.image = [UIImage imageNamed:@&quot;trumpet&quot;];</span><br><span class="line">    [self.view addSubview:imageView];</span><br><span class="line">    self.imageView = imageView;</span><br><span class="line">    textView.textContainer.exclusionPaths = @[[self translatedBezierPath]];</span><br><span class="line">    </span><br><span class="line">//æ–¹æ³•ï¼š</span><br><span class="line">- (UIBezierPath *)translatedBezierPath</span><br><span class="line">&#123;</span><br><span class="line">    //è®¡ç®—å‡ºimageViewç›¸å¯¹äºtextViewçš„ç›¸å¯¹åæ ‡</span><br><span class="line">    CGRect imageRect = [self.textView</span><br><span class="line">                        convertRect:self.imageView.frame fromView:self.view];</span><br><span class="line">    UIBezierPath *bezierPath = [UIBezierPath bezierPathWithRect:CGRectMake(imageRect.origin.x, imageRect.origin.y-10, imageRect.size.width, imageRect.size.height)];</span><br><span class="line">    return bezierPath;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (NSAttributedString*)textViewAttributestring&#123;</span><br><span class="line">    NSString *originStr = @&quot; Hi ALL,è¿™æ˜¯æˆ‘çš„åšå®¢ï¼šlemon2well.topï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œç¯æ¬¢è¿è¯„è®ºç•™è¨€ä¸€èµ·äº¤æµã€‚&quot;;</span><br><span class="line">    NSString *targetStr = @&quot;lemon2well.top&quot;;</span><br><span class="line">    </span><br><span class="line">    NSMutableAttributedString *attributedStr = [[NSMutableAttributedString alloc]initWithString:originStr attributes:@&#123;NSForegroundColorAttributeName:[UIColor blackColor],NSFontAttributeName:[UIFont systemFontOfSize:20]&#125;];</span><br><span class="line">    </span><br><span class="line">    NSRange linkRange = [originStr rangeOfString:targetStr];</span><br><span class="line">    if (linkRange.length != 0) &#123;</span><br><span class="line">        //æ·»åŠ å¯ç‚¹å‡»é“¾æ¥</span><br><span class="line">        [attributedStr addAttribute:NSLinkAttributeName value:[NSURL URLWithString:targetStr] range:linkRange];</span><br><span class="line">        [attributedStr addAttribute:NSForegroundColorAttributeName value:[UIColor blackColor] range:linkRange];</span><br><span class="line">        //æ·»åŠ ä¸‹åˆ’çº¿</span><br><span class="line">        [attributedStr addAttribute:NSUnderlineStyleAttributeName value:@1 range:linkRange];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ®µè½æ ·å¼</span><br><span class="line">    NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc]init];</span><br><span class="line">    // è¡Œé—´è·</span><br><span class="line">    [style setLineSpacing:3];</span><br><span class="line">    // æ®µè½é—´è·</span><br><span class="line">    [style setParagraphSpacing:10];</span><br><span class="line">    // é¦–è¡Œç¼©è¿›</span><br><span class="line">    [style setFirstLineHeadIndent:25];</span><br><span class="line">    [attributedStr addAttribute:NSParagraphStyleAttributeName value:style range:NSMakeRange(0, originStr.length-1)];</span><br><span class="line">    </span><br><span class="line">    return attributedStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CoreText"><a href="#CoreText" class="headerlink" title="CoreText"></a>CoreText</h2><p>coreTextç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯å¤ªéš¾ç”¨äº†ï¼Œä½†æ˜¯å¯åˆ›é€ æ€§åˆå¾ˆé«˜ï¼Œå› ä¸ºCoreTextæ˜¯å±äºæ¯”è¾ƒåº•å±‚çš„æ¡†æ¶ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨çš„Cçš„æ–¹æ³•ï¼ŒCoreTextå¯ä»¥å®ç°å¾ˆå¤æ‚çš„å›¾æ–‡æ··æ’è€Œä¸”æ¸²æŸ“é€Ÿåº¦æ›´å¿«ã€‚</p><p>CoreTextæ¥å®ç°å›¾æ–‡æ··æ’å®é™…ä¸Šåˆ†ä¸ºä»¥ä¸‹çš„å‡ æ­¥:</p><blockquote><p>è·å¾—ä¸Šä¸‹æ–‡ï¼Œç¿»è½¬åæ ‡ç³» -&gt; åˆ›å»ºNSAttributeString -&gt; åˆ›å»ºç©ºç™½å ä½å›¾ç‰‡ï¼Œåˆ›å»ºä»£ç† -&gt; å®ç°ä»£ç† -&gt; åˆ›å»ºCTFrameRef,CTFrameDrawç»˜åˆ¶ -&gt; è®¡ç®—å›¾ç‰‡åæ ‡ï¼ŒCGContextDrawImageç»˜åˆ¶ -&gt; é‡Šæ”¾èµ„æº</p></blockquote><p><img src="http://pcd17v2u0.bkt.clouddn.com/15343172514431.jpg" alt=""></p><blockquote></blockquote><p>CFAttributedStringRef ï¼šå±æ€§å­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨éœ€è¦ç»˜åˆ¶çš„æ–‡å­—å­—ç¬¦å’Œå­—ç¬¦å±æ€§<br>CTFramesetterRefï¼šé€šè¿‡CFAttributedStringRefè¿›è¡Œåˆå§‹åŒ–ï¼Œä½œä¸ºCTFrameå¯¹è±¡çš„ç”Ÿäº§å·¥å‚ï¼Œè´Ÿè´£æ ¹æ®pathåˆ›å»ºå¯¹åº”çš„CTFrame<br>CTFrameï¼šç”¨äºç»˜åˆ¶æ–‡å­—çš„ç±»ï¼Œå¯ä»¥é€šè¿‡CTFrameDrawå‡½æ•°ï¼Œç›´æ¥å°†æ–‡å­—ç»˜åˆ¶åˆ°contextä¸Š<br>CTLineï¼šåœ¨CTFrameå†…éƒ¨æ˜¯ç”±å¤šä¸ªCTLineæ¥ç»„æˆçš„ï¼Œæ¯ä¸ªCTLineä»£è¡¨ä¸€è¡Œ<br>CTRunï¼šæ¯ä¸ªCTLineåˆæ˜¯ç”±å¤šä¸ªCTRunç»„æˆçš„ï¼Œæ¯ä¸ªCTRunä»£è¡¨ä¸€ç»„æ˜¾ç¤ºé£æ ¼ä¸€è‡´çš„æ–‡æœ¬<br>å®é™…ä¸ŠCoreTextæ˜¯ä¸ç›´æ¥æ”¯æŒç»˜åˆ¶å›¾ç‰‡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆåœ¨éœ€è¦æ˜¾ç¤ºå›¾ç‰‡çš„åœ°æ–¹ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ç©ºç™½å ä½ç¬¦ä»£æ›¿ï¼ŒåŒæ—¶è®¾ç½®è¯¥å­—ä½“çš„CTRunDelegateä¿¡æ¯ä¸ºè¦æ˜¾ç¤ºçš„å›¾ç‰‡çš„å®½åº¦å’Œé«˜åº¦ï¼Œè¿™æ ·ç»˜åˆ¶æ–‡å­—çš„æ—¶å€™å°±ä¼šå…ˆæŠŠå›¾ç‰‡çš„ä½ç½®ç•™å‡ºæ¥ï¼Œå†åœ¨drawRectæ–¹æ³•é‡Œé¢ç”¨CGContextDrawImageç»˜åˆ¶å›¾ç‰‡ã€‚</p><p>Here is the code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">-(void)drawRect:(CGRect)rect</span><br><span class="line">&#123;</span><br><span class="line">    [super drawRect:rect];</span><br><span class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</span><br><span class="line">    CGContextSetTextMatrix(context, CGAffineTransformIdentity);    CGContextTranslateCTM(context, 0, self.bounds.size.height);</span><br><span class="line">    CGContextScaleCTM(context, 1.0, -1.0);</span><br><span class="line">    NSMutableAttributedString * attributeStr = [[NSMutableAttributedString alloc] initWithString:@&quot; Hi ALL,è¿™æ˜¯æˆ‘çš„åšå®¢ï¼šlemon2well.topï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œç¯æ¬¢è¿è¯„è®ºç•™è¨€ä¸€èµ·äº¤æµã€‚&quot; attributes:@&#123;NSForegroundColorAttributeName:[UIColor blackColor],NSFontAttributeName:[UIFont systemFontOfSize:20]&#125;];</span><br><span class="line">    NSString *targetStr = @&quot;lemon2well.top&quot;;</span><br><span class="line">    </span><br><span class="line">    NSRange linkRange = [attributeStr.string rangeOfString:targetStr];</span><br><span class="line">    if (linkRange.length != 0) &#123;</span><br><span class="line">        //æ·»åŠ å¯ç‚¹å‡»é“¾æ¥</span><br><span class="line">        [attributeStr addAttribute:NSLinkAttributeName value:[NSURL URLWithString:targetStr] range:linkRange];</span><br><span class="line">        [attributeStr addAttribute:NSForegroundColorAttributeName value:[UIColor blackColor] range:linkRange];</span><br><span class="line">        //æ·»åŠ ä¸‹åˆ’çº¿</span><br><span class="line">        [attributeStr addAttribute:NSUnderlineStyleAttributeName value:@1 range:linkRange];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ®µè½æ ·å¼</span><br><span class="line">    NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc]init];</span><br><span class="line">    // è¡Œé—´è·</span><br><span class="line">    [style setLineSpacing:3];</span><br><span class="line">    // æ®µè½é—´è·</span><br><span class="line">    [style setParagraphSpacing:10];</span><br><span class="line">    // é¦–è¡Œç¼©è¿›</span><br><span class="line">    [style setFirstLineHeadIndent:25];</span><br><span class="line">    [attributeStr addAttribute:NSParagraphStyleAttributeName value:style range:NSMakeRange(0, attributeStr.length-1)];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    CTRunDelegateCallbacks callBacks;</span><br><span class="line">    memset(&amp;callBacks,0,sizeof(CTRunDelegateCallbacks));</span><br><span class="line">    callBacks.version = kCTRunDelegateVersion1;</span><br><span class="line">    callBacks.getAscent = ascentCallBacks;</span><br><span class="line">    callBacks.getDescent = descentCallBacks;</span><br><span class="line">    callBacks.getWidth = widthCallBacks;</span><br><span class="line">    NSDictionary * dicPic = @&#123;@&quot;height&quot;:@16,@&quot;width&quot;:@16&#125;;</span><br><span class="line">    CTRunDelegateRef delegate = CTRunDelegateCreate(&amp; callBacks, (__bridge void *)dicPic);</span><br><span class="line">    unichar placeHolder = 0xFFFC;</span><br><span class="line">    NSString * placeHolderStr = [NSString stringWithCharacters:&amp;placeHolder length:1];</span><br><span class="line">    NSMutableAttributedString * placeHolderAttrStr = [[NSMutableAttributedString alloc] initWithString:placeHolderStr];</span><br><span class="line">    CFAttributedStringSetAttribute((CFMutableAttributedStringRef)placeHolderAttrStr, CFRangeMake(0, 1), kCTRunDelegateAttributeName, delegate);</span><br><span class="line">    CFRelease(delegate);</span><br><span class="line">    [attributeStr insertAttributedString:placeHolderAttrStr atIndex:0];</span><br><span class="line">    CTFramesetterRef frameSetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attributeStr);</span><br><span class="line">    CGMutablePathRef path = CGPathCreateMutable();</span><br><span class="line">    CGPathAddRect(path, NULL, self.bounds);</span><br><span class="line">    NSInteger length = attributeStr.length;</span><br><span class="line">    CTFrameRef frame = CTFramesetterCreateFrame(frameSetter, CFRangeMake(0, length), path, NULL);</span><br><span class="line">    CTFrameDraw(frame, context);</span><br><span class="line">    </span><br><span class="line">    UIImage * image = [UIImage imageNamed:@&quot;trumpet&quot;];</span><br><span class="line">    CGRect imgFrm = [self calculateImageRectWithFrame:frame];</span><br><span class="line">    CGContextDrawImage(context,imgFrm, image.CGImage);</span><br><span class="line">    CFRelease(frame);</span><br><span class="line">    CFRelease(path);</span><br><span class="line">    CFRelease(frameSetter);</span><br><span class="line">&#125;</span><br><span class="line">static CGFloat ascentCallBacks(void * ref)</span><br><span class="line">&#123;</span><br><span class="line">    return [(NSNumber *)[(__bridge NSDictionary *)ref valueForKey:@&quot;height&quot;] floatValue];</span><br><span class="line">&#125;</span><br><span class="line">static CGFloat descentCallBacks(void * ref)</span><br><span class="line">&#123;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">static CGFloat widthCallBacks(void * ref)</span><br><span class="line">&#123;</span><br><span class="line">    return [(NSNumber *)[(__bridge NSDictionary *)ref valueForKey:@&quot;width&quot;] floatValue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(CGRect)calculateImageRectWithFrame:(CTFrameRef)frame</span><br><span class="line">&#123;</span><br><span class="line">    NSArray * arrLines = (NSArray *)CTFrameGetLines(frame);</span><br><span class="line">    NSInteger count = [arrLines count];</span><br><span class="line">    CGPoint points[count];</span><br><span class="line">    CTFrameGetLineOrigins(frame, CFRangeMake(0, 0), points);</span><br><span class="line">    for (int i = 0; i &lt; count; i ++) &#123;</span><br><span class="line">        CTLineRef line = (__bridge CTLineRef)arrLines[i];</span><br><span class="line">        NSArray * arrGlyphRun = (NSArray *)CTLineGetGlyphRuns(line);</span><br><span class="line">        for (int j = 0; j &lt; arrGlyphRun.count; j ++) &#123;</span><br><span class="line">            CTRunRef run = (__bridge CTRunRef)arrGlyphRun[j];</span><br><span class="line">            NSDictionary * attributes = (NSDictionary *)CTRunGetAttributes(run);            CTRunDelegateRef delegate = (__bridge CTRunDelegateRef)[attributes valueForKey:(id)kCTRunDelegateAttributeName];</span><br><span class="line">            if (delegate == nil) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            NSDictionary * dic = CTRunDelegateGetRefCon(delegate);</span><br><span class="line">            if (![dic isKindOfClass:[NSDictionary class]]) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            CGPoint point = points[i];</span><br><span class="line">            CGFloat ascent;</span><br><span class="line">            CGFloat descent;</span><br><span class="line">            CGRect boundsRun;</span><br><span class="line">            boundsRun.size.width = CTRunGetTypographicBounds(run, CFRangeMake(0, 0), &amp;ascent, &amp;descent, NULL);</span><br><span class="line">            boundsRun.size.height = ascent + descent;</span><br><span class="line">            CGFloat xOffset = CTLineGetOffsetForStringIndex(line, CTRunGetStringRange(run).location, NULL);</span><br><span class="line">            boundsRun.origin.x = point.x + xOffset;</span><br><span class="line">            boundsRun.origin.y = point.y - descent;</span><br><span class="line">            CGPathRef path = CTFrameGetPath(frame);</span><br><span class="line">            CGRect colRect = CGPathGetBoundingBox(path);</span><br><span class="line">            CGRect imageBounds = CGRectOffset(boundsRun, colRect.origin.x, colRect.origin.y);</span><br><span class="line">            return imageBounds;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return CGRectZero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="YYText"><a href="#YYText" class="headerlink" title="YYText"></a>YYText</h2><p><a href="https://github.com/ibireme/YYText" target="_blank" rel="noopener">YYText</a><br>YYTextæ˜¯å¤§ç¥éƒ­æ›œæºå¼€å‘çš„ä¸€ä¸ªå¼ºå¤§çš„å±•ç¤ºå’Œç¼–è¾‘å¯Œæ–‡æœ¬çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œé‡Œé¢æä¾›äº†ä¸°å¯Œçš„ä¸å¯Œæ–‡æœ¬å¼€å‘ç›¸å…³çš„æ–¹æ³•ï¼Œå…·ä½“çš„å¯ä»¥åˆ°githubé‡Œé¢çœ‹ã€‚YYTextæ˜¯åŸºäºCoreTextå‘ä¸Šå°è£…äº†ä¸€å±‚ï¼Œæ‰€ä»¥å¯¹å¼€å‘è€…æ›´åŠ å‹å¥½ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­è¿ç”¨åˆ°å¤§é‡çš„å¯Œæ–‡æœ¬çš„åœ°æ–¹å»ºè®®å¯ä»¥ç”¨YYTextã€‚</p><p>here is the code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">YYLabel *label = [[YYLabel alloc]init];</span><br><span class="line">  label.numberOfLines = 0 ;</span><br><span class="line">  label.frame = CGRectMake(0, 200, 375, 200);</span><br><span class="line">  [self.view addSubview:label];</span><br><span class="line">  </span><br><span class="line">  NSString *headStr = @&quot;Hi ALL,è¿™æ˜¯æˆ‘çš„åšå®¢ï¼š&quot;;</span><br><span class="line">  NSString *linkStr = @&quot;lemon2well.top&quot;;</span><br><span class="line">  NSString *lastStr = @&quot;ï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼Œç¯æ¬¢è¿è¯„è®ºç•™è¨€ä¸€èµ·äº¤æµã€‚&quot;;</span><br><span class="line">  UIImage *image = [UIImage imageNamed:@&quot;trumpet&quot;];</span><br><span class="line">  </span><br><span class="line">  NSMutableAttributedString *attrText = [NSMutableAttributedString new];</span><br><span class="line">  </span><br><span class="line">  NSAttributedString *headAttr = [[NSAttributedString alloc] initWithString:headStr attributes:@&#123;NSFontAttributeName:[UIFont systemFontOfSize:20]&#125;];</span><br><span class="line">  </span><br><span class="line">  NSAttributedString *lastAttr = [[NSAttributedString alloc] initWithString:lastStr attributes:@&#123;NSFontAttributeName:[UIFont systemFontOfSize:20]&#125;];</span><br><span class="line">  </span><br><span class="line">  NSMutableAttributedString *linkAttr = [[NSMutableAttributedString alloc] initWithString:linkStr];</span><br><span class="line">  linkAttr.yy_font = [UIFont systemFontOfSize:20];</span><br><span class="line">  linkAttr.yy_underlineStyle = NSUnderlineStyleSingle;</span><br><span class="line">  [linkAttr yy_setTextHighlightRange:NSMakeRange(0, linkStr.length) color:[UIColor blueColor] backgroundColor:nil tapAction:^(UIView * _Nonnull containerView, NSAttributedString * _Nonnull text, NSRange range, CGRect rect) &#123;</span><br><span class="line">      NSLog(@&quot;link = %@&quot;,text);</span><br><span class="line">  &#125;];</span><br><span class="line">  </span><br><span class="line">  NSMutableAttributedString *imageAttr = [NSMutableAttributedString yy_attachmentStringWithContent:image contentMode:UIViewContentModeCenter attachmentSize:CGSizeMake(32, 32) alignToFont:[UIFont systemFontOfSize:20] alignment:YYTextVerticalAlignmentCenter];</span><br><span class="line">  </span><br><span class="line">  [attrText appendAttributedString:imageAttr];</span><br><span class="line">  [attrText appendAttributedString:headAttr];</span><br><span class="line">  [attrText appendAttributedString:linkAttr];</span><br><span class="line">  [attrText appendAttributedString:lastAttr];</span><br><span class="line"></span><br><span class="line">  label.attributedText = attrText;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>æ€»çš„æ¥è¯´ï¼Œä»¥ä¸Šè¯´çš„å››ç§éƒ½å„æœ‰ä¼˜åŠ£ï¼Œä½†æ˜¯ä»–ä»¬éƒ½ç”¨äº†NSAttributedStringæ¥å®ç°å¯Œæ–‡æœ¬ã€‚</p><p>å¦‚æœåœ¨é¡¹ç›®ä¸­ç”¨åˆ°å¯Œæ–‡æœ¬çš„åœ°æ–¹ä¸å¤šï¼Œå‡ºäºAPPä½“ç§¯è€ƒè™‘æ²¡å¿…è¦å¼•å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹ï¼Œ  å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸€å’Œç¬¬äºŒç§æ–¹æ¡ˆï¼Œå¦‚æœæ˜¯å›¾æ–‡ç¯ç»•è¿™ç§ï¼Œå¯ä»¥ä½¿ç”¨UITextView+UIImageviewçš„æ–¹æ¡ˆï¼Œå¦‚æœæ˜¯å°çš„è¡¨æƒ…å›¾æ–‡æ··æ’å¯ä»¥ä½¿ç”¨NSAttributedString+labelå³å¯ã€‚</p><p>å¦‚æœåœ¨é¡¹ç›®ä¸­å¤šå¤„ç”¨åˆ°å¯Œæ–‡æœ¬çš„å±•ç¤ºå’Œç¼–è¾‘ï¼Œå»ºè®®ä½¿ç”¨YYTextï¼Œå› ä¸ºå®ƒå¯¹äºå¼€å‘è€…æ›´åŠ å‹å¥½ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯åŸºäºCoreTextæ¥æ¸²æŸ“ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹å°±æ˜¯ç›®å‰YYTextå·²ç»æœ‰ä¸€å¹´æ²¡ç»´æŠ¤äº†ï¼Œä¹‹å‰ä»–ç”Ÿç—…äº†ï¼Œç°åœ¨æ­£åœ¨å®¶é‡Œä¿®å…»ï¼Œå¸Œæœ›ä»–å¿«ç‚¹å¥½èµ·æ¥ï¼Œç¥å¥½ã€‚</p><h2 id="çªç„¶æœ‰æ„Ÿ"><a href="#çªç„¶æœ‰æ„Ÿ" class="headerlink" title="çªç„¶æœ‰æ„Ÿ"></a>çªç„¶æœ‰æ„Ÿ</h2><p>æœ¬æ¥è¿™ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±åº”è¯¥å®Œäº†ï¼Œä¸è¿‡åˆšåˆšå»çœ‹äº†ä¸€ä¸‹YYKitçš„ä½œè€…çš„<a href="https://blog.ibireme.com/author/ibireme/" target="_blank" rel="noopener">åšå®¢</a>ï¼Œçªç„¶æœ‰ç‚¹ä¼¤æ„Ÿï¼Œæ²¡æƒ³åˆ°ä»–ç”Ÿç—…è¿™ä¹ˆä¸¥é‡ï¼Œçœ‹ä»–çš„æ–‡å­—æ„Ÿè§‰ä»–æ˜¯ä¸€ä¸ªå¯¹å¾…ç”Ÿæ´»ä¹Ÿå¾ˆç»†è…»çš„äººï¼Œè¿™ä¹Ÿè¯´å¾—é€šä¸ºä»€ä¹ˆä»–å¯ä»¥ç”¨ä¸šä½™çš„æ—¶é—´å†™å‡ºäº†YYKITè¿™ä¹ˆå¼ºå¤§çš„å·¥å…·ï¼Œå› ä¸ºä»–å¯¹å¾…æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆç»†è…»ã€‚</p><p>çœŸçš„å¾ˆä½©æœè¿™æ ·çš„äººï¼Œä½ å¯ä»¥æ„Ÿå—åˆ°ä»–çš„çœŸè¯šï¼Œæˆ‘è™½ç„¶æ²¡å’Œä»–èŠè¿‡å¤©ï¼Œæ²¡è§è¿‡ä»–çœŸäººï¼Œä¸è¿‡ä»–ä¸€å®šä¼šæ˜¯ä¸€ä¸ªè®©åˆ«äººæ„Ÿå—åˆ°äº¤æµæ²Ÿé€šèµ·æ¥è®©ä½ æ²¡æœ‰é˜²å¾¡çš„ä¸€ä¸ªäººã€‚ç°åœ¨è¿™ä¸ªç¤¾ä¼šå› ä¸ºå„ç§å„æ ·å˜æ€çš„äººä»¥åŠäº‹ï¼Œæ€»ä¼šè®©äººæ— è®ºä½•æ—¶ä½•åœ°æ€»ä¼šèº«ä¸Šæ¶ç€ä¸€å±‚é˜²å¾¡è£…ï¼Œæ›´å¯æ€•çš„æ˜¯è¿˜æœ‰é‚£ç§è¡¨é¢å–„å†…é‡Œæ¶çš„äººï¼Œå¤šå¯æ€•ï¼Œå¦‚æœæ˜¯å±å®³åˆ«äººçš„äººæˆ‘ä¸€ç‚¹éƒ½ä¸å¿ƒç–¼ã€‚</p><p>æœ€åå¸Œæœ›å¤§å®¶ä¸€å®šè¦æ³¨æ„è‡ªå·±çš„èº«ä½“ï¼Œç¥å¤§å®¶éƒ½å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å›¾æ–‡æ··æ’æœ‰å¤šç§æ–¹å¼å¯ä»¥å®ç°ï¼Œä¸‹é¢æˆ‘ä¼šç”¨å››ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°ä»¥ä¸‹ç•Œé¢çš„æ•ˆæœï¼Œå¹¶ä¸”è¯´æ˜ä»–ä»¬çš„ä¼˜ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pcd17v2u0.bkt.clouddn.com/screenshot.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;NSAttributedString&quot;&gt;&lt;a href=&quot;#NSAttributedString&quot; class=&quot;headerlink&quot; title=&quot;NSAttributedString&quot;&gt;&lt;/a&gt;NSAttributedString&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;NSAttributedStringæä¾›äº†è‡ªç”±å¹¶ä¸”å¤šæ ·å¼çš„å¯Œæ–‡æœ¬è®¾ç½®ï¼Œå›¾æ–‡æ··æ’çš„å®ç°æ˜¯é€šè¿‡æ’å…¥NSTestAttachmentæ¥å®ç°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>å¼€å‘ç»†èŠ‚ä¹‹ hash ä¸ isEqual æ–¹æ³•</title>
    <link href="http://lemon2well.top/2018/08/14/iOS%20%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91%E7%BB%86%E8%8A%82%E4%B9%8B-hash-%E4%B8%8E-isEqual-%E6%96%B9%E6%B3%95/"/>
    <id>http://lemon2well.top/2018/08/14/iOS å¼€å‘/å¼€å‘ç»†èŠ‚ä¹‹-hash-ä¸-isEqual-æ–¹æ³•/</id>
    <published>2018-08-14T03:11:53.000Z</published>
    <updated>2018-08-14T03:12:23.514Z</updated>
    
    <content type="html"><![CDATA[<h2 id="isEuqal-ä¸-çš„åŒºåˆ«"><a href="#isEuqal-ä¸-çš„åŒºåˆ«" class="headerlink" title="isEuqal ä¸ == çš„åŒºåˆ«"></a>isEuqal ä¸ == çš„åŒºåˆ«</h2><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“åœ¨OCä¸­æœ‰ä¸¤ç§æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥ç”¨<code>==</code>ç¬¦å·æ¯”è¾ƒï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨isEqualæ¥æ¯”è¾ƒï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li><code>==</code> å¦‚æœæ˜¯ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆç›´æ¥æ¯”è¾ƒæ•°å€¼ï¼ŒisEqualåªèƒ½ç”¨äºOCå¯¹è±¡æ¯”è¾ƒ</li><li><code>==</code> å¦‚æœæ˜¯ç”¨äºOCå¯¹è±¡æ¯”è¾ƒï¼Œé‚£ä¹ˆæ˜¯åˆ¤æ–­ä»–ä»¬æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ˜¯å¦ä¸€è‡´ã€‚è€ŒisEqualåˆ™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚</li></ol><a id="more"></a><p>æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªé¢œè‰²çš„ç¤ºä¾‹æ¥çœ‹çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UIColor *color1 = [UIColor colorWithRed:120/255.0 green:120/255.0 blue:120/255.0 alpha:1];</span><br><span class="line">UIColor *color2 = [UIColor colorWithRed:120/255.0 green:120/255.0 blue:120/255.0 alpha:1];</span><br><span class="line">NSLog(@&quot;color1.address = %p\ncolor2.address = %p&quot;,color1,color2);</span><br><span class="line">NSLog(@&quot;color1 == color2 ? %@ &quot;,color1 == color2 ? @&quot;æ˜¯&quot; : @&quot;å¦&quot;);</span><br><span class="line">NSLog(@&quot;color1 isEqual color2 ? %@ &quot;,[color1 isEqual:color2] ? @&quot;æ˜¯&quot; : @&quot;å¦&quot;);</span><br></pre></td></tr></table></figure><p>ç»“æœè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color1.address = 0x60400046af40</span><br><span class="line">color2.address = 0x60400046b280</span><br><span class="line">color1 == color2 ? å¦</span><br><span class="line">color1 isEqual color2 ? æ˜¯</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œcolor1å’Œcolor2æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨<code>==</code>æ¥æ¯”è¾ƒçš„æ—¶å€™ä»–ä»¬ä¸ç›¸ç­‰ã€‚ä½†æ˜¯color1å’Œcolor2é¢œè‰²çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä½¿ç”¨isEuqalæ¥æ¯”è¾ƒçš„æ—¶å€™ä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚</p><h2 id="isEuqal-ç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„æ¯”è¾ƒ"><a href="#isEuqal-ç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„æ¯”è¾ƒ" class="headerlink" title="isEuqal ç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„æ¯”è¾ƒ"></a>isEuqal ç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„æ¯”è¾ƒ</h2><p>åˆšåˆšæˆ‘ä»¬æ˜¯ä½¿ç”¨ç³»ç»Ÿçš„UIColorçš„å¯¹è±¡æ¥æ¯”è¾ƒï¼Œå¦‚æœæ˜¯æˆ‘ä»¬æ˜¯è‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œå¦‚æœéœ€è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„æ—¶å€™ï¼Œä½¿ç”¨isEqualæ–¹æ³•æ¥æ¯”è¾ƒæ˜¯å¦è¿˜èµ·ä½œç”¨å‘¢ï¼Ÿ</p><p>çœ‹çœ‹ä»¥ä¸‹ä»£ç ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>LMPerson</code>ç±»ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªnameï¼Œä¸€ä¸ªageï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œç„¶åç»™ä»–ä»¬èµ‹äºˆåŒæ ·çš„nameå’Œageï¼Œçœ‹çœ‹ä½¿ç”¨isEuqalæ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LMPerson *person1 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line">  LMPerson *person2 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line">  NSLog(@&quot;person1.address = %p\nperson2.address = %p&quot;,person1,person2);</span><br><span class="line">  NSLog(@&quot;person1 == person2 ? %@ &quot;,person1==person2?@&quot;æ˜¯&quot;:@&quot;å¦&quot;);</span><br><span class="line">  NSLog(@&quot;person1 isEqual person2 ? %@ &quot;,[person1 isEqual:person2]?@&quot;æ˜¯&quot;:@&quot;å¦&quot;);</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person1.address = 0x60400022b500</span><br><span class="line">person2.address = 0x60400022b200</span><br><span class="line">person1 == person2 ? å¦</span><br><span class="line">person1 isEqual person2 ? å¦</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå½“isEqualæ˜¯ç”¨äºæˆ‘ä»¬è‡ªå®šä¹‰å¯¹è±¡çš„æ¯”è¾ƒçš„æ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬èµ‹äºˆä¸¤ä¸ªå¯¹è±¡å±æ€§ç›¸åŒçš„å€¼ï¼Œä½†æ˜¯è¿”å›çš„å´æ˜¯NOã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>è¿™æ˜¯å› ä¸ºUIColorï¼ŒNSArray,NSdictonary ç³»ç»Ÿå·²ç»å¸®æˆ‘ä»¬å®ç°äº†å¯¹åº”çš„isEqualæˆ–è€…isEqualToçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦ç”¨äºè‡ªå®šä¹‰å¯¹è±¡æ¯”è¾ƒï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®ç°å¯¹åº”çš„isEqualæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»™LMPersonæ·»åŠ ä»¥ä¸‹å®ç°æ–¹æ³•</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqual:(id)object&#123;</span><br><span class="line">    if (self == object) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (![object isKindOfClass:LMPerson.class]) &#123;</span><br><span class="line">        return  NO;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    LMPerson *person2 = (LMPerson*)object;</span><br><span class="line">    BOOL isSameName = (!self.name &amp;&amp; !person2.name) || [self.name isEqualToString:person2.name];</span><br><span class="line">    BOOL isSameAge = self.age == person2.age ;</span><br><span class="line">    return isSameName &amp;&amp; isSameAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person1.address = 0x60000022bac0</span><br><span class="line">person2.address = 0x60000022c460</span><br><span class="line">person1 == person2 ? å¦</span><br><span class="line">person1 isEqual person2 ? æ˜¯</span><br></pre></td></tr></table></figure><p><strong>ç»¼ä¸Šï¼Œå¦‚æœæˆ‘ä»¬è¦æ¯”è¾ƒä¸¤ä¸ªè‡ªå®šä¹‰å¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦é‡å†™isEqualæ–¹æ³•ï¼Œç»™è¯¥æ–¹æ³•æä¾›ä¸€ä¸ªå®ç°ã€‚</strong></p><h2 id="ä»€ä¹ˆæ˜¯hashæ–¹æ³•"><a href="#ä»€ä¹ˆæ˜¯hashæ–¹æ³•" class="headerlink" title="ä»€ä¹ˆæ˜¯hashæ–¹æ³•"></a>ä»€ä¹ˆæ˜¯hashæ–¹æ³•</h2><p>è¿™ä¸ªè¦ä»hashTableè¯´èµ·ï¼Œå› ä¸ºhashTabeæ˜¯æ— åºçš„é›†åˆï¼Œå¹¶ä¸”æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ•°ç»„æ˜¯O(array_lenth)ï¼Œä¸ºä»€ä¹ˆhashTableå¯ä»¥åšåˆ°O(1)å‘¢ï¼Œå› ä¸ºå½“ä¸€ä¸ªå…ƒç´ åŠ åˆ°hashTableé‡Œé¢çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„hashå€¼ï¼Œç”¨äºæ ‡è®°å…ƒç´ åœ¨tableä¸­çš„ä½ç½®ï¼Œåé¢å¦‚æœéœ€è¦æŸ¥æ‰¾è¯¥å…ƒç´ ï¼Œé€šè¿‡hashå€¼å¯ä»¥ç›´æ¥æ‰¾åˆ°è¯¥å…ƒç´ ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªhashå€¼æ˜¯æ€æ ·å¾—æ¥çš„å‘¢ï¼Ÿ</p><p>è¿™ä¸ªhashå€¼å…¶å®å°±æ˜¯é€šè¿‡<code>- (NSUInteger)hash</code>æ–¹æ³•æä¾›çš„ï¼Œå¹¶ä¸”ç³»ç»Ÿé»˜è®¤çš„å®ç°å°±æ˜¯è¿”å›è¯¥å¯¹è±¡çš„åœ°å€ã€‚ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯è¿™ä¸ªè¯´æ³•ï¼š</p><p>æˆ‘ä»¬å¢åŠ ä»¥ä¸‹æ–¹æ³•ï¼Œå¹¶ä¸”æ‰“å°å‡ºhashçš„å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//LMPerson.m</span><br><span class="line">- (NSUInteger)getSuperHash&#123;</span><br><span class="line">    NSUInteger superHash = [super hash];</span><br><span class="line">    return superHash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ViewController</span><br><span class="line">  LMPerson *person1 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line">    LMPerson *person2 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line">    NSLog(@&quot;person1.address = %ld\nperson2.address = %ld&quot;,(NSUInteger)person1,(NSUInteger)person2);</span><br><span class="line">    NSLog(@&quot;person1.hash = %ld\nperson2.hash = %ld&quot;,[person1 getSuperHash],[person2 getSuperHash]);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person1.address = 105553118496736</span><br><span class="line">person2.address = 105553116524864</span><br><span class="line">person1.hash = 105553118496736</span><br><span class="line">person2.hash = 105553116524864</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»“æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå…¶å®ç³»ç»Ÿé»˜è®¤çš„hashæ–¹æ³•å°±æ˜¯è¿”å›å¯¹è±¡åœ°å€çš„åè¿›åˆ¶ã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨hash-æ–¹æ³•"><a href="#ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨hash-æ–¹æ³•" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨hash æ–¹æ³•"></a>ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨hash æ–¹æ³•</h2><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥è¯´ç»“è®ºï¼Œå¦‚æœä¸€ä¸ªé›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„å…ƒç´ é‚£ä¹ˆå°±ä¼šè°ƒç”¨hashæ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>NSMutableArrayå’ŒNSArrayæ˜¯å…è®¸æ·»åŠ é‡å¤å…ƒç´ çš„ï¼Œæ‰€ä»¥å°†ä¸€ä¸ªå…ƒç´ æ”¾åˆ°è¯¥å®¹å™¨ä¸­çš„æ—¶å€™æ˜¯ä¸ä¼šè°ƒç”¨hashæ–¹æ³•ï¼ŒåƒNSSetï¼ŒNSMutableSetå…ƒç´ ä¸èƒ½é‡å¤ï¼Œåœ¨æ·»åŠ å’Œåˆ é™¤çš„æ—¶å€™ä¼šè°ƒç”¨hashæ–¹æ³•ã€‚å½“ä¸€ä¸ªå…ƒç´ ä½œä¸ºNSDictonaryçš„keyçš„æ—¶å€™ï¼Œå› ä¸ºkeyä¹Ÿä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥ä¹Ÿä¼šè°ƒç”¨hashæ–¹æ³•ã€‚å¤§å®¶å¯ä»¥é€šè¿‡å°†ä¸Šè¿°åˆ›å»ºçš„ä¸¤ä¸ªpersonå¯¹è±¡åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„é›†åˆä¸­è¿›è¡ŒéªŒè¯ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°±ç®—hashæ–¹æ³•ç›¸ç­‰ä¹Ÿä¸èƒ½åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ å°±ä¸€å®šæ˜¯ç›¸ç­‰ï¼Œè¿˜ä¼šè°ƒç”¨isEqualæ¥è¿›è¡Œåˆ¤æ–­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šä¼˜å…ˆåˆ¤æ–­hashæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœhashä¸ç›¸ç­‰é‚£ä¹ˆè¿™ä¸¤ä¸ªå…ƒç´ ä¸€å®šä¸ç›¸ç­‰ï¼Œå¦‚æœhashç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è°ƒç”¨isEqualåˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœè¿”å›NOï¼Œé‚£ä¹ˆä¸¤ä¸ªå…ƒç´ ä¹Ÿä¸ç›¸ç­‰ï¼Œ å¦‚æœè¿”å›YESé‚£ä¹ˆä¸¤ä¸ªå…ƒç´ ç›¸ç­‰ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æŠŠè‡ªå®šä¹‰å¯¹è±¡åŠ åˆ°NSSetä¸­çš„æˆ–è€…ä½œä¸ºNSDictonaryçš„keyçš„æ—¶å€™ ä¼šåŒæ—¶è°ƒç”¨hashæ–¹æ³•å’ŒisEqualæ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡å†™isEqualæ–¹æ³•å’Œhashæ–¹æ³•ã€‚</p><h2 id="hash-çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"><a href="#hash-çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="hash çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"></a>hash çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</h2><p>æˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»éªŒè¯è¿‡å¦‚æœæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„hashæ–¹æ³•æ¥æ¯”è¾ƒä¸¤ä¸ªè‡ªå®šä¹‰å¯¹è±¡æ˜¯å¦ç›¸ç­‰æ˜¯ä¸æ­£ç¡®çš„äº†ï¼Œé‚£ä¹ˆæ­£ç¡®çš„ä½¿ç”¨å§¿åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨<a href="https://nshipster.com/equality/" target="_blank" rel="noopener">Equality</a>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œmattå¤§ç¥ç»™äº†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¯¹å±æ€§çš„hashè¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚åœ¨<code>LMPerson.m</code>ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (NSUInteger)hash&#123;</span><br><span class="line">    return ([self.name hash] ^ [[NSNumber numberWithInteger:self.age] hash]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬ç¼–å†™ä»¥ä¸‹ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹ç›¸åŒçš„å…ƒç´ æ˜¯å¦è¿˜èƒ½åŠ åˆ°hashTableé‡Œé¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LMPerson *person1 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line"> LMPerson *person2 = [LMPerson personWithName:@&quot;lemon&quot; age:18];</span><br><span class="line"> LMPerson *person3 = [LMPerson personWithName:@&quot;lemon&quot; age:19];</span><br><span class="line"> NSSet *set = [NSSet setWithObjects:person1,person2, person3,nil];</span><br><span class="line"> NSLog(@&quot;set.count = %ld&quot;,[set count]);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-08-14 11:08:13.250550+0800 testImageSourceCode[47478:7219161] set.count = 2</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¾€hashTableé‡Œé¢æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ç¬¬ä¸€å’Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æœ€ååŠ åˆ°é›†åˆé‡Œé¢çš„åªæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œè¯æ˜hashæ–¹æ³•èµ·ä½œç”¨äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;isEuqal-ä¸-çš„åŒºåˆ«&quot;&gt;&lt;a href=&quot;#isEuqal-ä¸-çš„åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;isEuqal ä¸ == çš„åŒºåˆ«&quot;&gt;&lt;/a&gt;isEuqal ä¸ == çš„åŒºåˆ«&lt;/h2&gt;&lt;p&gt;ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“åœ¨OCä¸­æœ‰ä¸¤ç§æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥ç”¨&lt;code&gt;==&lt;/code&gt;ç¬¦å·æ¯”è¾ƒï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨isEqualæ¥æ¯”è¾ƒï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;==&lt;/code&gt; å¦‚æœæ˜¯ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆç›´æ¥æ¯”è¾ƒæ•°å€¼ï¼ŒisEqualåªèƒ½ç”¨äºOCå¯¹è±¡æ¯”è¾ƒ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;==&lt;/code&gt; å¦‚æœæ˜¯ç”¨äºOCå¯¹è±¡æ¯”è¾ƒï¼Œé‚£ä¹ˆæ˜¯åˆ¤æ–­ä»–ä»¬æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ˜¯å¦ä¸€è‡´ã€‚è€ŒisEqualåˆ™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="isEuqal" scheme="http://lemon2well.top/tags/isEuqal/"/>
    
      <category term="hash" scheme="http://lemon2well.top/tags/hash/"/>
    
  </entry>
  
  <entry>
    <title>ç»†è¯´HTTPä¸HTTPS</title>
    <link href="http://lemon2well.top/2018/08/10/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/%E7%BB%86%E8%AF%B4HTTP%E4%B8%8EHTTPS/"/>
    <id>http://lemon2well.top/2018/08/10/å…¶ä»–æŠ€æœ¯/ç»†è¯´HTTPä¸HTTPS/</id>
    <published>2018-08-10T09:57:36.000Z</published>
    <updated>2018-08-10T09:59:57.944Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šå…³äºHTTPä¸HTTPSçš„æ–‡ç« ï¼Œä¸ºä»€ä¹ˆæˆ‘è¿˜è¦å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Œæºäºæ˜¨å¤©æœ‰ä¸ªiOSå¼€å‘åŒå­¦æ˜¨å¤©åœ¨ç¾¤é‡Œé¢æäº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªäººä¸‹è½½äº†ä¸€ä¸ªAPPï¼Œè¯¥APPä¸æœåŠ¡å™¨æ˜¯HTTPSè¿æ¥ï¼Œä»–ä¸ä¼šä¿¡ä»»ä»»ä½•æ¥æºäºä¸æ˜èº«ä»½çš„è¯ä¹¦ï¼Œç„¶åè¿ä¸Šäº†æˆ‘çš„WIFIï¼Œæˆ‘æœ‰æ²¡æœ‰åŠæ³•å»ç ´è§£é‡Œé¢çš„é€šä¿¡å†…å®¹?</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¸¦ç€è¿™ä¸ªç–‘é—®å»å¯»æ‰¾ç­”æ¡ˆï¼Œå¹¶ä¸”ç»™å‡ºæˆ‘çš„ç­”æ¡ˆã€‚</p><h2 id="ä»€ä¹ˆæ˜¯HTTP"><a href="#ä»€ä¹ˆæ˜¯HTTP" class="headerlink" title="ä»€ä¹ˆæ˜¯HTTP"></a>ä»€ä¹ˆæ˜¯HTTP</h2><blockquote><p>HTTP(HyperText Transfer Protocol)è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ŒHTTPæ˜¯ä¸ƒå±‚ç½‘ç»œæ¨¡å‹ä¸­ä½œç”¨åœ¨åº”ç”¨å±‚çš„åè®®ã€‚</p></blockquote><a id="more"></a><h3 id="HTTPçš„ç¼ºç‚¹ï¼š"><a href="#HTTPçš„ç¼ºç‚¹ï¼š" class="headerlink" title="HTTPçš„ç¼ºç‚¹ï¼š"></a>HTTPçš„ç¼ºç‚¹ï¼š</h3><ol><li>çªƒå¬é£é™©ï¼ˆeavesdroppingï¼‰ï¼šç¬¬ä¸‰æ–¹å¯ä»¥è·çŸ¥é€šä¿¡å†…å®¹ã€‚</li><li>ç¯¡æ”¹é£é™©ï¼ˆtamperingï¼‰ï¼šç¬¬ä¸‰æ–¹å¯ä»¥ä¿®æ”¹é€šä¿¡å†…å®¹ã€‚</li><li>å†’å……é£é™©ï¼ˆpretendingï¼‰ï¼šç¬¬ä¸‰æ–¹å¯ä»¥å†’å……ä»–äººèº«ä»½å‚ä¸é€šä¿¡ã€‚</li></ol><p>å› ä¸ºHTTPæ˜¯æ˜æ–‡ä¼ è¾“å†…å®¹çš„ï¼Œæ‰€ä»¥åªè¦æ”»å‡»è€…é€šè¿‡åŠ«æŒä½ çš„WIFIæˆ–è€…ä½ è¿ä¸Šäº†ä¸å®‰å…¨çš„WIFIé‚£ä¹ˆä½ æ‰€æœ‰çš„ä¼ è¾“å†…å®¹ä»–éƒ½å¯ä»¥æ‹¿åˆ°ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç¯¡æ”¹é‡Œé¢çš„æ•°æ®ã€‚åŸºäºä»¥ä¸Šçš„ç¼ºç‚¹å°±æœ‰äº†HTTPSï¼Œå¾…ä¼šæˆ‘ä»¬å†æ¥è¯´è¿™ä¸ªäº‹å„¿ã€‚</p><h3 id="HTTPçš„å·¥ä½œæµç¨‹ï¼š"><a href="#HTTPçš„å·¥ä½œæµç¨‹ï¼š" class="headerlink" title="HTTPçš„å·¥ä½œæµç¨‹ï¼š"></a>HTTPçš„å·¥ä½œæµç¨‹ï¼š</h3><p>ç›¸ä¿¡å¤§å®¶éƒ½å¬è¯´è¿‡TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒHTTPå°±æ˜¯é€šè¿‡TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå€¼å¾—ä¸€æçš„æ˜¯HTTP/1.0ç‰ˆæœ¬æ˜¯é»˜è®¤æ²¡æœ‰å¤ç”¨TCPè¿æ¥çš„ï¼Œæ¯æ¬¡å‘é€æ•°æ®éƒ½è¦å»ºç«‹ä¸€ä¸ªè¿æ¥(éœ€è¦ä½¿ç”¨keep-aliveæ¥å»ºç«‹é•¿è¿æ¥)ï¼Œè¿™æ ·å¯¼è‡´äº†è€—æ—¶ä»¥åŠå ç”¨èµ„æºéå¸¸ä¸¥é‡ï¼Œåæ¥å‘å¸ƒäº†HTTP/1.1ï¼ŒåŒä¸€ä¸ªTCPé€šé“å¯ä»¥å¤ç”¨å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯åœ¨è¯¥é€šé“é‡Œé¢æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯æŒ‰ç…§é¡ºåºæ¥å‘é€çš„å‘é€çš„ï¼Œå®¹æ˜“å¯¼è‡´é˜»å¡ã€‚HTTP/2åœ¨1.1çš„åŸºç¡€ä¸Šæ”¹è¿›äº†ï¼Œä¸æ­¢å¤ç”¨åŒä¸€ä¸ªTCPé€šé“å¹¶ä¸”å¯ä»¥å¹¶å‘çš„å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚</p><p>TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œä¾ç…§æƒ¯ä¾‹ï¼Œå…ˆå‘ä¸€ä¸ªå›¾ç‰‡ï¼Œçœ‹å›¾è¯´è¯</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15338881870637.png" alt=""></p><p>ä¸‹é¢æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢ä¸‰æ¬¡æ¡æ‰‹çš„ä½œç”¨ï¼š</p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€å°†SYNæ ‡å¿—ä½è®¾ç½®ä¸º1ï¼Œå¹¶ä¸”éšæœºäº§ç”Ÿä¸€ä¸ªåºåˆ—å·å€¼seq=Jï¼Œå‘é€ç»™æ•°æ®åŒ…ç»™æœåŠ¡ç«¯åï¼Œè‡ªèº«çŠ¶æ€å˜ä¸ºSYN_SENT</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œå°†å‘é€æ ‡å¿—ä½SYNè®¾ç½®ä¸º1ï¼ŒACKåº”ç­”éœ€è¦ä¸ºJ+1è¡¨ï¼Œå¹¶ä¸”å†å‘é€ä¸€ä¸ªéšæœºåºåˆ—å·å€¼seq=Kç„¶åå‘é€åˆ°å®¢æˆ·ç«¯</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ£€æŸ¥ACKæ˜¯å¦ä¸ºJ+1ï¼Œå¦‚æœæ˜¯çš„è¯å‘é€ä¸€ä¸ªACKåŒ…ï¼ŒACK=k+!ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ä¹‹åç¡®å®šackæ˜¯å¦ç­‰äºK+1ï¼Œæ˜¯çš„è¯è¿æ¥å»ºç«‹</p><p>æˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼š<br>ç¬¬ä¸€æ¬¡æ¡æ‰‹ç¡®è®¤å®¢æˆ·ç«¯æ˜¯å…·æœ‰å‘é€æ¶ˆæ¯èƒ½åŠ›çš„ï¼Œå‘é€æ¶ˆæ¯ä¹‹åå®¢æˆ·ç«¯å‡ºäºSYN_SENTçŠ¶æ€ï¼Œç¬¬äºŒæ¬¡æ¡æ‰‹æœåŠ¡å™¨ç¡®å®šäº†è‡ªå·±æœ‰æ¥æ”¶æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æœ‰æ²¡æœ‰å‘é€æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œæ­¤æ—¶æœåŠ¡å™¨å‡ºäºSYN_RECVçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åŠè¿æ¥çš„çŠ¶æ€ï¼Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ç¡®å®šäº†æœåŠ¡å™¨æœ‰å‘é€æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ”¶åˆ°äº†ä»–çš„æ¶ˆæ¯å¹¶ä¸”å›åº”äº†ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¤„äºestablishçŠ¶æ€ï¼Œè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥å¼€å§‹æ”¶å‘æ¶ˆæ¯ã€‚</p><p>åŸºäºHTTPçš„ç¡®å®šï¼Œåé¢è¡ç”Ÿå‡ºæ¥äº†HTTPSï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®²è®²HTTPSä»¥åŠä»–ä»¬çš„åŒºåˆ«</p><h2 id="ä»€ä¹ˆæ˜¯HTTPS"><a href="#ä»€ä¹ˆæ˜¯HTTPS" class="headerlink" title="ä»€ä¹ˆæ˜¯HTTPS"></a>ä»€ä¹ˆæ˜¯HTTPS</h2><blockquote><p>HTTPSï¼ˆHyper Text Transfer Protocol over Secure Socket Layerï¼‰é¡¾åæ€ä¹‰å°±æ˜¯åœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ äº†SSL/TLSï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p></blockquote><h3 id="HTTPSçš„ä¼˜ç‚¹"><a href="#HTTPSçš„ä¼˜ç‚¹" class="headerlink" title="HTTPSçš„ä¼˜ç‚¹"></a>HTTPSçš„ä¼˜ç‚¹</h3><p>HTTPS åè®®æ—¨åœ¨è§£å†³ä»¥ä¸Šä¸‰ä¸ªé£é™©ï¼Œå› æ­¤å®ƒå¯ä»¥ï¼š</p><ol><li>ä¿è¯æ‰€æœ‰ä¿¡æ¯åŠ å¯†ä¼ è¾“ï¼Œæ— æ³•è¢«ç¬¬ä¸‰æ–¹çªƒå–ã€‚</li><li>ä¸ºä¿¡æ¯æ·»åŠ æ ¡éªŒæœºåˆ¶ï¼Œå¦‚æœè¢«ç¬¬ä¸‰æ–¹æ¶æ„ç ´åï¼Œå¯ä»¥æ£€æµ‹å‡ºæ¥ã€‚</li><li>é…å¤‡èº«ä»½è¯ä¹¦ï¼Œé˜²æ­¢ç¬¬ä¸‰æ–¹ä¼ªè£…å‚ä¸é€šä¿¡ã€‚</li></ol><h3 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h3><blockquote><p>SSL(Secure Sockets Layer)/TLS(transport Layer Security)å®‰å…¨å¥—æ¥å±‚æ˜¯ä¿è¯HTTPSå®‰å…¨çš„åè®®ï¼Œè¿™ä¸ªåè®®ä¸»è¦çš„æ€æƒ³æ˜¯é€šè¿‡å…¬é’¥åŠ è§£å¯†æ¥å®ç°æ•°æ®ä¼ è¾“å®‰å…¨ã€‚</p></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬å°±é¢ä¸´ç€ä¸¤ä¸ªé—®é¢˜.<br>1.å¦‚ä½•ä¿è¯å…¬é’¥ä¸è¢«ç¯¡æ”¹ </p><blockquote><p>æˆ‘ä»¬é€šè¿‡æƒå¨æœºæ„ç”³è¯·è¯ä¹¦ï¼Œå°†è‡ªå·±çš„å…¬é’¥åŒ…è£…åˆ°è¯ä¹¦é‡Œé¢ï¼Œåªè¦è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œé‚£ä¹ˆå…¬é’¥å°±æ˜¯å¯ä¿¡çš„ã€‚</p></blockquote><p>2.æ¯æ¬¡éƒ½ç”Ÿæˆå…¬é’¥ï¼Œæ¶ˆè€—çš„æ—¶é—´å¤ªé•¿ï¼Œå¦‚ä½•å‡å°‘æ¶ˆè€—ã€‚</p><blockquote><p>ä½¿ç”¨å¯¹ç§°åŠ å¯†æ¥æ›¿æ¢éå¯¹ç§°åŠ å¯†ï¼Œæ¯ä¸€æ¬¡å¯¹è¯ï¼Œå®¢æˆ·ç«¯å’Œå’ŒæœåŠ¡ç«¯éƒ½ç”Ÿæˆä¸€ä¸ªå¯¹è¯ç§˜é’¥ï¼Œè€Œè¿™ä¸ªå¯¹ç§°ç§˜é’¥ä½¿ç”¨æœåŠ¡ç«¯çš„å…¬ç§é’¥æ¥è¿›è¡ŒåŠ è§£å¯†ï¼Œè¿™æ ·å°±å‡å°‘äº†åŠ å¯†è¿ç®—çš„æ¶ˆè€—æ—¶é—´ã€‚</p></blockquote><p>SSL/TLS æ¡æ‰‹çš„æµç¨‹ï¼š</p><ol><li><p>é¦–å…ˆå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯ä¼šå‘æœåŠ¡ç«¯æä¾›ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¯æŒçš„åŠ å¯†çš„ç®—æ³•ï¼Œæ”¯æŒåè®®çš„ç‰ˆæœ¬TLS,ä¸€ä¸ªéšæœºæ•°ï¼ˆç”¨äºå¾…ä¼šç”Ÿæˆå¯¹ç§°ç§˜é’¥ï¼‰ï¼Œæ”¯æŒçš„å‹ç¼©ç®—æ³•</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºç›¸åº”ï¼Œè¯¥å“åº”ä¹ŸåŒ…æ‹¬ä¸€äº›ä¿¡æ¯ï¼Œç¡®è®¤ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œä¸€ä¸ªæœåŠ¡ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼ˆç”¨äºå¾…ä¼šç”Ÿæˆç§˜é’¥ï¼‰,æ”¯æŒçš„åè®®çš„ç‰ˆæœ¬TLSï¼Œè¿˜æœ‰ä¸€ä¸ªæœ€é‡è¦çš„æ•°å­—è¯ä¹¦ï¼Œè¯¥æ•°å­—è¯ä¹¦åŒ…å«äº†æœåŠ¡å™¨çš„åŸŸåï¼Œè¿˜æœ‰æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œä»¥åŠç»è¿‡åŠ å¯†åçš„æ‘˜è¦ï¼Œè¯¥æ‘˜è¦æ˜¯é€šè¿‡ä¸€å®šçš„ç®—æ³•å¯¹åŸŸåä»¥åŠå…¬é’¥è¿›è¡Œè®¡ç®—å¾—æ¥ã€‚ç„¶åä½¿ç”¨CAçš„ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œ</p></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®ä¹‹åé¦–å…ˆä¼šéªŒè¯è¯¥æ•°å­—è¯ä¹¦æ˜¯ä¸æ˜¯æƒå¨æœºæ„ç”³è¯·çš„è¯ä¹¦ï¼Œæˆ–è€…è¯ä¹¦ä¸­çš„åŸŸåä¸å®é™…åŸŸåæ˜¯å¦ä¸€è‡´ï¼Œè¯ä¹¦æ˜¯å¦å·²ç»è¿‡æœŸï¼Œå¦‚æœéƒ½ä¸ç¬¦åˆçš„è¯é‚£ä¹ˆå°±ä¼šæç¤ºæ˜¯å¦ä¿¡ä»»è¯¥æœªçŸ¥æ¥æºè¯ä¹¦è­¦å‘Šã€‚<br>è¿™é‡Œä¼šéªŒè¯è¯ä¹¦æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œå› ä¸ºæœ¬åœ°ç³»ç»Ÿä¼šå†…ç½®æƒå¨æœºæ„çš„å…¬é’¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿  ç”¨å…¬é’¥å¯¹è§£å¯†å‡ºè¯ä¹¦é‡Œé¢çš„æ‘˜è¦ï¼Œç„¶åé€šè¿‡ç‰¹å®šçš„ç®—æ³•å¯¹åŸŸåä»¥åŠå…¬é’¥è¿›è¡Œè®¡ç®—å¾—åˆ°ä¸€ä¸ªæœ¬åœ°æ‘˜è¦ï¼Œå†å’ŒæœåŠ¡ç«¯ä¼ è¿‡æ¥çš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”æ˜¯å¦ä¸€è‡´ï¼Œä»¥æ­¤æ¥åˆ¤æ–­è¯ä¹¦æ˜¯å¦è¢«ç¯¡æ”¹ã€‚<br>å¦‚æœæ ¡éªŒäº†è¯ä¹¦æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶ä¸”ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”å‘é€ç¼–ç æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨åŒæ–¹å•†å®šçš„åŠ å¯†æ–¹æ³•å’Œå¯†é’¥å‘é€ã€‚</p></li><li><p>æœåŠ¡ç«¯è·å–å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œç„¶åä½¿ç”¨è‡ªå·±çš„ç§é’¥æœºå¯†å®¢æˆ·ç«¯å‘è¿‡æ¥çš„éšæœºæ•°ã€‚è‡³æ­¤ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªéšæœºæ•°ã€‚</p></li><li><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡ä¹‹å‰åè®®å¥½çš„åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨å‰é¢ç”Ÿæˆçš„ä¸‰ä¸ªéšæœºæ•°ç”Ÿæˆä¸€ä¸ªçœŸæ­£çš„å¯¹ç§°ç§˜é’¥ï¼Œè¯¥å¯¹ç§°ç§˜é’¥ç”¨äºåŠ å¯†ä¼ è¾“æ•°æ®ã€‚</p></li></ol><p>ç®€å•ç‚¹æ¥è¯´ä»¥ä¸Šæ­¥éª¤å°±æ˜¯ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚</li><li>æœåŠ¡ç«¯è¿”å›è¯ä¹¦ï¼Œè¯¥è¯ä¹¦åŒ…å«æœåŠ¡ç«¯çš„å…¬é’¥</li><li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ï¼Œå¹¶ä¸”ç”Ÿæˆå¯¹ç§°ç§˜é’¥ï¼Œå¹¶ä¸”ä½¿ç”¨æœåŠ¡ç«¯çš„å…¬é’¥åŠ å¯†è¯¥å¯¹ç§°ç§˜é’¥</li><li>æœåŠ¡ç«¯ç”¨ç§é’¥è§£å¯†å®¢æˆ·ç«¯çš„å¯¹ç§°ç§˜é’¥</li><li>å‘é€å†…å®¹é€šè¿‡å¯¹ç§°ç§˜é’¥æ¥åŠ å¯†</li></ol><p>æ€»ç»“ä¸€ä¸‹ HTTPS åè®®æ˜¯å¦‚ä½•é¿å…å‰æ–‡æ‰€è¯´çš„ä¸‰å¤§é£é™©çš„ï¼š<br>å…ˆç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯†ç ï¼Œç„¶åç”¨è¿™ä¸ªå¯†ç å¯¹ç§°åŠ å¯†æ•°æ®ï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹æ— æ³•è·å¾—é€šä¿¡å†…å®¹<br>å‘é€æ–¹å°†æ•°æ®çš„å“ˆå¸Œç»“æœå†™åˆ°æ•°æ®ä¸­ï¼Œæ¥æ”¶æ–¹è§£å¯†åå¯¹æ¯”æ•°æ®çš„å“ˆå¸Œç»“æœï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¯´æ˜è¢«ä¿®æ”¹ã€‚ç”±äºä¼ è¾“æ•°æ®åŠ å¯†ï¼Œç¬¬ä¸‰æ–¹æ— æ³•ä¿®æ”¹å“ˆå¸Œç»“æœã€‚<br>ç”±æƒå¨æœºæ„é¢å‘è¯ä¹¦ï¼Œå†åŠ ä¸Šè¯ä¹¦æ ¡éªŒæœºåˆ¶ï¼Œé¿å…ç¬¬ä¸‰æ–¹ä¼ªè£…å‚ä¸é€šä¿¡ã€‚</p><h2 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h2><p>åœ¨æˆ‘ä»¬æŠ›ç –å¼•ç‰è¯´äº†è¿™ä¹ˆå¤šHTTPä¸HTTPSçš„åŒºåˆ«ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç­”æ¡ˆã€‚</p><blockquote><p>å¦‚æœä¸€ä¸ªäººä¸‹è½½äº†ä¸€ä¸ªAPPï¼Œè¯¥APPä¸æœåŠ¡å™¨æ˜¯HTTPSè¿æ¥ï¼Œä»–ä¸ä¼šä¿¡ä»»ä»»ä½•æ¥æºäºä¸æ˜èº«ä»½çš„è¯ä¹¦ï¼Œç„¶åè¿ä¸Šäº†æˆ‘çš„WIFIï¼Œæˆ‘æœ‰æ²¡æœ‰åŠæ³•å»ç ´è§£é‡Œé¢çš„é€šä¿¡å†…å®¹</p></blockquote><p><strong>ç­”æ¡ˆå°±æ˜¯ä¸è¡Œ</strong></p><p>æˆ‘ä»¬æƒ³åˆ°çš„å¯ä»¥ç ´è§£é‡Œé¢çš„é€šä¿¡å†…å®¹ä¹Ÿè®¸å°±æ˜¯å¸Œæœ›èƒ½åšä¸€ä¸ªä¸­é—´äººæ‹¦æˆªï¼Œåœ¨æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€è¯ä¹¦çš„æ—¶å€™æ‹¦æˆªè¯¥è¯ä¹¦ï¼Œå¹¶ä¸”ä¼ªé€ ä¸€ä¸ªå’ŒæœåŠ¡ç«¯åŸŸåç›¸åŒå¹¶ä¸”æ›¿æ¢å°†é‡Œé¢çš„å…¬é’¥æ›¿æ¢æˆè‡ªå·±çš„å…¬é’¥ï¼Œå¹¶ä¸”ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œç­¾åã€‚å®¢æˆ·ç«¯æ”¶åˆ°ä¼ªé€ çš„è¯ä¹¦ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ç³»ç»Ÿä¸­æœ‰æˆ‘ä»¬çš„å…¬é’¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥éªŒè¯é€šè¿‡è¯¥ä¸­é—´äººçš„è¯ä¹¦ï¼Œç„¶åè·å–å¾—åˆ°å…¬é’¥ï¼Œç„¶åç”¨è¯¥å…¬é’¥å¯¹å¯¹ç§°ç§˜é’¥åŠ å¯†å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ­¤æ—¶ä¸­é—´ä»¶åˆå¯ä»¥æ‹¦æˆªï¼Œå¹¶ä¸”ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºå¯¹ç§°ç§˜é’¥ï¼Œç„¶åä¸­é—´äººé€šè¿‡æœåŠ¡ç«¯çš„å…¬é’¥å¯¹è¯¥ç§˜é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™æœåŠ¡ç«¯ï¼Œè¿™æ ·ä¸­é—´äººå°±æ‹¿åˆ°äº†å¯¹ç§°ç§˜é’¥ä¿¡æ¯ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥çªƒå–åˆ°é‡Œé¢çš„é€šä¿¡å†…å®¹ã€‚</p><p>ä½†æ˜¯â€¦â€¦â€¦.</p><p>å‰é¢çš„é¢˜ç›®è¯´äº†ä¸€ä¸ªå‰æï¼Œä¸ä¼šä¿¡ä»»ä»»ä½•æ¥æºäºä¸æ˜èº«ä»½çš„è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸­é—´äººæ‹¦æˆªäº†æœåŠ¡ç«¯çš„è¯ä¹¦å¹¶ä¸”å°†ä¼ªé€ çš„è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ä¹‹åï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šé€šè¿‡éªŒè¯è¯¥è¯ä¹¦ï¼Œç„¶åè¿æ¥å°±åˆ°æ­¤ä¸­æ–­äº†ã€‚ã€‚ã€‚ã€‚</p><h2 id="é™„åŠ ï¼šHTTPSä¸HTTPSçš„åŒºåˆ«"><a href="#é™„åŠ ï¼šHTTPSä¸HTTPSçš„åŒºåˆ«" class="headerlink" title="é™„åŠ ï¼šHTTPSä¸HTTPSçš„åŒºåˆ«"></a>é™„åŠ ï¼šHTTPSä¸HTTPSçš„åŒºåˆ«</h2><ol><li>HTTPæ˜¯æ˜æ–‡ä¼ è¾“ï¼ŒHTTPSæ˜¯åŠ å¯†ä¼ è¾“</li><li>HTTPåªæœ‰TCPä¸‰æ¬¡æ¡æ‰‹ï¼ŒHTTPSæ˜¯TCPä¸‰æ¬¡æ¡æ‰‹+SSL/TLS</li><li>HTTPæ˜¯ä½¿ç”¨80ç«¯å£ï¼ŒHTTPSæ˜¯ä½¿ç”¨443ç«¯å£</li><li>HTTPSæ¯”HTTPSæ›´åŠ è€—æ—¶</li><li>HTTPSéœ€è¦åˆ°CAè´­ä¹°è¯ä¹¦ï¼Œéœ€è¦ä¸€å®šçš„è´¹ç”¨</li></ol><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p>1  <a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="noopener">SSL/TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°</a></p><ol start="2"><li><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">å›¾è§£SSL/TLSåè®®</a></li><li><a href="http://skx926.com/2017/12/05/https/" target="_blank" rel="noopener">æ·±å…¥ç†è§£HTTPS</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šå…³äºHTTPä¸HTTPSçš„æ–‡ç« ï¼Œä¸ºä»€ä¹ˆæˆ‘è¿˜è¦å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Œæºäºæ˜¨å¤©æœ‰ä¸ªiOSå¼€å‘åŒå­¦æ˜¨å¤©åœ¨ç¾¤é‡Œé¢æäº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªäººä¸‹è½½äº†ä¸€ä¸ªAPPï¼Œè¯¥APPä¸æœåŠ¡å™¨æ˜¯HTTPSè¿æ¥ï¼Œä»–ä¸ä¼šä¿¡ä»»ä»»ä½•æ¥æºäºä¸æ˜èº«ä»½çš„è¯ä¹¦ï¼Œç„¶åè¿ä¸Šäº†æˆ‘çš„WIFIï¼Œæˆ‘æœ‰æ²¡æœ‰åŠæ³•å»ç ´è§£é‡Œé¢çš„é€šä¿¡å†…å®¹?&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¸¦ç€è¿™ä¸ªç–‘é—®å»å¯»æ‰¾ç­”æ¡ˆï¼Œå¹¶ä¸”ç»™å‡ºæˆ‘çš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯HTTP&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯HTTP&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯HTTP&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯HTTP&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;HTTP(HyperText Transfer Protocol)è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ŒHTTPæ˜¯ä¸ƒå±‚ç½‘ç»œæ¨¡å‹ä¸­ä½œç”¨åœ¨åº”ç”¨å±‚çš„åè®®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="å…¶ä»–æŠ€æœ¯" scheme="http://lemon2well.top/categories/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="http" scheme="http://lemon2well.top/tags/http/"/>
    
      <category term="https" scheme="http://lemon2well.top/tags/https/"/>
    
      <category term="SSL/TLS" scheme="http://lemon2well.top/tags/SSL-TLS/"/>
    
  </entry>
  
  <entry>
    <title>å›æ–‡æ•°</title>
    <link href="http://lemon2well.top/2018/08/10/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E5%9B%9E%E6%96%87%E6%95%B0/"/>
    <id>http://lemon2well.top/2018/08/10/å¸¸è§ç®—æ³•/å›æ–‡æ•°/</id>
    <published>2018-08-10T02:34:40.000Z</published>
    <updated>2018-08-10T02:35:39.604Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚"></a>åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚</h1><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 121</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: -121</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: ä»å·¦å‘å³è¯», ä¸º -121 ã€‚ ä»å³å‘å·¦è¯», ä¸º 121- ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚</span><br></pre></td></tr></table></figure><a id="more"></a><p>ç¤ºä¾‹ 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 10</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: ä»å³å‘å·¦è¯», ä¸º 01 ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>æ€è·¯ï¼š<br>æ ¹æ®å®šä¹‰å¦‚æœæˆ‘ä»¬è¦æ‰¾å‡ºä¸€ä¸ªæ•°æ˜¯å¦æ˜¯å›æ–‡æ•°æˆ‘ä»¬å…¶å®åªéœ€è¦å°†è¿™ä¸ªæ•°åˆ†æˆå¹³å‡åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œç„¶åå°†ååŠéƒ¨åˆ†ç¿»è½¬ï¼Œåªè¦ç¿»è½¬åçš„ååŠéƒ¨åˆ†ç­‰äºå‰åŠéƒ¨åˆ†ï¼Œå°±ä»£è¡¨è¿™ä¸ªæ•°æ˜¯å›æ–‡æ•°ã€‚<br>æˆ‘ä»¬æ‹¿1221æ¥ä¸¾ä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æ‹¿åˆ°ååŠæ®µæ˜¯21ç„¶åå°†21ç¿»è½¬å°±æ˜¯12äº†ï¼Œå’Œå‰åŠæ®µæ¯”è¾ƒç›¸ç­‰å°±ä»£è¡¨æ˜¯å›æ–‡æ•°ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å°†21ç¿»è½¬ï¼Œé¦–å…ˆæˆ‘ä»¬å°†1221%10 å¾—åˆ°çš„å°±æ˜¯ç¬¬ä¸€ä¸ªæ•°1ï¼Œç„¶åç”¨è¿™ç¬¬ä¸€ä¸ªæ•° 1<em> 10 å¾—åˆ°ç¿»è½¬åçš„æ­£ç¡®ä½ç½®ã€‚ç¬¬äºŒä¸ªæ•°æˆ‘ä»¬ä¾ç„¶æ˜¯122%10ï¼Œç„¶åå¾—åˆ°ç¬¬äºŒä¸ªæ•°ï¼Œç”¨ç¬¬ä¸€ä¸ªæ•°åŠ ä¸Šç¬¬äºŒä¸ªæ•°å°±å¾—åˆ°äº†12.<br>ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬å¦‚ä½•å°†è¿™ä¸ªæ•°åˆ†æˆä¸¤éƒ¨åˆ†ã€‚å½“åŸå§‹æ•°/10å°äºç¿»è½¬æ•°</em>10çš„æ—¶å€™å°±ä»£è¡¨å·²ç»å®Œæˆäº†ä¸€åŠçš„ç¿»è½¬ã€‚</p></blockquote><p><strong>ä¸è¿‡ä¾ç„¶æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ç‚¹æ˜¯å¦‚æœè¿™ä¸ªåŸå§‹çš„æ•°æ˜¯è´Ÿæ•°çš„è¯æˆ‘ä»¬éœ€è¦è¿”å›ï¼Œå¦‚æœè¿™ä¸ªæ•°æ˜¯ä»¥0ç»“å°¾çš„æ•°ï¼Œé‚£ä¹ˆåªæœ‰0æ‰æ»¡è¶³å›æ–‡æ•°ï¼Œå…¶ä»–æ•°éƒ½ä¸æ»¡è¶³å›æ–‡æ•°ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›falseã€‚</strong><br><strong>ç¬¬äºŒç‚¹æ˜¯å¦‚æœè¿™ä¸ªæ•°çš„ä½æ•°æ˜¯åŸºæ•°ï¼Œä¾‹å¦‚12321ï¼Œé‚£ä¹ˆå¾ªç¯å®Œæˆä¹‹ååŸå§‹æ•°ç¼–ç¨‹12ï¼Œç¿»è½¬æ•°æ˜¯123ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç”¨123/10å¾—åˆ°12å†å’ŒåŸå§‹æ•°12æ¯”è¾ƒï¼Œå¿½ç•¥ä¸­é—´é‚£ä¸€ä½æ•°</strong></p><p>ä»¥ä¸‹æ˜¯ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fileprivate func solution(_ num:Int)-&gt;Bool&#123;</span><br><span class="line">      if num&lt;0 || (num % 10 == 0 &amp;&amp; num != 0)&#123;</span><br><span class="line">          return false</span><br><span class="line">      &#125;</span><br><span class="line">      var originNum = num</span><br><span class="line">      var reverserNum = 0</span><br><span class="line">      while originNum &gt; reverserNum &#123;</span><br><span class="line">          reverserNum = reverserNum * 10 + originNum % 10</span><br><span class="line">          originNum = originNum / 10</span><br><span class="line">      &#125;</span><br><span class="line">      return originNum == reverserNum || originNum == reverserNum / 10</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚&quot;&gt;&lt;a href=&quot;#åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚&quot; class=&quot;headerlink&quot; title=&quot;åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚&quot;&gt;&lt;/a&gt;åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦æ˜¯å›æ–‡æ•°ã€‚å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚&lt;/h1&gt;&lt;p&gt;ç¤ºä¾‹ 1:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;è¾“å…¥: 121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;è¾“å‡º: true&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¤ºä¾‹ 2:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;è¾“å…¥: -121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;è¾“å‡º: false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;è§£é‡Š: ä»å·¦å‘å³è¯», ä¸º -121 ã€‚ ä»å³å‘å·¦è¯», ä¸º 121- ã€‚å› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°ã€‚&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="å¸¸è§ç®—æ³•" scheme="http://lemon2well.top/categories/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>æŒç»­é›†æˆä¹‹Jenkinsæ„å»ºé¡¹ç›®å¹¶ä¸Šä¼ åˆ°è’²å…¬è‹±</title>
    <link href="http://lemon2well.top/2018/08/08/iOS%20%E5%BC%80%E5%8F%91/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B9%8BJenkins%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E4%B8%8A%E4%BC%A0%E5%88%B0%E8%92%B2%E5%85%AC%E8%8B%B1/"/>
    <id>http://lemon2well.top/2018/08/08/iOS å¼€å‘/æŒç»­é›†æˆä¹‹Jenkinsæ„å»ºé¡¹ç›®å¹¶ä¸Šä¼ åˆ°è’²å…¬è‹±/</id>
    <published>2018-08-08T15:18:25.000Z</published>
    <updated>2018-08-09T03:18:43.898Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ç¬¬ä¸€ç¯‡<a href="http://lemon2well.top/2018/08/07/iOS%20å¼€å‘/æŒç»­é›†æˆä¹‹Jenkinsæ­å»º/">Jenkinsçš„æ­å»º</a>ä¸­æˆ‘ä»¬å·²ç»æŠŠæœ¬åœ°jenkinsç¯å¢ƒéƒ½æ­å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡jenkinsæ„å»ºä¸€ä¸ªipaå¹¶ä¸”ä¸Šä¼ åˆ°è’²å…¬è‹±ã€‚</p></blockquote><h2 id="åˆ›å»ºä»»åŠ¡"><a href="#åˆ›å»ºä»»åŠ¡" class="headerlink" title="åˆ›å»ºä»»åŠ¡"></a>åˆ›å»ºä»»åŠ¡</h2><p>1.é¦–å…ˆé€‰æ‹©å·¦ä¾§çš„æ–°å»ºä»»åŠ¡ï¼Œç„¶åä¸‹é¢æ˜¯æ„å»ºè¯¥å·¥ç¨‹çš„åŸºæœ¬ä¿¡æ¯</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336240434000.jpg" alt=""></p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336241947095.jpg" alt=""></p><a id="more"></a><h2 id="å¡«å†™æºç åœ°å€"><a href="#å¡«å†™æºç åœ°å€" class="headerlink" title="å¡«å†™æºç åœ°å€"></a>å¡«å†™æºç åœ°å€</h2><ol start="2"><li>ä¸‹é¢å¡«å†™githubæˆ–è€…gitLabçš„æºç çš„åœ°å€ï¼Œå¹¶ä¸”éœ€è¦é…ç½®å¯¹åº”çš„Credentialsï¼Œè¿™é‡Œç›¸å½“æ˜¯æˆæƒã€‚ç­‰åˆ°æ„å»ºçš„æ—¶å€™jenkinsä¼šä»å¯¹åº”çš„gitä¸Šé¢æ‹‰å»ä»£ç å¼€å§‹æ„å»ºã€‚</li></ol><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336242653880.jpg" alt=""></p><p>å¡«å®Œæºç çš„ç½‘å€ä¹‹åéœ€è¦å¡«å†™gitçš„è´¦å·å¯†ç æˆ–è€…è¾“å…¥å¯¹åº”çš„ç§é’¥ã€‚ç‚¹å‡»Addç„¶åä¼šå‡ºç°ä¸‹é¢çš„ç•Œé¢</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336242294039.jpg" alt=""></p><blockquote><p>å¦‚æœä½ çš„gitå·²ç»é…ç½®äº†sshé‚£ä¹ˆå¯ä»¥é€‰æ‹©SSH username and private keyï¼Œ ç„¶ååˆ°ä½ çš„/Users/ç”¨æˆ·å/.ssh/id_rsa å°†è¿™ä¸ªç§é’¥æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°privatekey (enter directly)ä¸Šé¢å»ã€‚<br>å¦åˆ™å¯ä»¥æŒ‰ç…§ä¸Šå›¾é‚£æ ·ï¼Œé€‰æ‹©username with passwordï¼Œç„¶åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç </p></blockquote><h2 id="è®¾ç½®è§¦å‘å™¨ï¼ˆéå¿…è¦ï¼‰"><a href="#è®¾ç½®è§¦å‘å™¨ï¼ˆéå¿…è¦ï¼‰" class="headerlink" title="è®¾ç½®è§¦å‘å™¨ï¼ˆéå¿…è¦ï¼‰"></a>è®¾ç½®è§¦å‘å™¨ï¼ˆéå¿…è¦ï¼‰</h2><ol start="3"><li>æ„å»ºè§¦å‘å™¨æ˜¯ä¸æµ‹è¯•ç›¸å…³çš„æ“ä½œï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æ„å»ºçš„è§¦å‘æ—¶åˆ»ï¼Œä¾‹å¦‚é€‰æ‹©ç¬¬äºŒä¸ªå°±æ˜¯å½“ä»£ç ä»“åº“æœ‰pushäº‹ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ„å»ºæ“ä½œï¼Œç„¶åæ„å»ºä¸€ä¸ªç‰ˆæœ¬å¹¶ä¸”é€šçŸ¥æµ‹è¯•å»æ“ä½œã€‚å› ä¸ºæˆ‘ä»¬æ˜¯æ‰‹åŠ¨æ„å»ºï¼Œæ‰€ä»¥è¿™é‡Œå…ˆä¸ç®¡è¿™ä¸ªã€‚<br><img src="http://pcd17v2u0.bkt.clouddn.com/15336265635081.jpg" alt=""></li></ol><h2 id="è®¾ç½®ç­¾åå’Œè¯ä¹¦"><a href="#è®¾ç½®ç­¾åå’Œè¯ä¹¦" class="headerlink" title="è®¾ç½®ç­¾åå’Œè¯ä¹¦"></a>è®¾ç½®ç­¾åå’Œè¯ä¹¦</h2><ol start="4"><li>æ¥ä¸‹æˆ‘ä»¬éœ€è¦è®¾ç½®ç­¾åæ–‡ä»¶å’Œè¯ä¹¦ã€‚<br>é¦–å…ˆä¿å­˜æˆ‘ä»¬åŸå…ˆçš„è®¾ç½®ï¼Œç„¶åå›åˆ°é¦–é¡µï¼Œé€‰æ‹©ç³»ç»Ÿç®¡ç†-&gt;Keychains and Provisioning Profiles Management ç‚¹å‡»é€‰å–æ–‡ä»¶ï¼Œç„¶åé€‰æ‹©login.keychainæ–‡ä»¶å’Œ provisioning file ä¸Šä¼ ã€‚<br><img src="http://pcd17v2u0.bkt.clouddn.com/15336269763882.jpg" alt=""></li></ol><p>å¡«å†™æœ¬æœºå¯†ç ï¼Œè¾“å…¥æè¿°ï¼Œç„¶åé€‰æ‹©Add Code Signing Identity è¾“å…¥ç­¾åæ–‡ä»¶çš„åç§°ï¼Œè¿™é‡Œçš„åç§°å¯ä»¥åˆ°é’¥åŒ™ä¸²æ‰¾åˆ°å¯¹åº”çš„è¯ä¹¦ç„¶åé€‰æ‹©æ˜¾ç¤ºç®€ä»‹ç„¶åå¤åˆ¶å¤´éƒ¨çš„æ–‡å­—ã€‚</p><blockquote><p>è¿™ä¸ªKeychainåœ¨/Users/ç®¡ç†å‘˜ç”¨æˆ·å/Library/keychains/login.keychain,å½“æŠŠè¿™ä¸ªKeychainè®¾ç½®å¥½äº†ä¹‹åï¼ŒJenkinsä¼šæŠŠè¿™ä¸ªKeychainæ‹·è´åˆ°/Users/Shared/Jenkins/Library/keychainsè¿™é‡Œï¼Œ(Libraryæ˜¯éšè—æ–‡ä»¶)ã€‚Provisioning Profilesæ–‡ä»¶ä¹Ÿç›´æ¥æ‹·è´åˆ°/Users/Shared/Jenkins/Library/MobileDeviceæ–‡ä»¶ç›®å½•ä¸‹</p></blockquote><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336275407363.jpg" alt=""></p><p>ä¸Šé¢çš„é…ç½®å®Œæˆä¹‹åï¼Œå›åˆ°ä»»åŠ¡çš„é…ç½®é‡Œé¢ï¼Œé€‰æ‹©å¯¹åº”çš„keyChainå’Œprovisioning file</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15336251729871.jpg" alt=""></p><h2 id="æ„å»ºå‘½ä»¤"><a href="#æ„å»ºå‘½ä»¤" class="headerlink" title="æ„å»ºå‘½ä»¤"></a>æ„å»ºå‘½ä»¤</h2><ol start="5"><li>ä¸Šé¢å·²ç»å°†æ‰€æœ‰çš„è®¾ç½®éƒ½é…ç½®å¥½äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦é€‰æ‹©æ„å»ºçš„æ–¹å¼ï¼Œä½ å¯ä»¥é€‰æ‹©é€šè¿‡xcodeæ¥æ„å»ºï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬é€‰æ‹©shell å¹¶ä¸”ä¹Ÿæ¨èé€šè¿‡shellæ¥æ„å»ºã€‚é€‰æ‹©æ‰§è¡Œshellï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç ï¼Œé‡Œé¢æœ‰äº›åœ°æ–¹éœ€è¦æ”¹æˆä½ è‡ªå·±çš„ï¼Œæ ¹æ®å®é™…æƒ…å†µæ”¹å°±å¯ä»¥äº†ï¼Œä¸è¿‡ä¸€å®šè¦æ³¨æ„ä¸€ç‚¹ï¼Œjenkinsé‚£ä¸ªç¼–è¾‘æ¡†æå…¶ä¸å¥½ç”¨ï¼Œæˆ‘å› ä¸ºä¸å°å¿ƒè¾“å…¥äº†ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ç„¶åä¸€ç›´æŠ¥ command not found ï¼Œæåˆ°æˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯jenkinsé…ç½®ç¯å¢ƒçš„é—®é¢˜ã€‚å¦‚æœä¸­é—´æœ‰æ„å»ºé”™è¯¯ï¼Œç‚¹å‡»æ„å»ºé‚£ä¸ªçº¢ç‚¹ç„¶åå¯ä»¥æŸ¥çœ‹å…·ä½“çš„æ§åˆ¶å°ä¿¡æ¯ï¼Œæ ¹æ®é”™è¯¯æç¤ºæ¥ä¿®æ”¹å°±å¥½äº†</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># å·¥ç¨‹åï¼Œè®°å¾—æ”¹æˆä½ è‡ªå·±</span><br><span class="line">APP_NAME=&quot;TestUMCOpen&quot;</span><br><span class="line"># è¯ä¹¦</span><br><span class="line">CODE_SIGN_DISTRIBUTION=&quot;iPhone Distribution: XXXXXXXXXX&quot;</span><br><span class="line"># info.plistè·¯å¾„</span><br><span class="line">project_infoplist_path=&quot;./$&#123;APP_NAME&#125;/Info.plist&quot;</span><br><span class="line"></span><br><span class="line">#å–ç‰ˆæœ¬å·</span><br><span class="line">bundleShortVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleShortVersionString&quot; &quot;$&#123;project_infoplist_path&#125;&quot;)</span><br><span class="line"></span><br><span class="line">#å–buildå€¼</span><br><span class="line">bundleVersion=$(/usr/libexec/PlistBuddy -c &quot;print CFBundleVersion&quot; &quot;$&#123;project_infoplist_path&#125;&quot;)</span><br><span class="line">DATE=&quot;$(date +%Y%m%d)&quot;</span><br><span class="line">IPAFOLDER=&quot;$&#123;APP_NAME&#125;_V$&#123;bundleShortVersion&#125;_$&#123;DATE&#125;&quot;</span><br><span class="line"></span><br><span class="line">#è¦ä¸Šä¼ çš„ipaæ–‡ä»¶è·¯å¾„</span><br><span class="line">ARCHIVE_PATH=&quot;$&#123;HOME&#125;/Desktop/archive&quot;</span><br><span class="line">IPA_PATH=&quot;$ARCHIVE_PATH/$&#123;IPAFOLDER&#125;/$&#123;APP_NAME&#125;.ipa&quot;</span><br><span class="line">PLIST_PATH=&quot;$ARCHIVE_PATH/ADHocExportOptions.plist&quot;</span><br><span class="line">echo $&#123;IPA_PATH&#125;</span><br><span class="line">echo $&#123;PLIST_PATH&#125;</span><br><span class="line"></span><br><span class="line">#ä¸‹é¢ä¸¤è¡Œæ˜¯æ²¡æœ‰Cocopodsçš„ç”¨æ³•</span><br><span class="line"># æ¸…é™¤ä¸Šæ¬¡æ„å»º</span><br><span class="line">xcodebuild clean -project &quot;$&#123;APP_NAME&#125;.xcodeproj&quot; -scheme $&#123;APP_NAME&#125;   -configuration &apos;Release&apos;</span><br><span class="line"># æ„å»ºxcarchiveæ–‡ä»¶</span><br><span class="line">xcodebuild archive -project &quot;$&#123;APP_NAME&#125;.xcodeproj&quot; -scheme $&#123;APP_NAME&#125; -archivePath &quot;$&#123;ARCHIVE_PATH&#125;/$&#123;APP_NAME&#125;.xcarchive&quot;</span><br><span class="line"></span><br><span class="line">#ä¸‹é¢ä¸¤è¡Œæ˜¯æœ‰cocopodsçš„ç”¨æ³•</span><br><span class="line"># xcodebuild clean -workspace &quot;$&#123;APP_NAME&#125;.xcworkspace&quot; -scheme $&#123;APP_NAME&#125;   -configuration &apos;Release&apos;</span><br><span class="line"></span><br><span class="line"># xcodebuild archive -workspace &quot;$&#123;APP_NAME&#125;.xcworkspace&quot; -scheme $&#123;APP_NAME&#125; -archivePath &quot;$&#123;ARCHIVE_PATH&#125;/$&#123;APP_NAME&#125;.xcarchive&quot;</span><br><span class="line"></span><br><span class="line"># å¯¼å‡ºipa</span><br><span class="line">xcodebuild -exportArchive -archivePath &quot;$&#123;ARCHIVE_PATH&#125;/$&#123;APP_NAME&#125;.xcarchive&quot; -exportPath &quot;$ARCHIVE_PATH/$IPAFOLDER&quot; -exportOptionsPlist &quot;$PLIST_PATH&quot;</span><br><span class="line"></span><br><span class="line">#æ‰“å¼€æ–‡ä»¶å¤¹</span><br><span class="line">open $&#123;ARCHIVE_PATH&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨xcode9ä¹‹åï¼Œéœ€è¦æä¾›ä¸€ä¸ªä¿¡æ¯æ‰èƒ½æ‰“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡xcodeæ‰“åŒ…å‡ºæ¥ipaæ–‡ä»¶ç„¶åå¤åˆ¶é‚£ä¸ªExportOption.plistæ–‡ä»¶å°±å¥½äº†ä»¥ä¸‹æ˜¯æˆ‘çš„æ–‡ä»¶çš„å†…å®¹</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;compileBitcode&lt;/key&gt;</span><br><span class="line">&lt;false/&gt;</span><br><span class="line">&lt;key&gt;method&lt;/key&gt;</span><br><span class="line">&lt;string&gt;enterprise&lt;/string&gt;</span><br><span class="line">&lt;key&gt;provisioningProfiles&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;your Bundle id&lt;/key&gt;</span><br><span class="line">&lt;string&gt;è¯ä¹¦çš„åå­—&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;key&gt;signingCertificate&lt;/key&gt;</span><br><span class="line">&lt;string&gt;iPhone Distribution&lt;/string&gt;</span><br><span class="line">&lt;key&gt;signingStyle&lt;/key&gt;</span><br><span class="line">&lt;string&gt;manual&lt;/string&gt;</span><br><span class="line">&lt;key&gt;stripSwiftSymbols&lt;/key&gt;</span><br><span class="line">&lt;true/&gt;</span><br><span class="line">&lt;key&gt;teamID&lt;/key&gt;</span><br><span class="line">&lt;string&gt;7LD5QKB26C&lt;/string&gt;</span><br><span class="line">&lt;key&gt;thinning&lt;/key&gt;</span><br><span class="line">&lt;string&gt;none&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li><p>å¦‚æœæˆåŠŸä¹‹åä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶é‡Œé¢ç”Ÿæˆä¸‹é¢çš„æ–‡ä»¶ï¼Œé™¤äº†é‚£ä¸ªADHocExportOption.plistæ˜¯æˆ‘åˆ›å»ºçš„ï¼Œå‰å¤©çš„æ–‡ä»¶éƒ½æ˜¯jenkinsæ„å»ºçš„ã€‚<br><img src="http://pcd17v2u0.bkt.clouddn.com/15336256611678.jpg" alt=""></p></li><li><p>ä¸Šä¼ ipaåˆ°è’²å…¬è‹±</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ä¸Šä¼ åˆ°è’²å…¬è‹±</span><br><span class="line">uKey=&quot;aec42b3cc32*******837cc7084a819c&quot;</span><br><span class="line">#è’²å…¬è‹±ä¸Šçš„API Key</span><br><span class="line">apiKey=&quot;ba4e62***************8067a87315&quot;</span><br><span class="line">#è¦ä¸Šä¼ çš„ipaæ–‡ä»¶è·¯å¾„</span><br><span class="line">echo $IPA_PATH</span><br><span class="line"> </span><br><span class="line">#æ‰§è¡Œä¸Šä¼ è‡³è’²å…¬è‹±çš„å‘½ä»¤</span><br><span class="line">echo &quot;++++++++++++++upload+++++++++++++&quot;</span><br><span class="line">curl -F &quot;file=@$&#123;IPA_PATH&#125;&quot; -F &quot;uKey=$&#123;uKey&#125;&quot; -F &quot;_api_key=$&#123;apiKey&#125;&quot; http://www.pgyer.com/apiv1/app/upload</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤è¡Œæ„å»º"><a href="#å‘½ä»¤è¡Œæ„å»º" class="headerlink" title="å‘½ä»¤è¡Œæ„å»º"></a>å‘½ä»¤è¡Œæ„å»º</h2><ol start="7"><li>è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆæ‰‹åŠ¨æ„å»ºé¡¹ç›®äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨Jenkinså‘½ä»¤è¡Œæ¥å®Œæˆä¸€è¡Œå‘½ä»¤æ„å»ºç‰ˆæœ¬<br>è¿›å…¥ç³»ç»Ÿç®¡ç†ç„¶åé€‰æ‹©Jenkinså‘½ä»¤è¡Œï¼Œä¸‹è½½æœ€æ–°çš„jenkins-cli.jar<br><img src="http://pcd17v2u0.bkt.clouddn.com/15336535463602.jpg" alt=""></li></ol><p>ä¸‹è½½å®Œæˆä¹‹åï¼Œå¦‚æœç›´æ¥è¿è¡Œä¸Šè¿°å‘½ä»¤è¡Œä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹SSHã€‚ç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·åï¼Œç„¶åç‚¹å‡»è®¾ç½®ï¼Œæ‰¾åˆ°SSHï¼Œç„¶åå°†æœ¬åœ°çš„å…¬é’¥å¤åˆ¶ç²˜è´´åˆ°ä¸Šé¢ï¼Œä¿å­˜ã€‚</p><p>ä¸‹é¢æ˜¯å®Œæ•´çš„å‘½ä»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">add-job-to-view</span><br><span class="line">    Adds jobs to view.</span><br><span class="line">  build</span><br><span class="line">    Builds a job, and optionally waits until its completion.</span><br><span class="line">  cancel-quiet-down</span><br><span class="line">    Cancel the effect of the &quot;quiet-down&quot; command.</span><br><span class="line">  clear-queue</span><br><span class="line">    Clears the build queue.</span><br><span class="line">  connect-node</span><br><span class="line">    Reconnect to a node(s)</span><br><span class="line">  console</span><br><span class="line">    Retrieves console output of a build.</span><br><span class="line">  copy-job</span><br><span class="line">    Copies a job.</span><br><span class="line">  create-credentials-by-xml</span><br><span class="line">    Create Credential by XML</span><br><span class="line">  create-credentials-domain-by-xml</span><br><span class="line">    Create Credentials Domain by XML</span><br><span class="line">  create-job</span><br><span class="line">    Creates a new job by reading stdin as a configuration XML file.</span><br><span class="line">  create-node</span><br><span class="line">    Creates a new node by reading stdin as a XML configuration.</span><br><span class="line">  create-view</span><br><span class="line">    Creates a new view by reading stdin as a XML configuration.</span><br><span class="line">  delete-builds</span><br><span class="line">    Deletes build record(s).</span><br><span class="line">  delete-credentials</span><br><span class="line">    Delete a Credential</span><br><span class="line">  delete-credentials-domain</span><br><span class="line">    Delete a Credentials Domain</span><br><span class="line">  delete-job</span><br><span class="line">    Deletes job(s).</span><br><span class="line">  delete-node</span><br><span class="line">    Deletes node(s)</span><br><span class="line">  delete-view</span><br><span class="line">    Deletes view(s).</span><br><span class="line">  disable-job</span><br><span class="line">    ç¦ç”¨ä»»åŠ¡</span><br><span class="line">  disconnect-node</span><br><span class="line">    Disconnects from a node.</span><br><span class="line">  enable-job</span><br><span class="line">    å¯ç”¨ä»»åŠ¡</span><br><span class="line">  get-credentials-as-xml</span><br><span class="line">    Get a Credentials as XML (secrets redacted)</span><br><span class="line">  get-credentials-domain-as-xml</span><br><span class="line">    Get a Credentials Domain as XML</span><br><span class="line">  get-job</span><br><span class="line">    Dumps the job definition XML to stdout.</span><br><span class="line">  get-node</span><br><span class="line">    Dumps the node definition XML to stdout.</span><br><span class="line">  get-view</span><br><span class="line">    Dumps the view definition XML to stdout.</span><br><span class="line">  groovy</span><br><span class="line">    Executes the specified Groovy script.</span><br><span class="line">  groovysh</span><br><span class="line">    Runs an interactive groovy shell.</span><br><span class="line">  help</span><br><span class="line">    Lists all the available commands or a detailed description of single command.</span><br><span class="line">  import-credentials-as-xml</span><br><span class="line">    Import credentials as XML. The output of &quot;list-credentials-as-xml&quot; can be used as input here as is, the only needed change is to set the actual Secrets which are redacted in the output.</span><br><span class="line">  install-plugin</span><br><span class="line">    Installs a plugin either from a file, an URL, or from update center.</span><br><span class="line">  install-tool</span><br><span class="line">    Performs automatic tool installation, and print its location to stdout. Can be only called from inside a build. [deprecated]</span><br><span class="line">  keep-build</span><br><span class="line">    æ°¸ä¹…ä¿ç•™è¿™æ¬¡æ„å»ºã€‚</span><br><span class="line">  list-changes</span><br><span class="line">    Dumps the changelog for the specified build(s).</span><br><span class="line">  list-credentials</span><br><span class="line">    Lists the Credentials in a specific Store</span><br><span class="line">  list-credentials-as-xml</span><br><span class="line">    Export credentials as XML. The output of this command can be used as input for &quot;import-credentials-as-xml&quot; as is, the only needed change is to set the actual Secrets which are redacted in the output.</span><br><span class="line">  list-credentials-context-resolvers</span><br><span class="line">    List Credentials Context Resolvers</span><br><span class="line">  list-credentials-providers</span><br><span class="line">    List Credentials Providers</span><br><span class="line">  list-jobs</span><br><span class="line">    Lists all jobs in a specific view or item group.</span><br><span class="line">  list-plugins</span><br><span class="line">    Outputs a list of installed plugins.</span><br><span class="line">  login</span><br><span class="line">    Saves the current credentials to allow future commands to run without explicit credential information. [deprecated]</span><br><span class="line">  logout</span><br><span class="line">    Deletes the credentials stored with the login command. [deprecated]</span><br><span class="line">  mail</span><br><span class="line">    Reads stdin and sends that out as an e-mail.</span><br><span class="line">  offline-node</span><br><span class="line">    Stop using a node for performing builds temporarily, until the next &quot;online-node&quot; command.</span><br><span class="line">  online-node</span><br><span class="line">    Resume using a node for performing builds, to cancel out the earlier &quot;offline-node&quot; command.</span><br><span class="line">  quiet-down</span><br><span class="line">    Quiet down Jenkins, in preparation for a restart. Donâ€™t start any builds.</span><br><span class="line">  reload-configuration</span><br><span class="line">    Discard all the loaded data in memory and reload everything from file system. Useful when you modified config files directly on disk.</span><br><span class="line">  reload-job</span><br><span class="line">    Reload job(s)</span><br><span class="line">  remove-job-from-view</span><br><span class="line">    Removes jobs from view.</span><br><span class="line">  restart</span><br><span class="line">    é‡æ–°å¯åŠ¨Jenkins</span><br><span class="line">  safe-restart</span><br><span class="line">    å®‰å…¨åœ°é‡æ–°å¯åŠ¨Jenkins</span><br><span class="line">  safe-shutdown</span><br><span class="line">    Puts Jenkins into the quiet mode, wait for existing builds to be completed, and then shut down Jenkins.</span><br><span class="line">  session-id</span><br><span class="line">    Outputs the session ID, which changes every time Jenkins restarts.</span><br><span class="line">  set-build-description</span><br><span class="line">    Sets the description of a build.</span><br><span class="line">  set-build-display-name</span><br><span class="line">    Sets the displayName of a build.</span><br><span class="line">  set-build-parameter</span><br><span class="line">    Update/set the build parameter of the current build in progress. [deprecated]</span><br><span class="line">  set-build-result</span><br><span class="line">    Sets the result of the current build. Works only if invoked from within a build. [deprecated]</span><br><span class="line">  set-external-build-result</span><br><span class="line">    Set external monitor job result.</span><br><span class="line">  shutdown</span><br><span class="line">    ç«‹åˆ»å…³é—­Jenkins</span><br><span class="line">  update-credentials-by-xml</span><br><span class="line">    Update Credentials by XML</span><br><span class="line">  update-credentials-domain-by-xml</span><br><span class="line">    Update Credentials Domain by XML</span><br><span class="line">  update-job</span><br><span class="line">    Updates the job definition XML from stdin. The opposite of the get-job command.</span><br><span class="line">  update-node</span><br><span class="line">    Updates the node definition XML from stdin. The opposite of the get-node command.</span><br><span class="line">  update-view</span><br><span class="line">    Updates the view definition XML from stdin. The opposite of the get-view command.</span><br><span class="line">  version</span><br><span class="line">    Outputs the current version.</span><br><span class="line">  wait-node-offline</span><br><span class="line">    Wait for a node to become offline.</span><br><span class="line">  wait-node-online</span><br><span class="line">    Wait for a node to become online.</span><br><span class="line">  who-am-i</span><br><span class="line">    Reports your credential and permissions.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„æ ¼å¼æ˜¯<br><code>java -jar jenkins-cli.jar -s http://localhost:8080/ -ssh -user username command</code><br>command å°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œbuildæ˜¯æ„å»ºå‘½ä»¤ï¼Œä¸‹é¢çš„äº‹æƒ…å°±å¾ˆç®€å•äº†ã€‚</p><p><code>java -jar jenkins-cli.jar -s http://localhost:8080/ -ssh -user username build UMC10.1.0Demo</code><br><strong>UMC10.1.0Demoæ˜¯æˆ‘ä»¬ä¸€å¼€å§‹åˆ›å»ºä»»åŠ¡çš„æ—¶å€™çš„åå­—ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè‡ªåŠ¨æ„å»ºç‰ˆæœ¬å¹¶ä¸”ä¸Šä¼ è’²å…¬è‹±</strong><br>å¯ä»¥å°†ä¸Šè¿°å‘½ä»¤æ”¾åˆ°.commandæ–‡ä»¶é‡Œé¢ï¼Œå¹¶ä¸”å¢åŠ å¯æ‰§è¡Œæƒé™ï¼Œè¿™æ ·åŒå‡»è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™å°±ä¼šè§¦å‘æ„å»ºã€‚æ³¨æ„é‡Œé¢cli.jarçš„è·¯å¾„ã€‚</p><p>ä¸Šè¿°å‘½ä»¤æŒ‡ç¤ºæ„å»ºä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„è„šæœ¬ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ—ä¸¾å‡ºæ‰€æœ‰çš„ä»»åŠ¡ï¼Œç„¶åé€‰æ‹©å…¶ä¸­ä¸€ä¸ªä»»åŠ¡æ¥å¼€å§‹æ„å»ºç‰ˆæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">ps -fe|grep &quot;jenkins&quot; |grep -v grep</span><br><span class="line">if [ $? -ne 0 ]</span><br><span class="line">then</span><br><span class="line">echo &quot;******è¯·å…ˆä½¿ç”¨Jenkins -hæ¥å¯åŠ¨jenkins**********&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;********æ£€æµ‹åˆ°Jenkinså·²ç»å¯åŠ¨**********&quot;</span><br><span class="line">fi</span><br><span class="line">LOCALHOST=&quot;http://localhost:8080/&quot;</span><br><span class="line">CLIJAR=&quot;/Users/lemon/jenkins-cli.jar&quot;</span><br><span class="line"></span><br><span class="line">java -jar $&#123;CLIJAR&#125; -s $&#123;LOCALHOST&#125; -ssh -user admin list-jobs</span><br><span class="line"></span><br><span class="line">echo &quot;*******è¯·è¾“å…¥ä½ è¦æ„å»ºçš„ä»»åŠ¡*******&quot;</span><br><span class="line">read BuildName</span><br><span class="line"></span><br><span class="line">java -jar $&#123;CLIJAR&#125; -s $&#123;LOCALHOST&#125; -ssh -user admin build $&#123;BuildName&#125;</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">echo &quot;*******æ­£åœ¨æ„å»º$&#123;BuildName&#125;ï¼Œæ„å»ºå®Œæˆåä¼šè‡ªåŠ¨æ‰“å¼€æœ¬åœ°æ–‡ä»¶å¤¹*******&quot;</span><br><span class="line">else</span><br><span class="line">echo &quot;*******æ„å»º$&#123;BuildName&#125;å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„ä»»åŠ¡*******&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼šæ€»çš„æ¥è¯´åœ¨æˆ‘ä»¬jenkinså·²ç»å®‰è£…å¥½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ„å»ºä»»åŠ¡ï¼Œç„¶åå¡«å†™æºç åœ°å€ï¼Œè®¾ç½®æ„å»ºç­–ç•¥ï¼Œè®¾ç½®ç­¾åå’Œè¯ä¹¦ï¼Œç¼–å†™æ„å»ºä»£ç ï¼ˆåŒ…æ‹¬ä¸Šä¼ è’²å…¬è‹±ï¼‰ï¼Œç¼–å†™shellã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€ç¯‡&lt;a href=&quot;http://lemon2well.top/2018/08/07/iOS%20å¼€å‘/æŒç»­é›†æˆä¹‹Jenkinsæ­å»º/&quot;&gt;Jenkinsçš„æ­å»º&lt;/a&gt;ä¸­æˆ‘ä»¬å·²ç»æŠŠæœ¬åœ°jenkinsç¯å¢ƒéƒ½æ­å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡jenkinsæ„å»ºä¸€ä¸ªipaå¹¶ä¸”ä¸Šä¼ åˆ°è’²å…¬è‹±ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;åˆ›å»ºä»»åŠ¡&quot;&gt;&lt;a href=&quot;#åˆ›å»ºä»»åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºä»»åŠ¡&quot;&gt;&lt;/a&gt;åˆ›å»ºä»»åŠ¡&lt;/h2&gt;&lt;p&gt;1.é¦–å…ˆé€‰æ‹©å·¦ä¾§çš„æ–°å»ºä»»åŠ¡ï¼Œç„¶åä¸‹é¢æ˜¯æ„å»ºè¯¥å·¥ç¨‹çš„åŸºæœ¬ä¿¡æ¯&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pcd17v2u0.bkt.clouddn.com/15336240434000.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://pcd17v2u0.bkt.clouddn.com/15336241947095.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="jenkins" scheme="http://lemon2well.top/tags/jenkins/"/>
    
      <category term="è’²å…¬è‹±" scheme="http://lemon2well.top/tags/%E8%92%B2%E5%85%AC%E8%8B%B1/"/>
    
  </entry>
  
  <entry>
    <title>æŒç»­é›†æˆä¹‹Jenkinsæ­å»º</title>
    <link href="http://lemon2well.top/2018/08/07/iOS%20%E5%BC%80%E5%8F%91/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B9%8BJenkins%E6%90%AD%E5%BB%BA/"/>
    <id>http://lemon2well.top/2018/08/07/iOS å¼€å‘/æŒç»­é›†æˆä¹‹Jenkinsæ­å»º/</id>
    <published>2018-08-07T08:26:29.000Z</published>
    <updated>2018-08-08T08:27:10.972Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯¹äºä¸€ä¸ªAPPæ¥è¯´ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬å¼€å‘æœ€æ‹…å¿ƒçš„å°±æ˜¯å‡ºbugï¼Œåªè¦æ˜¯çº¿ä¸ŠAPPå‡ºbugï¼Œå¿ƒé‡Œå°±æ…Œå¾—å¾ˆï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆä¸¥é‡çš„äº‹æƒ…ï¼Œè¿˜æœ‰å¯èƒ½è®©ç”¨æˆ·ä¸€æ°”ä¹‹ä¸‹æŠŠä½ çš„APPåˆ æ‰ï¼Œä»æ­¤å†ä¹Ÿä¸ä¼šå‡ºç°åœ¨ä»–çš„æ‰‹æœºé‡Œé¢ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸¥æ ¼æŠŠæ§APPçš„è´¨é‡ï¼Œæˆ‘ä»¬åšåˆ°æ¯å¤©éƒ½æ„å»ºä¸€ä¸ªç‰ˆæœ¬å¹¶ä¸”æµ‹è¯•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªAPPä¸Šä¼ åˆ°ä¸€ä¸ªç‰¹å®šçš„æµ‹è¯•ç³»ç»Ÿï¼Œå½“æœ‰ä»£ç æ›´æ–°çš„æ—¶å€™æˆ–è€…æ¯å¤©è®¾ç½®ä¸€ä¸ªæ—¶é—´å»ä¸æ–­çš„è·‘æµ‹è¯•ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µå°±å‘ç°å¾ˆå¤šé—®é¢˜ã€‚</p><blockquote><p>ä¸Šé¢æˆ‘ä»¬è¯´çš„å°±æ˜¯CI(Continuous Integration)æŒç»­é›†æˆ+TDD(Test Driven Development)æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚</p></blockquote><a id="more"></a><h2 id="æŒç»­é›†æˆå¸¦æ¥çš„å¥½å¤„"><a href="#æŒç»­é›†æˆå¸¦æ¥çš„å¥½å¤„" class="headerlink" title="æŒç»­é›†æˆå¸¦æ¥çš„å¥½å¤„"></a>æŒç»­é›†æˆå¸¦æ¥çš„å¥½å¤„</h2><p>æŒç»­é›†æˆå¸¦æ¥çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„</p><ol><li><p>å‡å°‘é£é™©ã€‚é€šè¿‡æ¯å¤©æ„å»ºç‰ˆæœ¬ï¼Œåœ¨å¼€å‘é˜¶æ®µå°±å¯ä»¥å‘ç°é¡¹ç›®çš„ç¼ºé™·ï¼Œæ’é™¤ä¸€äº›å› ä¸ºé¡¹ç›®è®¾ç½®çš„ä½çº§é”™è¯¯è€Œå¯¼è‡´çš„bugï¼Œç”¨åŒæ ·çš„è„šæœ¬å’Œè¿‡ç¨‹æ„å»ºå’Œæµ‹è¯•è½¯ä»¶ï¼Œæ’é™¤å› ä»£ç å¤–çš„å…¶ä»–å› ç´ ã€‚</p></li><li><p>å‡å°‘é‡å¤çš„è¿‡ç¨‹ï¼Œæé«˜æ•ˆç‡ã€‚å½“é¡¹ç›®å˜å¤§ä¹‹åï¼Œé¢‘ç¹çš„æ‰“åŒ…ä¼šå¾ˆå½±å“å¼€å‘çš„æ•ˆç‡ï¼Œä½†æ˜¯æœ‰äº†æŒç»­é›†æˆæˆ‘ä»¬ä¸ç”¨å…³å¿ƒæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œå°†é‡å¤çš„build,archive,code signäº¤ç»™æä¾›æ„å»ºæœåŠ¡çš„æœºå™¨å»åšï¼Œå°†æ—¶é—´æ”¾åœ¨æ›´æœ‰æ„ä¹‰çš„äº‹æƒ…ä¸Šé¢ã€‚</p></li><li><p>éšæ—¶å¯éƒ¨ç½²ã€‚æŒç»­é›†æˆæœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯æˆ‘ä»¬æ¯å¤©éƒ½ä¼šåšæ„å»ºç‰ˆæœ¬ï¼Œå¯ä»¥äº¤ä»˜éƒ¨ç½²ä¸Šçº¿ï¼Œå½“æˆ‘ä»¬æ— ä¼‘æ­¢çš„è®¨è®ºéœ€æ±‚è½¯ä»¶è´¨é‡æˆ–è€…å¼€å‘è¿›åº¦çš„æ—¶å€™ï¼Œå¯¹äºå®¢æˆ·æ¥è¯´ï¼Œä¸å¦‚ä¸€ä¸ªå¯å®‰è£…çš„è½¯ä»¶åŒ…æ¥å¾—å®é™…</p></li></ol><h3 id="æŒç»­é›†æˆä¹‹Jenkins"><a href="#æŒç»­é›†æˆä¹‹Jenkins" class="headerlink" title="æŒç»­é›†æˆä¹‹Jenkins"></a>æŒç»­é›†æˆä¹‹Jenkins</h3><p>CIåŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬çš„å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯è‡ªåŠ¨æ„å»ºç‰ˆæœ¬çš„æœåŠ¡ï¼Œç¬¬äºŒä¸ªæ˜¯ä»£ç ä»“åº“ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ­å»ºäº†æœåŠ¡çš„æœºå™¨ã€‚</p><blockquote><p>å¯è‡ªåŠ¨æ„å»ºç‰ˆæœ¬çš„æœåŠ¡ç›®å‰æœ‰Jenkinså’Œfastlaneã€‚<br>ä»£ç ä»“åº“ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„github,gitlabç­‰ç­‰<br>åœ¨iOSä¸­æœºå™¨å¿…é¡»æ˜¯æ­å»ºOSXç³»ç»Ÿçš„æœºå™¨ï¼Œå› ä¸ºæ„å»ºéœ€è¦ç”¨åˆ°xcodeBuildå‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”±xcodeæä¾›ï¼Œè€Œxcodeåªèƒ½å®‰è£…åœ¨OSXç³»ç»Ÿä¸‹é¢ã€‚</p></blockquote><p>ä¸‹é¢æˆ‘ä»¬è¦è¯´çš„å°±æ˜¯å¯è‡ªåŠ¨æ„å»ºç‰ˆæœ¬çš„æœåŠ¡ï¼Œ<a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins</a>ã€‚</p><p>Jenkins æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæä¾›äº†ä¸€ç§æ˜“äºä½¿ç”¨çš„æŒç»­é›†æˆç³»ç»Ÿï¼Œä½¿å¼€å‘è€…ä»ç¹æ‚çš„é›†æˆä¸­è§£è„±å‡ºæ¥ï¼Œä¸“æ³¨äºæ›´ä¸ºé‡è¦çš„ä¸šåŠ¡é€»è¾‘å®ç°ä¸Šã€‚åŒæ—¶ Jenkins èƒ½å®æ–½ç›‘æ§é›†æˆä¸­å­˜åœ¨çš„é”™è¯¯ï¼Œæä¾›è¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶å’Œæé†’åŠŸèƒ½ï¼Œè¿˜èƒ½ç”¨å›¾è¡¨çš„å½¢å¼å½¢è±¡åœ°å±•ç¤ºé¡¹ç›®æ„å»ºçš„è¶‹åŠ¿å’Œç¨³å®šæ€§ï¼Œæ„å»ºå®Œæˆä¹‹åé€šè¿‡è„šæœ¬ç›´æ¥ä¸Šä¼ åˆ°åˆ†å‘å¹³å°æˆ–è€…æµ‹è¯•å¹³å°ã€‚</p><h2 id="Jenkinsæ­å»º"><a href="#Jenkinsæ­å»º" class="headerlink" title="Jenkinsæ­å»º"></a>Jenkinsæ­å»º</h2><p>jenkinsæœ‰ä¸¤ç§å®‰è£…æ–¹å¼</p><p>ä¸€ç§æ˜¯é€šè¿‡åœ¨<a href="https://jenkins.io/download" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½pkgå®‰è£…åŒ…çš„æ–¹å¼å®‰è£…ï¼Œå›¾å½¢åŒ–çš„å®‰è£…ç•Œé¢ç›´æ¥è·Ÿç€æç¤ºå®‰è£…å°±å¥½äº†ã€‚</p><p>ç¬¬äºŒç§æ˜¯é€šè¿‡homebrewå®‰è£…ï¼Œä¸è¿‡åœ¨å®‰è£…ä¹‹å‰æˆ‘ä»¬éœ€è¦æ£€æµ‹æœ¬åœ°ç¯å¢ƒæ˜¯å¦å·²ç»å®‰è£…äº†javaï¼Œå¯ä»¥ä½¿ç”¨<code>java -version</code>æ¥æŸ¥çœ‹å½“å‰çš„javaç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…çš„javaçš„è¯å¯ä»¥åœ¨<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">è¿™é‡Œ</a>å®‰è£…javaã€‚<br>è¿˜è¦æ£€æµ‹æ˜¯å¦å·²ç»å®‰è£…äº†homebrew,æŸ¥çœ‹æœ¬æœºhomebrewç‰ˆæœ¬â€™brew -vâ€™ã€‚</p><p>å¦‚æœjavaå’Œhomebrewéƒ½å·²ç»å®‰è£…å¥½ï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£…jenkinsäº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install jenkins</span><br></pre></td></tr></table></figure><p>å½“å‡ºç°Jenkins is fully up and runningä¹‹åï¼Œè¡¨æ˜jenkinså·²ç»å®‰è£…å¥½äº†ï¼Œå¦‚æœæ²¡æœ‰è‡ªåŠ¨æ‰“å¼€<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> ï¼Œå¯ä»¥åˆ°ç½‘é¡µä¸Šé¢è‡ªè¡Œæ‰“å¼€è¯¥å¤–åœ°å€ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15337123514685.png" alt=""></p><p>ä¸Šé¢ç»™äº†ä¸€ä¸ªåœ°å€ï¼Œæç¤ºä½ å»é‚£é‡Œæ‰¾åˆ°åˆå§‹åŒ–çš„å¯†ç ã€‚æ‰“å¼€/User/Shared/Jenkins/Home/secrets/initialAdminPasswordå¤åˆ¶å‡ºå¯†ç ã€‚</p><p>æ¥ä¸‹æ¥ä¼šæç¤ºä½ å®‰è£…ä¸€äº›æ’ä»¶ï¼Œå®‰è£…é»˜è®¤çš„æ’ä»¶å³å¯ï¼Œä¸è¿‡å°±ç®—è¿™é‡Œå®‰è£…å¤±è´¥äº†ä¹Ÿæ²¡å…³ç³»ï¼Œåé¢è¿›åˆ°ä¸»ç•Œé¢è¿˜å¯ä»¥ç»§ç»­å®‰è£…ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15337131168237.png" alt=""></p><p>å®‰è£…å®Œæ’ä»¶ä¹‹åä¼šæç¤ºä½ åˆ›å»ºä¸€ä¸ªjenkinsç”¨æˆ·ã€‚<br><img src="http://pcd17v2u0.bkt.clouddn.com/15337133154570.jpg" alt=""></p><p>è¾“å…¥è¿™äº›ä¿¡æ¯ä¹‹åç‚¹å‡»save And Finishå®‰è£…çš„è¿‡ç¨‹å°±ç®—å®Œæˆäº†ã€‚æ¥ä¸‹æ¥å¯ä»¥è¿›å…¥åˆ°jenkinsä¸»ç•Œé¢äº†ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15337135245241.jpg" alt=""><br>æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸€ä¸‹é¢æ¿å·¦ä¾§çš„é€‰é¡¹ï¼Œç‚¹å‡»â€œç³»ç»Ÿç®¡ç†â€ï¼Œç„¶åæ‰¾åˆ°â€œç®¡ç†æ’ä»¶â€<br>åœ¨â€œå¯é€‰æ’ä»¶â€ä¸­é€‰ä¸­â€œGitLab Pluginâ€å’Œâ€œGitlab Hook Pluginâ€è¿™ä¸¤é¡¹ï¼Œç„¶åå®‰è£…ã€‚<br>å®‰è£…Xcodeæ’ä»¶<br>åŒå®‰è£…GitLabæ’ä»¶çš„æ­¥éª¤ä¸€æ ·ï¼Œæˆ‘ä»¬ä¾æ¬¡é€‰æ‹©ç³»ç»Ÿç®¡ç†-&gt;ç®¡ç†æ’ä»¶ï¼Œåœ¨â€œå¯é€‰æ’ä»¶â€ä¸­é€‰ä¸­â€œXcode integrationâ€å®‰è£…ï¼Œå®‰è£…å®Œè¿™ä¸ªæ’ä»¶æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ªâ€œKeychains and Provisioning Profiles Managementâ€æ’ä»¶ã€‚è¿™ä¸ªæ’ä»¶ç”¨äºæˆ‘ä»¬è®¾ç½®ç­¾åå’Œè¯ä¹¦ã€‚</p><p>å®‰è£…â€œKeychains and Provisioning Profiles Managementâ€ä¹‹åï¼Œæˆ‘ä»¬å»åˆ°ç³»ç»Ÿç®¡ç†-&gt;Keychains and Provisioning Profiles Managementè®¾ç½®ç­¾åå’Œè¯ä¹¦ã€‚</p><p><img src="http://pcd17v2u0.bkt.clouddn.com/15337147054369.jpg" alt=""></p><p>è¿™é‡Œéœ€è¦é€‰æ‹© login.keychain ï¼Œåœ¨ /Users/ç”¨æˆ·å/Library/keychains/login.keychain ç›®å½•é‡Œã€‚å¦‚æœä¸èƒ½é€šè¿‡é€‰æ‹©çš„è¯ï¼Œå¯ä»¥æŠŠlogin.keychainæ‹·è´åˆ°æ¡Œé¢ï¼Œç„¶ååœ¨é€‰æ‹©ä¸Šä¼ ã€‚<br>Code Signing Identityï¼Œå¯ä»¥æ·»åŠ å¤šé¡¹ã€‚è¿›å…¥é’¥åŒ™ä¸²ï¼Œé€‰æ‹©å¼€å‘è€…è¯ä¹¦æˆ–å‘å¸ƒè¯ä¹¦ï¼Œæ‹·è´å®Œå…¨ï¼Œç²˜è´´è‡³Jenkinsçš„Code Signing Identityé¡¹ã€‚</p><p>å½“æŠŠè¿™ä¸ªKeychainè®¾ç½®å¥½äº†ä¹‹åï¼ŒJenkinsä¼šæŠŠè¿™ä¸ªKeychainæ‹·è´åˆ°/Users/Shared/Jenkins/Library/keychainsè¿™é‡Œï¼Œ(Libraryæ˜¯éšè—æ–‡ä»¶)ã€‚Provisioning Profilesæ–‡ä»¶ä¹Ÿç›´æ¥æ‹·è´åˆ°/Users/Shared/Jenkins/Library/MobileDeviceæ–‡ä»¶ç›®å½•ä¸‹</p><p>åˆ°è¿™é‡ŒJenkinsçš„æ­å»ºå°±ç®—å®Œæˆäº†ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°†ä¼šä½¿ç”¨jenkinsåˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åæ„é€ ç‰ˆæœ¬å¹¶ä¸”ä¸Šä¼ è’²å…¬è‹±ï¼Œæœ€ç»ˆçš„ç›®çš„éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆä¸Šè¿°çš„æ“ä½œã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¯¹äºä¸€ä¸ªAPPæ¥è¯´ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬å¼€å‘æœ€æ‹…å¿ƒçš„å°±æ˜¯å‡ºbugï¼Œåªè¦æ˜¯çº¿ä¸ŠAPPå‡ºbugï¼Œå¿ƒé‡Œå°±æ…Œå¾—å¾ˆï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆä¸¥é‡çš„äº‹æƒ…ï¼Œè¿˜æœ‰å¯èƒ½è®©ç”¨æˆ·ä¸€æ°”ä¹‹ä¸‹æŠŠä½ çš„APPåˆ æ‰ï¼Œä»æ­¤å†ä¹Ÿä¸ä¼šå‡ºç°åœ¨ä»–çš„æ‰‹æœºé‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸¥æ ¼æŠŠæ§APPçš„è´¨é‡ï¼Œæˆ‘ä»¬åšåˆ°æ¯å¤©éƒ½æ„å»ºä¸€ä¸ªç‰ˆæœ¬å¹¶ä¸”æµ‹è¯•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªAPPä¸Šä¼ åˆ°ä¸€ä¸ªç‰¹å®šçš„æµ‹è¯•ç³»ç»Ÿï¼Œå½“æœ‰ä»£ç æ›´æ–°çš„æ—¶å€™æˆ–è€…æ¯å¤©è®¾ç½®ä¸€ä¸ªæ—¶é—´å»ä¸æ–­çš„è·‘æµ‹è¯•ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µå°±å‘ç°å¾ˆå¤šé—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬è¯´çš„å°±æ˜¯CI(Continuous Integration)æŒç»­é›†æˆ+TDD(Test Driven Development)æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS å¼€å‘" scheme="http://lemon2well.top/categories/iOS-%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="jenkins" scheme="http://lemon2well.top/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨é˜Ÿåˆ—å®ç°æ ˆå’Œç”¨æ ˆå®ç°é˜Ÿåˆ—</title>
    <link href="http://lemon2well.top/2018/08/03/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/%E7%94%A8%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88%E5%92%8C%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"/>
    <id>http://lemon2well.top/2018/08/03/å¸¸è§ç®—æ³•/ç”¨é˜Ÿåˆ—å®ç°æ ˆå’Œç”¨æ ˆå®ç°é˜Ÿåˆ—/</id>
    <published>2018-08-03T02:44:23.000Z</published>
    <updated>2018-08-03T02:46:05.639Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°é˜Ÿåˆ—ï¼Œæ€è·¯å’Œç”¨æ•°ç»„å®ç°é˜Ÿåˆ—ä¸€æ ·</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//ç”¨æ ˆå®ç°é˜Ÿåˆ—</span><br><span class="line">struct QueueByStack&#123;</span><br><span class="line">    </span><br><span class="line">    var Peek: Int? &#123;</span><br><span class="line">        mutating middleCaulate()</span><br><span class="line">        return rightStack?.peek</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    typealias Element = Int</span><br><span class="line">    </span><br><span class="line">    private var leftStack:IntergerStack?</span><br><span class="line">    private var rightStack:IntergerStack?</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">    leftStack = IntergerStack()</span><br><span class="line">    rightStack = IntergerStack()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var isEmpty: Bool &#123;return leftStack!.isEmpty &amp;&amp; rightStack!.isEmpty&#125;</span><br><span class="line">    var Size: Int &#123;return leftStack!.Size + rightStack!.Size&#125;</span><br><span class="line">    </span><br><span class="line">    mutating func middleCaulate()&#123;</span><br><span class="line">        if leftStack!.isEmpty &#123;</span><br><span class="line">            while !rightStack!.isEmpty&#123;</span><br><span class="line">                leftStack!.push((rightStack?.pop())!)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mutating func enQueue(_ newElement: Int) &#123;</span><br><span class="line">        rightStack?.push(newElement)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mutating func deQueue() -&gt; Int? &#123;</span><br><span class="line">        middleCaulate()</span><br><span class="line">        return leftStack?.peek</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ä¸¤ä¸ªé˜Ÿåˆ—æ¥å®ç°æ ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">struct StackByQueue &#123;</span><br><span class="line">    private var queueA : IntergerQueue?</span><br><span class="line">    private var queueB : IntergerQueue?</span><br><span class="line">    init() &#123;</span><br><span class="line">        queueA = IntergerQueue()</span><br><span class="line">        queueB = IntergerQueue()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var isEmpty: Bool&#123;</span><br><span class="line">        get &#123;</span><br><span class="line">            return queueA!.isEmpty &amp;&amp; queueB!.isEmpty</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var Size: Int &#123;</span><br><span class="line">        get &#123;</span><br><span class="line">            return queueA!.Size</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var peek: Int?&#123;</span><br><span class="line">        mutating get &#123;</span><br><span class="line">            transfer()</span><br><span class="line">            let obj = queueB?.Peek</span><br><span class="line">            swap()</span><br><span class="line">            return obj</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mutating func push(_ newElement:Int)&#123;</span><br><span class="line">        queueB?.enQueue(newElement)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mutating func pop()-&gt;Int?&#123;</span><br><span class="line">        transfer()</span><br><span class="line">        let obj = queueB?.deQueue()</span><br><span class="line">        swap()</span><br><span class="line">        return obj</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mutating func transfer() &#123;</span><br><span class="line">        if queueB?.Size != 1&#123;</span><br><span class="line">            queueA?.enQueue((queueB?.deQueue())!)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mutating func swap()&#123;</span><br><span class="line">        (queueA,queueB) = (queueB,queueA)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°é˜Ÿåˆ—ï¼Œæ€è·¯å’Œç”¨æ•°ç»„å®ç°é˜Ÿåˆ—ä¸€æ ·&lt;/p&gt;
    
    </summary>
    
      <category term="å¸¸è§ç®—æ³•" scheme="http://lemon2well.top/categories/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>swiftå®ç°æ ˆå’Œé˜Ÿåˆ—</title>
    <link href="http://lemon2well.top/2018/08/02/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/swift%E5%AE%9E%E7%8E%B0%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
    <id>http://lemon2well.top/2018/08/02/å¸¸è§ç®—æ³•/swiftå®ç°æ ˆå’Œé˜Ÿåˆ—/</id>
    <published>2018-08-02T15:58:37.000Z</published>
    <updated>2018-08-02T16:00:14.923Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨swiftä¸­å¹¶æ²¡æœ‰å†…è®¾çš„æ ˆå’Œé˜Ÿåˆ—ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡æ•°ç»„æ¥å®ç°æ ˆå’Œé˜Ÿåˆ—</p><p>æ ˆçš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">protocol Stack &#123;</span><br><span class="line">    associatedtype Element</span><br><span class="line">    //æ˜¯å¦ä¸ºç©º</span><br><span class="line">    var isEmpty: Bool&#123; get &#125;</span><br><span class="line">    //æ ˆçš„å¤§å°</span><br><span class="line">    var Size: Int&#123; get &#125;</span><br><span class="line">    //æ ˆé¡¶å…ƒç´ </span><br><span class="line">    var peek: Element? &#123; get &#125;</span><br><span class="line">    //å…¥æ ˆ</span><br><span class="line">    mutating func push(_ newElement:Element)</span><br><span class="line">    //å‡ºæ ˆ</span><br><span class="line">    mutating func pop()-&gt;Element?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct IntegerStack:Stack &#123;</span><br><span class="line">    typealias Element  = Int</span><br><span class="line">    private var stack = [Element]()</span><br><span class="line">    var isEmpty: Bool &#123;return stack.isEmpty&#125;</span><br><span class="line">    var Size: Int &#123;return stack.count&#125;</span><br><span class="line">    var peek: Int? &#123;return stack.last&#125;</span><br><span class="line">    mutating func push(_ newElement: Int) &#123;</span><br><span class="line">        self.stack.append(newElement)</span><br><span class="line">    &#125;</span><br><span class="line">    func pop() -&gt; Int? &#123;</span><br><span class="line">        return stack.last</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>é˜Ÿåˆ—çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">protocol Queue &#123;</span><br><span class="line">    associatedtype Element</span><br><span class="line">    var isEmpty: Bool &#123;get&#125;</span><br><span class="line">    var Size: Int &#123;get&#125;</span><br><span class="line">    var Peek:Element? &#123;get&#125;</span><br><span class="line">    mutating func enQueue(_ newElement:Element)</span><br><span class="line">    mutating func deQueue()-&gt;Element?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct IntergerQueue:Queue &#123;</span><br><span class="line">    typealias Element = Int</span><br><span class="line">    private var left = [Element]()</span><br><span class="line">    private var right = [Element]()</span><br><span class="line">    var isEmpty: Bool &#123;return left.isEmpty &amp;&amp; right.isEmpty&#125;</span><br><span class="line">    var Size: Int &#123;return left.count + right.count&#125;</span><br><span class="line">    var Peek: Element? &#123;return left.isEmpty ? right.first : left.last&#125;</span><br><span class="line">    mutating func enQueue(_ newElement: Int) &#123;</span><br><span class="line">       right.append(newElement)</span><br><span class="line">    &#125;</span><br><span class="line">    mutating func deQueue() -&gt; Element? &#123;</span><br><span class="line">        if left.isEmpty &#123;</span><br><span class="line">            left = right.reversed()</span><br><span class="line">            right.removeAll()</span><br><span class="line">        &#125;</span><br><span class="line">        return left.popLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨swiftä¸­å¹¶æ²¡æœ‰å†…è®¾çš„æ ˆå’Œé˜Ÿåˆ—ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡æ•°ç»„æ¥å®ç°æ ˆå’Œé˜Ÿåˆ—&lt;/p&gt;
&lt;p&gt;æ ˆçš„å®ç°ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;protocol Stack &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    associatedtype Element&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ˜¯å¦ä¸ºç©º&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var isEmpty: Bool&amp;#123; get &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ ˆçš„å¤§å°&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var Size: Int&amp;#123; get &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //æ ˆé¡¶å…ƒç´ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var peek: Element? &amp;#123; get &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å…¥æ ˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mutating func push(_ newElement:Element)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    //å‡ºæ ˆ&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mutating func pop()-&amp;gt;Element?&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct IntegerStack:Stack &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    typealias Element  = Int&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    private var stack = [Element]()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var isEmpty: Bool &amp;#123;return stack.isEmpty&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var Size: Int &amp;#123;return stack.count&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var peek: Int? &amp;#123;return stack.last&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mutating func push(_ newElement: Int) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.stack.append(newElement)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    func pop() -&amp;gt; Int? &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return stack.last&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="å¸¸è§ç®—æ³•" scheme="http://lemon2well.top/categories/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æ ˆ" scheme="http://lemon2well.top/tags/%E6%A0%88/"/>
    
      <category term="é˜Ÿåˆ—" scheme="http://lemon2well.top/tags/%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
</feed>
